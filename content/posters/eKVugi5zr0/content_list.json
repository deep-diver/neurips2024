[{"type": "text", "text": "RoME: A Robust Mixed-Effects Bandit Algorithm for Optimizing Mobile Health Interventions ", "text_level": 1, "page_idx": 0}, {"type": "text", "text": "Easton Huch\u2217 ", "text_level": 1, "page_idx": 0}, {"type": "text", "text": "Department of Statistics University of Michigan Ann Arbor, MI, USA ekhuch@umich.edu ", "page_idx": 0}, {"type": "text", "text": "Jieru Shi\u2217 ", "text_level": 1, "page_idx": 0}, {"type": "text", "text": "Statistical Laboratory, DPMMS University of Cambridge Cambridge, England, UK js2882@cam.ac.uk ", "page_idx": 0}, {"type": "text", "text": "Madeline R. Abbott ", "text_level": 1, "page_idx": 0}, {"type": "text", "text": "Department of Biostatistics University of Michigan Ann Arbor, MI, USA mrabbott@umich.edu ", "page_idx": 0}, {"type": "text", "text": "Jessica R. Golbus ", "text_level": 1, "page_idx": 0}, {"type": "text", "text": "Michigan Medicine Ann Arbor, MI, USA jgolbus@umich.edu ", "page_idx": 0}, {"type": "text", "text": "Alexander Moreno ", "page_idx": 0}, {"type": "text", "text": "Independent Researcher\u2020 alexander.f.moreno@gmail.com ", "page_idx": 0}, {"type": "text", "text": "Walter H. Dempsey ", "text_level": 1, "page_idx": 0}, {"type": "text", "text": "Department of Biostatistics University of Michigan Ann Arbor, MI, USA wdem@umich.edu ", "page_idx": 0}, {"type": "text", "text": "Abstract ", "text_level": 1, "page_idx": 0}, {"type": "text", "text": "Mobile health leverages personalized and contextually tailored interventions optimized through bandit and reinforcement learning algorithms. In practice, however, challenges such as participant heterogeneity, nonstationarity, and nonlinear relationships hinder algorithm performance. We propose RoME, a Robust Mixed-Effects contextual bandit algorithm that simultaneously addresses these challenges via (1) modeling the differential reward with user- and time-specific random effects, (2) network cohesion penalties, and (3) debiased machine learning for flexible estimation of baseline rewards. We establish a high-probability regret bound that depends solely on the dimension of the differential-reward model, enabling us to achieve robust regret bounds even when the baseline reward is highly complex. We demonstrate the superior performance of the RoME algorithm in a simulation and two off-policy evaluation studies. ", "page_idx": 0}, {"type": "text", "text": "1 Introduction ", "text_level": 1, "page_idx": 0}, {"type": "text", "text": "Mobile health (mHealth) uses smart devices to deliver digital notification interventions to users. These notifications nudge users toward healthier attitudes and behaviors. Because mHealth applications can monitor and react to users and their environment, they offer the promise of personalized, contextually tailored interventions. In practice, achieving this promise requires bandit or reinforcement learning (RL) algorithms that can accurately learn mHealth intervention effects, including how they vary by user, over time, and based on context. In this regard, contextual bandit algorithms are appealing due to strong empirical performance in other settings, their ability to customize intervention decisions based on changing contexts, and their simplicity and extensibility relative to full RL algorithms. ", "page_idx": 0}, {"type": "text", "text": "One unique aspect of mHealth (Greenewald et al., 2017) is the presence of a \u201cdo-nothing\u201d action in which the mHealth app does not intervene. As mHealth rewards typically involve human decision making (e.g., whether the user chooses to exercise), the distribution of the the corresponding baseline reward\u2014the reward under the do-nothing action\u2014typically evolves in a complex, nonstationary fashion as time progresses and contexts change. In contrast, the treatment effects\u2014the difference in the expected value of the reward relative to the do-nothing action\u2014tend to be much more stable and can be adequately modeled using classical stationary models, such as linear models (Robinson, 1988). ", "page_idx": 0}, {"type": "text", "text": "", "page_idx": 1}, {"type": "text", "text": "Greenewald et al. (2017) introduced an action-centered contextual bandit algorithm with sublinear regret in this setting by replacing the observed reward, $R_{t}$ , with a \u201cpseudo-reward,\u201d ${\\tilde{R}}_{t}$ , where $t$ indexes the time points. Denoting the binary action as $A_{t}\\in\\{0,1\\}$ with $A_{t}=0$ corresponding to the do-nothing action, the pseudo-reward for $A_{t}$ can be written as ", "page_idx": 1}, {"type": "equation", "text": "$$\n\\tilde{R}_{t}:=(A_{t}-\\pi_{t})R_{t}=\\pi_{t}(1-\\pi_{t})R_{t}\\left(\\frac{A_{t}}{\\pi_{t}}-\\frac{1-A_{t}}{1-\\pi_{t}}\\right),\n$$", "text_format": "latex", "page_idx": 1}, {"type": "text", "text": "where $\\pi_{t}$ is the (known) probability of treatment assignment from the Thompson-sampling algorithm. We took an additional step to derive an equivalent expression (second equality), which reveals that ${\\tilde{R}}_{t}$ is proportional to an inverse-probability-weighted (IPW) estimator. Crucially, ${\\tilde{R}}_{t}$ provides an unbiased estimate of the treatment effect regardless of the nonstationarity of the baseline outcome. ", "page_idx": 1}, {"type": "text", "text": "Although Greenewald et al. (2017)\u2019s analysis shows sublinear regret in nonstationary settings, our simulations show that other methods can achieve lower regret over finite time horizons. The reasons include its failure to address treatment effect heterogeneity, pool information across users, and model the baseline outcome, which leads to highly variable pseudo-rewards and slow learning. We propose to generalize their method to overcome these limitations by ", "page_idx": 1}, {"type": "text", "text": "1. imposing hierarchical structure in the treatment effect model with shared fixed effects and random effects for users and time (i.e., a mixed-effects model),   \n2. efficiently pooling across users and time via nearest-neighbor regularization (NNR), and   \n3. denoising rewards with flexible supervised learning models via the debiased machine learning (DML) framework of Chernozhukov et al. (2018). ", "page_idx": 1}, {"type": "text", "text": "We name the resulting method RoME to highlight that it is a Robust Mixed-Effects algorithm. The primary contributions are (a) the RoME method, (b) a high-probability regret bound that relies solely on the dimension of the differential-reward model, which is typically much smaller than that of the complex baseline reward model, and (c) empirical comparisons demonstrating the superior performance of RoME in simulation and two real-world mHealth studies. ", "page_idx": 1}, {"type": "text", "text": "2 Related Work ", "text_level": 1, "page_idx": 1}, {"type": "text", "text": "Related work in statistics considers the estimation of treatment effects with longitudinal data. Cho et al. (2017) present a semiparametric random-effects method for estimating subject-specific static treatment effects. Qian et al. (2020) discusses the statistical challenges of applying linear mixedeffects models to mHealth data and shows that the resulting estimates may lack a causal interpretation. ", "page_idx": 1}, {"type": "text", "text": "In the bandit literature, several works address a growing pool of users. Ma et al. (2011) introduced NNR in recommender systems using homophily principles\u2014similar nodes are more likely to be connected than dissimilar ones (McPherson et al., 2001). Cesa-Bianchi et al. (2013) adapted NNR for bandit settings, improving regret. Subsequent improvements focused on scalability and algorithm modifications for stronger regret bounds (Vaswani et al., 2017; Yang et al., 2020). ", "page_idx": 1}, {"type": "text", "text": "Other bandit approaches explicitly address the longitudinal setting in which treatment effects may evolve over time. The intelligentpooling method of Tomkins et al. (2021) employs a Gaussian linear mixed-effects model with both user- and time-specific random effects. Hu et al. (2021) provides a related approach based on generalized linear mixed effects models. Unlike our approach, both methods require the (generalized) linear conditional mean model to be correctly specified. ", "page_idx": 1}, {"type": "text", "text": "Aouali et al. (2023) and Lee et al. (2024) also propose bandit algorithms with mixed effects; methodologically, however, their use of mixed effects is dissimilar from that of the works above and our own. Aouali et al. (2023) employs random effects to relate treatments within categories (e.g., movies within a genre), and Lee et al. (2024) considers the case in which a single, discrete action leads to a multivariate reward that is affected by a user-specific random effect. In contrast, the other approaches listed above (and our own) do not assume any relationships among the actions, and they associate each discrete action with a single scalar-valued reward in an iterative fashion. ", "page_idx": 1}, {"type": "text", "text": "Other work develops semiparametric methods that lead to sublinear regret without requiring correct specification of the conditional mean reward. Krishnamurthy et al. (2018) and Kim & Paik (2019) propose improvements to the approach of Greenewald et al. (2017) that lead to stronger regret bounds. Kim et al. (2021, 2023) develop a doubly robust approach for both linear and generalized linear contextual bandits. However, in contrast to Tomkins et al. (2021), Hu et al. (2021), and our approach, these semiparametric methods are not immediately applicable to longitudinal settings. ", "page_idx": 2}, {"type": "text", "text": "3 Setting ", "text_level": 1, "page_idx": 2}, {"type": "text", "text": "3.1 Problem Statement ", "text_level": 1, "page_idx": 2}, {"type": "text", "text": "Recognizing the connection between mHealth policy learning and contextual bandit methods, we now consider a contextual multi-armed bandit environment with one control arm (the do-nothing action) denoted by $a=0$ and $q$ non-baseline arms corresponding to different actions or treatments. Individuals are indexed by $i\\;=\\;1,2,\\ldots$ and decision points are indexed by $t\\,=\\,1,2,\\ldots$ . For each individual $i$ at time $t$ , the algorithm observes a context vector $S_{i,t}\\,\\in\\,S$ , chooses an action $A_{i,t}\\in[q]:=\\{0,\\dots,q\\}$ , and receives a reward $R_{i,t}\\,\\in\\,\\mathbb{R}$ . The differential reward describes the difference in expected rewards between choosing a non-baseline arm and the control arm, defined as $\\Delta_{i,t}(s,a):=\\mathbb{E}\\left[R_{i,t}|S_{i,t}=s,A_{i,t}=a\\right]-\\mathbb{E}\\left[R_{i,t}^{\\overline{{i}}}|S_{i,t}=s,A_{i,t}=0\\right]\\!,$ ", "page_idx": 2}, {"type": "text", "text": "We denote the observation history up to time $t$ for individual $i$ as $\\mathcal{H}_{i,t}:=(S_{i1},A_{i1},R_{i1},\\ldots,S_{i t})$ . Actions are selected according to stochastic policies, $\\pi_{i,t}:\\mathcal{H}_{i,t}\\times\\mathcal{S}\\to\\mathcal{P}([q])$ . We use $\\pi_{i,t}(a|s)$ to denote the probability of action $a\\in[q]$ given current context $s\\in S$ for a fixed (implicit) history. As in Greenewald et al. (2017), we assume that the probability of the control action is bounded: ", "page_idx": 2}, {"type": "text", "text": "Assumption 1. There exists $0<\\pi_{\\operatorname*{min}},\\pi_{\\operatorname*{max}}<1\\;s.t\\;\\pi_{\\operatorname*{min}}<\\pi_{i,t}(0|a),1-\\pi_{i,t}(0|a)<\\pi_{\\operatorname*{max}}\\forall i,t,a.$ ", "page_idx": 2}, {"type": "text", "text": "As noted in Greenewald et al. (2017), this assignment probability controls the number of messages that participants receive. It ensures that participants receive sufficient messages that they do not disengage, but not so many that they are overwhelmed or fatigued. We now define ", "page_idx": 2}, {"type": "equation", "text": "$$\n\\begin{array}{r}{\\boldsymbol{A}^{*}=\\underset{o\\in[q]}{\\mathrm{argmax}}\\;\\mathbb{E}\\left[R_{i,t}|S_{i,t},A_{i,t}=a\\right],\\quad\\bar{\\boldsymbol{A}}^{*}=\\underset{o\\in[q]\\backslash\\{0\\}}{\\mathrm{argmax}}\\;\\mathbb{E}\\left[R_{i,t}|S_{i,t},A_{i,t}=a\\right],}\\end{array}\n$$", "text_format": "latex", "page_idx": 2}, {"type": "text", "text": "the optimal treatment arm (including control) and the alternative arm, respectively. Respecting the restrictions in Assumption 1, we can now express the optimal policy, $\\pi_{i,t}^{*}$ , in two cases: ", "page_idx": 2}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{\\pi_{i,t}^{*}(0|S_{i,t})=\\pi_{\\operatorname*{max}}\\mathrm{~and~}\\pi_{i,t}^{*}(\\bar{A}^{*}|S_{i,t})=1-\\pi_{\\operatorname*{max}}.}\\\\ &{\\pi_{i,t}^{*}(A^{*}|S_{i,t})=1-\\pi_{\\operatorname*{min}}\\mathrm{~and~}\\pi_{i,t}^{*}(0|S_{i,t})=\\pi_{\\operatorname*{min}}.}\\end{array}\n$$", "text_format": "latex", "page_idx": 2}, {"type": "text", "text": "These cases represent the appropriate boundary condition given the optimal action; we maximize the probability of the do-nothing action if $A^{\\star}=0$ and minimize it if $A^{\\star}\\neq0$ , selecting the next-best action with the highest possible probability. In Section 5.2, we define regret relative to this optimal policy, $\\pi_{i,t}^{*}$ . ", "page_idx": 2}, {"type": "text", "text": "Lastly, we consider a study design that progresses in stages, where individuals enter the study sequentially (Friedman et al., 2010), as illustrated in Figure 1. Staged recruitment serves two purposes in our analysis: it increases the fidelity of the theoretical setting by mimicking real-world recruitment strategies, and it allows us to estimate changes in the differential reward over time. Concretely, we first observe individual $i=1$ at time $t=1$ . Then we observe individuals $i=(1,2)$ at times $t\\,=\\,(2,1)$ . Subsequent stages $k$ involve individuals $i\\,\\leq\\,k$ , each having had $k\\mathrm{~-~}i+1$ observations, respectively. Define $\\mathcal{O}_{k}=\\{(i,t):i\\leq k\\,\\&\\,t\\leq k+1-i\\}$ as the set of all observations in stage $k$ . A notation summary is presented in Appendix $\\boldsymbol{\\mathrm F}$ . ", "page_idx": 2}, {"type": "text", "text": "3.2 Doubly Robust Differential Reward ", "text_level": 1, "page_idx": 2}, {"type": "text", "text": "Following Greenewald et al. (2017), we assume that the differential reward is linear: ", "page_idx": 2}, {"type": "equation", "text": "$$\n\\Delta_{i,t}(s,a)=x(s,a)^{\\top}\\theta_{i,t},\n$$", "text_format": "latex", "page_idx": 2}, {"type": "text", "text": "where $\\boldsymbol{x}(s,a)\\in\\mathbb{R}^{p\\times1}$ is a feature vector depending on the context and action. We allow the baseline reward, $g_{t}(s)$ , to be a nonlinear and nonstationary function of context and time. Combined, these two ", "page_idx": 2}, {"type": "image", "img_path": "eKVugi5zr0/tmp/17987ae26b6ed422995fc7ae5620c88fb1198a825cdeeea8807341ac08f4aef1.jpg", "img_caption": ["Figure 1: Illustration of the staged recruitment scheme. At each recruitment stage (each time point), a new participant is recruited and observed. At the same time, all participants who were recruited prior to the current stage are also observed again. Observations are not collected from participants who have yet to be recruited. For simplicity, we assume one participant is recruited at each stage. "], "img_footnote": [], "page_idx": 3}, {"type": "text", "text": "assumptions imply a partially linear model for the conditional mean reward: ", "page_idx": 3}, {"type": "equation", "text": "$$\n\\mathbb{E}\\left[R_{i,t}|S_{i,t}=s,A_{i,t}=a\\right]=x(s,a)^{\\top}\\theta_{i,t}\\delta_{a>0}+g_{t}(s),\n$$", "text_format": "latex", "page_idx": 3}, {"type": "text", "text": "where $\\delta_{a>0}$ is an indicator of a non-baseline action. By incorporating both the linear predictor $x(s,a)^{\\top}\\theta_{i,t}\\delta_{a>0}$ and the nonlinear baseline $g_{t}(s)$ , we can maintain interpretability of the action effects while also allowing flexibility in specifying the observed rewards. The individual rewards are then realized according to the model ", "page_idx": 3}, {"type": "equation", "text": "$$\nR_{i,t}=x(s,a)^{\\top}\\theta_{i,t}\\delta_{a>0}+g_{t}(s)+\\epsilon_{i,t},\n$$", "text_format": "latex", "page_idx": 3}, {"type": "text", "text": "where we make the following standard assumption (Abeille & Lazaric, 2017) regarding $\\epsilon_{i,t}$ : ", "page_idx": 3}, {"type": "text", "text": "Assumption 2. $\\epsilon_{i,t}$ is conditionally mean zero (i.e., $\\mathbb{E}[\\epsilon_{i,t}|\\mathcal{H}_{i,t}]=0,$ ) and sub-Gaussian with variance $\\begin{array}{r}{\\sigma^{2}\\colon\\mathbb{E}[\\exp(\\eta\\epsilon_{i,t})|\\mathcal{H}_{i,t}]\\le\\exp(\\eta^{2}\\sigma^{2}/2),}\\end{array}$ for $\\eta>0$ . ", "page_idx": 3}, {"type": "text", "text": "Assumption 2 ensures that large errors are sufficiently rare and that ${\\tilde{R}}_{t}$ is proportional to an unbiased estimate of $\\Delta_{i,t}(s,a)$ . However, ${\\tilde{R}}_{t}$ suffers from high variance, which leads to suboptimal performance in practice. Our proposed algorithm RoME, however, relies on an improved estimator, $\\tilde{R}_{i,t}^{f}(s,\\bar{a})$ , that is also unbiased but achieves lower variance by denoising the rewards according to a working model, $f_{i,t}(s,a)$ , for the conditional mean $r_{i,t}(s,a):=\\mathbb{E}\\left[R_{i,t}|S_{i,t}=s,A_{i,t}=a\\right]$ : ", "page_idx": 3}, {"type": "equation", "text": "$$\n\\tilde{R}_{i,t}^{f}(s,\\bar{a}):=\\underbrace{f_{i,t}(s,\\bar{a})-f_{i,t}(s,0)}_{\\substack{\\mathrm{~}}}+\\frac{\\{R_{i,t}-f_{i,t}(s,A_{i,t})\\}}{\\delta_{A_{i,t}=\\bar{a}}-\\pi_{i,t}(0|s)},\n$$", "text_format": "latex", "page_idx": 3}, {"type": "text", "text": "where $\\bar{a}$ is a preselected non-baseline arm; i.e., we condition on $A_{i,t}\\in\\{0,\\bar{a}\\}$ . The first component is a model-based prediction of the differential reward, and the second component is a debiasing term that uses IPW to correct for potential errors in the specification of $f$ . This improved estimator is a form of pseudo-outcome, a common technique in the causal inference literature (Bang $\\&$ Robins, 2005; Kennedy, 2023; Nie & Wager, 2021). We refer to it as a Doubly Robust Differential Reward because it produces an unbiased estimate of $\\Delta_{i,t}(s,a)$ as long as either $\\pi_{i,t}$ or $f_{i,t}$ is correctly specified (see proof in Appendix E.1); though, in practice, the benefti stems from (a) the robustness to misspecification of $f$ (because $\\pi_{i,t}$ is known) and (b) the variance reduction introduced by denoising the outcomes. Lemma 5 and Remark 2 in Appendix E.2 provide a proof and discussion of the variance reduction. In the following, we abbreviate $\\bar{\\tilde{R}}_{i,t}^{f}(s,a)$ as $\\tilde{R}_{i,t}^{f}$ , with the context and action implied. ", "page_idx": 3}, {"type": "text", "text": "4 Algorithm Components ", "text_level": 1, "page_idx": 3}, {"type": "text", "text": "We now construct $\\tilde{R}_{i,t}^{f}$ , introduce the weighted least-squares loss function used by RoME to estimate parameters, and use nearest-neighbor regularization to pool information across users. ", "page_idx": 3}, {"type": "text", "text": "4.1 Debiased Machine Learning ", "text_level": 1, "page_idx": 4}, {"type": "text", "text": "Twoh iccohn srterquucit $\\tilde{R}_{i,t}^{f}$ h, rweee  fmti aai nw coorknidnitgi omnos:d e(la $f_{i,t}$ efyorm tahne  ocrotnhdoitgioonnaalli tmy,e awnh riechw amrda kveias  tthhee  DpsMeuLd for-aomuetcwoomrke, $\\tilde{R}_{i,t}^{f}$ robust to misspecification of $f_{i,t}$ , (b) sufficiently fast convergence of the working conditional mean model $f_{i,t}$ , and (c) independence of $f_{i,t}$ and the observed results. (a) is ensured by the structure of the doubly robust differential reward. (b) requires us to introduce the following assumption, which states that the mean squared error (MSE) of the working conditional mean is asymptotically smaller than the inverse square root of the number of stages: ", "page_idx": 4}, {"type": "text", "text": "Assumption 3. The working model, $f_{i,t}$ , satisfies $\\begin{array}{r l}{\\mathbb{E}_{p(s,\\bar{a})}\\left[\\{r_{i,t}(s,\\bar{a})-f_{i,t}(s,\\bar{a})\\}^{2}\\right]}&{{}=}\\end{array}$ $o_{P}(k^{-1/2})$ and $\\mathbb{E}_{p(s)}\\left[\\{r_{i,t}(s,0)-f_{i,t}(s,0)\\}^{2}\\right]=o_{P}(k^{-1/2})$ . Further, $|f_{i,t}|\\leq2M$ . ", "page_idx": 4}, {"type": "text", "text": "Examples of supervised learning methods that converge at this rate (or faster) include parametric models of fixed dimension, local mean smoothers with small dimension (Wasserman, 2006, Chapter 5), and random forests and feedforward neural networks under certain regularity conditions (Biau, 2012; Farrell et al., 2021). Assumption 3 guarantees that RoME achieves better asymptotic variance than action-centered (AC) bandits Greenewald et al. (2017), resulting in the tighter regret bound in Section 5.2. Because our differential reward in (4) is robust to misspecification of $f_{i,t}$ , our regret bound can be adapted to settings in which Assumption 3 does not hold, provided $f_{i,t}$ converges to a bounded function at the rate specified in Assumption 3; this setting would result in a weaker bound of the same asymptotic order. The final requirement of independence, (c), can be accomplished via sample-splitting techniques. Below, we present two such options. ", "page_idx": 4}, {"type": "text", "text": "Option 1: The first option exploits the fact that outcomes across different users are independent. Consequently, we can perform sample splitting as follows. Step 1: Randomly assign each user $i$ to one of $J$ folds. Let $I_{j}$ denote the set containing user indexes for the $j$ -th fold and let $I_{j}^{\\complement}$ denote its complement. Step 2: For each fold, use a supervised learning algorithm to estimate the working model for $r_{i,t}(s,a)$ denoted $\\hat{f}_{i,t}^{(j)}(s,a)$ using $I_{j}^{\\complement}$ . Step 3: Construct the pseudo-outcomes using (4). ", "page_idx": 4}, {"type": "text", "text": "Option 2: Because we do not expect an adversarial environment in mHealth, we may be willing to assume that the errors, $\\epsilon_{i,t}$ , are independent across time. In this case, we can adapt the procedure given above by randomly assigning data to folds at the level of $(i,t)$ . In this case, $I_{j}$ , contains the $(i,t)$ pairs assigned to fold $j$ . This option is more powerful than option 1 in that it enables us to learn heterogeneity across users in the nuisance function, $f_{i,t}$ , leading to greater variance reduction. ", "page_idx": 4}, {"type": "text", "text": "Lastly, we note two strategies that can reduce the computational demands of sample splitting. The first is to employ estimators that satisfy a leave-one-out stability condition, such as bagged estimators that use subsampling (Chen et al., 2022); these estimators eliminate the need to perform sample splitting. The second is to fit $f_{i,t}$ in an online fashion. ", "page_idx": 4}, {"type": "text", "text": "4.2 Estimation via Weighted Least Squares ", "text_level": 1, "page_idx": 4}, {"type": "text", "text": "Having formed $\\tilde{R}_{i,t}^{f}(s,\\bar{a})$ , we now explain how to estimate the parameters, $\\theta_{i,t}\\in\\mathbb{R}^{p}$ , determining the differential reward, $\\Delta_{i,t}(s,a)$ . We assume that $\\theta_{i,t}$ consists of three components: ", "page_idx": 4}, {"type": "text", "text": "Assumption 4. $\\theta_{i,t}=\\theta^{s h a r e d}+\\theta_{i}^{u s e r}+\\theta_{t}^{t i m e}$ for all $i,t$ . ", "page_idx": 4}, {"type": "text", "text": "The parameter $\\theta^{\\mathrm{shared}}$ is a fixed effect shared across all $i,t$ . In contrast, $\\theta_{i}^{\\mathrm{user}}$ and $\\theta_{t}^{\\mathrm{time}}$ are random ecfofleucmtsn s pveeccitfoirc, $\\theta$ ,  aa sg $\\mathrm{vec}(\\theta^{\\mathrm{shared}},\\theta_{1}^{\\mathrm{user}},\\cdot\\cdot\\cdot,\\theta_{K}^{\\mathrm{user}},\\theta_{1}^{\\mathrm{time}},\\cdot\\cdot\\cdot,\\theta_{K}^{\\mathrm{time}})$ , plwahcee rteh $K$ ips atrhaem teottearls  ninu am bsienr golef stages. We then form a corresponding feature vector, $\\phi_{i,t}\\bar{\\mathbf{\\xi}}=\\mathbf{\\xi}\\phi(x_{i,t})$ , where $\\phi$ inserts $x_{i,t}$ into the positions corresponding to $\\theta^{\\mathrm{shared}}$ , $\\theta_{i}^{\\mathrm{user}}$ , and $\\theta_{t}^{\\mathrm{time}}$ with zeros in all other locations; i.e., letting $p:=\\dim(x_{i,t})$ , the feature vector $\\phi(x_{i,t})\\in\\mathbb{R}^{(2K+1)p}$ is defined as follows: ", "page_idx": 4}, {"type": "equation", "text": "$$\n\\phi(\\boldsymbol{x}_{i,t})=[x_{i,t}^{\\top},\\,0_{(i-1)p}^{\\top},\\,x_{i,t}^{\\top},\\,0_{(K-i+t-1)p}^{\\top},\\,x_{i,t}^{\\top},\\,0_{(K-t)p}^{\\top}]^{\\top}.\n$$", "text_format": "latex", "page_idx": 4}, {"type": "text", "text": "We could then estimate $\\theta_{i,t}$ via a weighted least squares (WLS) regression that minimizes the following objective function: ", "page_idx": 4}, {"type": "equation", "text": "$$\n\\ell_{\\mathrm{WLS}}(\\boldsymbol{\\theta})=\\sum_{i=1}^{n}\\sum_{t=1}^{K-i+1}\\tilde{\\sigma}_{i,t}^{2}\\big(\\tilde{R}_{i,t}^{f}-\\phi_{i,t}^{\\top}\\theta\\big)^{2},\n$$", "text_format": "latex", "page_idx": 4}, {"type": "text", "text": "where $\\tilde{\\sigma}_{i,t}^{2}\\,=\\,\\pi_{i,t}(0|S_{i,t})\\cdot(1-\\pi_{i,t}(0|S_{i,t}))$ . However, $\\ell_{\\mathrm{WLS}}(\\theta)$ is over-parameterized and does not take advantage of available network information. The next section modifies $\\ell_{\\mathrm{WLS}}(\\theta)$ by adding regularization, producing the final loss function used in RoME. ", "page_idx": 5}, {"type": "text", "text": "4.3 Nearest-Neighbor Regularization ", "text_level": 1, "page_idx": 5}, {"type": "text", "text": "We assume access to network information relating neighboring users and time points. These networks are defined by graphs $G_{\\mathrm{user}}\\,=\\,(V_{\\mathrm{user}},E_{\\mathrm{user}})$ and $G_{\\mathrm{time}}^{\\bar{}}\\,=\\,(\\bar{V}_{\\mathrm{time}},E_{\\mathrm{time}})$ , where $V$ denotes vertices and $E$ , edges. In practice, these networks can be formed via known clusters (e.g., shared schools, companies, geographic locations) or similar covariates. In the case of $G_{\\mathrm{time}}$ , a reasonable choice is to construct a graph of neighboring sequential time points; i.e., $t=1\\leftrightarrow t=2\\leftrightarrow t=3\\dots.$ We assume the following bounds on the random effects: ", "page_idx": 5}, {"type": "text", "text": "Assumption 5. There exists $D_{u s e r},D_{t i m e},B_{u s e r},B_{t i m e},B_{s h a r e d}\\in\\mathbb{R}^{+}$ such that $\\lVert{\\boldsymbol{\\theta}}_{i}^{u s e r}\\!-\\!{\\boldsymbol{\\theta}}_{j}^{u s e r}\\rVert_{2}^{2}\\leq D_{u s e r},$ $\\lVert\\theta_{i}^{t i m e}-\\theta_{j}^{t i m e}\\rVert_{2}^{2}\\leq D_{t i m e},$ , $\\lVert{\\boldsymbol{\\theta}}_{i}^{u s e r}\\rVert\\leq B_{u s e r},$ and $\\lVert\\theta_{i}^{t i m e}\\rVert\\leq B_{t i m e}$ and $\\lVert\\theta^{s h a r e d}\\rVert\\leq B_{s h a r e d}$ for all $i,j$ . ", "page_idx": 5}, {"type": "text", "text": "The assumption 5 suggests that we may be able to improve our estimates of $\\theta$ by regularizing neighboring values of $\\theta_{i}^{\\mathrm{user}}$ and $\\theta_{i}^{\\mathrm{time}}$ toward each other. This can be accomplished by using an $L^{\\overline{{2}}}$ Laplacian penalty. We illustrate the idea using $G_{\\mathrm{user}}$ ; the application to $G_{\\mathrm{time}}$ is similar. ", "page_idx": 5}, {"type": "text", "text": "First, we form the incidence matrix, $Q\\in\\mathbb{R}^{K\\times K}$ , with the entry $Q_{v,e}$ corresponding to the $v$ -th vertex (user) and the $e$ -th edge. Denote the vertices of $e$ as $v_{i}$ and $v_{j}$ with $i>j.\\,Q_{v,e}$ is then equal to 1 if $v=v_{i}$ , $^-1$ if $v=v_{j}$ , and 0 otherwise. The Laplacian matrix is then defined as $L=Q Q^{\\top}$ . Similar to Yang et al. (2020), we can then form a network cohesion penalty across users as follows: ", "page_idx": 5}, {"type": "equation", "text": "$$\n\\mathrm{tr}(\\Theta_{\\mathrm{user}}^{\\top}L_{\\mathrm{user}}\\Theta_{\\mathrm{user}})=\\sum_{(i,j)\\in E_{\\mathrm{user}}}\\|\\theta_{i}^{\\mathrm{user}}-\\theta_{j}^{\\mathrm{user}}\\|_{2}^{2},\n$$", "text_format": "latex", "page_idx": 5}, {"type": "text", "text": "iws hsermea $\\Theta_{\\mathrm{user}}:=(\\theta_{1}^{\\mathrm{user}},\\dots,\\theta_{K}^{\\mathrm{user}})^{\\top}\\in\\mathbb{R}^{K\\times p}$ r  acnodn $L_{\\mathrm{user}}$ e ids  tuhsee rLs.a plWacei aenm mplaotryi xa  fsohr auresedr sr.e gTuhlea rpizeantailotny $\\theta_{i}^{\\mathrm{user}}$ $\\theta_{j}^{\\mathrm{user}}$   \nhyperparameter $\\lambda$ , for $G_{\\mathrm{user}}$ and $G_{\\mathrm{time}}$ , and include a standard $L^{2}$ penalty on $\\theta$ with hyperparameter   \n$\\gamma$ . The full penalization matrix $V_{0}\\in\\mathbb{R}^{(2K+1)p\\times(2K+1)p}$ is ", "page_idx": 5}, {"type": "equation", "text": "$$\nV_{0}=\\mathrm{diag}(\\gamma I_{p},\\lambda L_{\\otimes}^{\\mathrm{user}}+\\gamma I_{K p},\\lambda L_{\\otimes}^{\\mathrm{time}}+\\gamma I_{K p}),\n$$", "text_format": "latex", "page_idx": 5}, {"type": "text", "text": "where $L_{\\otimes}^{\\mathrm{user}}:=L_{\\mathrm{user}}\\otimes I_{p}$ , the Kronecker product of $L_{\\mathrm{user}}$ with $I_{p}$ . We then adapt $\\ell_{\\mathrm{WLS}}(\\theta)$ to include a corresponding penalty term: ", "page_idx": 5}, {"type": "equation", "text": "$$\n\\ell(\\theta)=\\sum_{i=1}^{n}\\sum_{t=1}^{K-i+1}\\tilde{\\sigma}_{i,t}^{2}\\big(\\tilde{R}_{i,t}^{f}-\\phi_{i,t}^{\\top}\\theta\\big)^{2}+\\theta^{\\top}V_{0}\\theta.\n$$", "text_format": "latex", "page_idx": 5}, {"type": "text", "text": "In Section 5, we show that (8) leads to a Thompson sampling algorithm for action selection. ", "page_idx": 5}, {"type": "text", "text": "5 Thompson Sampling Algorithm ", "text_level": 1, "page_idx": 5}, {"type": "text", "text": "We now describe the Thompson sampling procedure and provide a high-probability regret bound. ", "page_idx": 5}, {"type": "text", "text": "5.1 Algorithm Description ", "text_level": 1, "page_idx": 5}, {"type": "text", "text": "The minimizer of the weighted regularized least squares loss in (8) can be expressed as ${\\hat{\\theta}}=V^{-1}b$ , where ", "page_idx": 5}, {"type": "equation", "text": "$$\nV=V_{0}+\\sum_{i=1}^{n}\\sum_{t=1}^{K-i+1}\\tilde{\\sigma}_{i,t}^{2}\\phi_{i,t}\\phi_{i,t}^{\\top},\\quad b=\\sum_{i=1}^{n}\\sum_{t=1}^{K-i+1}\\tilde{R}_{i,t}^{f}\\tilde{\\sigma}_{i,t}^{2}\\phi_{i,t}.\n$$", "text_format": "latex", "page_idx": 5}, {"type": "text", "text": "In analogy to Bayesian linear regression, the penalized and weighted Gram matrix, $V$ , plays the role of a (scaled) posterior precision matrix under a multivariate Gaussian prior for $\\theta$ . This motivates an algorithm in which we randomly perturb the point estimate, $\\hat{\\theta}$ , scaling by an inverse square-root matrix, $V^{-1/2}$ , times a mean-zero random deviate, $\\eta$ . The perturbed estimate, $\\tilde{\\theta}$ , can be written as $\\tilde{\\theta}=\\hat{\\theta}+\\beta(\\delta)V^{-1/2}\\eta$ , where letting $W>0$ be the max number of neighbors a time point or user has, $\\beta(\\delta)$ is defined as ", "page_idx": 5}, {"type": "text", "text": "", "page_idx": 6}, {"type": "equation", "text": "$$\n\\begin{array}{l}{\\displaystyle\\beta(\\delta)=v\\left[2\\log\\left(\\frac{\\operatorname*{det}(V)^{1/2}}{\\operatorname*{det}(V_{0})^{1/2}\\delta/2}\\right)\\right]^{1/2}+B,}\\\\ {\\displaystyle B=\\sqrt\\gamma B_{\\mathrm{shared}}+\\sqrt{\\lambda W K}(\\sqrt{D_{\\mathrm{user}}}+\\sqrt{D_{\\mathrm{time}}})+\\sqrt{\\gamma W K}(B_{\\mathrm{user}}+B_{\\mathrm{time}}).}\\end{array}\n$$", "text_format": "latex", "page_idx": 6}, {"type": "text", "text": "The value $v$ is defined in Corollary 4 and can be set to a sufficiently large constant. The hyperparameter $\\delta$ determines the probability with which the regret bound holds. The random deviate, $\\eta$ , is drawn from a distribution, $\\mathcal{D}^{T S}$ , satisfying the technical conditions given in Definition 1 in Appendix $\\mathrm{D}$ In practice, we recommend setting $\\mathit{\\check{D}}^{T S}$ to a multivariate Gaussian distribution or t-distribution to simplify calculations. Given $\\tilde{\\theta}$ , we then compute $\\bar{A}_{i,t}=\\operatorname*{argmax}_{a\\in[q]\\setminus\\{0\\}}\\phi_{i,t}^{\\top}\\tilde{\\theta}$ and randomly select $A_{i,t}=0$ with probability ", "page_idx": 6}, {"type": "equation", "text": "$$\n\\pi_{i,t}(0|\\bar{A}_{i,t}):=\\operatorname*{max}\\left[\\pi_{\\operatorname*{min}},\\operatorname*{min}\\left\\{\\pi_{\\operatorname*{max}},\\operatorname*{Pr}(\\phi_{i,t}^{\\top}\\tilde{\\theta}>0)\\right\\}\\right],\n$$", "text_format": "latex", "page_idx": 6}, {"type": "text", "text": "or $A_{i,t}=\\bar{A}_{i,t}$ with probability $1-\\pi_{i,t}(0|\\bar{A}_{i,t})$ . The action selection is summarized in Algorithm 1. ", "page_idx": 6}, {"type": "text", "text": "Algorithm 1 Action selection   \ninput V , b, \u03c0min, \u03c0max, \u03d5i,t, \u03b2(\u03b4) ${\\hat{\\theta}}=V^{-1}b$ Sample $\\eta\\sim\\mathcal{D}^{T S}$ $\\tilde{\\theta}=\\hat{\\theta}+\\beta(\\delta)V^{-1/2}\\eta,$ , with $\\beta(\\delta)$ given in (9) $\\bar{A}_{i,t}=\\operatorname*{argmax}_{a\\in[q]\\setminus\\{0\\}}\\phi_{i,t}^{\\top}\\tilde{\\theta}$ Calculate $\\pi_{i,t}(0|\\bar{A}_{i,t})$ according to (11) With probability $\\pi_{i,t}(0|\\bar{A}_{i,t})$ , play action 0; otherwise, play action $\\bar{A}_{i,t}$ ", "page_idx": 6}, {"type": "text", "text": "Having detailed the action selection algorithm, we now summarize RoME in Algorithm 2. The algorithm includes an outer loop that iterates through the stages from $k=1$ to $k=K$ . Within each stage, we handle users sequentially, iteratively selecting actions according to Algorithm 1, observing rewards, and updating $V$ and $b$ accordingly. ", "page_idx": 6}, {"type": "text", "text": "Algorithm 2 RoME Initialize $V_{0}$ according to (7) $V\\leftarrow V_{0}$ b \u21900 for $k=1,\\ldots,K$ do for $(i,t)=(1,k)$ , $(2,k-1),\\ldots,(k,1)$ do Choose an arm according to Algorithm 1 using $V$ and $b$ Observe rewards, Ri,t Construct pseudo-rewards, $\\tilde{R}_{i,t}^{f^{(m)}}$ , as explained in Section 4.1 Set $\\phi=\\phi(x_{i,t})$ as described in (5) Update weighted Gram matrix: $V\\leftarrow V+\\tilde{\\sigma}_{i,t}^{2}\\phi_{i,t}\\phi_{i,t}^{\\top}$ Update feature-outcome products: $b\\leftarrow b+\\tilde{\\sigma}_{i,t}^{2}\\tilde{R}_{i,t}^{f}\\phi_{i,t}$ end for end for ", "page_idx": 6}, {"type": "text", "text": "5.2 Regret bound ", "text_level": 1, "page_idx": 6}, {"type": "text", "text": "We first define regret, $\\mathbf{Regret}_{K}$ , in terms of the following average across stages: ", "page_idx": 6}, {"type": "equation", "text": "$$\n\\sum_{k=1}^{K}\\frac{1}{k}\\sum_{(i,t)\\in\\mathcal{O}_{k}\\backslash\\mathcal{O}_{k-1}}\\left\\{\\pi_{i,t}^{\\star}(\\bar{A}_{i,t}^{*}|S_{i,t})\\cdot x(S_{i,t},\\bar{A}_{i,t}^{*})^{\\top}\\theta_{i,t}^{*}-\\pi_{i,t}(\\bar{A}_{i,t}|S_{i,t})\\cdot x(S_{i,t},\\bar{A}_{i,t})^{\\top}\\theta_{i,t}^{*}\\right\\}.\n$$", "text_format": "latex", "page_idx": 6}, {"type": "text", "text": "The inner sum calculates regret (the difference between the expected reward of the optimal action and the chosen action) weighted by the probability of the action, following Greenewald et al. (2017), for all individuals at stage $k$ . We then average these values to account for the growing number of pairs $(i,t)$ as the stages progress. The cumulative regret is the sum of these averaged values over all stages. The rewards associated with the baseline action are excluded since $\\Delta_{i,t}(S_{i,t},0)=0$ . Regret $K$ is a form of pseudo-regret because the randomness attributed to $\\{\\epsilon_{i,t}\\}_{t=1}^{K}$ has been eliminated (Audibert et al., 2003). Before presenting the regret bound, we introduce one more assumption: ", "page_idx": 7}, {"type": "text", "text": "Assumption 6. $\\|x(s,a)\\|\\leq1$ for all s and $a$ . Also, there exists a known value $M\\in\\mathbb{R}^{+}$ bounding both $\\lVert\\theta_{i,t}\\rVert$ and $|g_{t}(s)|$ for all i, t, and $s$ . Further, $|f_{i,t}|\\leq2M$ . ", "page_idx": 7}, {"type": "text", "text": "Theorem 1. Under Assumptions $^{I-6,}$ , with probability at least $1-\\delta$ , Regret $K$ satisfies ", "page_idx": 7}, {"type": "equation", "text": "$$\nO\\left(\\left[\\beta_{K}(\\delta^{\\prime})+\\gamma_{K}(\\delta^{\\prime})\\left\\{1+\\frac{4}{p}\\right\\}\\right]\\cdot\\log(K)\\sqrt{c K p}\\right)\n$$", "text_format": "latex", "page_idx": 7}, {"type": "text", "text": "where $\\delta^{\\prime}=\\delta/4K$ and ${\\mathrm{min}}\\{\\pi(0|s),1-\\pi(0|s)\\}>1/c$ . The exact regret bound is given and both $\\beta_{K}$ and $\\gamma_{K}$ are defined in Appendix $E$ . ", "page_idx": 7}, {"type": "text", "text": "Theorem 1\u2019s proof is in Appendix E. It resembles Abeille & Lazaric (2017), albeit with adjustments to address (a) the nonlinear baseline and (b) the increasing pool of users and time points. The nonlinear baseline requires deriving the new sub-Gaussian variance factor for the centered pseudo-reward and adapting classic contextual bandit theory (Abbasi-Yadkori et al., 2011) to our weighted least squares setting. The increasing pool of users and time points requires modifying the Abeille & Lazaric (2017) proof with a careful use of stages and the Cauchy\u2013Schwarz inequality to decouple the weighted feature norms from inverse stage scaling, which allows us to apply standard techniques to the sum of norms and bound the sum of inverse stages by the harmonic number. ", "page_idx": 7}, {"type": "text", "text": "DML is particularly advantageous for $\\beta_{K}(\\delta^{\\prime})$ and $\\gamma_{K}(\\delta^{\\prime})$ , which rely on the convergence rate of the model $f$ towards the true mean differential reward $r$ , as discussed further in Appendix E.2. Another interesting aspect of the regret bound is its dependence solely on the dimension, $p$ , of the differential-reward model, rather than the dimension of the baseline reward. This characteristic allows us to achieve strong regret bounds even in cases where the baseline reward is highly complex. ", "page_idx": 7}, {"type": "text", "text": "6 Experiments ", "text_level": 1, "page_idx": 7}, {"type": "text", "text": "This section presents results from applying RoME in a simulated mHealth study with staggered recruitment and an off-policy comparison study for cardiac rehabilitation mHealth interventions. The simulations were implemented using Python and the results were generated using individual compute nodes with two $3.0\\:\\mathrm{GHz}$ Intel Xeon Gold 6154 processors and 180 GB of RAM. Case studies were implemented using R 4.2.2 and results were generated on a cluster composed of individual compute nodes with $2.10\\:\\mathrm{GHz}$ Intel Xeon Gold 6230 processors and 192 GB of RAM. ", "page_idx": 7}, {"type": "text", "text": "6.1 Competitor Comparison Simulation ", "text_level": 1, "page_idx": 7}, {"type": "text", "text": "In this section, we compare RoME to four competing methods in simulation. We implemented RoME using Option 2 with a bagged ensemble of stochastic gradient trees (Gouk et al., 2019; Mastelini et al., 2021) trained online via the River library (Montiel et al., 2021). We programmed the linear algebra operations using SuiteSparse (Davis & Hu, 2011) to take advantage of the sparse nature of the Laplacian matrices and $\\phi_{i,t}$ from Algorithm 2. ", "page_idx": 7}, {"type": "text", "text": "Our competing baselines are (a) Standard: Standard Thompson sampling for linear contextual bandits, (b) AC: the Action-Centered contextual bandit algorithm (Greenewald et al., 2017), (c) IntelPooling: The intelligentpooling method of Tomkins et al. (2021) fixing the variance parameters close to their true values, and (d) Neural-Linear: a method that uses a pre-trained neural network to transform the feature space for the baseline reward (similar to the Neural Linear method of Riquelme et al. (2018)). ", "page_idx": 7}, {"type": "text", "text": "We compare these methods under three settings: Homogeneous Users, Heterogeneous Users, and Nonlinear. The first two involve a linear baseline model and time-homogeneous parameters, with the second setting having distinct user parameters. The third setting, designed to mirror the challenges of mHealth studies, includes a nonlinear baseline and both user- and time-specific parameters. For each setting, we simulate 200 stages following the staged recruitment regime depicted in Figure 1, and we repeat the full 200-stage simulation 50 times. Appendix A.1 provides details on the setup and a link to our implementation. ", "page_idx": 7}, {"type": "text", "text": "", "page_idx": 8}, {"type": "image", "img_path": "eKVugi5zr0/tmp/c5ef7fa5b04019cd5609a3453580186d2217adc945810ee432f77563dd2cd5b8.jpg", "img_caption": ["Figure 2: Cumulative regret in the (a) Homogeneous Users, (b) Heterogeneous Users, and (c) Nonlinear settings. RoME performs competitively in the first setting (the simplest), and it substantially outperforms the next-best method (IntelPooling) in the others. "], "img_footnote": [], "page_idx": 8}, {"type": "text", "text": "Figure 2 displays the average cumulative regret for each method. RoME and IntelPooling have similar performance in the Homogeneous Users setting, but RoME excels in the Heterogeneous Users and Nonlinear settings, with significantly lower cumulative regret by stage 200. This is expected as RoME can utilize network information and model nonlinear baselines in these settings. However, in the Homogeneous Users setting, where no network information is available and a linear baseline is used, RoME does not outperform IntelPooling. ", "page_idx": 8}, {"type": "text", "text": "Appendices A.2\u2013A.5 offer more results, including additional method comparisons, a rectangular data array simulation, hyperparameter sensitivity analyses, and pairwise statistical comparisons. The latter show that RoME outperformed each competitor in at least 48 of 50 repetitions in the Nonlinear setting, indicating even higher statistical confidence than Figure 2 suggests. RoME substantially outperforms the competing algorithms in the additional comparisons and is several orders of magnitude faster than would be required in a standard mHealth study, producing over 20,000 decisions in as little as 45 seconds (see Table 2 in Appendix A.2). ", "page_idx": 8}, {"type": "text", "text": "6.2 Valentine Study Analysis Results ", "text_level": 1, "page_idx": 8}, {"type": "text", "text": "In this section, we compare RoME to the above algorithms via off-policy evaluation using data from the Valentine Study (Jeganathan et al., 2022), a prospective, randomized-controlled, remotely administered trial designed to evaluate an mHealth intervention to supplement cardiac rehabilitation for low- and moderate-risk patients. In the analyzed dataset, participants were randomized to receive or not receive contextually tailored notifications promoting low-level physical activity and exercise throughout the day. The left of Figure 3 shows the estimated improvement in the average reward over the original constant randomization, averaged over stages $\\mathrm{K}=120)$ ) and participants $(\\mathrm{N}{=}108)$ . We see that RoME achieved the highest average reward; its average performance (across bootstrap replications) is higher than the 75th percentile of all other methods. ", "page_idx": 8}, {"type": "text", "text": "To further analyze the improvement of RoME relative to the other methods, we test whether the proposed algorithm significantly improves cumulative rewards using paired t-tests with one-sided alternative hypotheses. The null hypothesis $(H_{0})$ for these tests is that the two algorithms being compared achieve the same average reward. The alternative hypothesis $(H_{1})$ is that the algorithm listed in the column achieves higher average rewards than the algorithm listed in the row. The right of Figure 3 displays the p-values obtained from these pairwise t-tests. The dark shade of the last column indicates that the proposed RoME algorithm achieves significantly higher rewards than the other five competing algorithms $p\\leq0.01$ for all pairwise comparisons). The results imply that RoME would have achieved a $3.5\\%$ increase in step count relative to the constant randomization policy that was actually implemented in this study. This effect translates to an increase of 140 steps per day, given a baseline of 1,000 steps per hour and four one-hour measurement windows. See Appendix B for additional implementation details. ", "page_idx": 8}, {"type": "image", "img_path": "eKVugi5zr0/tmp/5408479e3eeddd868b048c9e6c5a75f1ef3a8f51f09ceb49f2ec913ba7bc5638.jpg", "img_caption": ["Figure 3: (left) Boxplot of unbiased estimates of the average per-trial reward for all five competing algorithms, relative to the reward obtained under the pre-specified Valentine randomization policy across 100 bootstrap samples. Within each box, the asterisk $(*)$ indicates the mean value, while the mid-bar represents the median. (right) Heatmap of p-values from the pairwise paired t-tests. "], "img_footnote": [], "page_idx": 9}, {"type": "text", "text": "We performed an additional off-policy comparison using data from the Intern Health Study (IHS) (NeCamp et al., 2020), as shown in Figure 11 in Appendix C.2. The results further demonstrate the competitive performance of the RoME algorithm, with the AC algorithm also showing comparable performance in this dataset. Further details on the analysis can be found in Appendix C. ", "page_idx": 9}, {"type": "text", "text": "7 Discussion ", "text_level": 1, "page_idx": 9}, {"type": "text", "text": "This paper introduces RoME, a robust mixed-effects contextual bandit algorithm for mHealth studies. RoME adapts DML and network cohesion penalties to dynamic settings, enabling researchers to efficiently pool information across users and over time. In addition to the methodological contribution, we also prove a high-probability regret bound in a challenging asymptotic regime that involves a growing pool of users and time points. Our implementation of RoME is several orders of magnitude faster than would be required in practice and could easily be adapted for use in future mHealth studies. ", "page_idx": 9}, {"type": "text", "text": "We see several promising directions for improving RoME in future work. One such direction might consider data-adaptive strategies for setting the hyperparameters or constructing a network in settings where the network is not known a priori. Another interesting direction is to address the long-term impacts of mHealth treatments, such as accumulating treatment fatigue. Future work could also consider computational improvements that would enable large-scale deployment of RoME, which would be especially relevant in nonclinical settings. ", "page_idx": 9}, {"type": "text", "text": "Acknowledgements ", "text_level": 1, "page_idx": 9}, {"type": "text", "text": "The authors gratefully acknowledge the contributions of the researchers, administrators, and participants involved in the Valentine (https://clinicaltrials.gov/study/NCT04587882) and Intern Health (https://clinicaltrials.gov/study/NCT03972293) studies. This work was supported in part by grant P50 DA054039 provided through the NIH and NIDDK and by grant R01 GM152549 through the NIH and NIGMS. Dr. Golbus receives funding from the NIH (L30HL143700, 1K23HL168220). Initially while working on this paper, Dr. Moreno was supported by Luminous Computing, Inc. ", "page_idx": 9}, {"type": "text", "text": "References ", "text_level": 1, "page_idx": 10}, {"type": "text", "text": "Abbasi-Yadkori, Y., P\u00e1l, D., and Szepesv\u00e1ri, C. Improved algorithms for linear stochastic bandits. Advances in Neural Information Processing Systems, 24, 2011.   \nAbeille, M. and Lazaric, A. Linear Thompson sampling revisited. Electronic Journal of Statistics, 11(2):5165 \u2013 5197, 2017. doi: 10.1214/17-EJS1341SI. URL https://doi.org/10.1214/ 17-EJS1341SI.   \nAouali, I., Kveton, B., and Katariya, S. Mixed-effect Thompson sampling. In International Conference on Artificial Intelligence and Statistics, pp. 2087\u20132115. PMLR, 2023.   \nAudibert, J.-Y., Biermann, A., and Long, P. Reinforcement learning with immediate rewards and linear hypotheses. Algorithmica, 37(4):263\u2013296, 2003.   \nBang, H. and Robins, J. M. Doubly robust estimation in missing data and causal inference models. Biometrics, 61(4):962\u2013973, 2005.   \nBiau, G. Analysis of a random forests model. The Journal of Machine Learning Research, 13(1): 1063\u20131095, 2012.   \nCesa-Bianchi, N., Gentile, C., and Zappella, G. A gang of bandits. Advances in Neural Information Processing Systems, 26, 2013.   \nChen, Q., Syrgkanis, V., and Austern, M. Debiased machine learning without sample-splitting for stable estimators. Advances in Neural Information Processing Systems, 35:3096\u20133109, 2022.   \nChernozhukov, V., Chetverikov, D., Demirer, M., Duflo, E., Hansen, C., Newey, W., and Robins, J. Double/debiased machine learning for treatment and structural parameters. The Econometrics Journal, 21(1):C1\u2013C68, 01 2018. ISSN 1368-4221. doi: 10.1111/ectj.12097. URL https: //doi.org/10.1111/ectj.12097.   \nCho, H., Wang, P., and Qu, A. Personalize treatment for longitudinal data using unspecified randomeffects model. Statistica Sinica, pp. 187\u2013206, 2017.   \nDavis, T. A. and Hu, Y. The University of Florida sparse matrix collection. ACM Transactions on Mathematical Software (TOMS), 38(1):1\u201325, 2011.   \nFarrell, M. H., Liang, T., and Misra, S. Deep neural networks for estimation and inference. Econometrica, 89(1):181\u2013213, 2021.   \nFriedman, L. M., Furberg, C. D., and DeMetsR., D. L. (eds.). Machine Learning: An Artificial Intelligence Approach, Vol. I. Springer, New York, NY, 4 edition, 2010.   \nGolbus, J. R., Gupta, K., Stevens, R., Jeganathan, V. S. E., Luff, E., Shi, J., Dempsey, W., Boyden, T., Mukherjee, B., Kohnstamm, S., et al. A randomized trial of a mobile health intervention to augment cardiac rehabilitation. NPJ Digital Medicine, 6(1):173, 2023.   \nGouk, H., Pfahringer, B., and Frank, E. Stochastic gradient trees. In Asian Conference on Machine Learning, pp. 1094\u20131109. PMLR, 2019.   \nGreenewald, K., Tewari, A., Klasnja, P., and Murphy, S. Action centered contextual bandits. Advances in Neural Information Processing Systems, 30, 2017.   \nHu, X., Qian, M., Cheng, B., and Cheung, Y. K. Personalized policy learning using longitudinal mobile health data. Journal of the American Statistical Association, 116(533):410\u2013420, 2021.   \nJeganathan, V. S., Golbus, J. R., Gupta, K., Luff, E., Dempsey, W., Boyden, T., Rubenfire, M., Mukherjee, B., Klasnja, P., Kheterpal, S., et al. Virtual application-supported environment to increase exercise (VALENTINE) during cardiac rehabilitation study: Rationale and design. American Heart Journal, 248:53\u201362, 2022.   \nKennedy, E. H. Towards optimal doubly robust estimation of heterogeneous causal effects. Electronic Journal of Statistics, 17(2):3008\u20133049, 2023.   \nKim, G.-S. and Paik, M. C. Contextual multi-armed bandit algorithm for semiparametric reward model. In International Conference on Machine Learning, pp. 3389\u20133397. PMLR, 2019.   \nKim, W., Kim, G.-S., and Paik, M. C. Doubly robust Thompson sampling with linear payoffs. Advances in Neural Information Processing Systems, 34:15830\u201315840, 2021.   \nKim, W., Lee, K., and Paik, M. C. Double doubly robust Thompson sampling for generalized linear contextual bandits. In Proceedings of the AAAI Conference on Artificial Intelligence, volume 37, pp. 8300\u20138307, 2023.   \nKingma, D. P. and Ba, J. Adam: A method for stochastic optimization. arXiv preprint arXiv:1412.6980, 2014.   \nKrishnamurthy, A., Wu, Z. S., and Syrgkanis, V. Semiparametric contextual bandits. In International Conference on Machine Learning, pp. 2776\u20132785. PMLR, 2018.   \nLee, K., Paik, M. C., Oh, M.-h., and Kim, G.-S. Mixed-effects contextual bandits. In Proceedings of the AAAI Conference on Artificial Intelligence, volume 38, pp. 13409\u201313417, 2024.   \nLi, L., Chu, W., Langford, J., and Schapire, R. A contextual-bandit approach to personalized news article recommendation. WWW, pp. 661\u2013670, 2010.   \nMa, H., Zhou, D., Liu, C., Lyu, M. R., and King, I. Recommender systems with social regularization. In Proceedings of the Fourth ACM International Conference on Web Search and Data Mining, pp. 287\u2013296, 2011.   \nMastelini, S. M., de Leon Ferreira, A. C. P., et al. Using dynamical quantization to perform split attempts in online tree regressors. Pattern Recognition Letters, 145:37\u201342, 2021.   \nMcPherson, M., Smith-Lovin, L., and Cook, J. M. Birds of a feather: Homophily in social networks. Annual Review of Sociology, 27(1):415\u2013444, 2001.   \nMontiel, J., Halford, M., Mastelini, S. M., Bolmier, G., Sourty, R., Vaysse, R., Zouitine, A., Gomes, H. M., Read, J., Abdessalem, T., et al. River: Machine learning for streaming data in Python. 2021.   \nNair, V. and Hinton, G. E. Rectified linear units improve restricted boltzmann machines. In Proceedings of the 27th International Conference on Machine Learning, pp. 807\u2013814, 2010.   \nNeCamp, T., Sen, S., Frank, E., Walton, M. A., Ionides, E. L., Fang, Y., Tewari, A., and Wu, Z. Assessing real-time moderation for developing adaptive mobile health interventions for medical interns: Micro-randomized trial. Journal of Medical Internet Research, 22(3):e15033, 2020.   \nNie, X. and Wager, S. Quasi-oracle estimation of heterogeneous treatment effects. Biometrika, 108 (2):299\u2013319, 2021.   \nQian, T., Klasnja, P., and Murphy, S. A. Linear mixed models with endogenous covariates: Modeling sequential treatment effects with application to a mobile health study. Statistical Science, 35(3): 375, 2020.   \nRiquelme, C., Tucker, G., and Snoek, J. Deep Bayesian bandits showdown: An empirical comparison of bayesian deep networks for Thompson sampling. arXiv preprint arXiv:1802.09127, 2018.   \nRobinson, P. M. Root-n-consistent semiparametric regression. Econometrica: Journal of the Econometric Society, pp. 931\u2013954, 1988.   \nSnoek, J., Rippel, O., Swersky, K., Kiros, R., Satish, N., Sundaram, N., Patwary, M., Prabhat, M., and Adams, R. Scalable bayesian optimization using deep neural networks. In International Conference on Machine Learning, pp. 2171\u20132180. PMLR, 2015.   \nTomkins, S., Liao, P., Klasnja, P., and Murphy, S. Intelligentpooling: Practical Thompson sampling for mhealth. Machine Learning, 110(9):2685\u20132727, 2021.   \nVaswani, S., Schmidt, M., and Lakshmanan, L. Horde of bandits using Gaussian Markov random fields. In Artificial Intelligence and Statistics, pp. 690\u2013699. PMLR, 2017. ", "page_idx": 10}, {"type": "text", "text": "", "page_idx": 11}, {"type": "text", "text": "Wasserman, L. All of Nonparametric Statistics. Springer Science & Business Media, 2006. ", "page_idx": 12}, {"type": "text", "text": "Yang, K., Toni, L., and Dong, X. Laplacian-regularized graph bandits: Algorithms and theoretical analysis. In International Conference on Artificial Intelligence and Statistics, pp. 3133\u20133143. PMLR, 2020. ", "page_idx": 12}, {"type": "text", "text": "A Additional Details for Simulation Study ", "text_level": 1, "page_idx": 13}, {"type": "text", "text": "This appendix provides details regarding the setup of our simulation study, additional results not presented in the main paper, and results from additional simulations employing different competitors and/or simulation designs. We summarize the differences between the competing algorithms in Table 1. ", "page_idx": 13}, {"type": "table", "img_path": "eKVugi5zr0/tmp/3a69804d1b0c10b0ed07d2f1b2d0e8f9225bbd45b600257f34250005ba13c6c6.jpg", "table_caption": [], "table_footnote": [], "page_idx": 13}, {"type": "text", "text": "Table 1: This table compares the meth\u221aods tested in the simulation study based on the design components listed in the columns, with $\\surd$ indicating that the method includes the component listed in the column, $\\times$ indicating that it does not, and $\\mathrm{N/A}$ indicating that the component is not applicable. This table can be used to investigate the effect of certain model components on cumulative regret; for example, comparing RoME and RoME-BLM helps us understand the impact of modeling the nonlinear baseline\u2014the only column that differs between these two methods. ", "page_idx": 13}, {"type": "text", "text": "A.1 Setup Details ", "text_level": 1, "page_idx": 13}, {"type": "text", "text": "The code for the simulation study is fully containerized and publicly available at https://github. com/eastonhuch/RoME. The simulation study involves a generative model of the following form for user $i$ at time $t$ : ", "page_idx": 13}, {"type": "equation", "text": "$$\n\\begin{array}{r}{R_{i t}=g(S_{i t})+x(S_{i t},A_{i t})^{\\top}\\,\\theta_{i t}+\\epsilon_{i t},\\quad\\epsilon_{i t}\\sim\\mathcal{N}(0,1)}\\end{array}\n$$", "text_format": "latex", "page_idx": 13}, {"type": "text", "text": "Here $S_{i t}=(s_{1},s_{2})\\in\\mathbb{R}^{2}$ is a context vector, with both dimensions $\\stackrel{i i d}{\\sim}U(-1,1)$ . We set $x(s,a)=$ $a\\left(1,s_{1},s_{2}\\right)$ . For simplicity, we set $g$ to a time-homogeneous function. The specific nature of the function varies across the following three settings mentioned in Section 6.1: ", "page_idx": 13}, {"type": "text", "text": "\u2022 Homogeneous Users: Standard contextual bandit assumptions with a linear baseline and no user- or time-specific parameters. The linear baseline is $g(S_{i t})=2-2s_{1}+3s_{2}$ , and the causal parameter is $\\theta_{i t}=(1,0.5,-4)$ such that the optimal action varies across the context space.   \n\u2022 Heterogeneous Users: Same as the above but each user\u2019s causal parameter has iid $\\mathcal{N}(0,1)$ noise added to it.   \n\u2022 Nonlinear: The general setting discussed in the paper with a nonlinear baseline, user-specific parameters, and time-specific parameters. The base causal parameter and user-specific parameters are the same as in the previous two settings. The nonlinear baseline and timespecific parameter are shown in Figure 4. ", "page_idx": 13}, {"type": "text", "text": "We assume that the data are observed via a staged recruitment scheme, as illustrated in Figure 1. For computational convenience, we update parameters and select actions in batches. If, for instance, we observe twenty users at a given stage, we update our estimates of the relevant causal parameters and select actions for all twenty users simultaneously. This strategy offers a slight computational advantage with limited implications in terms of statistical performance. ", "page_idx": 13}, {"type": "text", "text": "For simplicity, we assume that the nearest-neighbor network is known and set the relevant hyperparameters accordingly. We took care to set the hyperparameters such that RoME performs a similar amount of shrinkage compared to other methods, especially IntelPooling, which effectively uses a separate penalty matrix for users and time. To accomplish this, we used the same penalty matrices for RoME and IntelPooling, effectively generalizing the scalar $\\gamma$ penalty discussed in the main paper. For the purposes of calculating the constant $B$ given in Algorithm 2, we used a separate value of $\\gamma$ for both users and time and set them equal to the maximum eigenvalue of the corresponding penalty matrix. We use 5 neighbors within the DML methods and set the other hyperparameters as follows: $\\lambda=1$ , and $\\delta=0.01$ , and $v_{k}=1$ (i.e., $v_{k}$ is constant). ", "page_idx": 13}, {"type": "text", "text": "", "page_idx": 14}, {"type": "text", "text": "For the Neural-Linear method, we generate a $200\\times200$ array of baseline rewards to train the neural network prior to running the bandit algorithm. Consequently, the results shown in the paper for Neural-Linear are better than would be observed in practice because we allowed the Neural-Linear method to leverage data that we did not make available to the other methods. This setup offers the computational benefti of not needing to update the neural network within bandit replications, which substantially reduces the necessary computation time. ", "page_idx": 14}, {"type": "text", "text": "Aside from the input features used, the Neural-Linear method has the same implementation as the Standard method. The Neural-Linear method uses the output from the last hidden layer of a neural network to model the baseline reward. However, we use the original features (the state vectors) to model the advantage function because the true advantage function is, in fact, linear in these features. ", "page_idx": 14}, {"type": "text", "text": "Our neural networks consisted of four hidden layers with 10, 20, 20, and 10 nodes, respectively. The first two employ the ReLU activation function (Nair & Hinton, 2010) while the latter two employ the hyperbolic tangent. We chose to use the hyperbolic tangent for the last two layers because Snoek et al. (2015) found that smooth activation functions such as the hyperbolic tangent were advantageous in their neural bandit algorithm. The loss function was the mean squared error between the neural networks\u2019 output and the baseline reward on a simulated data set. We trained our networks using the Adam optimizer (Kingma & Ba, 2014) with batch sizes of 200 for between 20 and 50 epochs. We simulated a separate validation data set to check that our model had converged and was generating accurate predictions. ", "page_idx": 14}, {"type": "text", "text": "Figure 5 compares the true baseline reward function in the nonlinear setting (left) to that estimated by the neural network (right). We see that the neural network produced an accurate approximation of the baseline reward, which helps explain the good performance of the Neural-Linear method relative to other baseline approaches, such as Standard. ", "page_idx": 14}, {"type": "text", "text": "We include the Neural-Linear method primarily to demonstrate that correctly modeling the baseline is not sufficient to ensure good performance. In the mHealth, algorithms should also be able to (1) efficiently pool data across users and time and (2) leverage network information. The Neural-Linear method satisfies neither of these criteria. Note that a neural network could be used to model the baseline rewards as part of our algorithm. Future work could consider allowing the differential rewards themselves to also be complex nonlinear functions, which could be accomplished by combining our method with Neural-Linear. We leave the details to future work. ", "page_idx": 14}, {"type": "image", "img_path": "eKVugi5zr0/tmp/44b5c617796c4584ca3f30297c2f72f34a89d2b22922171e75a131426f6f02bf.jpg", "img_caption": ["Figure 4: (left) The baseline reward function $g(S_{i t})$ used in the simulation study. The proposed method allows this function to be a nonlinear function of the context vectors. The baseline was generated using a combination of recursive partitioning and by summing scaled, shifted, and rotated Gaussian densities. (right) The time-specific parameters used in the simulation study. These parameters cause the advantage function to vary over time. We set them such that the advantage function changes quickly at the beginning of the study then stabilizes. "], "img_footnote": [], "page_idx": 14}, {"type": "text", "text": "", "page_idx": 15}, {"type": "text", "text": "A.2 Additional Method Comparisons ", "text_level": 1, "page_idx": 15}, {"type": "text", "text": "Our results in the main paper indicate that RoME outperforms existing methods, especially in the complex longitudinal setting that we are targeting. These positive results beg the question: What aspects of RoME contribute most to its superior performance? ", "page_idx": 15}, {"type": "text", "text": "In this section, we describe an additional simulation study designed to answer this question. In it, we compare RoME (as implemented in the main paper) to three additional comparison methods: RoME-BLM, RoME-SU, and NNR-Linear. Each comparison isolates particular aspects of our algorithm to understand its contribution to RoME\u2019s performance. ", "page_idx": 15}, {"type": "text", "text": "RoME-BLM is a version of RoME that employs Bagged Linear Models as the baseline supervised learning algorithm. Unlike the method implemented in the main paper (which uses bagged stochastic gradient trees), this baseline model is misspecified in the nonlinear setting; i.e., it cannot accurately model the nonlinear baseline reward function. Consequently, this comparison will allow us to gauge the impact of the supervised learning method used in our method. In particular, it should allow us to validate whether the algorithm is robust to baseline misspecification as the theory suggests. ", "page_idx": 15}, {"type": "text", "text": "RoME-SU is a Single-User version of our algorithm. Rather than having a separate $\\theta_{i}$ for each user, this method estimates a single advantage function that is shared across all users. It does, however, employ DML, time effects, and nearest-neighbor regularization (for the time effects). Consequently, this comparison will help us understand the impact of the user-specific parameters in our simulation. ", "page_idx": 15}, {"type": "text", "text": "NNR-Linear is similar to the existing network-cohesion bandit algorithms described in the main paper. It includes a distinct $\\theta_{i}$ for each user and regularizes them toward each other using a Laplacian penalty. It does not, however, use DML or time effects. As a result, this comparison isolates the impact of these two factors and should provide evidence that RoME is more broadly applicable than existing network-cohesion bandit algorithms. ", "page_idx": 15}, {"type": "text", "text": "Figure 6 displays the cumulative regret as a function of the stage for these methods across the three settings used in the main paper. We see that all methods perform similarly in panel (a), the setting with homogeneous users. However, in panel (b) we see that the regret achieved by RoME-SU begins to resemble a straight upward-sloping line because it cannot appropriately model the user-specific advantage functions. ", "page_idx": 15}, {"type": "text", "text": "In panel (c), we observe a much wider spread of performance, with RoME and RoME-BLM performing similarly and substantially outperforming the other methods. The fact that RoME and RoME-BLM perform similarly indicates that our algorithm is, in fact, robust to misspecification as expected. The comparison to NNR-Linear reveals that the DML and time effects\u2014the new components of our method compared to existing network-cohesion bandit algorithms\u2014do contribute meaningfully to RoME\u2019s superior performance. We found in additional simulations studies not reported here that the gap between NNR-Linear and our method widens as the magnitude of the time effects increases. ", "page_idx": 15}, {"type": "image", "img_path": "eKVugi5zr0/tmp/7bab67c1c575821122eddfeb8a90fca2efa32ce72469f653af4b6d6ec1cc03bd.jpg", "img_caption": ["Figure 5: (left) The baseline reward function $g(S_{i t})$ used in the simulation study compared to (right) the estimated baseline reward from our neural network in the nonlinear setting. "], "img_footnote": [], "page_idx": 15}, {"type": "image", "img_path": "eKVugi5zr0/tmp/551d313a618af6f6c98a9f45805f1ef6af3d0dbe2d759b17389cb289ea3d5538.jpg", "img_caption": ["Figure 6: Cumulative regret in the (a) Homogeneous Users, (b) Heterogeneous Users, and (c) Nonlinear settings for the additional comparison methods. The fact that RoME outperforms RoMESU demonstrates the importance of the user-specific parameters. The fact that RoME outperforms NNR-Linear shows that previous network cohesion approaches do not adequately address the (1) nonlinear nature of the baseline reward and (2) presence of time effects. The comparable performance of RoME-BLM to RoME highlights how our algorithm is robust to misspecification of the baseline reward model. "], "img_footnote": [], "page_idx": 16}, {"type": "table", "img_path": "eKVugi5zr0/tmp/0d441e945aaf4fa9cad5e7dc7774ae9df1c70681bb9f89153ed85341b6ce0066.jpg", "table_caption": ["Table 2: Average computation time across all methods and settings in the main simulation. "], "table_footnote": [], "page_idx": 16}, {"type": "text", "text": "Table 2 displays the average computation time for each method across all three settings. Each run of the simulation produces $200*201/2=20$ , 100 decisions. RoME and RoME-SU require the longest computation time at about six minutes. RoME-BLM requires only 45\u201353 seconds, indicating that the computational bottleneck for RoME is the ML model ftiting. The required computation time for IntelPooling is similar to RoME-BLM at 43\u201347 seconds. NNR-Linear requires 29\u201332 seconds, and the remaining methods run in less than one second. Because most clinical mHealth studies require fewer than 1,000 decisions per day, the speed of RoME is orders of magnitude faster than is required in practice. However, large-scale commercial deployment of RoME may require computational adjustments and approximations. ", "page_idx": 16}, {"type": "text", "text": "A.3 Pairwise Comparisons ", "text_level": 1, "page_idx": 16}, {"type": "text", "text": "Table 3 shows pairwise comparisons between methods across the three settings. The individual cells indicate the percentage of repetitions (out of 50) in which the method listed in the row outperformed the method listed in the column. The asterisks indicate ${\\bf p}\\mathrm{.}$ -values below 0.05 from paired two-sided ttests on the differences in final regret. The Avg column indicates the average pairwise win percentage. ", "page_idx": 16}, {"type": "text", "text": "RoME and RoME-BLM perform well across all three settings and the difference between them is statistically indistinguishable. These methods perform about equally well compared to IntelPooling and NNR-Linear in the first setting, but they perform better in the other two. In the Nonlinear setting in particular, RoME and RoME-BLM substantially outperform all other methods, and the pairwise differences are statistically significant at the $5\\%$ level. ", "page_idx": 16}, {"type": "text", "text": "Homogeneous Users ", "text_level": 1, "page_idx": 17}, {"type": "table", "img_path": "eKVugi5zr0/tmp/f5e20c3327f4794198a172a4c29ecb0e51ac09d66f9d1090d3b1f1bacd5e99e2.jpg", "table_caption": [], "table_footnote": [], "page_idx": 17}, {"type": "text", "text": "Heterogeneous Users ", "text_level": 1, "page_idx": 17}, {"type": "table", "img_path": "eKVugi5zr0/tmp/e8faee44acdff80c8bcc7b7965f37274d502d19a4af897579a2b17bb69392692.jpg", "table_caption": [], "table_footnote": [], "page_idx": 17}, {"type": "table", "img_path": "eKVugi5zr0/tmp/b53ff97a1d8d07c8366f411d502a291cd6331f5d23d63d466faaaee178adbb0c.jpg", "table_caption": ["Nonlinear "], "table_footnote": [], "page_idx": 17}, {"type": "text", "text": "Table 3: Pairwise comparisons between methods in the three settings of the main simulation. Each cell indicates the percent of repetitions (out of 50) in which the method listed in the row outperformed the method listed in the column in term of final regret. Asterisks indicate $\\mathbf{p}$ -values below 0.05 from paired two-sided t-tests on the differences in final regret. RoME and RoME-BLM perform well in all three settings, and their final regret is statistically indistinguishable. They substantially outperform all other methods in the Nonlinear setting. ", "page_idx": 17}, {"type": "text", "text": "A.4 Simulation with Rectangular Data Array ", "text_level": 1, "page_idx": 18}, {"type": "text", "text": "The main simulation involves simulating data from a triangular data array. At the 200-th (final) stage, the algorithm has observed 200 rewards for user 1, 199 rewards for user 2, and so on. ", "page_idx": 18}, {"type": "text", "text": "In this section, we simulate actions and rewards under a rectangular array with 100 users and 100 time points. Although we still follow the staged recruitment regime depicted in Figure 1, at stage 100 we stop sampling actions and rewards for user 1; at stage 101 we stop sampling for user 2; and so on until we have sampled 100 time points for all 100 users. Aside from the shape of the data array, the setup is the same for this simulation as for the main simulation. ", "page_idx": 18}, {"type": "image", "img_path": "eKVugi5zr0/tmp/003cac113f97d3559fc29539145a9aca16c75dd910f7297d6185d502a7c39c34.jpg", "img_caption": ["Figure 7: Cumulative regret in the (a) Homogeneous Users, (b) Heterogeneous Users, and (c) Nonlinear settings using a rectangular array of data in which we observe 100 time points for 100 users in a stagewise fashion as depicted in Figure 1. Similar to Figure 2, RoME is competitive in the first setting and substantially outperforms the competitors in the other settings. "], "img_footnote": [], "page_idx": 18}, {"type": "image", "img_path": "eKVugi5zr0/tmp/53b23921c6d438f81b514a93e47c42dbd5bc965a1985b9dbb3c950f1426d0660.jpg", "img_caption": ["Figure 8: Cumulative regret in the (a) Homogeneous Users, (b) Heterogeneous Users, and (c) Nonlinear settings using a rectangular array of data in which we observe 100 time points for 100 users in a stagewise fashion as depicted in Figure 1. We observe the same performance ordering as in Figure 6, but here the relative differences are even larger. "], "img_footnote": [], "page_idx": 18}, {"type": "text", "text": "The cumulative regret for these methods as a function of time\u2014not stage\u2014is shown in Figure 7. Qualitatively, the results are nearly identical to those from the main simulation (compare to Figure 2). The differences in final regret are even larger in this simulation than they were in the main simulation, presumably because this study exhibits greater variation in time effects due to the balance across time. ", "page_idx": 18}, {"type": "text", "text": "Figure 8 displays comparisons similar to those shown in Figure 6 but for the rectangular simulation. We again see that the results are qualitatively similar to the main simulation. The methods perform similarly in the Homogeneous Users setting. RoME-SU performs poorly in the Heterogeneous Users setting, but the other methods perform similarly. Finally, RoME and RoME-BLM substantially outperform the other methods in the nonlinear setting. Again, the differences in performance are even larger in this simulation than in the main simulation. ", "page_idx": 18}, {"type": "text", "text": "Table 4 displays results from pairwise method comparisons, similar to those shown in Table 3. Again, the results are qualitatively similar to but slightly more exaggerated than those from the main ", "page_idx": 18}, {"type": "text", "text": "Homogeneous Users ", "text_level": 1, "page_idx": 19}, {"type": "table", "img_path": "eKVugi5zr0/tmp/2c817efc2f3c45d0ccde6bb6e22547b90a56649e6b77b52db747be9ad7d465c9.jpg", "table_caption": [], "table_footnote": [], "page_idx": 19}, {"type": "text", "text": "Heterogeneous Users ", "text_level": 1, "page_idx": 19}, {"type": "table", "img_path": "eKVugi5zr0/tmp/e5afe8292028c654fa5bf687384251802b0e308bc91f09059d686c7d90189d2d.jpg", "table_caption": [], "table_footnote": [], "page_idx": 19}, {"type": "table", "img_path": "eKVugi5zr0/tmp/9490253414f3434c0c92c18a8f54ec43b90fb667d48f0fbdc0a5dcb8d3f73c46.jpg", "table_caption": ["Nonlinear "], "table_footnote": [], "page_idx": 19}, {"type": "text", "text": "Table 4: Pairwise comparisons between methods in the three settings of the simulation with a rectangular array of data. As in Table 3, each cell indicates the percent of repetitions (out of 50) in which the method listed in the row outperformed the method listed in the column in term of final regret. Asterisks indicate p-values below 0.05 from paired two-sided t-tests on the differences in final regret. The qualitative results are similar to those of Table 3. RoME and RoME-BLM perform well across all three settings and substantially outperform all other methods in the Nonlinear setting. ", "page_idx": 19}, {"type": "text", "text": "simulation. In particular, in this simulation study, RoME and RoME-BLM outperform all other methods in $100\\%$ of repetitions in the nonlinear setting. ", "page_idx": 20}, {"type": "text", "text": "A.5 Hyperparameter Sensitivity ", "text_level": 1, "page_idx": 20}, {"type": "text", "text": "In the simulation study, we chose hyperparameters for the fairest comparison possible, employing the same regularization parameters across methods. To assess robustness, we performed eight sensitivity analyses that alter hyperparameters for our methods while fixing those of the other methods; this approach gives the competing algorithms an advantage. Under these alternative hyperparameters, RoME and RoME-BLM still dramatically outperform the other methods in the Nonlinear Setting. We provide detailed results below. ", "page_idx": 20}, {"type": "text", "text": "Three analyses led to no meaningful changes to Figure 2 or Table 3. These involved rescaling $(1)\\,\\gamma$ , (2) $\\lambda$ , and (3) and the bounds $B,D$ by a factor of 10. The remaining simulations resulted in minor performance differences, especially in the Heterogeneous setting. In the following, we summarize these five analyses. ", "page_idx": 20}, {"type": "text", "text": "\u2022 Adding (low and medium) noise to the network: NNR-Linear slightly outperforms our methods in the Heterogeneous Setting, winning $50{-}60\\%$ of simulations (compared to 40- $42\\%$ without noise) because NNR-Linear has access to a higher quality network.   \n\u2022 Increasing to 10 neighbors: RoME, RoME-BLM perform much better than RoME-SU (the Single-User ablation) in the Heterogeneous Setting, presumably because this change enforced stronger network cohesion among highly similar users.   \n\u2022 Rescaling $\\sigma$ by 10: NNR-Linear outperforms our methods in the Heterogeneous setting. NNR-Linear and IntelPooling outperform RoME-SU (but not RoME) in the Nonlinear Setting. Both occur because NNR-Linear and IntelPooling use the true value of $\\sigma$ .   \n\u2022 Setting $\\delta$ to 0.05: NNR-Linear outperforms RoME-SU in the Nonlinear Setting, likely because this change led to insufficient exploration. ", "page_idx": 20}, {"type": "text", "text": "The results for the medium-noise sensitivity analysis are displayed in Table 5. Results for the remaining sensitivity analyses are available with our code. ", "page_idx": 20}, {"type": "text", "text": "B Additional Details for Valentine Study ", "text_level": 1, "page_idx": 20}, {"type": "text", "text": "Personalizing treatment delivery in mobile health is a common application for online learning algorithms. We focus here on the Valentine study, a prospective, randomized-controlled, remotely administered trial designed to evaluate an mHealth intervention to supplement cardiac rehabilitation for low- and moderate-risk patients (Jeganathan et al., 2022; Golbus et al., 2023). We aim to use smartwatch data (Apple Watch and Fitbit) obtained from the Valentine study to learn the optimal timing of notification delivery given the users\u2019 current context. ", "page_idx": 20}, {"type": "text", "text": "B.1 Data from the Valentine Study ", "text_level": 1, "page_idx": 20}, {"type": "text", "text": "Prior to the start of the trial, baseline data was collected from each of the participants (e.g., age, gender, baseline activity level, and health information). During the study, participants are randomized to either receive a notification $\\chi_{t}=1$ ) or not ( $\\mathit{A}_{t}=0$ ) at each of 4 daily time points (morning, lunchtime, mid-afternoon, evening), with probability 0.25. Contextual information was collected frequently (e.g., number of messages sent in prior week, step count variability in prior week, and pre-decision point step-counts). ", "page_idx": 20}, {"type": "text", "text": "Since the goal of the Valentine study is to increase participants\u2019 activity levels, we define the reward, $R_{t}$ , as the step count for the 60 minutes following a decision point (log-transformed to eliminate skew). Our application also uses a subset of the baseline and contextual data; this subset contains the variables with the strongest association with the reward. Table 6 shows the features available to the bandit in the Valentine study data set. ", "page_idx": 20}, {"type": "text", "text": "For baseline variables, we use the participant\u2019s device model $Z_{1}$ , Fitbit coded as 1), the participant\u2019s step count variability in the prior week $(Z_{2})$ , and a measure of the participant\u2019s pre-trial activity level based on an intake survey ( $Z_{3}$ , with larger values corresponding to higher activity levels). ", "page_idx": 20}, {"type": "text", "text": "Homogeneous Users ", "text_level": 1, "page_idx": 21}, {"type": "table", "img_path": "eKVugi5zr0/tmp/4087f9b1a025d89ecd816eb5014c925dcf4c2a630a7cde95fe5f414375f50ed6.jpg", "table_caption": [], "table_footnote": [], "page_idx": 21}, {"type": "text", "text": "Heterogeneous Users ", "text_level": 1, "page_idx": 21}, {"type": "table", "img_path": "eKVugi5zr0/tmp/acbd4c250b1f1f5a51335f2ffebe27a729f5bf94da4cfc6f6132d721801c80ac.jpg", "table_caption": [], "table_footnote": [], "page_idx": 21}, {"type": "text", "text": "Nonlinear ", "text_level": 1, "page_idx": 21}, {"type": "table", "img_path": "eKVugi5zr0/tmp/55a9d0cd358fb6e1ca8215643181d746e586dbe4a32c4939ce947dad0774dd85.jpg", "table_caption": [], "table_footnote": ["Table 5: Pairwise comparisons between methods in a sensitivity analysis in which we add noise to the network. As in Table 3, each cell indicates the percent of repetitions (out of 50) in which the method listed in the row outperformed the method listed in the column in term of final regret. Asterisks indicate p-values below 0.05 from paired two-sided t-tests on the differences in final regret. "], "page_idx": 21}, {"type": "table", "img_path": "eKVugi5zr0/tmp/a8f0ce2249f9835222ac0cfa3d5128efecc1601d20e5e8ad7a4d309c319efd87.jpg", "table_caption": [], "table_footnote": [], "page_idx": 21}, {"type": "text", "text": "Table 6: List of features available to the bandit in the Valentine study. The features available to model the action interaction (effect of sendin\u221ag an anti-sedentary message) and to model the baseline (reward under no action) are denoted via a ${}^{\\ast}{\\sqrt{}}^{\\ast}$ in the corresponding column, otherwise $\\times$ . ", "page_idx": 21}, {"type": "table", "img_path": "eKVugi5zr0/tmp/68705a11e7b6ff4777ec0f148a7e115a0fd7652712cfb69a6c0facfd21319a42.jpg", "table_caption": [], "table_footnote": ["Table 7: ANOVA analysis of the pseudo-outcomes in the Valentine study. The small p-values constitute strong evidence that the treatment effects differ by participant and over time. "], "page_idx": 22}, {"type": "text", "text": "At every decision point, before selecting an action, the learner sees two state variables: the participant\u2019s previous 30-minute step count $S_{1}$ , log-transformed) and the participant\u2019s phase of cardiac rehabilitation $S_{2}$ , dummy coded). The cardiac rehabilitation phase is defined based on a participant\u2019s time in the study: month 1 represents Phase I, month 2-4 represents Phase II, and month 5-6 represents Phase III. ", "page_idx": 22}, {"type": "text", "text": "B.2 Justification of Assumption 4 ", "text_level": 1, "page_idx": 22}, {"type": "text", "text": "The motivation for Assumption 4 arises from an exploratory analysis we performed using data from the Valentine study. We constructed the pseudo-reward for each observation as suggested by Equation (4) and then conducted an ANOVA test. The results show clear heterogeneity between individuals and across time, motivating the adoption of user- and time-specific random effects. The results of the ANOVA test are displayed in Table 7. Figure 9 shows the shape of the heterogeneity in the treatment effects over time. ", "page_idx": 22}, {"type": "image", "img_path": "eKVugi5zr0/tmp/c1a6d0fd49f8f1d866671a42517693779f203e3ab83037805364cb9c3e38bffa.jpg", "img_caption": ["Figure 9: The time heterogeneity in the pseudo-outcomes. We calculated the pseudo-outcomes using 4, then averaged them across participants and plotted them over time. This exploratory analysis shows evidence that the causal effects vary substantially over time. "], "img_footnote": [], "page_idx": 22}, {"type": "text", "text": "B.3 Evaluation ", "text_level": 1, "page_idx": 22}, {"type": "text", "text": "The Valentine study collected the sensor-based features at 4 decision points per day for each study participant. The reward for each message was defined to be $\\log(0.5+x)$ , where $x$ is the step count of the participant in the 60 minutes following the notification. As noted in the introduction, the baseline reward, i.e. the step count of a subject when no message is sent, not only depends on the state in a complex way but is likely dependent on a large number of time-varying observed variables. Both of these characteristics (complex, time-varying baseline reward function) suggest using our proposed approach. ", "page_idx": 22}, {"type": "text", "text": "We generated 100 bootstrap samples and ran our contextual bandit on them, considering the binary action of whether or not to send a message at a given decision point based on the contextual variables $S_{1}$ and $S_{2}$ . Each user is considered independently and with a cohesion network, for maximum personalization and independence of results. To guarantee that messages have a positive probability of being sent, we only sample the observations with notification randomization probability between 0.01 and 0.99. In the case of the algorithm utilizing NNR, we chose four baseline characteristics (gender, age, device, and baseline average daily steps) to establish a measure of \u201cdistance\u201d between users. For this analysis, the value of $k$ representing the number of nearest neighbors was set to 5. To utilize bootstrap sampling, we train the Neural-Linear method\u2019s neural network using out-of-bag samples. The neural network architecture comprises a single hidden layer with two hidden nodes. The input contains both the baseline characteristics and the contextual variables and the activation function applied here is the softplus function, defined as softplus $(x)=\\log(1+\\exp\\left(x\\right))$ . ", "page_idx": 22}, {"type": "text", "text": "", "page_idx": 23}, {"type": "text", "text": "We performed an offline evaluation of the contextual bandit algorithms using an inverse propensity score (IPS) version of the method from Li et al. (2010), where the sequence of states, actions, and rewards in the data are used to form a near-unbiased estimate of the average expected reward achieved by each algorithm, averaging over all users. ", "page_idx": 23}, {"type": "image", "img_path": "eKVugi5zr0/tmp/0a05250a4e4f7823e5a23835892d9eec74c00301a04f3a6371ba97e56822dcd0.jpg", "img_caption": ["Figure 10: (left) Unbiased estimates of the average per-trial reward for all three ablation algorithms, relative to the reward obtained under the pre-specified Valentine Study randomization policy across 20 multiple-imputed data sets. And (right) p-values from the pairwise paired t-tests. "], "img_footnote": [], "page_idx": 23}, {"type": "text", "text": "B.4 An ablation study ", "text_level": 1, "page_idx": 23}, {"type": "text", "text": "We further investigate the primary contributors to the algorithm\u2019s performance, we conducted a parallel ablation study using real-world data analysis. In this study, we compared RoME (as detailed in the main paper) with two additional methods for reference: RoME-SU and NNR-Linear. Each comparison focuses on specific elements of our algorithm to discern their impact on RoME\u2019s overall performance. ", "page_idx": 23}, {"type": "text", "text": "The differences between these methods are illustrated in Figure. 10. In this particular dataset, NNR plays a more significant role in driving the overall superior performance of our algorithm. ", "page_idx": 23}, {"type": "text", "text": "B.5 Inverse Propensity Score (IPS) offline evaluation ", "text_level": 1, "page_idx": 23}, {"type": "text", "text": "In the implemented Valentine study, the treatment was randomized with a constant probability $p_{t}=0.25$ at each time $t$ . To conduct off-policy evaluation using our proposed algorithm and the competing variations of the TS algorithm, we outline the IPS estimator for an unbiased estimate of the per-trial expected reward based on what has been studied in Li et al. (2010). ", "page_idx": 23}, {"type": "text", "text": "Given the logged data $\\mathcal{D}=\\{s_{t}=s_{t},A_{t}=a_{t},R_{t}=r_{t}\\}_{t=1}^{T}$ collected under the policy $\\mathbf{p}=\\{p_{t}\\}_{t=1}^{T}$ , and the treatment policy being evaluated $\\pi=\\{\\pi_{t}\\}_{t=1}^{T}$ , the objective of this offline estimator is to reweight the observed reward sequence $\\{R_{t}\\}_{t=1}^{T}$ to assign varying importance to actions based on the propensities of both the original and new policies in selecting them. ", "page_idx": 23}, {"type": "text", "text": "Lemma 1 (Unbiasedness of the IPS estimator). Assuming the positivity assumption in logging, which states that for any given s and $a$ , if $p_{t}(a|s)>0,$ , then we also have $\\pi_{t}(a|s)>0,$ , we can obtain an unbiased per-trial expected reward using the following IPS estimator: ", "page_idx": 23}, {"type": "equation", "text": "$$\n\\hat{R}_{I P S}=\\frac{1}{T}\\sum_{t=1}^{T}\\frac{\\pi_{t}(a_{t}|s_{t})}{p_{t}(a_{t}|s_{t})}r_{t}\n$$", "text_format": "latex", "page_idx": 23}, {"type": "text", "text": "As mentioned in the previous section, we restrict our sampling to observations with notification randomization probabilities ranging from 0.01 to 0.99. This selection criterion ensures the satisfaction of the positivity assumption. The proof essentially follows from definition, we have: ", "page_idx": 23}, {"type": "text", "text": "Proof. ", "page_idx": 24}, {"type": "equation", "text": "$$\n\\begin{array}{l}{\\displaystyle\\mathbb{E}[R_{\\mathrm{IPS}}]=\\mathbb{E}_{\\boldsymbol\\Psi}\\left[\\frac{1}{T}\\sum_{t=1}^{T}\\frac{\\pi_{t}(a_{t}|s_{t})}{p_{t}(a_{t}|s_{t})}R_{t}(a_{t},s_{t})\\right]}\\\\ {\\displaystyle=\\frac{1}{T}\\sum_{t=1}^{T}\\frac{\\pi_{t}(a_{t}|s_{t})}{p_{t}(a_{t}|s_{t})}R_{t}(a_{t},s_{t})\\times p_{t}(a_{t}|s_{t})}\\\\ {\\displaystyle=\\frac{1}{T}\\sum_{t=1}^{T}\\pi_{t}(a_{t}|s_{t})R_{t}(a_{t},s_{t})}\\\\ {\\displaystyle=\\mathbb{E}_{\\boldsymbol\\pi}\\left[\\frac{1}{T}\\sum_{t=1}^{T}R_{t}(a_{t},s_{t})\\right]}\\end{array}\n$$", "text_format": "latex", "page_idx": 24}, {"type": "text", "text": "To address the instability issue caused by reweighting in some cases, we use a Self-Normalized Inverse Propensity Score (SNIPS) estimator. This estimator scales the results by the empirical mean of the importance weights, and still maintains the property of unbiasedness. ", "page_idx": 24}, {"type": "equation", "text": "$$\n{\\hat{R}}_{\\mathrm{SNIPS}}={\\frac{{\\hat{R}}_{\\mathrm{IPS}}}{{\\frac{1}{T}}\\sum_{t=1}^{T}{\\frac{\\pi_{t}(a_{t}|s_{t})}{p_{t}(a_{t}|s_{t})}}}}={\\frac{\\sum_{t=1}^{T}{{\\frac{\\pi_{t}(a_{t}|s_{t})}{p_{t}(a_{t}|s_{t})}}r_{t}}}{\\sum_{t=1}^{T}{\\frac{\\pi_{t}(a_{t}|s_{t})}{p_{t}(a_{t}|s_{t})}}}}\n$$", "text_format": "latex", "page_idx": 24}, {"type": "text", "text": "C Additional Details for the Intern Health Study (IHS) ", "text_level": 1, "page_idx": 24}, {"type": "text", "text": "To further enhance the competitive performance of our proposed RoME algorithm, we performed an additional comparative analysis using a real-world data set from the Intern Health Study (IHS) (NeCamp et al., 2020). This micro-randomized trial investigated the use of mHealth interventions aimed at improving the behavior and mental health of individuals in stressful work environments. The estimates obtained represent the improvement in average reward relative to the original constant randomization, averaging across stages $\\mathbf{K}=30^{\\circ},$ ) and participants $(\\mathsf{N}=1553)$ ). The available IHS data consist of 20 multiple-imputed data sets. We apply the algorithms to each imputed data set and perform a comparative analysis of the competing algorithms. The results presented in Figure 11 shows our proposed RoME algorithm achieved significantly higher rewards than the other three competing ones and demonstrated performance comparable to the AC algorithm. These findings further support the advantages of our proposed algorithm. ", "page_idx": 24}, {"type": "text", "text": "C.1 Data from the IHS ", "text_level": 1, "page_idx": 24}, {"type": "text", "text": "Prior to the start of the trial, baseline data was collected on each of the participants (e.g., institution, specialty, gender, baseline activity level, and health information). During the study, participants are randomized to either receive a notification ( $\\left.A_{t}=1\\right)$ ) or not $\\left.A_{t}=0\\right]$ ) every day, with probability $3/8$ . Contextual information was collected frequently (e.g., step count in prior five days, and current day in study). ", "page_idx": 24}, {"type": "text", "text": "We define the reward, $R_{t}$ , as the step count on the following day (cubic root). Our application also uses a subset of the baseline and contextual data; this subset contains the variables with the strongest association to the reward. Table 8 shows the features available to the bandit in the IHS data set. ", "page_idx": 24}, {"type": "text", "text": "At every decision point, before selecting an action, the learner sees two state variables: the participant\u2019s previous 5-day average daily step count ( $S_{1}$ , cubic root) and the participant\u2019s day in the study $S_{2}$ , an integer from 1 to 30). ", "page_idx": 24}, {"type": "text", "text": "C.2 Evaluation ", "text_level": 1, "page_idx": 24}, {"type": "text", "text": "We run our contextual bandit on the IHS data, considering the binary action of whether or not to send a message at a given decision point based on the contextual variables $S_{1}$ and $S_{2}$ . Each user is considered independently and with a cohesion network, for maximum personalization and independence of results. To guarantee that messages have a positive probability of being sent, we only sample the observations with notification randomization probability between 0.01 and 0.99. For the algorithm employing NNR, we defined participants in the same institution as their own \u201cneighbors\". This definition enables the flexibility for the value of $k$ , representing the number of nearest neighbors, to vary for each participant based on their specific institutional context. Furthermore, in our study setting, we assume that individuals from the same institution enter the study simultaneously as a group. Due to the limited access to prior data, we are unable to build the neural linear models as in the Valentine Study. ", "page_idx": 24}, {"type": "table", "img_path": "eKVugi5zr0/tmp/60e24250d1e560f601a86f2a52041c946b339a1d03a7332c96b447ecc857ecd0.jpg", "table_caption": [], "table_footnote": ["Table 8: List of features available to the bandit in the IHS. The features available to model the action interaction (effect o\u221af sending a mobile prompt) and to model the baseline (reward under no action) are denoted via a $\\stackrel{\\leftarrow}{\\mathrm{\\tiny~v}}\\,\\stackrel{\\leftarrow}{\\mathrm{\\tiny~\\infty~}}\\,\\stackrel{\\leftarrow}{\\mathrm{\\tiny~\\infty~}}\\,\\stackrel{\\leftarrow}{\\mathrm{\\tiny~\\infty~}}\\,\\stackrel{\\leftarrow}{\\mathrm{\\tiny~\\infty~}}\\,\\stackrel{\\leftarrow}{\\mathrm{\\tiny~\\infty~}}\\,\\stackrel{\\leftarrow}{\\mathrm{\\tiny~\\infty~}}\\,\\stackrel{\\leftarrow}{\\mathrm{\\tiny~\\infty~}}$ in the corresponding column, otherwise $\\times$ . "], "page_idx": 25}, {"type": "text", "text": "", "page_idx": 25}, {"type": "text", "text": "We utilized 20 multiple-imputed data sets and performed an offline evaluation of the contextual bandit algorithms on each data set. The result is presented below in Figure 11. Similar to Section B.4, here we also compared RoME (as detailed in the main paper) with RoME-SU and NNR-Linear. The differences between these methods are illustrated in Figure. 12. In this specific dataset, both NNR and DML exhibit comparable performance individually, but their combined effect significantly enhances the overall performance of the algorithm. ", "page_idx": 25}, {"type": "text", "text": "D Additional Details for Algorithm 1 ", "text_level": 1, "page_idx": 25}, {"type": "text", "text": "This appendix briefly discusses two details of Algorithm 1. The first is efficient computation of $V^{-1}$ Because $V$ is a fairly large matrix, a full matrix inversion is expensive. Fortunately, however, we can dramatically reduce the necessary computational requirements because each additional $(i,t)$ involves a rank-one perturbation to $V$ . Consequently, we can apply the Sherman\u2013Morrison formula to speed up computations. We leveraged this trick in our implementation of RoME for the simulation study by using efficient rank-one updates available in the SuiteSparse library (Davis & Hu, 2011). ", "page_idx": 25}, {"type": "text", "text": "The second detail is the requirements for the distribution, $\\mathcal{D}^{T S}$ : ", "page_idx": 25}, {"type": "text", "text": "Definition 1. $\\mathcal{D}^{T S}$ is a multivariate distribution on $\\mathbb{R}^{d}$ absolutely continuous with respect to Lebesgue measure which satisfies: $^{l.}$ . (anti-concentration) that there exists a strictly positive probability $p$ such that for any $u\\in\\mathbb{R}^{d}$ with $\\|u\\|=1$ , $\\mathbb{P}(u^{\\top}\\eta\\geq1)\\geq p,$ ; and 2. (concentration) there exists c, $c^{\\prime}$ positive constants such that $\\forall\\delta\\in(0,1)$ , $\\begin{array}{r}{P(\\|\\eta\\|\\le\\sqrt{c d\\log(c^{\\prime}d/\\delta))}\\ge1-\\delta.}\\end{array}$ . ", "page_idx": 25}, {"type": "text", "text": "While a Gaussian prior satisfies Definition 1, this approach allows us to move beyond Bayesian posteriors to generic randomized policies. As discussed in the main paper, we recommend setting ", "page_idx": 25}, {"type": "image", "img_path": "eKVugi5zr0/tmp/ea33fd6fe61482ddfa4d431712b1f936c93139f03a66e89ac9ea22d373aa2fd5.jpg", "img_caption": [], "img_footnote": [], "page_idx": 26}, {"type": "text", "text": "Figure 11: (left) Unbiased estimates of the average per-trial reward for all four competing algorithms, relative to the reward obtained under the pre-specified Intern Health Study randomization policy across 20 multiple-imputed data sets. And (right) p-values from the pairwise paired t-tests. The dark shade in the last column indicates that the proposed RoME algorithm achieved significantly higher rewards than the other three competing algorithms while demonstrating comparable performance to the AC algorithm. ", "page_idx": 26}, {"type": "image", "img_path": "eKVugi5zr0/tmp/b544f311314fb0093912a4739bdb5835456704b0501a0ff72850c719a16b466e.jpg", "img_caption": ["Figure 12: (left) Unbiased estimates of the average per-trial reward for all three ablation algorithms, relative to the reward obtained under the pre-specified Intern Health Study randomization policy across 20 multiple-imputed data sets. And (right) p-values from the pairwise paired t-tests. "], "img_footnote": [], "page_idx": 26}, {"type": "text", "text": "$\\mathcal{D}^{T S}$ to a multivariate Gaussian distribution or multivariate t-distribution. These choices simplify computations because the probability computation in (11) simplifies to an evaluation of the CDF of either (a) a univariate Gaussian or (b) a univariate t-distribution. The mean and variance of the corresponding univariate distribution can easily be worked out using the moments of a linear combination of random variables. ", "page_idx": 26}, {"type": "text", "text": "E Regret Bound ", "text_level": 1, "page_idx": 26}, {"type": "text", "text": "E.1 Double Robustness of Pseudo-Reward ", "text_level": 1, "page_idx": 26}, {"type": "text", "text": "Going forward, we use the notation $\\Delta_{i,t}^{f}(s,\\bar{a}):=f_{i,t}(s,\\bar{a})-f_{i,t}(s,0)$ to denote the prediction of the differential reward. ", "page_idx": 26}, {"type": "text", "text": "Lemma 2. If either $p_{i,t}=\\pi_{i,t}$ or $f_{i,t}=r_{i,t},$ , then ", "page_idx": 26}, {"type": "equation", "text": "$$\n\\mathbb{E}\\left[\\tilde{R}_{i,t}^{f}|s,\\bar{a}\\right]=\\Delta_{i,t}(s,\\bar{a}).\n$$", "text_format": "latex", "page_idx": 26}, {"type": "text", "text": "That is, the pseudo-reward is an unbiased estimator of the true differential reward. ", "page_idx": 26}, {"type": "text", "text": "Proof. Recall that ", "page_idx": 26}, {"type": "equation", "text": "$$\n\\tilde{R}_{i,t}^{f}=\\frac{R_{i t}-f_{i,t}(s,A_{i,t})}{\\delta_{A_{i,t}=\\bar{a}}-\\pi_{i,t}(0|s)}+\\Delta_{i,t}^{f}(s,\\bar{a})\n$$", "text_format": "latex", "page_idx": 27}, {"type": "text", "text": "Case I: $\\pi$ \u2019s are correctly specified ", "text_level": 1, "page_idx": 27}, {"type": "text", "text": "Then ", "page_idx": 27}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{\\mathbb{E}\\left[\\frac{R_{i t}}{\\delta_{A_{i,t}=\\bar{a}}-\\pi_{i,t}(0|s)}\\bigg|s,\\bar{a}\\right]=r_{i,t}(s,\\bar{a})-r_{i,t}(s,0)}\\\\ &{~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~=\\Delta_{i,t}(s,\\bar{a})}\\end{array}\n$$", "text_format": "latex", "page_idx": 27}, {"type": "text", "text": "and ", "page_idx": 27}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{\\mathbb{E}\\left[\\frac{f_{i,t}(s,A_{i,t})}{\\delta_{A_{i,t}=\\bar{a}}-\\pi_{i,t}(0|s)}\\Big|s,\\bar{a}\\right]=f_{i,t}(s,\\bar{a})-f_{i,t}(s,0)}\\\\ &{~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~}\\\\ &{~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~=\\Delta_{i,t}^{f}(s,\\bar{a})}\\end{array}\n$$", "text_format": "latex", "page_idx": 27}, {"type": "text", "text": "so that ", "page_idx": 27}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{\\mathbb{E}\\left[\\frac{R_{i t}-f_{i,t}(s,A_{i,t})}{\\delta_{A_{i,t}=\\bar{a}}-\\pi_{i,t}(0|s)}+\\Delta_{i,t}^{f}(s,\\bar{a})\\bigg|s,\\bar{a}\\right]=\\Delta_{i,t}(s,\\bar{a})-\\Delta_{i,t}^{f}(s,\\bar{a})+\\Delta_{i,t}^{f}(s,\\bar{a})}\\\\ &{\\quad\\quad\\quad\\quad\\quad\\quad\\quad\\quad\\quad\\quad\\quad=\\Delta_{i,t}(s,\\bar{a})}\\end{array}\n$$", "text_format": "latex", "page_idx": 27}, {"type": "text", "text": "Case II: $f$ correctly specified ", "text_level": 1, "page_idx": 27}, {"type": "equation", "text": "$$\n\\mathbb{E}\\left[\\frac{R_{i t}}{\\delta_{A_{i,t}=\\bar{a}}-\\pi_{i,t}(0|s)}\\bigg|s,\\bar{a}\\right]=\\frac{1-p_{i,t}(0|s)}{1-\\pi_{i,t}(0|s)}r_{i,t}(s,\\bar{a})-\\frac{p_{i,t}(0|s)}{\\pi_{i,t}(0|s)}r_{i,t}(s,0)\n$$", "text_format": "latex", "page_idx": 27}, {"type": "text", "text": "and ", "page_idx": 27}, {"type": "equation", "text": "$$\n\\begin{array}{r}{\\mathbb{E}\\left[\\frac{f_{i,t}(s,A_{i,t})}{\\delta_{A_{i,t}=\\bar{a}}-\\pi_{i,t}(0|s)}\\Big|s,\\bar{a}\\right]=\\frac{1-p_{i,t}(0|s)}{1-\\pi_{i,t}(0|s)}f_{i,t}(s,\\bar{a})-\\frac{p_{i,t}(0|s)}{\\pi_{i,t}(0|s)}f_{i,t}(s,\\bar{0})}\\\\ {=\\frac{1-p_{i,t}(0|s)}{1-\\pi_{i,t}(0|s)}r_{i,t}(s,\\bar{a})-\\frac{p_{i,t}(0|s)}{\\pi_{i,t}(0|s)}r_{i,t}(s,\\bar{0})}\\end{array}\n$$", "text_format": "latex", "page_idx": 27}, {"type": "text", "text": "and ", "page_idx": 27}, {"type": "equation", "text": "$$\n\\mathbb{E}\\left[\\Delta_{i,t}^{f}(s,\\bar{a})\\Big\\vert s,\\bar{a}\\right]=\\Delta_{i,t}(s,\\bar{a})\n$$", "text_format": "latex", "page_idx": 27}, {"type": "equation", "text": "$$\n\\mathbb{E}\\left[\\frac{R_{i t}-f_{i,t}(s,\\bar{A}_{i,t})}{\\delta_{A_{i,t}=\\bar{a}}-\\pi_{i,t}(0|s)}+\\Delta_{i,t}^{f}(s,\\bar{a})\\Big|s,\\bar{a}\\right]=\\Delta_{i,t}(s,\\bar{a})\n$$", "text_format": "latex", "page_idx": 27}, {"type": "text", "text": "E.2 Preliminaries ", "text_level": 1, "page_idx": 27}, {"type": "text", "text": "Lemma 3. Let $X$ be a mean-zero sub-Gaussian random variable with variance factor $v^{2}$ and $Y$ be $a$ bounded random variable such that $|Y|\\le B$ for some $0\\le B<\\infty$ . Then $X Y$ is sub-Gaussian with variance factor $v^{2}B^{2}$ . ", "page_idx": 27}, {"type": "text", "text": "Proof. Recall that $X$ being mean-zero sub-Gaussian means that ", "page_idx": 27}, {"type": "equation", "text": "$$\nP(|X|\\ge t)\\le2\\exp\\left(-\\frac{t^{2}}{2v^{2}}\\right).\n$$", "text_format": "latex", "page_idx": 27}, {"type": "text", "text": "Now note that ", "page_idx": 27}, {"type": "equation", "text": "$$\n|X Y|\\le|X|B\n$$", "text_format": "latex", "page_idx": 27}, {"type": "text", "text": "so that if $\\vert X Y\\vert>t$ , then $|X|B>t$ . Thus by monotonicity ", "page_idx": 28}, {"type": "equation", "text": "$$\n\\begin{array}{l}{P(|X Y|\\geq t)\\leq P(|X|B\\geq t)\\,}\\\\ {\\qquad\\qquad\\qquad=P\\left(|X|\\geq\\displaystyle\\frac{t}{B}\\right)\\,}\\\\ {\\qquad\\qquad\\leq2\\exp\\left(-\\displaystyle\\frac{t^{2}}{2B^{2}v^{2}}\\right)}\\end{array}\n$$", "text_format": "latex", "page_idx": 28}, {"type": "text", "text": "as desired. ", "page_idx": 28}, {"type": "text", "text": "Lemma 4. If $X,Y$ are sub-Gaussian with variance factors $v_{x}^{2},\\,v_{y}^{2},$ , respectively, then $\\alpha X+\\beta Y$ is sub-Gaussian with variance factor $\\alpha^{2}v_{x}^{2}+\\beta^{2}v_{y}^{2}\\forall\\alpha,\\beta\\in\\mathbb R.$ . ", "page_idx": 28}, {"type": "text", "text": "Proof. Recall the equivalent definition of sub-Gaussianity that $X,Y$ are sub-Gaussian iff for some $b,a>0$ and all $\\lambda>0$ ", "page_idx": 28}, {"type": "equation", "text": "$$\n\\begin{array}{r}{\\mathbb{E}\\exp\\left(\\lambda(X-\\mathbb{E}X)\\right)\\leq\\exp(\\lambda^{2}v_{x}^{2}/2)}\\\\ {\\mathbb{E}\\exp\\left(\\lambda(Y-\\mathbb{E}Y)\\right)\\leq\\exp(\\lambda^{2}v_{y}^{2}/2)}\\end{array}\n$$", "text_format": "latex", "page_idx": 28}, {"type": "text", "text": "Then ", "page_idx": 28}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{\\mathbb{E}\\exp\\left(\\lambda(\\alpha X+\\beta Y-\\alpha\\mathbb{E}X-\\beta\\mathbb{E}Y)\\right)\\leq\\sqrt{\\mathbb{E}\\exp\\left(2\\alpha\\lambda(X-\\mathbb{E}X)\\right)}\\sqrt{\\mathbb{E}\\exp\\left(2\\beta\\lambda(Y-\\mathbb{E}Y)\\right)}}\\\\ &{\\leq\\sqrt{\\exp(2\\alpha^{2}\\lambda^{2}v_{x}^{2})}\\sqrt{\\exp(2\\beta^{2}\\lambda^{2}v_{y}^{2})}}\\\\ &{=\\exp((\\alpha^{2}v_{x}^{2}+\\beta^{2}v_{y}^{2})\\lambda^{2})}\\end{array}\n$$", "text_format": "latex", "page_idx": 28}, {"type": "text", "text": "The following Lemma gives the sub-Gaussianity and variance of the difference between the pseudoreward and its expectation. We see that in the variance, all terms except those involving the inverse propensity weighted noise variance vanish as $f_{i,t}$ becomes a better estimate of $\\boldsymbol{r}_{i,t}$ . Note that means and variances may be implicitly conditioned on the history. ", "page_idx": 28}, {"type": "text", "text": "Lemma 5. If $\\pi_{i,t}$ is correctly specified and $\\tilde{\\sigma}_{i,t}^{2}\\geq\\frac{1}{c}$ , the difference between the pseudo-reward and its expectation (taken wrt the action and noise) is mean zero sub-Gaussian with variance ", "page_idx": 28}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{V a r\\left(\\tilde{R}_{i,t}^{f}(s,\\bar{a})\\right)=\\frac{(r_{i,t}(s,\\bar{a})-f_{i,t}(s,\\bar{a}))^{2}\\pi_{i,t}(0|s)+V a r(\\epsilon_{i,t})}{1-\\pi_{i,t}(0|s)}}\\\\ &{\\qquad\\qquad\\qquad\\qquad+\\,\\frac{(r_{i,t}(s,0)-f_{i,t}(s,0))^{2}[1-\\pi_{i,t}(0|s)]+V a r(\\epsilon_{i,t})}{\\pi_{i,t}(0|s)}}\\\\ &{\\qquad\\qquad\\qquad\\qquad-\\,2(r_{i,t}(s,\\bar{a})-f_{i,t}(s,\\bar{a}))(r_{i,t}(s,0)-f_{i,t}(s,0))}\\end{array}\n$$", "text_format": "latex", "page_idx": 28}, {"type": "text", "text": "Proof. We need to show that it is sub-Gaussian and upper bound its variance. We write the difference as ", "page_idx": 28}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{\\tilde{R}_{i,t}^{f}(s,\\bar{a})-\\mathbb{E}[\\tilde{R}_{i,t}^{f}|s,\\bar{a}]=\\tilde{R}_{i,t}^{f}(s,\\bar{a})-\\Delta_{i,t}(s,\\bar{a})}\\\\ &{\\quad\\quad\\quad\\quad\\quad\\quad=\\frac{R_{i t}-f_{i,t}(s,\\bar{A}_{i,t})}{\\delta_{A_{i,t}=\\bar{a}}-\\pi_{i,t}(0|s)}+\\Delta_{i,t}^{f}(s,\\bar{a})-\\Delta_{i,t}(s,\\bar{a})}\\\\ &{\\quad\\quad\\quad\\quad\\quad\\quad=\\frac{r_{i,t}(s,\\bar{A}_{i,t})-f_{i,t}(s,\\bar{A}_{i,t})+\\epsilon_{i,t}}{\\delta_{A_{i,t}=\\bar{a}}-\\pi_{i,t}(0|s)}+\\Delta_{i,t}^{f}(s,\\bar{a})-\\Delta_{i,t}(s,\\bar{a})}\\end{array}\n$$", "text_format": "latex", "page_idx": 28}, {"type": "text", "text": "Note that $\\vert r_{i,t}(s,A_{i,t})\\vert$ $\\operatorname*{max}\\left(|r_{i,t}(s,\\bar{a})|,|r_{i,t}(s,0)|\\right)$ and $\\vert f_{i,t}(s,A_{i,t})\\vert$ $\\operatorname*{max}\\big(|f_{i,t}(s,\\bar{a})|,|f_{i,t}(s,0)|\\big)$ . Thus since $\\left|\\frac{1}{\\delta_{A_{i,t}=\\bar{a}}\\!-\\!\\pi_{i,t}(0|s)}\\right|$ is upper bounded by $c~>~0$ , we have that $\\frac{r_{i,t}\\left(s,A_{i,t}\\right)-f_{i,t}\\left(s,A_{i,t}\\right)}{\\delta_{A_{i,t}=\\bar{a}}-\\pi_{i,t}\\left(0|s\\right)}$ is bounded and thus (not necessarily mean zero) sub-Gaussian. Since $\\epsilon_{i,t}$ is sub-Gaussian, its denominator is bounded, and the remaining terms are deterministic, the entire difference between the pseudo-reward and its mean is sub-Gaussian. Now ", "page_idx": 28}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{\\mathrm{Var}(\\tilde{R}_{i,t}^{f}(s,\\bar{a})-\\mathbb{E}[\\tilde{R}_{i,t}^{f}|s,\\bar{a}])=\\mathrm{Var}\\left(\\tilde{R}_{i,t}^{f}(s,\\bar{a})\\right)}\\\\ &{\\quad\\quad\\quad\\quad\\quad\\quad\\quad=\\mathbb{E}\\left[\\tilde{R}_{i,t}^{f}(s,\\bar{a})^{2}\\right]-\\Delta_{i,t}(s,\\bar{a})^{2}}\\end{array}\n$$", "text_format": "latex", "page_idx": 29}, {"type": "text", "text": "since $\\mathbb{E}[\\tilde{R}_{i,t}^{f}|s,\\bar{a}]$ is not random. Now we expand the first term on the rhs. ", "page_idx": 29}, {"type": "equation", "text": "$$\n\\begin{array}{r l}{\\mathbb{E}\\left[\\tilde{R}_{i,t}^{f}(s,\\bar{a})^{2}\\right]=\\mathbb{E}\\left[\\left(\\frac{r_{i,t}(s,A_{i,t})-f_{i,t}(s,A_{i,t})+\\epsilon_{i,t}}{\\delta_{A_{i,t}=\\bar{a}}-\\pi_{i,t}(\\bar{a}|s)}+\\triangle_{i,t}^{f}(s,\\bar{a})\\right)^{2}\\right]}\\\\ {=\\mathbb{E}\\left[\\left(\\frac{r_{i,t}(s,A_{i,t})-f_{i,t}(s,A_{i,t})+\\epsilon_{i,t}}{\\delta_{A_{i,t}=\\bar{a}}-\\pi_{i,t}(\\bar{a}|s)}\\right)^{2}\\right]}\\\\ {\\quad}&{\\quad+\\,2\\mathbb{E}\\left[\\frac{r_{i,t}(s,A_{i,t})-f_{i,t}(s,A_{i,t})+\\epsilon_{i,t}}{\\delta_{A_{i,t}=\\bar{a}}-\\pi_{i,t}(0|s)}\\right]\\Delta_{i,t}^{f}(s,\\bar{a})+\\Delta_{i,t}^{f}(s,\\bar{a})^{2}}\\\\ {=\\mathbb{E}\\left[\\left(\\frac{r_{i,t}(s,A_{i,t})-f_{i,t}(s,A_{i,t})+\\epsilon_{i,t}}{\\delta_{A_{i,t}=\\bar{a}}-\\pi_{i,t}(\\bar{a}|s)}\\right)^{2}\\right]}\\\\ {\\quad}&{\\quad+\\,2(\\Delta_{i,t}(s,\\bar{a})-\\Delta_{i,t}^{f}(s,\\bar{a}))\\Delta_{i,t}^{f}(s,\\bar{a})+\\Delta_{i,t}^{f}(s,\\bar{a})^{2}}\\end{array}\n$$", "text_format": "latex", "page_idx": 29}, {"type": "text", "text": "For the first term on the rhs of Eqn. 15, ", "page_idx": 29}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{\\mathbb{E}\\left[\\left(\\frac{r_{i,t}(s,A_{i,t})-f_{i,t}(s,A_{i,t})+\\epsilon_{i,t}}{\\delta_{A_{i,t}=\\bar{a}}-\\pi_{i,t}(0|s)}\\right)^{2}\\right]}\\\\ &{\\quad=\\mathbb{E}\\left[\\left(\\frac{r_{i,t}(s,A_{i,t})-f_{i,t}(s,A_{i,t})}{\\delta_{A_{i,t}=\\bar{a}}-\\pi_{i,t}(0|s)}\\right)^{2}\\right]+\\mathbb{E}\\left[\\left(\\frac{\\epsilon_{i,t}}{\\delta_{A_{i,t}=\\bar{a}}-\\pi_{i,t}(0|s)}\\right)^{2}\\right]}\\\\ &{\\quad=\\frac{\\left(r_{i,t}(s,\\bar{a})-f_{i,t}(s,\\bar{a})\\right)^{2}+\\mathbb{E}[\\epsilon_{i,t}^{2}]}{1-\\pi_{i,t}(0|s)}+\\frac{\\left(r_{i,t}(s,0)-f_{i,t}(s,0)\\right)^{2}+\\mathbb{E}[\\epsilon_{i,t}^{2}]}{\\pi_{i,t}(0|s)}}\\end{array}\n$$", "text_format": "latex", "page_idx": 29}, {"type": "text", "text": "so that plugging this into Eqn. 15, we have ", "page_idx": 29}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{\\mathbb{E}\\left[\\tilde{R}_{i,t}^{f}(s,\\bar{a})^{2}\\right]=\\frac{\\left(r_{i,t}(s,\\bar{a})-f_{i,t}(s,\\bar{a})\\right)^{2}+\\mathbb{E}[\\epsilon_{i,t}^{2}]}{1-\\pi_{i,t}(0|s)}+\\frac{\\left(r_{i,t}(s,0)-f_{i,t}(s,0)\\right)^{2}+\\mathbb{E}[\\epsilon_{i,t}^{2}]}{\\pi_{i,t}(0|s)}}\\\\ &{\\quad\\quad\\quad\\quad\\quad\\quad+\\,2(\\Delta_{i,t}(s,\\bar{a})-\\Delta_{i,t}^{f}(s,\\bar{a}))\\Delta_{i,t}^{f}(s,\\bar{a})+\\Delta_{i,t}^{f}(s,\\bar{a})^{2}}\\end{array}\n$$", "text_format": "latex", "page_idx": 29}, {"type": "text", "text": "and plugging this into Eqn. 14 we obtain the variance. ", "page_idx": 29}, {"type": "equation", "text": "$$\n\\begin{array}{r l r}&{}&{\\mathrm{Var}\\left(\\tilde{R}_{i,t}^{f}(s,\\bar{a})\\right)=\\frac{(r_{i,t}(s,\\bar{a})-f_{i,t}(s,\\bar{a}))^{2}+\\mathrm{Var}(\\epsilon_{i,t})}{1-\\pi_{i,t}(0|s)}+\\frac{(r_{i,t}(s,0)-f_{i,t}(s,0))^{2}+\\mathrm{Var}(\\epsilon_{i,t})}{\\pi_{i,t}(0|s)}}\\\\ &{}&{+\\,2(\\Delta_{i,t}(s,\\bar{a})-\\Delta_{i,t}^{f}(s,\\bar{a}))\\Delta_{i,t}^{f}(s,\\bar{a})+\\Delta_{i,t}^{f}(s,\\bar{a})^{2}-\\Delta_{i,t}(s,\\bar{a})^{2}\\qquad(1\\leftarrow A)^{2}}\\end{array}\n$$", "text_format": "latex", "page_idx": 29}, {"type": "text", "text": "Note that ", "page_idx": 29}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{2(\\Delta_{i,t}(s,\\bar{a})-\\Delta_{i,t}^{f}(s,\\bar{a}))\\Delta_{i,t}^{f}(s,\\bar{a})+\\Delta_{i,t}^{f}(s,\\bar{a})^{2}-\\Delta_{i,t}(s,\\bar{a})^{2}}\\\\ &{=2(\\Delta_{i,t}(s,\\bar{a})-\\Delta_{i,t}^{f}(s,\\bar{a}))\\Delta_{i,t}^{f}(s,\\bar{a})-(\\Delta_{i,t}(s,\\bar{a})-\\Delta_{i,t}^{f}(s,\\bar{a}))(\\Delta_{i,t}(s,\\bar{a})+\\Delta_{i,t}^{f}(s,\\bar{a}))}\\\\ &{=(\\Delta_{i,t}(s,\\bar{a})-\\Delta_{i,t}^{f}(s,\\bar{a}))(\\Delta_{i,t}^{f}(s,\\bar{a})-\\Delta_{i,t}(s,\\bar{a}))}\\\\ &{=-(\\Delta_{i,t}(s,\\bar{a})-\\Delta_{i,t}^{f}(s,\\bar{a}))^{2}}\\end{array}\n$$", "text_format": "latex", "page_idx": 29}, {"type": "text", "text": "and plugging this into Eqn. 16, ", "page_idx": 29}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{\\mathrm{Var}\\left(\\tilde{R}_{i,t}^{f}(s,\\bar{a})\\right)=\\frac{(r_{i,t}(s,\\bar{a})-f_{i,t}(s,\\bar{a}))^{2}+\\mathrm{Var}(\\epsilon_{i,t})}{1-\\pi_{i,t}(0|s)}+\\frac{(r_{i,t}(s,0)-f_{i,t}(s,0))^{2}+\\mathrm{Var}(\\epsilon_{i,t})}{\\pi_{i,t}(0|s)}}\\\\ &{\\qquad\\qquad\\qquad\\qquad-\\left(\\Delta_{i,t}(s,\\bar{a})-\\Delta_{i,t}^{f}(s,\\bar{a})\\right)^{2}}\\end{array}\n$$", "text_format": "latex", "page_idx": 29}, {"type": "text", "text": "as desired. Now note that ", "page_idx": 30}, {"type": "equation", "text": "$$\n\\begin{array}{r l r}&{}&{\\Big(\\Delta_{i,t}(s,\\bar{a})-\\Delta_{i,t}^{f}(s,\\bar{a})\\Big)^{2}=\\big(r_{i,t}(s,\\bar{a})-r_{i,t}(s,0)-\\big(f_{i,t}(s,\\bar{a})-f_{i,t}(s,0)\\big)\\big)^{2}}\\\\ &{}&{\\quad=\\big(r_{i,t}(s,\\bar{a})-f_{i,t}(s,\\bar{a})-\\big(r_{i,t}(s,0)-f_{i,t}(s,0)\\big)\\big)^{2}}\\\\ &{}&{\\quad=\\big(r_{i,t}(s,\\bar{a})-f_{i,t}(s,\\bar{a})\\big)^{2}+\\big(r_{i,t}(s,0)-f_{i,t}(s,0)\\big)^{2}}\\\\ &{}&{\\quad\\quad-\\,2\\big(r_{i,t}(s,\\bar{a})-f_{i,t}(s,\\bar{a})\\big)\\big(r_{i,t}(s,0)-f_{i,t}(s,0)\\big)}\\end{array}\n$$", "text_format": "latex", "page_idx": 30}, {"type": "text", "text": "so that ", "page_idx": 30}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{\\mathrm{Var}\\left(\\tilde{R}_{i,t}^{f}(s,\\bar{a})\\right)=\\frac{(r_{i,t}(s,\\bar{a})-f_{i,t}(s,\\bar{a}))^{2}\\pi_{i,t}(0|s)+\\mathrm{Var}(\\epsilon_{i,t})}{1-\\pi_{i,t}(0|s)}}\\\\ &{\\qquad\\qquad\\qquad\\qquad+\\,\\frac{(r_{i,t}(s,0)-f_{i,t}(s,0))^{2}[1-\\pi_{i,t}(0|s)]+\\mathrm{Var}(\\epsilon_{i,t})}{\\pi_{i,t}(0|s)}}\\\\ &{\\qquad\\qquad\\qquad\\qquad-\\,2(r_{i,t}(s,\\bar{a})-f_{i,t}(s,\\bar{a}))(r_{i,t}(s,0)-f_{i,t}(s,0))}\\end{array}\n$$", "text_format": "latex", "page_idx": 30}, {"type": "text", "text": "Corollary 1. ", "text_level": 1, "page_idx": 30}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{\\mathfrak{L}_{p(s,\\bar{a})}\\left[V a r\\left(\\tilde{R}_{i,t}^{f}(s,\\bar{a})\\right)\\right]\\leq\\frac{\\mathbb{E}_{p(s,\\bar{a})}\\left[\\left(r_{i,t}(s,\\bar{a})-f_{i,t}(s,\\bar{a})\\right)^{2}\\right]\\pi_{i,t}(0|s)+V a r(\\epsilon_{i,t})}{1-\\pi_{i,t}(0|s)}}\\\\ &{\\qquad\\qquad\\qquad\\qquad\\qquad+\\,\\frac{\\mathbb{E}_{p(s,\\bar{a})}\\left[\\left(r_{i,t}(s,0)-f_{i,t}(s,0)\\right)^{2}\\right]\\left[1-\\pi_{i,t}(0|s)\\right]+V a r(\\epsilon_{i,t})}{\\pi_{i,t}(0|s)}}\\\\ &{\\qquad\\qquad\\qquad\\qquad\\qquad+\\,2\\sqrt{\\mathbb{E}_{p(s,\\bar{a})}\\left[(r_{i,t}(s,\\bar{a})-f_{i,t}(s,\\bar{a}))^{2}\\right]}\\sqrt{\\mathbb{E}_{p(s)}\\left[(r_{i,t}(s,0)-f_{i,t}(s,0))\\right]}}\\end{array}\n$$", "text_format": "latex", "page_idx": 30}, {"type": "text", "text": "Proof. It follows immediately by taking expectations and applying Cauchy Schwartz. ", "page_idx": 30}, {"type": "text", "text": "Corollary 2. $(r_{i,t}(\\cdot,0)-f_{i,t}(\\cdot,0))^{2}=o_{P}(k^{-1/2})$ and $(r_{i,t}(\\cdot,\\bar{a})-f_{i,t}(\\cdot,\\bar{a}))^{2}=o_{P}(k^{-1/2})$ ", "page_idx": 30}, {"type": "text", "text": "Proof. Note that ", "page_idx": 30}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{P\\left((r_{i,t}(\\cdot,0)-f_{i,t}(\\cdot,0))^{2}k^{1/2}>C\\right)\\leq\\frac{\\mathbb{E}_{p(\\mathcal{H}_{k-1})}\\mathbb{E}_{p(s)}\\left[(r_{i,t}(s,0)-f_{i,t}(s,0))^{2}\\right]k^{1/2}}{C}}\\\\ &{\\qquad\\qquad\\qquad\\qquad\\qquad=\\frac{\\mathbb{E}_{p(\\mathcal{H}_{k-1})}o_{P}(k^{-1/2})k^{1/2}}{C}\\operatorname{Assumption}3}\\\\ &{\\qquad\\qquad\\qquad\\qquad=\\frac{\\mathbb{E}_{p(\\mathcal{H}_{k-1})}o_{P}(1)}{C}}\\\\ &{\\qquad\\qquad\\qquad\\qquad\\qquad\\leq\\delta\\mathrm{~for~sufficiently~large\\}k}\\end{array}\n$$", "text_format": "latex", "page_idx": 30}, {"type": "text", "text": "so that $(r_{i,t}(\\cdot,0)-f_{i,t}(\\cdot,0))^{2}=o_{P}(k^{-1/2})$ . In the second to last line we used that since $r_{i,t},f_{i,t}$ are bounded, $\\mathbb{E}_{p(s)}\\left[(r_{i,t}(s,0)-f_{i,t}(s,0))^{2}\\right]$ is bounded. For bounded random variables, convergence in probability implies convergence in mean. A similar result holds when using $\\bar{a}$ instead of $0$ \uff1a\u53e3 ", "page_idx": 30}, {"type": "text", "text": "Corollary 3. ", "text_level": 1, "page_idx": 30}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\! \n$$", "text_format": "latex", "page_idx": 30}, {"type": "text", "text": "Proof. This follows immediately from the previous two Corollaries. ", "page_idx": 30}, {"type": "text", "text": "Corollary 4. For all $\\delta>0$ , there exists $C>0$ s.t. w.p. at least $1-\\delta_{i}$ , ", "page_idx": 30}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{\\lambda a r\\left(\\tilde{R}_{i,t}^{f}(s,\\bar{a})\\right)\\leq\\frac{C k^{-1/2}\\pi_{i,t}(0|s)+V a r(\\epsilon_{i,t})}{1-\\pi_{i,t}(0|s)}+\\frac{C k^{-1/2}[1-\\pi_{i,t}(0|s)]+V a r(\\epsilon_{i,t})}{\\pi_{i,t}(0|s)}+2C k^{-1/2}}\\\\ &{\\equiv v_{k}^{2}}\\end{array}\n$$", "text_format": "latex", "page_idx": 30}, {"type": "text", "text": "Proof. By the definition of $O P$ , if $(f_{i,t}-r_{i,t})^{2}=o_{P}(k^{-1/2})$ for any $A>0,\\delta>0$ , there exists $K$ s.t. if $K>k$ , then w.p. at least $1-\\delta$ , ", "page_idx": 31}, {"type": "equation", "text": "$$\n\\begin{array}{r}{(f_{i,t}-r_{i,t})^{2}\\leq A k^{-1/2}.}\\end{array}\n$$", "text_format": "latex", "page_idx": 31}, {"type": "text", "text": "Then for all $k\\in\\mathbb{N}$ , since $f,r$ are bounded ", "page_idx": 31}, {"type": "equation", "text": "$$\n(f_{i,t}-r_{i,t})^{2}\\leq16B^{2}I(k\\leq K)+I(k>K)A k^{-1/2}.\n$$", "text_format": "latex", "page_idx": 31}, {"type": "text", "text": "Now choose ", "page_idx": 31}, {"type": "equation", "text": "$$\nC\\equiv\\operatorname*{max}\\left(A,16B^{2}K^{1/2}\\right).\n$$", "text_format": "latex", "page_idx": 31}, {"type": "text", "text": "Remark 1. In the limit as $k\\rightarrow\\infty$ ", "page_idx": 31}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{\\tilde{\\sigma}_{i,t}^{2}V a r\\left(\\tilde{R}_{i,t}^{f}(s,\\bar{a})\\right)\\leq\\pi_{i,t}(0|s)V a r(\\epsilon_{i,t})+(1-\\pi_{i,t}(0|s))V a r(\\epsilon_{i,t})}\\\\ &{\\qquad\\qquad\\qquad\\qquad=V a r(\\epsilon_{i,t})}\\end{array}\n$$", "text_format": "latex", "page_idx": 31}, {"type": "text", "text": "In the next remark, we show what the variance would be if we did not use DML and estimate $f_{i,t}\\approx r_{i,t}$ , but used only the inverse propensity weighted observed reward as the pseudo-reward. This was done in Greenewald et al. (2017). In this case, there are terms dependent on the mean reward that do not vanish as the number of stages goes to infinity. ", "page_idx": 31}, {"type": "text", "text": "Remark 2. If we instead used as our pseudo-reward the inverse propensity weighted observed reward ", "page_idx": 31}, {"type": "equation", "text": "$$\n\\tilde{R}_{i,t}(s,\\bar{a})=\\frac{R_{i t}}{\\delta_{A_{i,t}=\\bar{a}}-\\pi_{i,t}(0|s)}\n$$", "text_format": "latex", "page_idx": 31}, {"type": "text", "text": "this would be unbiased with variance ", "page_idx": 31}, {"type": "equation", "text": "$$\nv_{k}^{2}\\equiv\\frac{r_{i,t}(s,\\bar{a})^{2}+V a r(\\epsilon_{i,t})}{1-\\pi_{i,t}(0|s)}+\\frac{r_{i,t}(s,0)^{2}+V a r(\\epsilon_{i,t})}{\\pi_{i,t}(0|s)}-\\Delta_{i,t}(s,\\bar{a})^{2}\n$$", "text_format": "latex", "page_idx": 31}, {"type": "text", "text": "Proof. The unbiasedness is clear from our proof of Lemma 2. For the variance, ", "page_idx": 31}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{\\mathrm{Var}\\left(\\frac{R_{i t}}{\\delta_{A_{i,t}=\\bar{a}}-\\pi_{i,t}(0|s)}\\right)=\\mathbb{E}\\left[\\frac{(r_{i,t}(s,\\bar{a})+\\epsilon_{i,t})^{2}}{1-\\pi_{i,t}(0|s)}+\\frac{(r_{i,t}(s,0)+\\epsilon_{i,t})^{2}}{\\pi_{i,t}(0|s)}\\right]-\\Delta_{i,t}(s,\\bar{a})^{2}}\\\\ &{\\quad\\quad\\quad\\quad\\quad\\quad\\quad=\\frac{r_{i,t}(s,\\bar{a})^{2}+\\mathrm{Var}(\\epsilon_{i,t})}{1-\\pi_{i,t}(0|s)}+\\frac{r_{i,t}(s,0)^{2}+\\mathrm{Var}(\\epsilon_{i,t})}{\\pi_{i,t}(0|s)}-\\Delta_{i,t}(s,\\bar{a})^{2}}\\end{array}\n$$", "text_format": "latex", "page_idx": 31}, {"type": "text", "text": "Here we collect some important results. We first adapt an important concentration inequality for regularized least-squares estimates. Our proof follows the same basic strategy as Abbasi-Yadkori et al. (2011), but with modifications due to (a) the use of weighted least squares (b) the use of pseudo-rewards to estimate differential rewards (c) replacing the scaled diagonal regularization with Laplacian regularization. ", "page_idx": 31}, {"type": "text", "text": "Lemma 6 (Adapted from Theorem 2 in Abbasi-Yadkori et al. (2011)). Let $\\hat{\\theta}_{k}$ be the stage $k$ regularized least squares (RLS) estimate from Algorithm $^{\\,I}$ and $\\theta^{*}$ the ground truth where we assume $\\|\\bar{\\theta}^{*}\\|\\leq S$ . For any $\\delta>0$ , $w.p$ . at least $1-\\delta$ the estimates $\\{\\theta_{k}\\}_{k=0}^{\\infty}$ satisfies for any $\\{x_{k}\\}_{k=0}^{\\infty}$ , ", "page_idx": 31}, {"type": "equation", "text": "$$\n|x_{k}^{\\top}(\\hat{\\theta}_{k}-\\theta^{*})|\\leq\\|x_{k}\\|_{V_{k}^{-1}}\\left(v_{k}\\sqrt{2\\log\\left(\\frac{\\operatorname*{det}(V_{k})^{1/2}\\operatorname*{det}(V_{0})^{-1/2}}{\\delta}\\right)}+\\|\\theta^{*}\\|_{V_{0}}\\right),\n$$", "text_format": "latex", "page_idx": 31}, {"type": "text", "text": "where $v_{k}^{2}$ is the variance factor for the difference between the pseudo-reward and its mean at stage $k$ . In particular, setting $x_{k}=V_{k}(\\hat{\\theta}_{k}-\\theta^{*})$ implies ", "page_idx": 31}, {"type": "equation", "text": "$$\n\\|\\hat{\\theta}_{k}-\\theta^{*}\\|_{V_{k}}\\leq v_{k}\\sqrt{2\\log\\left(\\frac{\\operatorname*{det}(V_{k})^{1/2}\\operatorname*{det}(V_{0})^{-1/2}}{\\delta}\\right)}+\\|\\theta^{*}\\|_{V_{0}}\n$$", "text_format": "latex", "page_idx": 31}, {"type": "text", "text": "holds w.p. at least $1-\\delta$ for all $k\\geq1$ . ", "page_idx": 31}, {"type": "text", "text": "Proof. Let $m_{i,t}=\\tilde{\\sigma}_{i,t}\\phi(\\mathbf{x}_{i,t})$ and $\\rho_{i,t}=\\tilde{\\sigma}_{i,t}[\\tilde{R}_{i,t}^{f}(s,\\bar{a})-\\mathbb{E}[\\tilde{R}_{i,t}^{f}|s,\\bar{a}]]$ . Further let ", "page_idx": 32}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{\\xi_{k}\\equiv\\displaystyle\\sum_{(i,t)\\in\\mathcal{O}_{k-1}}\\tilde{\\sigma}_{i,t}^{2}[\\tilde{R}_{i,t}^{f}(s,\\bar{a})-\\mathbb{E}[\\tilde{R}_{i,t}^{f}|s,\\bar{a}]]\\phi(\\mathbf{x}_{i,t})}\\\\ &{\\quad=\\displaystyle\\sum_{(i,t)\\in\\mathcal{O}_{k-1}}\\tilde{\\sigma}_{i,t}[\\tilde{R}_{i,t}^{f}(s,\\bar{a})-\\mathbb{E}[\\tilde{R}_{i,t}^{f}|s,\\bar{a}]]m_{i,t}}\\\\ &{\\quad=\\displaystyle\\sum_{(i,t)\\in\\mathcal{O}_{k-1}}m_{i,t}\\rho_{i,t}}\\end{array}\n$$", "text_format": "latex", "page_idx": 32}, {"type": "text", "text": "Then noting that $\\begin{array}{r}{V_{k}=\\sum_{(i,t)\\in\\mathcal{O}_{k-1}}m_{i,t}m_{i,t}^{\\top}+V_{0}}\\end{array}$ and $\\begin{array}{r}{b_{k}=\\sum_{(i,t)\\in\\mathcal{O}_{k-1}}\\sigma_{i,t}^{2}\\tilde{R}_{i,t}^{f}\\phi_{i,t}}\\end{array}$ and letting $W_{k}$ be the diagonal matrix of weights $\\tilde{\\sigma}_{i,t}^{2}$ , we have ", "page_idx": 32}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{\\hat{\\theta}_{k}=V_{k}^{-1}b_{k}}\\\\ &{\\quad=V_{k}^{-1}(\\xi_{k}+\\Phi_{k}^{\\top}W_{k}\\mathbb{E}[R_{k}^{f_{k}}|\\bar{a},s])}\\\\ &{\\quad=V_{k}^{-1}\\xi_{k}+V_{k}^{-1}\\Phi_{k}^{\\top}W_{k}\\Delta_{k}\\mathrm{\\;by\\;Lemma\\;2}}\\\\ &{\\quad=V_{k}^{-1}\\xi_{k}+V_{k}^{-1}\\Phi_{k}^{\\top}W_{k}\\Phi_{k}\\theta^{*}}\\\\ &{\\quad=V_{k}^{-1}\\xi_{k}+V_{k}^{-1}(\\Phi_{k}^{\\top}W_{k}\\Phi_{k}+V_{0})\\theta^{*}-V_{k}^{-1}V_{0}\\theta^{*}}\\\\ &{\\quad=V_{k}^{-1}\\xi_{k}+\\theta^{*}-V_{k}^{-1}V_{0}\\theta_{k}^{*}}\\end{array}\n$$", "text_format": "latex", "page_idx": 32}, {"type": "text", "text": "and thus ", "page_idx": 32}, {"type": "equation", "text": "$$\n\\hat{\\theta}_{k}-\\theta^{*}=V_{k}^{-1}(\\xi_{k}-V_{0}\\theta^{*})\n$$", "text_format": "latex", "page_idx": 32}, {"type": "text", "text": "which gives ", "page_idx": 32}, {"type": "equation", "text": "$$\n|x_{k}^{\\top}\\hat{\\theta}_{k}-x_{k}^{\\top}\\theta^{*}|\\leq\\|x_{k}\\|_{V_{k}^{-1}}(\\|\\xi_{k}\\|_{V_{k}^{-1}}+\\|V_{0}\\theta^{*}\\|_{V_{k}^{-1}})\n$$", "text_format": "latex", "page_idx": 32}, {"type": "text", "text": "Now since $\\xi_{k}$ is sub-Gaussian with variance factor $v_{k}^{2}$ , by Theorem 1 in Abbasi-Yadkori et al. (2011), w.p. $1-\\delta$ , ", "page_idx": 32}, {"type": "equation", "text": "$$\n\\|\\xi_{k}\\|_{V_{k}^{-1}}^{2}\\leq2v_{k}^{2}\\log\\left({\\frac{\\operatorname*{det}(V_{k})^{1/2}\\operatorname*{det}(V_{0})^{-1/2}}{\\delta}}\\right)\n$$", "text_format": "latex", "page_idx": 32}, {"type": "text", "text": "Further note that since $V_{0}\\preceq V_{k}$ , then $V_{k}^{-1}\\preceq V_{0}^{-1}$ . Thus ", "page_idx": 32}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{\\|V_{0}\\theta^{*}\\|_{V_{k}^{-1}}^{2}=\\theta^{*^{\\top}}V_{0}^{\\top}V_{k}^{-1}V_{0}\\theta^{*}}\\\\ &{\\qquad\\qquad\\leq\\theta^{*^{\\top}}V_{0}^{\\top}V_{0}^{-1}V_{0}\\theta^{*}}\\\\ &{\\qquad\\qquad=\\theta^{*^{\\top}}V_{0}\\theta^{*}.}\\end{array}\n$$", "text_format": "latex", "page_idx": 32}, {"type": "text", "text": "Finally, setting $x_{k}=V_{k}(\\hat{\\theta}_{k}-\\theta^{*})$ implies ", "page_idx": 32}, {"type": "equation", "text": "$$\n\\begin{array}{r l}{\\bigl\\|\\dot{\\theta}_{k}-\\theta^{*}\\bigr\\|_{V_{k}}^{2}=(\\dot{\\theta}_{k}-\\theta^{*})^{\\top}V_{k}(\\hat{\\theta}_{k}-\\theta^{*})}&{}\\\\ {=|x_{k}^{\\top}\\hat{\\theta}_{k}-x_{k}^{\\top}\\theta^{*}|}&{}\\\\ {\\leq\\|x_{k}\\|_{V_{k}^{-1}}\\left(v_{k}\\sqrt{2\\log\\left(\\frac{\\operatorname*{det}(V_{k}^{-1})^{1/2}\\operatorname*{det}(V_{0})^{-1/2}}{\\delta}\\right)}+\\sqrt{\\theta^{*\\top}V_{0}\\theta^{*}}\\right)}&{}\\\\ {=\\|V_{k}(\\hat{\\theta}_{k}-\\theta^{*})\\|_{V_{k}^{-1}}\\left(v_{k}\\sqrt{2\\log\\left(\\frac{\\operatorname*{det}(V_{k}^{-1})^{1/2}\\operatorname*{det}(V_{0})^{-1/2}}{\\delta}\\right)}+\\sqrt{\\theta^{*\\top}V_{0}\\theta^{*}}\\right)}&{}\\\\ {=\\|\\hat{\\theta}_{k}-\\theta^{*}\\|_{V_{k}}\\left(v_{k}\\sqrt{2\\log\\left(\\frac{\\operatorname*{det}(V_{k}^{-1})^{1/2}\\operatorname*{det}(V_{0})^{-1/2}}{\\delta}\\right)}+\\sqrt{\\theta^{*\\top}V_{0}\\theta^{*}}\\right)}&{}\\end{array}\n$$", "text_format": "latex", "page_idx": 32}, {"type": "text", "text": "and dividing both sides by $\\lVert\\hat{{\\boldsymbol{\\theta}}}_{k}-{\\boldsymbol{\\theta}}^{*}\\rVert_{V_{k}}$ implies ", "page_idx": 32}, {"type": "equation", "text": "$$\n\\|\\hat{\\theta}_{k}-\\theta^{*}\\|_{V_{k}}\\leq v_{k}\\sqrt{2\\log\\left(\\frac{\\operatorname*{det}(V_{k})^{1/2}\\operatorname*{det}(V_{0})^{-1/2}}{\\delta}\\right)}+\\sqrt{\\theta^{*\\top}V_{0}\\theta^{*}}\n$$", "text_format": "latex", "page_idx": 32}, {"type": "text", "text": "In the above inequality, we will need to bound $\\Vert\\theta^{*}\\Vert_{V_{0}}$ in order to obtain useful confidence sets. ", "page_idx": 33}, {"type": "text", "text": "Lemma 7. ", "page_idx": 33}, {"type": "equation", "text": "$$\n\\begin{array}{r}{\\|\\theta^{*}\\|_{V_{0}}\\leq\\sqrt{\\gamma}B_{s h a r e d}+\\sqrt{\\lambda W K}(\\sqrt{D_{u s e r}}+\\sqrt{D_{t i m e}})+\\sqrt{\\gamma W K}(B_{u s e r}+B_{t i m e}).}\\end{array}\n$$", "text_format": "latex", "page_idx": 33}, {"type": "text", "text": "Proof. Recall that ", "page_idx": 33}, {"type": "equation", "text": "$$\nV_{0}=\\mathrm{diag}(\\gamma I_{p},\\lambda L_{\\otimes}^{\\mathrm{user}}+\\gamma I_{K p},\\lambda L_{\\otimes}^{\\mathrm{time}}+\\gamma I_{K p}),\n$$", "text_format": "latex", "page_idx": 33}, {"type": "text", "text": "Then ", "page_idx": 33}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{\\theta^{*\\top}V_{0}\\theta^{*}=\\gamma\\Vert\\theta_{\\mathrm{shared}}\\Vert^{2}+\\lambda\\mathrm{tr}\\left(\\Theta_{\\mathrm{user}}^{\\top}L^{\\mathrm{user}}\\Theta_{\\mathrm{user}}\\right)+\\gamma\\mathrm{tr}\\left(\\Theta_{\\mathrm{user}}^{\\top}I_{K_{p}}\\Theta_{\\mathrm{user}}\\right)}\\\\ &{\\qquad\\qquad+\\lambda\\mathrm{tr}\\left(\\Theta_{\\mathrm{time}}^{\\top}L^{\\mathrm{time}}\\Theta_{\\mathrm{time}}\\right)+\\gamma\\mathrm{tr}\\left(\\Theta_{\\mathrm{time}}^{\\top}I_{K_{p}}\\Theta_{\\mathrm{time}}\\right)}\\\\ &{\\qquad=\\gamma\\Vert\\theta_{\\mathrm{shared}}\\Vert^{2}+\\lambda\\displaystyle\\sum_{(i,j)\\in E_{\\mathrm{user}}}\\Vert\\theta_{i}^{\\mathrm{user}}-\\theta_{j}^{\\mathrm{user}}\\Vert_{2}^{2}+\\lambda\\displaystyle\\sum_{(i,j)\\in E_{\\mathrm{ime}}}\\Vert\\theta_{i}^{\\mathrm{time}}-\\theta_{j}^{\\mathrm{time}}\\Vert_{2}^{2}}\\\\ &{\\qquad\\qquad+\\gamma\\Vert\\Theta_{\\mathrm{user}}\\Vert_{F}^{2}+\\gamma\\Vert\\Theta_{\\mathrm{time}}\\Vert_{F}^{2}}\\\\ &{\\leq\\gamma B_{\\mathrm{shared}}^{2}+\\lambda W K(D_{\\mathrm{user}}+D_{\\mathrm{time}})+\\gamma W K(B_{\\mathrm{user}}^{2}+B_{\\mathrm{time}}^{2})\\mathrm{~by~Assumptic~}}\\end{array}\n$$", "text_format": "latex", "page_idx": 33}, {"type": "text", "text": "where we assume that each user and time have at most $m$ neighbors. Now using ${\\sqrt{a+b}}\\leq{\\sqrt{a}}+{\\sqrt{b}}$ for $a,b>0$ we have ", "page_idx": 33}, {"type": "equation", "text": "$$\n\\begin{array}{r}{\\sqrt{\\theta^{*}\\top\\boldsymbol{V}_{0}\\theta^{*}}\\leq\\sqrt{\\gamma}B_{\\mathrm{shared}}+\\sqrt{\\lambda W K}(\\sqrt{D_{\\mathrm{user}}}+\\sqrt{D_{\\mathrm{time}}})+\\sqrt{\\gamma W K}(B_{\\mathrm{user}}+B_{\\mathrm{time}}).}\\end{array}\n$$", "text_format": "latex", "page_idx": 33}, {"type": "text", "text": "We will also want to bound the log determinant terms. The next two Lemmas show us how to do so.   \nLemma 8. ", "page_idx": 33}, {"type": "equation", "text": "$$\nd e t(V_{K+1})\\le\\left(\\frac{\\frac{3K(K+1)}{8}+\\gamma(2K+1)p+2\\lambda M K p}{(2K+1)p}\\right)^{(2K+1)p}\n$$", "text_format": "latex", "page_idx": 33}, {"type": "text", "text": "Proof. By AM-GM inequality, ", "page_idx": 33}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{\\operatorname*{det}(V_{K+1})=\\operatorname*{det}\\left(\\sum_{(i,t)\\in\\mathcal{O}_{K}}\\tilde{\\sigma}_{i,t}^{2}\\phi(x_{i,t})\\phi(x_{i,t})^{\\top}+V_{0}\\right)}\\\\ &{\\qquad\\qquad\\leq\\left(\\frac{\\operatorname{tr}\\left(\\sum_{(i,t)\\in\\mathcal{O}_{K}}\\tilde{\\sigma}_{i,t}^{2}\\phi(x_{i,t})\\phi(x_{i,t})^{\\top}+V_{0}\\right)}{(2K+1)p}\\right)^{(2K+1)p}}\\end{array}\n$$", "text_format": "latex", "page_idx": 33}, {"type": "text", "text": "Now ", "page_idx": 33}, {"type": "equation", "text": "$$\n\\begin{array}{r l r}{\\lefteqn{\\mathrm{tr}\\left(\\sum_{(i,t)\\in\\mathcal{O}_{K}}\\tilde{\\sigma}_{i,t}^{2}\\phi(x_{i,t})\\phi(x_{i,t})^{\\top}\\right)\\leq\\sum_{(i,t)\\in\\mathcal{O}_{K}}\\tilde{\\sigma}_{i,t}^{2}\\|\\phi(x_{i,t})\\|_{2}^{2}}}\\\\ &{}&{\\leq\\frac{3}{4}\\frac{K(K+1)}{2}.}\\end{array}\n$$", "text_format": "latex", "page_idx": 33}, {"type": "text", "text": "Recall that $V_{0}=\\mathrm{diag}(\\gamma I_{p},\\lambda L_{\\otimes}^{\\mathrm{user}}+\\gamma I_{K p},\\lambda L_{\\otimes}^{\\mathrm{time}}+\\gamma I_{K p})$ , so that ", "page_idx": 33}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{\\mathrm{tr}(V_{0})=\\gamma\\left(\\mathrm{tr}(I_{p})+\\mathrm{tr}(I_{K_{p}})+\\mathrm{tr}(I_{K_{p}})\\right)+\\lambda\\left(\\mathrm{tr}(L_{\\otimes}^{\\mathrm{user}})+\\mathrm{tr}(L_{\\otimes}^{\\mathrm{time}})\\right)}\\\\ &{\\qquad\\quad=\\gamma(2K+1)p+\\lambda\\left(\\mathrm{tr}(L^{\\mathrm{user}})\\mathrm{tr}(I_{p})+\\mathrm{tr}(L^{\\mathrm{time}})\\mathrm{tr}(I_{p})\\right)}\\\\ &{\\qquad\\quad=\\gamma(2K+1)p+\\lambda p(\\mathrm{tr}(L^{\\mathrm{user}})+\\mathrm{tr}(L^{\\mathrm{time}}))}\\\\ &{\\qquad\\quad\\leq\\gamma(2K+1)p+2\\lambda W K p}\\end{array}\n$$", "text_format": "latex", "page_idx": 33}, {"type": "text", "text": "and thus ", "page_idx": 33}, {"type": "equation", "text": "$$\n\\operatorname*{det}(V_{K+1})\\le\\left(\\frac{\\frac{3K(K+1)}{8}+\\gamma(2K+1)p+2\\lambda M K p}{(2K+1)p}\\right)^{(2K+1)p}\n$$", "text_format": "latex", "page_idx": 33}, {"type": "text", "text": "Lemma 9. ", "text_level": 1, "page_idx": 34}, {"type": "equation", "text": "$$\n\\log\\frac{d e t(V_{K})}{d e t(V_{0})}\\le(2K+1)p\\log\\left(\\frac{3K(K+1)}{\\gamma8(2K+1)p}+1+\\frac{2\\lambda M K}{\\gamma(2K+1)}\\right)\n$$", "text_format": "latex", "page_idx": 34}, {"type": "text", "text": "Proof. Note that ", "page_idx": 34}, {"type": "equation", "text": "$$\n\\operatorname*{det}(V_{0})\\geq\\gamma^{(2K+1)p},\n$$", "text_format": "latex", "page_idx": 34}, {"type": "text", "text": "so that ", "page_idx": 34}, {"type": "equation", "text": "$$\n\\frac{\\mathsf{d e t}(V_{K})}{\\mathsf{d e t}(V_{0})}\\le\\left(\\frac{\\frac{3K(K+1)}{8}+\\gamma(2K+1)p+2\\lambda M K p}{\\gamma(2K+1)p}\\right)^{(2K+1)p}\n$$", "text_format": "latex", "page_idx": 34}, {"type": "text", "text": "Taking the log, we have ", "page_idx": 34}, {"type": "equation", "text": "$$\n\\begin{array}{r}{\\log\\frac{\\mathrm{det}(V_{K})}{\\mathrm{det}(V_{0})}\\leq\\log\\left(\\frac{\\frac{3K(K+1)}{8}+\\gamma(2K+1)p+2\\lambda M K p}{\\gamma(2K+1)p}\\right)^{(2K+1)p}}\\\\ {\\leq(2K+1)p\\log\\left(\\frac{3K(K+1)}{\\gamma8(2K+1)p}+1+\\frac{2\\lambda M K}{\\gamma(2K+1)}\\right)}\\end{array}\n$$", "text_format": "latex", "page_idx": 34}, {"type": "text", "text": "Corollary 5. If Assumption $^3$ , then for any $\\delta>0$ , there exists $C>0$ s.t. w.p. at least $1-\\delta$ the estimates $\\{\\hat{\\theta}_{k}\\}_{k=0}^{\\infty}$ in Algorithm 2 satisfies for any $\\{x_{k}\\}_{k=0}^{\\infty}$ , ", "page_idx": 34}, {"type": "equation", "text": "$$\n|x_{k}^{\\top}(\\hat{\\theta}_{k}-\\theta^{*})|\\leq\\|x_{k}\\|_{V_{k}^{-1}}\\left(\\left(\\frac{C}{k^{1/2}}+\\sigma^{2}c^{2}\\right)\\sqrt{2\\log\\left(\\frac{\\operatorname*{det}(V_{k})^{1/2}\\operatorname*{det}(V_{0})^{-1/2}}{\\delta/2}\\right)}+\\|\\theta^{*}\\|_{V_{0}}\\right),\n$$", "text_format": "latex", "page_idx": 34}, {"type": "text", "text": "In particular, setting $x_{k}=V_{k-1}(\\hat{\\theta}_{k-1}-\\theta^{*})$ implies ", "page_idx": 34}, {"type": "equation", "text": "$$\n\\|\\hat{\\theta}_{k}-\\theta^{*}\\|_{V_{k}}\\leq\\left(\\frac{C}{k^{1/2}}+\\sigma^{2}c^{2}\\right)\\sqrt{2\\log\\left(\\frac{\\operatorname*{det}(V_{k})^{1/2}\\operatorname*{det}(V_{0})^{-1/2}}{\\delta/2}\\right)}+\\|\\theta^{*}\\|_{V_{0}}\n$$", "text_format": "latex", "page_idx": 34}, {"type": "text", "text": "holds w.p. at least $1-\\delta$ for all $k\\geq1$ . ", "page_idx": 34}, {"type": "text", "text": "Proof. Use Corollary 3 and Lemma 6, each with $\\delta/2$ . Then w.p. at least $1-\\delta$ the result holds. ", "page_idx": 34}, {"type": "text", "text": "We next state a slightly modified form of a standard result of RLS (Lemma 11 in Abbasi-Yadkori et al. (2011)) that helps to guarantee that the prediction error is cumulatively small. This bounds the sum of quadratic forms where the matrix is the inverse Gram matrix and the arguments are the feature vectors. We use such terms to construct a martingale in the regret bound so that we can bound such terms and the martingale. ", "page_idx": 34}, {"type": "text", "text": "Proposition 1. Let $\\lambda\\geq1$ and $\\gamma\\geq1$ . For any arbitrary sequence $(x_{i,t})_{(i,t)\\in{\\mathcal{O}}_{k}}$ , let ", "page_idx": 34}, {"type": "equation", "text": "$$\nV_{k+1}\\equiv\\sum_{(i,t)\\in\\mathcal{O}_{k}}\\tilde{\\sigma}_{i,t}^{2}\\phi(x_{i,t})\\phi(x_{i,t})^{\\top}+V_{0},\n$$", "text_format": "latex", "page_idx": 34}, {"type": "text", "text": "be the regularized Gram matrix. Then ", "page_idx": 34}, {"type": "equation", "text": "$$\n\\sum_{k=1}^{K}\\sum_{\\substack{(i,t)\\in\\mathcal{O}_{k}\\backslash\\mathcal{O}_{k-1}}}\\|\\phi(x_{i,t})\\|_{V_{k}^{-1}}^{2}\\leq2c\\log\\left(\\frac{\\operatorname*{det}(V_{K+1})}{\\operatorname*{det}(V_{0})}\\right).\n$$", "text_format": "latex", "page_idx": 34}, {"type": "text", "text": "where c is a constant such that $\\begin{array}{r}{0<\\frac{1}{c}<\\tilde{\\sigma}_{i,t}^{2}\\forall i,t\\in\\mathbb{N}}\\end{array}$ . ", "page_idx": 34}, {"type": "text", "text": "Proof. By Lemma 11 in Abbasi-Yadkori et al. (2011), we have ", "page_idx": 35}, {"type": "equation", "text": "$$\n\\sum_{k=1}^{K}\\sum_{\\substack{(i,t)\\in\\mathcal{O}_{k}\\backslash\\mathcal{O}_{k-1}}}\\tilde{\\sigma}_{i,t}^{2}\\Vert\\phi(x_{i,t})\\Vert_{V_{k}^{-1}}^{2}\\leq2\\log\\left(\\frac{\\operatorname*{det}(V_{K+1})}{\\operatorname*{det}(V_{0})}\\right).\n$$", "text_format": "latex", "page_idx": 35}, {"type": "text", "text": "The lower bound on the weights implies ", "page_idx": 35}, {"type": "equation", "text": "$$\n\\sum_{k=1}^{K}\\sum_{(i,t)\\in\\mathcal{O}_{k}\\backslash\\mathcal{O}_{k-1}}\\|\\phi(x_{i,t})\\|_{V_{k}^{-1}}^{2}\\leq2c\\log\\left(\\frac{\\operatorname*{det}(V_{K+1})}{\\operatorname*{det}(V_{0})}\\right)\n$$", "text_format": "latex", "page_idx": 35}, {"type": "text", "text": "as desired. ", "page_idx": 35}, {"type": "text", "text": "Finally, we state Azuma\u2019s concentration inequality which describes concentration of super-martingales with bounded differences and is useful in controlling the regret due to the randomization of Thompson sampling. ", "page_idx": 35}, {"type": "text", "text": "Proposition 2 (Azuma\u2019s concentration inequality). If a super-martingale $(Y_{t})_{t\\geq0}$ corresponding to $a$ filtration $\\mathcal{F}_{t}$ satisfies $|Y_{t}-Y_{t-1}|<c_{t}$ some constant $c_{t}$ for all $t=1,\\dots,T$ then for any $\\alpha>0$ : ", "page_idx": 35}, {"type": "equation", "text": "$$\nP\\left(Y_{T}-Y_{0}\\ge\\alpha\\right)\\le\\exp\\left(-\\frac{\\alpha^{2}}{2\\sum_{t=1}^{T}c_{t}^{2}}\\right).\n$$", "text_format": "latex", "page_idx": 35}, {"type": "text", "text": "E.3 Proof of Theorem 1 ", "text_level": 1, "page_idx": 35}, {"type": "text", "text": "We first decompose the regret bound ", "page_idx": 35}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{\\displaystyle\\sum_{k=1}^{K}\\frac{1}{k}\\sum_{(i,t)\\in\\mathcal{P}_{k}\\setminus\\mathcal{O}_{k-1}}\\left[\\pi_{i,t}^{*}x(S_{i},t,a_{i,t}^{*})^{\\top}\\theta_{i,t}^{*}-\\pi_{i,t}x(S_{i},t,A_{i,t})^{\\top}\\theta_{i,t}^{*}\\right]}\\\\ &{=\\displaystyle\\sum_{k=1}^{K}\\frac{1}{k}\\sum_{(i,t)\\in\\mathcal{P}_{k}\\setminus\\mathcal{O}_{k-1}}\\left[\\left(\\pi_{i,t}^{*}-\\pi_{i,t}\\right)x(S_{i,t},A_{i,t})^{\\top}\\theta_{i,t}^{*}\\right.}\\\\ &{\\displaystyle\\left.\\qquad\\qquad\\qquad\\qquad\\qquad\\qquad+\\pi_{i,t}^{*}\\left\\{x(S_{i,t},a_{i,t}^{*})^{\\top}\\theta_{i,t}^{*}-x(S_{i,t},A_{i,t})^{\\top}\\theta_{i,t}^{*}\\right\\}\\right]}\\\\ &{\\le\\displaystyle\\sum_{k=1}^{K}\\frac{1}{k}\\sum_{(i,t)\\in\\mathcal{P}_{k}\\setminus\\mathcal{O}_{k-1}}\\left[\\left(\\pi_{i,t}^{*}-\\pi_{i,t}\\right)x(S_{i,t},A_{i,t})^{\\top}\\theta_{i,t}^{*}\\right]}\\\\ &{\\displaystyle\\qquad\\qquad\\qquad\\qquad\\qquad\\qquad\\qquad\\left.\\sum_{k=1}^{K}\\frac{1}{k}\\sum_{(i,t)\\in\\mathcal{P}_{k}\\setminus\\mathcal{O}_{k-1}}\\left[x(S_{i,t},a_{i,t}^{*})^{\\top}\\theta_{i,t}^{*}-x(S_{i,t},A_{i,t})^{\\top}\\theta_{i,t}^{*}\\right]\\right.}\\end{array}\n$$", "text_format": "latex", "page_idx": 35}, {"type": "text", "text": "iFdoern tthice alf irpsrt otoefr mto, $\\begin{array}{r}{\\sum_{k=1}^{K}\\frac{1}{k}\\sum_{(i,t)\\in\\mathcal{O}_{k}\\backslash\\mathcal{O}_{k-1}}\\left[(\\pi_{i,t}^{\\star}-\\pi_{i,t})x(S_{i,t},A_{i,t})^{\\top}\\theta_{i,t}^{\\ast}\\right]}\\end{array}$ ,e  onneee cda an  naopvplely  sat rnaetaerglyy, and thus focus on that term. The proof follows closely from Abeille $\\&$ Lazaric (2017) with several adjustments. Assumption 6 implies that we only need to consider the unit ball $\\mathcal{X}=\\left\\{\\|x\\|\\leq1\\right\\}$ . Then the second term of the regret can be decomposed into ", "page_idx": 35}, {"type": "equation", "text": "$$\n\\frac{\\underset{i=1}{\\overset{K}{\\sum}}\\frac{1}{k}\\sum_{(i,t)\\in\\mathcal{O}_{k}\\setminus\\mathcal{O}_{k-1}}\\left((\\phi(x_{i,t}^{\\star}))^{\\top}\\theta^{\\star}-\\phi(x_{i,t})^{\\top}\\tilde{\\theta}_{k}\\right)}{R^{T s}(K)}+\\underset{K\\mapsto1}{\\overset{K}{\\sum}}\\frac{1}{k}\\sum_{(i,t)\\in\\mathcal{O}_{k}\\setminus\\mathcal{O}_{k-1}}\\left(\\phi(x_{i,t})^{\\top}\\tilde{\\theta}_{k}-\\phi(x_{i,t})^{\\top}\\theta^{\\star}\\right)\n$$", "text_format": "latex", "page_idx": 35}, {"type": "text", "text": "where $\\phi(\\boldsymbol{x}_{i,t}^{\\star})$ is the context vector under the optimal action and $\\theta^{\\star}$ is the true parameter value. The first term is the regret due to the random deviations caused by sampling $\\tilde{\\theta}_{k}$ and whether it provides sufficient useful information about the true parameter $\\theta_{k}^{\\star}$ . The second term is the concentration of the sampled term around the true linear model for the advantage function. ", "page_idx": 35}, {"type": "text", "text": "Definition 2. We define the filtration $\\mathcal{F}_{k}$ as the information accumulated up to stage $k$ before the sampling procedure, that is, ${\\mathcal F}_{k}\\ =\\ ({\\mathcal F}_{1},\\sigma(x_{1},r_{2},x_{2},\\ldots,x_{k-1},r_{k-1}))$ ), and filtration $\\mathcal{F}_{k}^{x}$ as the information accumulated up to stage $k$ and including the sampled context, that is, $\\mathcal{F}_{t}^{\"}=(\\mathcal{F}_{1},\\sigma(x_{1},r_{2},x_{2},\\ldots,x_{k-1},r_{k-1},x_{k}))$ ). ", "page_idx": 35}, {"type": "text", "text": "Bounding $R^{R L S}(T)$ . We decompose the second term into the variation of the point estimate and the variation of the random sample around the point estimate: ", "page_idx": 36}, {"type": "equation", "text": "$$\n\\sum_{i=1}^{K}\\frac{1}{k}\\sum_{(i,t)\\in\\mathcal{O}_{k}\\backslash\\mathcal{O}_{k-1}}\\Big(\\phi(x_{i,t})^{\\top}\\tilde{\\theta}_{k}-\\phi(x_{i,t})^{\\top}\\hat{\\theta}_{k}\\Big)+\\sum_{k=1}^{K}\\frac{1}{k}\\sum_{(i,t)\\in\\mathcal{O}_{k}\\backslash\\mathcal{O}_{k-1}}\\Big(\\phi(x_{i,t})^{\\top}\\hat{\\theta}_{k}-\\phi(x_{i,t})^{\\top}\\theta_{k}^{\\star}\\Big)\n$$", "text_format": "latex", "page_idx": 36}, {"type": "text", "text": "The first term describes the deviation of the TS linear predictor from the RLS one, while the second term describes the deviation of the RLS linear predictor from the true linear predictor. The first term is controlled by the construction of the sampling distribution $D^{T S}$ , while the second term is controlled by the RLS estimate being a minimizer of the regularized cumulative squared error in (8). In particular, the first term will be small when the TS estimate concentrates around the RLS one, while the second will be small when the RLS estimate concentrates around the true parameter vector. The next proposition gives a lower bound on the probability that, for all stages, both the RLS parameter vector concentrates around the true parameter vector and the TS parameter vector concentrates around the RLS one. ", "page_idx": 36}, {"type": "text", "text": "Recall that ", "page_idx": 36}, {"type": "equation", "text": "$$\n\\beta_{k}(\\delta)=v_{k}\\left[2\\log\\left(\\frac{\\operatorname*{det}(V_{k})^{1/2}}{\\operatorname*{det}(V_{0})^{1/2}\\delta/2}\\right)\\right]^{1/2}+B\n$$", "text_format": "latex", "page_idx": 36}, {"type": "text", "text": "where $B=\\sqrt{\\gamma}B_{\\mathrm{shared}}+\\sqrt{\\lambda M K}(\\sqrt{D_{\\mathrm{user}}}+\\sqrt{D_{\\mathrm{time}}})+\\sqrt{\\gamma M K}(B_{\\mathrm{user}}+B_{\\mathrm{time}})$ . This is, from Lemma 6 and Corollary 7, an upper bound on a $1-\\delta$ confidence set on the RLS estimator. ", "page_idx": 36}, {"type": "text", "text": "Proposition 3. Let $\\hat{E}_{k}$ denote the event that $\\boldsymbol{\\hat{\\theta}}_{k}$ concentrates around the true parameter for all $l\\leq k$ , i.e., $\\hat{E}_{k}=\\{\\forall l\\leq k,\\|\\hat{\\theta}_{l}-\\theta_{l}^{\\star}\\|_{V_{l}}\\leq\\beta_{l}(\\delta^{\\prime})\\}$ . Let $\\begin{array}{r}{\\gamma_{k}(\\delta)\\equiv\\beta_{k}(\\delta^{\\prime})\\sqrt{c d\\log\\frac{c^{\\prime}d}{\\delta}}L e t\\,\\tilde{E}_{k}}\\end{array}$ denote the event that $\\tilde{\\theta}_{l}$ concentrates around the estimated parameter for all $l\\leq k,$ , i.e., $\\tilde{E}_{k}=\\{\\forall l\\leq k,\\|\\tilde{\\theta}_{l}-\\hat{\\theta}_{l}\\|_{{V}_{l}}\\leq$ $\\gamma_{l}(\\delta^{\\prime})\\}$ . Let $E_{k}=\\hat{E}_{k}\\cap\\tilde{E}_{k}$ . Then $P(E_{k})\\ge1-\\delta/2$ . ", "page_idx": 36}, {"type": "text", "text": "Proof. Let $\\delta^{\\prime}=\\delta/4K$ , then Lemma 6 and a union bound give us ", "page_idx": 36}, {"type": "equation", "text": "$$\n\\begin{array}{l}{\\displaystyle P(\\hat{E}_{K})=P(\\cap_{k=1}^{K}\\{\\|\\hat{\\theta}_{k}-\\theta^{\\star}\\|_{V_{k}}\\leq\\beta_{k}(\\delta^{\\prime})\\})}\\\\ {\\displaystyle=1-\\sum_{k=1}^{K}P(\\|\\hat{\\theta}_{k}-\\theta^{\\star}\\|_{V_{k}}>\\beta_{k}(\\delta^{\\prime}))}\\\\ {\\displaystyle=1-\\sum_{k=1}^{K}\\delta^{\\prime}=1-\\delta^{\\prime}K=1-\\delta/4.}\\end{array}\n$$", "text_format": "latex", "page_idx": 36}, {"type": "text", "text": "Applying the TS sampling distribution and $\\tilde{\\theta}_{k}=\\hat{\\theta}_{k}+\\beta_{k}(\\delta^{\\prime})V_{k}^{-1/2}\\eta_{k}$ where $\\eta_{t}$ is drawn i.i.d. from $D^{T S}$ we have ", "page_idx": 36}, {"type": "equation", "text": "$$\nP\\left(\\|\\tilde{\\theta}_{k}-\\hat{\\theta}_{k}\\|_{V_{k}}\\le\\beta_{k}(\\delta^{\\prime})\\sqrt{c d\\log\\left(\\frac{c^{\\prime}d}{\\delta^{\\prime}}\\right)}\\right)=P\\left(\\|\\eta_{k}\\|\\le\\sqrt{c d\\log\\left(\\frac{c^{\\prime}d}{\\delta^{\\prime}}\\right)}\\right)\\ge1-\\delta^{\\prime}.\n$$", "text_format": "latex", "page_idx": 36}, {"type": "text", "text": "by Definition 1. A union-bound argument yields the conclusion. ", "page_idx": 36}, {"type": "text", "text": "We can then bound $R^{R L S}(K)$ by leveraging Lemma 6 and decomposing the error via ", "page_idx": 36}, {"type": "equation", "text": "$$\n\\begin{array}{r}{R^{R L S}(K)\\leq\\underset{k=1}{\\overset{K}{\\sum}}\\frac{1[E_{K}]}{k}\\left[\\underset{(i,t)\\in\\mathcal{O}_{k}\\backslash\\mathcal{O}_{k-1}}{\\sum}|\\phi(x_{i,t})^{\\top}(\\tilde{\\theta}_{k}-\\hat{\\theta}_{k})|\\right]}\\\\ {+\\underset{k=1}{\\overset{K}{\\sum}}\\frac{1[E_{K}]}{k}\\left[\\underset{(i,t)\\in\\mathcal{O}_{k}\\backslash\\mathcal{O}_{k-1}}{\\sum}|\\phi(x_{i,t})^{\\top}(\\hat{\\theta}_{k}-\\theta^{*})|\\right]}\\end{array}\n$$", "text_format": "latex", "page_idx": 36}, {"type": "text", "text": "By definition of the event $E_{K}$ , we have ", "page_idx": 36}, {"type": "equation", "text": "$$\n\\begin{array}{r}{\\phi(x_{i,t})^{\\top}(\\tilde{\\theta}_{k}-\\hat{\\theta}_{k})|1[E_{k}]\\leq\\|\\phi(x_{i,t})\\|_{V_{k}^{-1}}\\gamma_{k}(\\delta^{\\prime}),\\quad|\\phi(x_{i,t})^{\\top}(\\hat{\\theta}_{k}-\\theta^{\\star})|1[E_{k}]\\leq\\|\\phi(x_{i,t})\\|_{V_{k}^{-1}}\\beta_{k}(\\delta^{\\prime})}\\end{array}\n$$", "text_format": "latex", "page_idx": 36}, {"type": "text", "text": "so from Proposition 1, we have ", "page_idx": 37}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{\\displaystyle\\sum_{k=1}^{N}\\|E_{k}\\|\\left[\\sum_{\\ell=1}^{N}\\sum_{\\ell=1}^{\\infty}\\|\\phi(x_{k,\\ell})\\Gamma(\\hat{\\theta}_{k}-\\hat{\\theta}_{k})\\|\\right]}\\\\ &{\\le\\displaystyle\\gamma\\kappa^{(\\ell)}\\sum_{k=1}^{N}\\left\\{\\sum_{\\ell,t\\ge1\\atop\\ell\\leq j_{1}\\ldots\\ell\\leq N-1}\\frac{1}{k}\\|\\phi(x_{\\ell,t})\\|_{\\ell^{\\frac{1}{\\ell-1}}}\\right\\}}\\\\ &{\\leq\\displaystyle\\gamma\\kappa^{(\\ell)}\\sqrt{\\sum_{k=1}^{N}\\sum_{\\ell=1,\\ell\\leq n_{1}+\\ell\\leq n_{1}+1}^{N}\\sum_{k=1}^{\\ell}\\sqrt{\\sum_{\\ell=1}^{N}\\sum_{\\ell=1,\\ell\\leq n_{1}+1}^{\\ell}\\|\\phi(x_{\\ell,t-1})\\|_{\\ell_{\\ell-1}}^{2}}}}\\\\ &{\\leq\\displaystyle\\gamma\\kappa^{(\\ell)}\\sqrt{\\sum_{k=1}^{N}\\sum_{\\ell=1}^{N}\\sum_{\\ell=1}^{N}\\sum_{\\ell=1}^{N}\\sum_{\\ell=1}^{N}\\|\\phi(x_{\\ell,t})\\|_{\\ell_{\\ell-1}}^{2}}}\\\\ &{\\leq\\displaystyle\\gamma\\kappa^{(\\ell)}\\sqrt{\\sum_{k=1}^{N}\\sum_{\\ell=1}^{N}\\|\\phi(x_{\\ell})\\|_{\\ell_{\\ell-1}}\\|_{\\ell_{\\ell-1}}^{2}}}\\\\ &{\\leq\\displaystyle\\gamma\\kappa^{(\\ell)}\\sqrt{N}\\sqrt{\\sum_{\\ell=1}^{N}\\|\\phi(x_{\\ell})\\|_{\\ell_{\\ell-1}}^{2}}}\\\\ &{\\leq\\displaystyle\\gamma\\kappa^{(\\ell)}\\sqrt{N}\\sqrt{\\sum_{\\ell=1}^{N}\\|\\phi(x_{\\ell})\\|_{\\ell_{\\ell-1}}^{2}}.}\\end{array}\n$$", "text_format": "latex", "page_idx": 37}, {"type": "text", "text": "Using a similar derivation for the $\\beta_{k}(\\delta^{\\prime})$ case, we obtain ", "page_idx": 37}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{\\mathfrak{q}^{R L S}(K)\\le\\left(\\beta_{K}(\\delta^{\\prime})+\\gamma_{K}(\\delta^{\\prime})\\right)\\sqrt{\\displaystyle\\sum_{k=1}^{K}\\displaystyle\\sum_{(i,t)\\in\\mathcal{O}_{k}\\backslash\\mathcal{O}_{k-1}}\\frac{1}{k^{2}}}\\sqrt{2c\\log\\left(\\frac{\\operatorname*{det}\\left(V_{K+1}\\right)}{\\operatorname*{det}\\left(V_{0}\\right)}\\right)}}\\\\ &{\\qquad\\le\\left(\\beta_{K}(\\delta^{\\prime})+\\gamma_{K}(\\delta^{\\prime})\\right)\\sqrt{\\displaystyle\\sum_{k=1}^{K}\\frac{1}{k}}\\sqrt{2c\\log\\left(\\frac{\\operatorname*{det}\\left(V_{K+1}\\right)}{\\operatorname*{det}\\left(V_{0}\\right)}\\right)}}\\\\ &{\\qquad\\le\\left(\\beta_{K}(\\delta^{\\prime})+\\gamma_{K}(\\delta^{\\prime})\\right)\\sqrt{H_{K}}\\sqrt{2c\\left[(2K+1)p\\log\\left(\\frac{3K(K+1)}{\\gamma8(2K+1)p}+1+\\frac{2\\lambda M K}{\\gamma(2K+1)}\\right)\\right]}}\\end{array}\n$$", "text_format": "latex", "page_idx": 37}, {"type": "text", "text": "with probability at least $1-\\delta/2$ by Proposition 3, where $H_{K}$ is the harmonic number. Note that $H_{K}\\sim\\log(K)$ for large $K$ . ", "page_idx": 37}, {"type": "text", "text": "Bounding $R^{T S}(T)$ . Leveraging Abeille & Lazaric (2017), Definition 1 lets us bound $R^{T S}(K)$ under the event $E_{k}$ . Let $\\begin{array}{r}{\\phi(x_{i,t}^{\\star})(\\theta)=\\arg\\operatorname*{max}_{x_{i,t}\\in\\mathcal{X}}\\theta^{\\top}\\phi(x_{i,t})}\\end{array}$ . Then ", "page_idx": 37}, {"type": "equation", "text": "$$\nR^{T S}(K)\\leq\\sum_{k=1}^{K}\\frac{1}{k}R_{k}^{T S}1[E_{k}]\\leq\\frac{4\\gamma_{K}(\\delta^{\\prime})}{d}\\sum_{k=1}^{K}\\frac{1}{k}\\sum_{(i,t)\\in\\mathcal{O}_{k}\\backslash\\mathcal{O}_{k-1}}\\mathbb{E}\\left[\\|\\phi(x_{i,t}^{\\star})(\\widetilde{\\theta})\\|_{V_{k}^{-1}}|\\mathcal{F}_{k}\\right]\n$$", "text_format": "latex", "page_idx": 37}, {"type": "text", "text": "We re-write the sum in (20) as: ", "page_idx": 37}, {"type": "equation", "text": "$$\n\\sum_{i=1}^{K}\\frac{1}{k}\\sum_{(i,t)\\in\\mathcal{O}_{k}\\backslash\\mathcal{O}_{k-1}}\\lVert\\phi(x_{i,t})\\rVert_{V_{k}^{-1}}+\\sum_{k=1}^{K}\\frac{1}{k}\\sum_{(i,t)\\in\\mathcal{O}_{k}\\backslash\\mathcal{O}_{k-1}}\\left(\\mathbb{E}\\left[\\|\\phi(x_{i,t}^{\\star})(\\Tilde{\\theta})\\|_{V_{k}^{-1}}|\\mathcal{F}_{k}\\right]-\\|\\phi(x_{i,t})\\|_{V_{k}^{-1}}\\right)\n$$", "text_format": "latex", "page_idx": 37}, {"type": "text", "text": "The first term is bounded by Proposition 1: ", "page_idx": 37}, {"type": "equation", "text": "$$\n\\sum_{k=1}^{K}\\frac{1}{k}\\sum_{(i,t)\\in\\mathcal{O}_{k}\\backslash\\mathcal{O}_{k-1}}\\|\\phi(x_{i,t})\\|_{V_{k}^{-1}}\\leq\\sqrt{2c H_{K}\\log\\left(\\frac{\\operatorname*{det}(V_{K+1})}{\\operatorname*{det}(V_{0})}\\right)}\n$$", "text_format": "latex", "page_idx": 37}, {"type": "text", "text": "The second term is a martingale by construction and so we can apply Azuma\u2019s inequality. Under Assumption 6, so since $V_{k}\\leq\\frac{1}{\\lambda}I$ we have ", "page_idx": 37}, {"type": "equation", "text": "$$\n\\mathbb{E}\\left[\\Vert\\phi(x_{i,t})^{\\star}(\\tilde{\\theta})\\Vert_{V_{k}^{-1}}\\vert\\mathcal{F}_{t}\\right]-\\Vert\\phi(x_{i,t})\\Vert_{V_{k}^{-1}}\\leq\\frac{2}{\\sqrt{\\lambda}},\\quad a.s.\n$$", "text_format": "latex", "page_idx": 37}, {"type": "text", "text": "This provides the upper-bound ", "page_idx": 38}, {"type": "equation", "text": "$$\n\\mathfrak{q}^{T S}(K)\\leq\\frac{4\\gamma_{K}(\\delta^{\\prime})}{d}\\left(\\sqrt{\\frac{8K}{\\lambda}\\log\\left(\\frac{4}{\\delta}\\right)}+\\sqrt{2c H_{K}(2K+1)p\\log\\left(\\frac{3K(K+1)}{\\gamma8(2K+1)p}+1+\\frac{2\\lambda M K}{\\gamma(2K+1)}\\right)}\\right)\n$$", "text_format": "latex", "page_idx": 38}, {"type": "text", "text": "Overall bound. Putting together the two bounds under a union bound argument yields the upper bound in Theorem 1; specifically, we have ", "page_idx": 38}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{\\quad\\left(\\beta_{K}(\\delta^{\\prime})+\\gamma_{K}(\\delta^{\\prime})\\left[1+\\frac{4}{d}\\right]\\right)\\sqrt{2c H_{K}(2K+1)p\\log\\left(\\frac{3K(K+1)}{\\gamma8(2K+1)p}+1+\\frac{2\\lambda M K}{\\gamma(2K+1)}\\right)}}\\\\ &{+\\frac{4\\gamma_{K}(\\delta^{\\prime})}{p}\\sqrt{\\frac{8K}{\\lambda}\\log\\left(\\frac{4}{\\delta}\\right)}}\\end{array}\n$$", "text_format": "latex", "page_idx": 38}, {"type": "text", "text": "F Notation Guide ", "text_level": 1, "page_idx": 38}, {"type": "text", "text": "For convenience, we summarize below some key notation used in the main paper. ", "page_idx": 38}, {"type": "text", "text": "\u2022 $a=0$ : control action   \n\u2022 $q$ : number of non-baseline treatment arms   \n\u2022 $i=1,2,\\dots;$ index for individuals (later in the paper, we consider $N$ individuals)   \n\u2022 $t=1,2,\\ldots;$ index for decision points (later in the paper, we consider $T$ decision points)   \n\u2022 $S_{i,t}\\in{\\cal S}$ : context vector observed for individual $i$ at decision point $t$   \n\u2022 $A_{i,t}\\in\\{0,\\ldots,q\\}$ : action chosen for individual $i$ at decision point $t$   \n\u2022 $R_{i,t}\\in\\mathbb{R}$ : reward observed for individual $i$ at decision point $t$   \n\u2022 $r_{i,t}(s,a):=\\mathbb{E}\\left[R_{i,t}|S_{i,t}=s,A_{i,t}=a\\right]$ : conditional model for the observed reward given the state and context   \n\u2022 $\\boldsymbol{x}(s,a)\\in\\mathbb{R}^{p\\times1}$ : feature vector containing the state and action   \n\u2022 $\\theta_{i,t}\\in\\mathbb{R}^{p}$ : vector of parameters that may depend on the individual $i$ and decision point $t$ . Later $\\theta_{i,t}$ is written as $\\theta_{i,t}=\\theta+\\theta_{i}^{u s e r}+\\theta_{t}^{t i m e}$ , where $\\theta_{i}^{u s e r}$ is the individual-specific but time-invariant term and $\\theta_{t}^{t i m e}$ is a shared time-specific term   \n\u2022 $\\delta_{a>0}$ : indicator function that takes the value 1 if $a>0$ and 0 otherwise   \n\u2022 $g_{t}(s)$ : baseline reward function that is observed when individuals are randomized to receive no treatment   \n\u2022 $\\Delta_{i,t}(s,a):=r_{i,t}(s,a)-r_{i,t}(s,0)$ : linear differential reward for any action $a>0$ and state $s$   \n\u2022 $\\mathcal{H}_{i,t}$ : history up to decision point $t$ for individual $i$   \n\u2022 $\\pi_{i,t}(a|s)$ : probability of action $a\\in[K]$ given current context $s\\in S$ for a fixed (implicit) history   \n\u2022 $\\bar{a}_{i,t}\\in[K]$ : potential non-baseline arm that may be chosen if the baseline arm is not chosen   \n\u2022 $f_{i,t}(s,a)$ : working model for the true conditional mean $r_{i,t}(s,a)$   \n\u2022 $\\tilde{R}_{i,t}^{f}(s,\\bar{a})$ : pseudo-reward given state $S_{i,t}\\,=\\,s$ and potential arm $\\bar{a}$ , which has the same expectation as the differential reward, $\\Delta_{i,t}(s_{i,t},\\bar{a}_{i,t})$ ; this term is written as $\\tilde{R}_{i,t}^{f}$ in some points in the main paper, with the state and action implied   \n\u2022 $\\Delta_{i,t}^{f}(s,\\bar{a}):=f_{i,t}(s,\\bar{a})-f_{i,t}(s,0)$ : doubly robust estimator for the differential reward   \n\u2022 $I_{m}(t)\\subseteq\\{1,...,t\\}$ : the $m$ -th fold, of $M$ total folds, as assigned up to time $t$ . $I_{m}^{\\tt G}(t)$ denotes its complement   \n\u2022 $\\lambda$ : parameter for ridge penalization, used in $\\lambda||\\theta||_{2}^{2}$ ", "page_idx": 38}, {"type": "text", "text": "\u2022 $\\tilde{\\sigma}_{i,t}^{2}=\\pi_{i,t}(0|s_{i,t})\\cdot(1-\\pi_{i,t}(0|s_{i,t}))$ : weights used in the penalized regression estimation, which are inversely proportional to $v a r(\\tilde{R}_{i,t}^{f})$ ", "page_idx": 39}, {"type": "text", "text": "\u2022 $\\{d(i,j):=||\\theta_{i}-\\theta_{j}||_{2}^{2}\\}_{i\\neq j}\\colon L_{2}.$ -distances for network construction   \n\u2022 $G=(V,E)$ : graph with nodes $V$ and edges $E$ ; each node corresponds to an individual, $V:=[N]$ , and $(i,j)\\in E$ for the smallest $M<<N$ distances   \n\u2022 Q: incidence matrix where the element $Q_{v,e}$ corresponds to the $v$ -th vertex (individual) and $e$ -th edge   \n\u2022 $L$ : Laplacian   \n\u2022 $M$ : max number of neighbors per participant and time step   \n\u2022 $\\mathcal{O}_{k}=\\{(i,t):i\\leq k\\,\\&\\,t\\leq k+1-i\\}$ : the set of observed time points across all individuals at stage $k$ of the sequential requirement setting   \n\u2022 $G_{u s e r}$ : nearest-neighbor graph characterizing proximity in the user domain   \n\u2022 $G_{t i m e}$ : nearest-neighbor graph characterizing proximity in the time domain item $\\Theta_{k}=$ $\\mathrm{vec}[\\left(\\theta,\\theta_{1}^{\\mathrm{user}},\\cdot\\cdot\\cdot,\\theta_{k}^{\\mathrm{user}},\\theta_{1}^{\\mathrm{time}},\\cdot\\cdot\\cdot,\\theta_{k}^{\\mathrm{time}}\\right)]\\in\\mathbb{R}^{p(2k+1)}$ : the set of all parameters, including the individual-specific time-invariant parameters and the shared time-specific parameters, at stage $k$ of the sequential recruitment setting   \n\u2022 $D_{u s e r}$ , $D_{t i m e}$ , $\\textstyle B_{\\mathrm{user}}$ , $B_{\\mathrm{time}}$ , $M$ : terms for bound on parameters and mean estimate ", "page_idx": 39}, {"type": "text", "text": "NeurIPS Paper Checklist ", "text_level": 1, "page_idx": 40}, {"type": "text", "text": "1. Claims ", "text_level": 1, "page_idx": 40}, {"type": "text", "text": "Question: Do the main claims made in the abstract and introduction accurately reflect the paper\u2019s contributions and scope? ", "page_idx": 40}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 40}, {"type": "text", "text": "Justification: The abstract offers a brief summary of the paper\u2019s motivation and contribution, while the introduction delves deeper into background details and highlights the key components of our proposed algorithm. ", "page_idx": 40}, {"type": "text", "text": "Guidelines: ", "page_idx": 40}, {"type": "text", "text": "\u2022 The answer NA means that the abstract and introduction do not include the claims made in the paper.   \n\u2022 The abstract and/or introduction should clearly state the claims made, including the contributions made in the paper and important assumptions and limitations. A No or NA answer to this question will not be perceived well by the reviewers.   \n\u2022 The claims made should match theoretical and experimental results, and reflect how much the results can be expected to generalize to other settings.   \n\u2022 It is fine to include aspirational goals as motivation as long as it is clear that these goals are not attained by the paper. ", "page_idx": 40}, {"type": "text", "text": "2. Limitations ", "text_level": 1, "page_idx": 40}, {"type": "text", "text": "Question: Does the paper discuss the limitations of the work performed by the authors? Answer: [Yes] ", "page_idx": 40}, {"type": "text", "text": "Justification: In the Discussion section (Section 7), we reflect on limitations related to computation, modeling assumptions, hyper-parameter tuning, and practical implementation. Guidelines: ", "page_idx": 40}, {"type": "text", "text": "\u2022 The answer NA means that the paper has no limitation while the answer No means that the paper has limitations, but those are not discussed in the paper.   \n\u2022 The authors are encouraged to create a separate \"Limitations\" section in their paper.   \n\u2022 The paper should point out any strong assumptions and how robust the results are to violations of these assumptions (e.g., independence assumptions, noiseless settings, model well-specification, asymptotic approximations only holding locally). The authors should reflect on how these assumptions might be violated in practice and what the implications would be.   \n\u2022 The authors should reflect on the scope of the claims made, e.g., if the approach was only tested on a few datasets or with a few runs. In general, empirical results often depend on implicit assumptions, which should be articulated.   \n\u2022 The authors should reflect on the factors that influence the performance of the approach. For example, a facial recognition algorithm may perform poorly when image resolution is low or images are taken in low lighting. Or a speech-to-text system might not be used reliably to provide closed captions for online lectures because it fails to handle technical jargon.   \n\u2022 The authors should discuss the computational efficiency of the proposed algorithms and how they scale with dataset size.   \n\u2022 If applicable, the authors should discuss possible limitations of their approach to address problems of privacy and fairness.   \n\u2022 While the authors might fear that complete honesty about limitations might be used by reviewers as grounds for rejection, a worse outcome might be that reviewers discover limitations that aren\u2019t acknowledged in the paper. The authors should use their best judgment and recognize that individual actions in favor of transparency play an important role in developing norms that preserve the integrity of the community. Reviewers will be specifically instructed to not penalize honesty concerning limitations. ", "page_idx": 40}, {"type": "text", "text": "3. Theory Assumptions and Proofs ", "text_level": 1, "page_idx": 40}, {"type": "text", "text": "Question: For each theoretical result, does the paper provide the full set of assumptions and a complete (and correct) proof? ", "page_idx": 40}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 41}, {"type": "text", "text": "Justification: We present all assumptions clearly, each numbered for reference, and we provide the full set of assumptions in Theorem 1. Additionally, the proof is available in the Appendix, and within the main text, we indicate where the corresponding proof can be found. ", "page_idx": 41}, {"type": "text", "text": "Guidelines: ", "page_idx": 41}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not include theoretical results.   \n\u2022 All the theorems, formulas, and proofs in the paper should be numbered and crossreferenced.   \n\u2022 All assumptions should be clearly stated or referenced in the statement of any theorems.   \n\u2022 The proofs can either appear in the main paper or the supplemental material, but if they appear in the supplemental material, the authors are encouraged to provide a short proof sketch to provide intuition.   \n\u2022 Inversely, any informal proof provided in the core of the paper should be complemented by formal proofs provided in appendix or supplemental material.   \n\u2022 Theorems and Lemmas that the proof relies upon should be properly referenced. ", "page_idx": 41}, {"type": "text", "text": "4. Experimental Result Reproducibility ", "text_level": 1, "page_idx": 41}, {"type": "text", "text": "Question: Does the paper fully disclose all the information needed to reproduce the main experimental results of the paper to the extent that it affects the main claims and/or conclusions of the paper (regardless of whether the code and data are provided or not)? ", "page_idx": 41}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 41}, {"type": "text", "text": "Justification: In the manuscript, we provided a clear description of the proposed algorithm in Algorithm 2. Additionally, we elaborated on the key components of the algorithm in Section 4. Furthermore, in Section 6.1, we outlined the simulation setup, with detailed information available in Appendix A. ", "page_idx": 41}, {"type": "text", "text": "Guidelines: ", "page_idx": 41}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not include experiments.   \n\u2022 If the paper includes experiments, a No answer to this question will not be perceived well by the reviewers: Making the paper reproducible is important, regardless of whether the code and data are provided or not.   \n\u2022 If the contribution is a dataset and/or model, the authors should describe the steps taken to make their results reproducible or verifiable.   \n\u2022 Depending on the contribution, reproducibility can be accomplished in various ways. For example, if the contribution is a novel architecture, describing the architecture fully might suffice, or if the contribution is a specific model and empirical evaluation, it may be necessary to either make it possible for others to replicate the model with the same dataset, or provide access to the model. In general. releasing code and data is often one good way to accomplish this, but reproducibility can also be provided via detailed instructions for how to replicate the results, access to a hosted model (e.g., in the case of a large language model), releasing of a model checkpoint, or other means that are appropriate to the research performed.   \n\u2022 While NeurIPS does not require releasing code, the conference does require all submissions to provide some reasonable avenue for reproducibility, which may depend on the nature of the contribution. For example (a) If the contribution is primarily a new algorithm, the paper should make it clear how to reproduce that algorithm. (b) If the contribution is primarily a new model architecture, the paper should describe the architecture clearly and fully. (c) If the contribution is a new model (e.g., a large language model), then there should either be a way to access this model for reproducing the results or a way to reproduce the model (e.g., with an open-source dataset or instructions for how to construct the dataset). (d) We recognize that reproducibility may be tricky in some cases, in which case authors are welcome to describe the particular way they provide for reproducibility. ", "page_idx": 41}, {"type": "text", "text": "In the case of closed-source models, it may be that access to the model is limited in some way (e.g., to registered users), but it should be possible for other researchers to have some path to reproducing or verifying the results. ", "page_idx": 42}, {"type": "text", "text": "5. Open access to data and code ", "text_level": 1, "page_idx": 42}, {"type": "text", "text": "Question: Does the paper provide open access to the data and code, with sufficient instructions to faithfully reproduce the main experimental results, as described in supplemental material? ", "page_idx": 42}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 42}, {"type": "text", "text": "Justification: The primary simulation results can be entirely reproduced using the provided code on Github. However, the Valentine study data, used for our real-world analysis, is not publicly accessible. ", "page_idx": 42}, {"type": "text", "text": "Guidelines: ", "page_idx": 42}, {"type": "text", "text": "\u2022 The answer NA means that paper does not include experiments requiring code.   \n\u2022 Please see the NeurIPS code and data submission guidelines (https://nips.cc/ public/guides/CodeSubmissionPolicy) for more details.   \n\u2022 While we encourage the release of code and data, we understand that this might not be possible, so \u201cNo\u201d is an acceptable answer. Papers cannot be rejected simply for not including code, unless this is central to the contribution (e.g., for a new open-source benchmark).   \n\u2022 The instructions should contain the exact command and environment needed to run to reproduce the results. See the NeurIPS code and data submission guidelines (https: //nips.cc/public/guides/CodeSubmissionPolicy) for more details.   \n\u2022 The authors should provide instructions on data access and preparation, including how to access the raw data, preprocessed data, intermediate data, and generated data, etc.   \n\u2022 The authors should provide scripts to reproduce all experimental results for the new proposed method and baselines. If only a subset of experiments are reproducible, they should state which ones are omitted from the script and why.   \n\u2022 At submission time, to preserve anonymity, the authors should release anonymized versions (if applicable).   \n\u2022 Providing as much information as possible in supplemental material (appended to the paper) is recommended, but including URLs to data and code is permitted. ", "page_idx": 42}, {"type": "text", "text": "6. Experimental Setting/Details ", "text_level": 1, "page_idx": 42}, {"type": "text", "text": "Question: Does the paper specify all the training and test details (e.g., data splits, hyperparameters, how they were chosen, type of optimizer, etc.) necessary to understand the results? ", "page_idx": 42}, {"type": "text", "text": "Answer: [Yes] ", "text_level": 1, "page_idx": 42}, {"type": "text", "text": "Justification: Algorithm 2 requires data splits, and we devoted two paragraphs on Page 5 to discussing options for this split. Additionally, we clearly listed all of the hyperparameters involved in forming objective functions and provided guidance on how to make suitable choices for them. ", "page_idx": 42}, {"type": "text", "text": "Guidelines: ", "page_idx": 42}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not include experiments. \u2022 The experimental setting should be presented in the core of the paper to a level of detail that is necessary to appreciate the results and make sense of them. \u2022 The full details can be provided either with the code, in appendix, or as supplemental material. ", "page_idx": 42}, {"type": "text", "text": "7. Experiment Statistical Significance ", "text_level": 1, "page_idx": 42}, {"type": "text", "text": "Question: Does the paper report error bars suitably and correctly defined or other appropriate information about the statistical significance of the experiments? ", "page_idx": 42}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 42}, {"type": "text", "text": "Justification: In Section 6.2, the experiment results include hypothesis testing, and we have clearly indicated the p-values in the Figure legend to denote statistical significance. ", "page_idx": 42}, {"type": "text", "text": "Guidelines: ", "page_idx": 43}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not include experiments.   \n\u2022 The authors should answer \"Yes\" if the results are accompanied by error bars, confidence intervals, or statistical significance tests, at least for the experiments that support the main claims of the paper.   \n\u2022 The factors of variability that the error bars are capturing should be clearly stated (for example, train/test split, initialization, random drawing of some parameter, or overall run with given experimental conditions).   \n\u2022 The method for calculating the error bars should be explained (closed form formula, call to a library function, bootstrap, etc.)   \n\u2022 The assumptions made should be given (e.g., Normally distributed errors).   \n\u2022 It should be clear whether the error bar is the standard deviation or the standard error of the mean.   \n\u2022 It is OK to report 1-sigma error bars, but one should state it. The authors should preferably report a 2-sigma error bar than state that they have a $96\\%$ CI, if the hypothesis of Normality of errors is not verified.   \n\u2022 For asymmetric distributions, the authors should be careful not to show in tables or figures symmetric error bars that would yield results that are out of range (e.g. negative error rates).   \n\u2022 If error bars are reported in tables or plots, The authors should explain in the text how they were calculated and reference the corresponding figures or tables in the text. ", "page_idx": 43}, {"type": "text", "text": "8. Experiments Compute Resources ", "text_level": 1, "page_idx": 43}, {"type": "text", "text": "Question: For each experiment, does the paper provide sufficient information on the computer resources (type of compute workers, memory, time of execution) needed to reproduce the experiments? ", "page_idx": 43}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 43}, {"type": "text", "text": "Justification: At the start of Section 6, we offer a paragraph outlining the computer resources required to reproduce the experiments. ", "page_idx": 43}, {"type": "text", "text": "Guidelines: ", "page_idx": 43}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not include experiments.   \n\u2022 The paper should indicate the type of compute workers CPU or GPU, internal cluster, or cloud provider, including relevant memory and storage.   \n\u2022 The paper should provide the amount of compute required for each of the individual experimental runs as well as estimate the total compute.   \n\u2022 The paper should disclose whether the full research project required more compute than the experiments reported in the paper (e.g., preliminary or failed experiments that didn\u2019t make it into the paper). ", "page_idx": 43}, {"type": "text", "text": "9. Code Of Ethics ", "text_level": 1, "page_idx": 43}, {"type": "text", "text": "Question: Does the research conducted in the paper conform, in every respect, with the NeurIPS Code of Ethics https://neurips.cc/public/EthicsGuidelines? ", "page_idx": 43}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 43}, {"type": "text", "text": "Justification: The author has obtained permission to access both the Valentine study and the Intern Health Study dataset. It\u2019s important to note that the experiments conducted in this paper are purely numerical simulations and offilne evaluation of existing data, which do not involve any human research subjects or participants. ", "page_idx": 43}, {"type": "text", "text": "Guidelines: ", "page_idx": 43}, {"type": "text", "text": "\u2022 The answer NA means that the authors have not reviewed the NeurIPS Code of Ethics.   \n\u2022 If the authors answer No, they should explain the special circumstances that require a deviation from the Code of Ethics.   \n\u2022 The authors should make sure to preserve anonymity (e.g., if there is a special consideration due to laws or regulations in their jurisdiction). ", "page_idx": 43}, {"type": "text", "text": "10. Broader Impacts ", "text_level": 1, "page_idx": 43}, {"type": "text", "text": "Question: Does the paper discuss both potential positive societal impacts and negative societal impacts of the work performed? ", "page_idx": 44}, {"type": "text", "text": "Answer: [Yes] ", "text_level": 1, "page_idx": 44}, {"type": "text", "text": "Justification: This paper is driven by the current challenges in mobile health policy learning, aiming to enhance policy learning to maximize the benefits of mobile interventions. As a result, we emphasize the societal impacts, focusing on how the algorithm has the potential to improve public health. ", "page_idx": 44}, {"type": "text", "text": "Guidelines: ", "page_idx": 44}, {"type": "text", "text": "\u2022 The answer NA means that there is no societal impact of the work performed.   \n\u2022 If the authors answer NA or No, they should explain why their work has no societal impact or why the paper does not address societal impact.   \n\u2022 Examples of negative societal impacts include potential malicious or unintended uses (e.g., disinformation, generating fake profiles, surveillance), fairness considerations (e.g., deployment of technologies that could make decisions that unfairly impact specific groups), privacy considerations, and security considerations.   \n\u2022 The conference expects that many papers will be foundational research and not tied to particular applications, let alone deployments. However, if there is a direct path to any negative applications, the authors should point it out. For example, it is legitimate to point out that an improvement in the quality of generative models could be used to generate deepfakes for disinformation. On the other hand, it is not needed to point out that a generic algorithm for optimizing neural networks could enable people to train models that generate Deepfakes faster.   \n\u2022 The authors should consider possible harms that could arise when the technology is being used as intended and functioning correctly, harms that could arise when the technology is being used as intended but gives incorrect results, and harms following from (intentional or unintentional) misuse of the technology.   \n\u2022 If there are negative societal impacts, the authors could also discuss possible mitigation strategies (e.g., gated release of models, providing defenses in addition to attacks, mechanisms for monitoring misuse, mechanisms to monitor how a system learns from feedback over time, improving the efficiency and accessibility of ML). ", "page_idx": 44}, {"type": "text", "text": "11. Safeguards ", "text_level": 1, "page_idx": 44}, {"type": "text", "text": "Question: Does the paper describe safeguards that have been put in place for responsible release of data or models that have a high risk for misuse (e.g., pretrained language models, image generators, or scraped datasets)? ", "page_idx": 44}, {"type": "text", "text": "Answer: [NA] ", "page_idx": 44}, {"type": "text", "text": "Justification: The paper poses no such risks. ", "page_idx": 44}, {"type": "text", "text": "Guidelines: ", "page_idx": 44}, {"type": "text", "text": "\u2022 The answer NA means that the paper poses no such risks.   \n\u2022 Released models that have a high risk for misuse or dual-use should be released with necessary safeguards to allow for controlled use of the model, for example by requiring that users adhere to usage guidelines or restrictions to access the model or implementing safety filters.   \n\u2022 Datasets that have been scraped from the Internet could pose safety risks. The authors should describe how they avoided releasing unsafe images.   \n\u2022 We recognize that providing effective safeguards is challenging, and many papers do not require this, but we encourage authors to take this into account and make a best faith effort. ", "page_idx": 44}, {"type": "text", "text": "12. Licenses for existing assets ", "text_level": 1, "page_idx": 44}, {"type": "text", "text": "Question: Are the creators or original owners of assets (e.g., code, data, models), used in the paper, properly credited and are the license and terms of use explicitly mentioned and properly respected? ", "page_idx": 44}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 44}, {"type": "text", "text": "Justification: We have cited the associated papers that produced the code package and dataset in Section 6. ", "page_idx": 45}, {"type": "text", "text": "Guidelines: ", "page_idx": 45}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not use existing assets.   \n\u2022 The authors should cite the original paper that produced the code package or dataset.   \n\u2022 The authors should state which version of the asset is used and, if possible, include a URL.   \n\u2022 The name of the license (e.g., CC-BY 4.0) should be included for each asset.   \n\u2022 For scraped data from a particular source (e.g., website), the copyright and terms of service of that source should be provided.   \n\u2022 If assets are released, the license, copyright information, and terms of use in the package should be provided. For popular datasets, paperswithcode.com/datasets has curated licenses for some datasets. Their licensing guide can help determine the license of a dataset.   \n\u2022 For existing datasets that are re-packaged, both the original license and the license of the derived asset (if it has changed) should be provided.   \n\u2022 If this information is not available online, the authors are encouraged to reach out to the asset\u2019s creators. ", "page_idx": 45}, {"type": "text", "text": "13. New Assets ", "text_level": 1, "page_idx": 45}, {"type": "text", "text": "Question: Are new assets introduced in the paper well documented and is the documentation provided alongside the assets? ", "page_idx": 45}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 45}, {"type": "text", "text": "Justification: The Appendix includes a link to our GitHub repository that contains the code to reproduce our simulation study. ", "page_idx": 45}, {"type": "text", "text": "Guidelines: ", "page_idx": 45}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not release new assets.   \n\u2022 Researchers should communicate the details of the dataset/code/model as part of their submissions via structured templates. This includes details about training, license, limitations, etc.   \n\u2022 The paper should discuss whether and how consent was obtained from people whose asset is used.   \n\u2022 At submission time, remember to anonymize your assets (if applicable). You can either create an anonymized URL or include an anonymized zip file. ", "page_idx": 45}, {"type": "text", "text": "14. Crowdsourcing and Research with Human Subjects ", "text_level": 1, "page_idx": 45}, {"type": "text", "text": "Question: For crowdsourcing experiments and research with human subjects, does the paper include the full text of instructions given to participants and screenshots, if applicable, as well as details about compensation (if any)? ", "page_idx": 45}, {"type": "text", "text": "Answer: [NA] ", "page_idx": 45}, {"type": "text", "text": "Justification: This paper does not involve crowdsourcing nor research with human subjects. Guidelines: ", "page_idx": 45}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not involve crowdsourcing nor research with human subjects.   \n\u2022 Including this information in the supplemental material is fine, but if the main contribution of the paper involves human subjects, then as much detail as possible should be included in the main paper.   \n\u2022 According to the NeurIPS Code of Ethics, workers involved in data collection, curation, or other labor should be paid at least the minimum wage in the country of the data collector. ", "page_idx": 45}, {"type": "text", "text": "15. Institutional Review Board (IRB) Approvals or Equivalent for Research with Human Subjects ", "page_idx": 45}, {"type": "text", "text": "Question: Does the paper describe potential risks incurred by study participants, whether such risks were disclosed to the subjects, and whether Institutional Review Board (IRB) approvals (or an equivalent approval/review based on the requirements of your country or institution) were obtained? ", "page_idx": 46}, {"type": "text", "text": "Answer: [NA] ", "page_idx": 46}, {"type": "text", "text": "Justification: The paper does not involve crowdsourcing nor research with human subjects. Guidelines: ", "page_idx": 46}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not involve crowdsourcing nor research with human subjects.   \n\u2022 Depending on the country in which research is conducted, IRB approval (or equivalent) may be required for any human subjects research. If you obtained IRB approval, you should clearly state this in the paper.   \n\u2022 We recognize that the procedures for this may vary significantly between institutions and locations, and we expect authors to adhere to the NeurIPS Code of Ethics and the guidelines for their institution.   \n\u2022 For initial submissions, do not include any information that would break anonymity (if applicable), such as the institution conducting the review. ", "page_idx": 46}]