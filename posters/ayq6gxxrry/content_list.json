[{"type": "text", "text": "Transferable Boltzmann Generators ", "text_level": 1, "page_idx": 0}, {"type": "text", "text": "Leon Klein ", "page_idx": 0}, {"type": "text", "text": "", "page_idx": 0}, {"type": "text", "text": "Freie Universit\u00e4t Berlin leon.klein@fu-berlin.de ", "page_idx": 0}, {"type": "text", "text": "", "page_idx": 0}, {"type": "text", "text": "Frank No\u00e9   \nMicrosoft Research AI4Science   \nFreie Universit\u00e4t Berlin   \nRice University   \nfranknoe@microsoft.com ", "page_idx": 0}, {"type": "text", "text": "Abstract ", "text_level": 1, "page_idx": 0}, {"type": "text", "text": "The generation of equilibrium samples of molecular systems has been a longstanding problem in statistical physics. Boltzmann Generators are a generative machine learning method that addresses this issue by learning a transformation via a normalizing flow from a simple prior distribution to the target Boltzmann distribution of interest. Recently, flow matching has been employed to train Boltzmann Generators for small molecular systems in Cartesian coordinates. We extend this work and propose a first framework for Boltzmann Generators that are transferable across chemical space, such that they predict zero-shot Boltzmann distributions for test molecules without being retrained for these systems. These transferable Boltzmann Generators allow approximate sampling from the target distribution of unseen systems, as well as efficient reweighting to the target Boltzmann distribution. The transferability of the proposed framework is evaluated on dipeptides, where we show that it generalizes efficiently to unseen systems. Furthermore, we demonstrate that our proposed architecture enhances the efficiency of Boltzmann Generators trained on single molecular systems. ", "page_idx": 0}, {"type": "text", "text": "1 Introduction ", "text_level": 1, "page_idx": 0}, {"type": "text", "text": "Generative models have demonstrated remarkable success in the physical sciences, including protein structure prediction [1, 2, 3], generation of de novo molecules [4, 5, 6, 7], and efficiently generating samples from the Boltzmann distribution [8, 9, 10]. In this work, we will focus on the latter for molecular systems, which represents a promising avenue for addressing the sampling problem. The sampling problem refers to the long-standing challenge in statistical physics to generate samples from equilibrium Boltzmann distributions $\\mu(x)\\propto\\exp{(-U(x)/k_{B}T)}$ , where $U(x)$ is the potential energy of the system, $k_{B}$ the Boltzmann constant, and $T$ the temperature. Traditionally, samples are generated with sequential sampling algorithms such as Markov Chain Monte Carlo and Molecular Dynamics (MD) simulations. However, these algorithms require a significant amount of time to generate uncorrelated samples from the target distribution. This is due to the necessity of performing small update steps, in the order of femtoseconds, for stability. This is especially challenging in the presence of well-separated metastable states, where transitions are unlikely due to high energy barriers. In recent years, numerous machine learning methods have emerged to address this challenge [8, 11]. One such method is the Boltzmann Generators (BG) [8]. In this work, we refer to BGs as a model that allows for the approximate sampling of the Boltzmann distribution of interest and the subsequent reweighting to the unbiased target distribution. If the model is only capable of generating approximate samples, which may stem from a subset of the Boltzmann distribution, we refer to them as Boltzmann Emulators1. Boltzmann Generators transform a typically simple prior distribution into an approximation of the target Boltzmann distribution through a normalizing flow [12, 13, 14, 15]. Once generated, samples can be reweighted to align with the unbiased target distribution. The effectiveness of this reweighting hinges on how closely the generated distribution approximates the target. As a result, it is possible to obtain uncorrelated and unbiased samples from the target Boltzmann distribution, potentially achieving significant speed-ups compared to classical MD simulations. ", "page_idx": 0}, {"type": "text", "text": "", "page_idx": 1}, {"type": "text", "text": "There are numerous ways to construct a Boltzmann Generator due to the variety of realizations of normalizing flows available. In this work, we concentrate on continuous normalizing flows (CNFs) [16, 17], as opposed to coupling flows [18]. Recently, flow matching [19, 20, 21, 22] has emerged as an alternative training method for CNFs. This approach is simulation-free, enabling more efficient training of CNFs. ", "page_idx": 1}, {"type": "text", "text": "Thus far, Boltzmann Generators have been limited by the requirement to train them on the specific system of interest. This training process demands a significant amount of time, making it difficult to achieve substantial speed-ups over classical MD simulations. Consequently, there is a strong desire for a transferable Boltzmann Generator that can be trained on one set of molecules and effectively generalize to another, enabling efficient generation of Boltzmann samples at inference time without the need for retraining. Recently, reliable Boltzmann Generators in Cartesian coordinates for molecules have been introduced [23, 24], paving the way for transferable Boltzmann Generators. This advancement is particularly significant because these models do not rely on molecule-specific internal coordinate representations, which have traditionally made the construction of transferable models challenging. ", "page_idx": 1}, {"type": "text", "text": "In this work, we present a framework for transferable Boltzmann Generators based on CNFs, enabling effective sample generation from previously unseen Boltzmann distributions. Transferable Boltzmann Generators are particularly advantageous as they do not require retraining for similar systems and can be trained on shorter trajectories that may not fully capture all metastable states. ", "page_idx": 1}, {"type": "text", "text": "We make the following main contributions: ", "text_level": 1, "page_idx": 1}, {"type": "text", "text": "1. To the best of our knowledge, we introduce the first transferable Boltzmann Generator. We demonstrate its transferability on dipeptides, successfully generating unbiased samples from the Boltzmann distributions of unseen dipeptides.   \n2. We outline a general framework for training and sampling with transferable Boltzmann Generators based on continuous normalizing flows, which also includes the post-processing of generated samples.   \n3. We conduct several ablation studies to investigate the effects of different architectures, training set sizes, and biasing of the training data. The results reveal that even small training sets can suffice to train transferable Boltzmann Generators. Additionally, we compare our model with Timewarp [11], which employs large time steps instead of generating independent samples as our method does. ", "page_idx": 1}, {"type": "text", "text": "2 Related work ", "text_level": 1, "page_idx": 1}, {"type": "text", "text": "The initial work on Boltzmann Generators [8] has led to a great deal of subsequent research. The most common application of BGs is to generate samples from Boltzmann distributions of molecules [25, 26, 27, 28, 29, 30], as well as lattice systems [26, 31, 32, 33]. Most BGs for molecular systems require system-specific featurizations such as internal coordinates [8, 34, 26, 27, 35, 36, 30]. Only recently, BGs for small molecular systems in Cartesian coordinates were introduced [23, 24], using CNFs and coupling flows, respectively. Equivariant normalizing flows [37, 38, 39, 28, 23, 40] played a pivotal role in the success of Boltzmann Generators in Cartesian coordinates, not only for molecular systems. The majority of BGs employ a Gaussian prior distribution, but it is also possible to start from prior distributions close to the target distribution [41, 36, 42], which makes the learning task simpler. However, all previous Boltzmann Generators are not transferable. Arguably, the work of [7] represents an exception, as they are able to generate samples from unseen conditional (Boltzmann) distributions in torsion space. However, the distribution is conditioned on a single local structure for each molecule, namely fixed bonds and angles. Consequently, in contrast to our work, they are unable to generate samples from the full Boltzmann distribution in Euclidean space. The first transferable deep generative model that was able to generate asymptotically unbiased samples from the Boltzmann distribution is [11]. Instead of generating independent samples, they learn large time steps and combine these with Metropolis-Hastings acceptance steps, to ensure asymptotically unbiased samples. However, in contrast to our work, they do not generate uncorrelated samples. ", "page_idx": 1}, {"type": "text", "text": "Boltzmann Emulators are analogous to Boltzmann Generators, yet they are not designed to generate unbiased equilibrium samples from the target Boltzmann distribution. Instead, they are intended to generate approximate samples that do not undergo reweighting. Furthermore, the generation of all metastable states may not be a necessary requirement, depending on the system. Boltzmann Emulators do not need to be based on flow models, as they do not aim to do reweighing to the target distribution. They are often similar to Boltzmann Generators and use normalizing flows or diffusion models for the architecture, but due to removing the constraint of sampling the unbiased Boltzmann distribution, they can target significantly larger systems or are transferable. One example is [43], who propose a three stage transferable CNF model to learn peptide ensembles. [44] use flow matching to learn distributions of proteins, while [45] utilize diffusion models. [46] build a transferable Boltzmann Emulator for small molecules. Others aim to additionally also capture the correct dynamics of the molecular systems, such as [47], who use a diffusion model to predict transition probabilities. Scaling to larger systems often requires coarse graining [48, 49, 44], e.g. describing amino acids by a single bead rather than the individual atoms. However, this approach precludes the possibility of reweighting to the Boltzmann distribution. ", "page_idx": 2}, {"type": "text", "text": "A distinct, though related, learning objective is to generate novel molecular conformations. However, approximations from the Boltzmann distribution are not necessary; it is sufficient to generate a few (or even a single) conformation per molecule. The utilized architectures are once again analogous, as flow and diffusion models are employed [5, 6, 50, 51, 52, 7]. ", "page_idx": 2}, {"type": "text", "text": "3 Boltzmann Generators and Normalizing Flows ", "text_level": 1, "page_idx": 2}, {"type": "text", "text": "Here, we describe Boltzmann Generators and normalizing flows, which are a central part of our proposed transferable Boltzmann Generator framework. We follow the notation of [23]. ", "page_idx": 2}, {"type": "text", "text": "3.1 Boltzmann Generators ", "text_level": 1, "page_idx": 2}, {"type": "text", "text": "Boltzmann Generators (BGs) [8] combine an exact likelihood deep generative model and a reweighting algorithm to reweight the generated distribution to the target Boltzmann distribution. The exact likelihood deep generative model is trained to generate samples from a distribution $\\tilde{p}(\\boldsymbol{x})$ that is close to the target Boltzmann distribution $\\mu(x)$ . A common choice for the exact likelihood model are normalizing flows. ", "page_idx": 2}, {"type": "text", "text": "The Boltzmann Generator can be used to generate unbiased samples by first sampling $x\\sim\\tilde{p}(x)$ with the exact likelihood model and then computing corresponding importance weights $w(x)=\\mu(x)/\\tilde{p}(x)$ for each sample. These allow to reweight generated samples to the target Boltzmann distribution $\\mu(x)$ . It is possible to estimate observables of interest (asymptotically unbiased) using the weights $w(x)$ with importance sampling via ", "page_idx": 2}, {"type": "equation", "text": "$$\n\\langle O\\rangle_{\\mu}=\\frac{\\mathbb{E}_{x\\sim\\tilde{p}(x)}[w(x)O(x)]}{\\mathbb{E}_{x\\sim\\tilde{p}(x)}[w(x)]}.\n$$", "text_format": "latex", "page_idx": 2}, {"type": "text", "text": "Furthermore, these reweighting weights can be employed to assess the efficiency of trained BGs by computing the effective sample size (ESS) with Kish\u2019s equation [53]. In this work, we will compute the relative ESS, rather than the absolute one, and refer to it as ESS. ", "page_idx": 2}, {"type": "text", "text": "3.2 Continuous Normalizing Flows (CNFs) ", "text_level": 1, "page_idx": 2}, {"type": "text", "text": "Normalizing flows [15, 54] are a type of deep generative model used to learn complex probability densities $\\mu(x)$ by transforming a prior distribution $q(x)$ through an invertible transformation $f_{\\theta}:$ $\\mathbb{R}^{n}\\to\\mathbb{R}^{n}$ , resulting in the push-forward distribution $\\tilde{p}(\\boldsymbol{x})$ . ", "page_idx": 2}, {"type": "text", "text": "Continuous Normalizing Flows (CNFs) [16, 17] are a specific kind of normalizing flow. For CNFs, the invertible transformation $f_{\\theta}^{t}(x)$ is defined by the ordinary differential equation ", "page_idx": 2}, {"type": "equation", "text": "$$\n\\frac{d f_{\\theta}^{t}(x)}{d t}=v_{\\theta}\\left(t,f_{\\theta}^{t}(x)\\right),\\quad f_{\\theta}^{0}(x)=x_{0},\n$$", "text_format": "latex", "page_idx": 2}, {"type": "text", "text": "where $v_{\\theta}(t,x):\\mathbb{R}^{n}\\times[0,1]\\rightarrow\\mathbb{R}^{n}$ is a time-dependent vector field. The solution to this initial value problem provides the transformation equation ", "page_idx": 2}, {"type": "equation", "text": "$$\nf_{\\theta}^{t}(x)=x_{0}+\\int_{0}^{t}d t^{\\prime}v_{\\theta}\\left(t^{\\prime},f_{\\theta}^{t^{\\prime}}(x)\\right),\n$$", "text_format": "latex", "page_idx": 2}, {"type": "text", "text": "with $f_{\\theta}^{1}(x)=\\tilde{p}^{t}(x)$ . The corresponding change in log density from the prior to the push-forward distribution is described by the continuous change of variable equation ", "page_idx": 3}, {"type": "equation", "text": "$$\n\\log\\tilde{p}(x)=\\log q(x)-\\int_{0}^{1}d t\\nabla\\cdot v_{\\theta}\\left(t,f_{\\theta}^{t}(x)\\right).\n$$", "text_format": "latex", "page_idx": 3}, {"type": "text", "text": "Equivariant flows The energy of molecular systems is typically invariant under permutations of interchangeable particles and global rotations and translations. Consequently, it is advantageous for the push-forward distribution of a Boltzmann Generator to possess the same symmetries as the target system. In [37, 38] the authors demonstrate that the push-forward distribution $\\tilde{p}(\\boldsymbol{x})$ of a permutation and rotation equivariant normalizing flow with a permutation and rotation invariant prior distribution, is again rotation and permutation invariant. Furthermore, [37] present a method to construct such equivariant CNFs by using an equivariant vector field $v_{\\theta}$ . ", "page_idx": 3}, {"type": "text", "text": "3.3 Flow matching ", "text_level": 1, "page_idx": 3}, {"type": "text", "text": "Flow matching [19, 20, 21, 22] enables efficient, simulation-free training of CNFs. The conditional flow matching training objective allows for the direct training of the vector field $v_{\\theta}(t,x)$ through ", "page_idx": 3}, {"type": "equation", "text": "$$\n\\mathcal{L}_{\\mathrm{CFM}}(\\theta)=\\mathbb{E}_{t\\sim[0,1],x\\sim p_{t}(x|z)}\\left|\\left|v_{\\theta}(t,x)-u_{t}(x|z)\\right|\\right|_{2}^{2}.\n$$", "text_format": "latex", "page_idx": 3}, {"type": "text", "text": "There are many possible parametrizations for the conditional vector field $u_{t}(x|z)$ and the conditional probability path $\\dot{p}_{t}(x|z)$ . One of the most simple, but powerful possible parametrization is ", "page_idx": 3}, {"type": "equation", "text": "$$\n\\begin{array}{r l}{z=(x_{0},x_{1})}&{\\mathrm{and}\\quad p(z)=q(x_{0})\\mu(x_{1})}\\\\ {u_{t}(x|z)=x_{1}-x_{0}}&{\\mathrm{and}\\quad p_{t}(x|z)=\\mathcal{N}(x|t\\cdot x_{1}+(1-t)\\cdot x_{0},\\sigma^{2}),}\\end{array}\n$$", "text_format": "latex", "page_idx": 3}, {"type": "text", "text": "which we use in this work to train our models. For a more detailed description refer to [19, 22, 23, 50]. ", "page_idx": 3}, {"type": "text", "text": "4 Transferable Boltzmann Generators ", "text_level": 1, "page_idx": 3}, {"type": "text", "text": "This section presents our proposed framework for transferable Boltzmann Generators (TBGs). ", "page_idx": 3}, {"type": "text", "text": "4.1 Architecture ", "text_level": 1, "page_idx": 3}, {"type": "text", "text": "Our proposed transferable Boltzmann Generator is based on a CNF. The corresponding vector field $v_{\\theta}(t,x)$ is parametrized by an $O(D)$ - and $S(N)$ -equivariant graph neural network (EGNN) [39, 55, 43], as commonly used in prior work, e.g. [23, 39]. Although, less expressive than other equivariant networks such as [56, 57, 58, 59], it is faster to evaluate, which is important for CNFs as there can be hundreds of vector field calls during inference. ", "page_idx": 3}, {"type": "text", "text": "The vector field $v_{\\theta}(t,x)$ consists of $L$ consecutive layers. The position of the $i$ -th particle $x_{i}$ is updated according to the following equations: ", "page_idx": 3}, {"type": "equation", "text": "$$\n\\begin{array}{r l r}&{\\displaystyle h_{i}^{0}=(t,a_{i},b_{i},c_{i}),\\quad m_{i j}^{l}=\\phi_{e}\\left(h_{i}^{l},h_{j}^{l},d_{i j}^{2}\\right),}&\\\\ &{\\displaystyle x_{i}^{l+1}=x_{i}^{l}+\\sum_{j\\neq i}\\frac{(x_{i}^{l}-x_{j}^{l})}{d_{i j}+1}\\phi_{d}(m_{i j}^{l}),}&\\\\ &{\\displaystyle h_{i}^{l+1}=\\phi_{h}\\left(h_{i}^{l},m_{i}^{l}\\right),\\quad m_{i}^{l}=\\sum_{j\\neq i}\\phi_{m}(m_{i j}^{l})m_{i j}^{l},}&\\\\ &{\\displaystyle v_{\\theta}(t,x^{0})_{i}=x_{i}^{L}-x_{i}^{0}-\\frac{1}{N}\\sum_{j}^{N}(x_{j}^{L}-x_{j}^{0}),}&\\end{array}\n$$", "text_format": "latex", "page_idx": 3}, {"type": "text", "text": "where $\\phi_{\\alpha}$ represents different neural networks, $d_{i j}$ is the Euclidean distance between particle $i$ and $j,t$ is the time, $a_{i}$ is an embedding for the particle type, $b_{i}$ for the amino acid, and $c_{i}$ or the amino acid position in the peptide. In the final step, the geometric center is subtracted to ensure that the center of positions is conserved. When combined with a symmetric mean-free prior distribution, the push-forward distribution of the CNF will be $O(D)$ - and $S(N)$ -invariant, as demonstrated in [60]. ", "page_idx": 3}, {"type": "text", "text": "The embedding of each atom is constructed from three parts. The first part is the atom type $a_{i}$ , which is a one-hot vector of 54 classes. The classes are defined based on the atom types in the peptide topology. Therefore, only a few atoms are indistinguishable, such as hydrogen atoms that are bound to the same carbon or nitrogen atom. The second part is the amino acid to which the atom belongs, which is divided into 20 classes. The third part is the position of the amino acid in the peptide sequence. This embedding is similar to the embedding used in [43] for the rotamer embeddings. The amino acid and positional embeddings are only used for the transferable experiments. For more details see Appendix B.5. In this study, we refer to this transferable Boltzmann Generator architecture as $T B G+f u l l$ , and we use this name even when we apply it to a non-transferable setting. ", "page_idx": 4}, {"type": "text", "text": "The proposed architecture in [23] uses distinct encodings for all backbone atoms and the atom types for all other atoms. This represents a special case of our architecture, wherein $b_{i}$ and $c_{i}$ are omitted and $a_{i}$ encodes the atom type or a backbone atom. Hence, there are 13 classes for $a_{i}$ . We refer to this architecture as $T B G+$ backbone. Furthermore, we refer to the specific architecture employed in [23] as $\\mathrm{BG}+$ backbone for the alanine dipeptide experiments. Note that using only $a_{i}$ causes problems for transferability, see Appendix A.4 for more details. ", "page_idx": 4}, {"type": "text", "text": "Moreover, we employ a model that utilizes the atom type as the sole encoding (there are only five distinct atom types). This model is referred to as simply TBG. ", "page_idx": 4}, {"type": "text", "text": "4.2 Training transferable Boltzmann Generators ", "text_level": 1, "page_idx": 4}, {"type": "text", "text": "All transferable Boltzmann Generators utilize flow matching for training. Given the variation in peptides across batches, the flow matching loss for each peptide is normalized by the number of atoms it contains. This training procedure is applied to all different architectures. For further details, refer to Appendix B. ", "page_idx": 4}, {"type": "text", "text": "4.3 Inference with transferable Boltzmann Generators ", "text_level": 1, "page_idx": 4}, {"type": "text", "text": "Sampling with a transferable Boltzmann Generator, especially on unseen peptides, poses multiple challenges: (i) Some generated samples may not correspond to the molecule of interest, but rather to a molecule that contains the same atoms but has a different bonding graph. Some of these configurations might even be valid molecules. For some examples see Appendix A.4. However, as we are in this work interested in sampling from the equilibrium Boltzmann distribution for a given molecular bonding graph, rather than sampling distinct molecules, we would like to avoid these cases. Nevertheless, this effect can be largely mitigated by our proposed $\\mathrm{TBG+}$ full architecture. (ii) When working with classical force fields, the correct ordering with respect to the topology is crucial for evaluating energies. This is not a concern for semi-empirical force fields, as they respect the permutation symmetry of particles of the same type. As we typically use a Gaussian prior distribution, it is common that the generated samples are not arranged according to the topology. Consequently, in order to evaluate the energy, it is necessary to reorder the generated samples according to the topology. (iii) It is possible that the chirality of generated samples differs from that of the peptide of interest. ", "page_idx": 4}, {"type": "text", "text": "We resolve (i) and (ii) by generating a bond graph for the generated samples, based on empirical bond distances and atom types. This graph is then compared with a reference bond graph. If the two graphs are isomorphic, we can conclude that the configuration is correct. For more details, see Appendix B.1. For (iii), we employ the code of [11] to check all chiral centers. If all chirality centers of a peptide are flipped, this can be resolved by mirroring. Otherwise, these samples are assigned high energies, as they are not from the target Boltzmann distribution of interest. It is important to note that only generated samples with the correct configuration and chirality are considered valid samples from the Boltzmann distribution of interest. ", "page_idx": 4}, {"type": "text", "text": "5 Experiments ", "text_level": 1, "page_idx": 4}, {"type": "text", "text": "In this section, we compare our model with similar previous work on equivariant Boltzmann Generators [23] for alanine dipeptide. Moreover, we show the transferability of our model on dipeptides, where we compare our model with the transferable Timewarp model [11]. More experimental details, such as dataset details, the specifics of the employed models, and the utilized computing infrastructure can be found in Appendix B. ", "page_idx": 4}, {"type": "table", "img_path": "AYq6GxxrrY/tmp/c85c2efd18a5ac499065612dfc29a38cf03476bc60a492cf8c2c565ed7cc3778.jpg", "table_caption": ["Table 1: Comparison of Boltzmann Generators with different architectures for the single molecular system alanine dipeptide. Errors are computed over five runs. The results for the Boltzmann Generator and backbone encoding $\\mathrm{BG}+$ backbone) for the semi-empirical force field are taken from [23]. "], "table_footnote": [], "page_idx": 5}, {"type": "text", "text": "5.1 Alanine dipeptide ", "text_level": 1, "page_idx": 5}, {"type": "text", "text": "In our first experiment, we investigate the single molecule alanine dipeptide in implicit solvent, described in Cartesian coordinates. The dataset was introduced in [23], for more details see Appendix B.2. The training trajectory was generated by sampling with respect to a classical force field, and subsequently, $10^{5}$ random samples were relaxed with respect to the semi-empirical $G F N2{-}x T B$ force-field [61] for 100fs each. The objective is to train a Boltzmann Generator capable of sampling from the equilibrium Boltzmann distribution defined by the semi-empirical $G F N2{-}x T B$ force-field efficiently and to recover the free energy surface along the slowest transition, i.e. the $\\varphi$ angle. Following the methodology outlined in [23], the training data is biased towards the less probable (positive) $\\varphi$ state. It is evident that any trained model on this set will be biased in comparison to the true Boltzmann distribution defined by the semi-empirical energy. However, the reweighting technique allows for the debiasing of the samples. The model is trained in the same way as described in [23]. Overall, the likelihoods and ESS values observed for the $\\mathrm{TGB+}$ full model are superior to those reported in [23] (Table 1). This is achieved with nearly the same amount of parameters and maintaining comparable training and inference times (see Appendix B.3). Furthermore, the correct free energy difference is recovered, as demonstrated in Appendix A.1. ", "page_idx": 5}, {"type": "text", "text": "In [23] the authors utilized a semi-empirical potential to avoid the required ordering of the atoms to the topology for classical force fields. As the prior distribution of the Boltzmann Generator is usually a multivariate standard Gaussian distribution, generated samples will almost certainly not have the correct ordering. As we have introduced an efficient way to reorder samples in Section 4.3, we can now also evaluate alanine dipeptide for a classical force field. Therefore, we retrain the model in [23] on the classical MD trajectory and compare with our $\\mathrm{TBG}+$ full architecture. We bias the training data as before towards the unlikely $\\varphi$ state. As expected, the likelihood and ESS for the classical force field are much better than for the semi-empirical one, as the training data stems from the target distribution. Our proposed architecture again performs significantly better, as shown in Table 1 and Figure 1. The majority of generated samples with the $\\mathrm{TBG}+$ full model and the $\\mathrm{BG}+$ backbone sample nearly exclusively correct configurations, i.e. configurations with the correct bond graph, namely nearly $100\\%$ and about $98\\%$ , respectively. As presented in Figure 1, both models recover the free energy landscape correctly. ", "page_idx": 5}, {"type": "image", "img_path": "AYq6GxxrrY/tmp/e9a74787f7456ede7039dcf62c17f633cf622c096c6693a8b4fddcb2b4641c91.jpg", "img_caption": [], "img_footnote": [], "page_idx": 6}, {"type": "text", "text": "Figure 2: Results for the KS dipeptide (a) Sample generated with the $\\mathrm{TBG}+$ full model (b) Ramachandran plot for the weighted MD distribution (left) and for samples generate with the $\\mathrm{TBG+}$ full model (right). (c) TICA plot for the weighted MD distribution (left) and for samples generate with the $\\mathrm{TBG}+$ full model (right). (d) Energies of samples generated with different methods and architectures. (e) Free energy projection along the $\\varphi$ angle. (f) Free energy projection along the slowest transition (TIC0). ", "page_idx": 6}, {"type": "image", "img_path": "AYq6GxxrrY/tmp/03ea23cb14a5acdad0ee3b718fe64ef60e1da51550d0c7f9ca2dc7b16cd186e5.jpg", "img_caption": [], "img_footnote": [], "page_idx": 6}, {"type": "text", "text": "Figure 3: Results for the GN dipeptide (a) Sample generated with the TBG $^+$ full model (b) Ramachandran plot for the weighted MD distribution (left) and for samples generate with the $\\mathrm{TBG+}$ full model (right). (c) TICA plot for the weighted MD distribution (left) and for samples generate with the $\\mathrm{TBG}+$ full model (right). (d) Energies of samples generated with different methods and architectures. (e) Free energy projection along the $\\varphi$ angle. (f) Free energy projection along the slowest transition (TIC0). ", "page_idx": 6}, {"type": "text", "text": "5.2 Dipeptides (2AA) ", "text_level": 1, "page_idx": 6}, {"type": "text", "text": "In our second experiment, we evaluate our model on dipeptides and show transferability. The dataset was introduced in [11]. The training set consists of 200 dipeptides, which were simulated each with a classical force field for 50 ns and, therefore, may not have reached convergence. Nevertheless, as previously demonstrated, it is not necessary to train on unbiased data in order to obtain unbiased samples with a Boltzmann Generator. ", "page_idx": 6}, {"type": "text", "text": "We compare the three different transferable architectures described in Section 4.1 and use the same training procedure for all of them. Similar to the alanine dipeptide experiments, we obtain significantly better results for the $\\mathrm{TBG}+$ full model in terms of ESS (Table 2 and Figure 4a), energies (Figure 2d), the ratio of correct configurations (Table 2), and likelihoods of test set samples (Appendix A.5). In particular, the extremely low number of correct configurations for numerous test peptides for the ", "page_idx": 6}, {"type": "image", "img_path": "AYq6GxxrrY/tmp/f9a7618d90094c890c7ffb8af39be03d2e0732b8e27d9a5ac4347c7076ba1e46.jpg", "img_caption": [], "img_footnote": [], "page_idx": 7}, {"type": "text", "text": "Figure 4: (a) Effective samples sizes (ESS) for the first 8 test peptides for different transferable architectures and training sets. (b) Free energy projection along the $\\varphi$ angle for the $\\mathrm{TBG}+$ full model trained on the biased dataset for the KS dipeptide. The weighted free energy projection demonstrates a superior fti compared to the $\\mathrm{TBG+}$ full model (see Figure 2e). (c) Free energy projection along the $\\varphi$ angle for the $\\mathrm{TBG+}$ full model trained on the biased dataset for the GN dipeptide. The weighted free energy projection demonstrates a superior fti compared to the TBG $^+$ full model (see Figure 3e). ", "page_idx": 7}, {"type": "text", "text": "TBG and $\\mathrm{TBG+}$ backbone models renders them unsuitable as Boltzmann Generators for this setting (Table 2 and Appendix A.5). Furthermore, the TBG $^+$ full model always finds all metastable states for unseen test peptides (see also Appendix A.5). ", "page_idx": 7}, {"type": "text", "text": "The results for the well-performing TBG $^+$ full model are presented for two exemplary peptides from the test set in Figure 2 and Figure 3. They were chosen as all architectures sample relevant amounts of valid configurations. Detailed results for other evaluated test peptides are shown in Appendix A.5. ", "page_idx": 7}, {"type": "text", "text": "The TBG $^+$ full model is an exemplary Boltzmann Emulator, as it is capable of capturing all metastable states of the target Boltzmann distribution (Figure 2b,c and Figure 3b,c). However, it is furthermore also a capable Boltzmann Generator, as it allows for efficient reweighting (Figure 2d,e,f and Figure 3d,e,f) with good ESSs (Table 2). To identify different metastable states, we employ time-lagged independent component analysis (TICA) [62], a dimensionality reduction technique that separates metastable states. We show this analysis in addition to the Ramachandran plots for the dihedral angles. ", "page_idx": 7}, {"type": "text", "text": "Moreover, we investigate the influence of the training set in two ablation studies. ", "page_idx": 7}, {"type": "text", "text": "Training on a biased training set Our alanine dipeptide results as well as [23] indicate that it can be advantageous to bias the training data towards states that are less probable, such as positive $\\varphi$ states, to recover free energy landscapes. Therefore, we bias the training data by weighting positive $\\varphi$ states for each training peptide, such that they have nearly equal weight to the negative states (see also Appendix B.4). We show that a $\\mathrm{TBG+}$ full model trained on this dataset $\\mathrm{TBG+}$ full (biased)) produces even more accurate free energy landscapes for both the Ramachandran and TICA projections (Figure 4bc). Notably, the unweighted projection shows a clear bias, as expected. However, as the training data is now biased, the effective sample size (ESS) is generally lower (Table 2 and Figure 4a). ", "page_idx": 7}, {"type": "text", "text": "Training on a smaller training set Additionally, we examine the impact of smaller training sets on the generalization results. To this end, we train the TBG $^+$ full model on two smaller datasets with shorter simulation times: (i) 5ns for each training simulation and (ii) only 500ps of each training simulation. Consequently, the training trajectories are 10 times and 100 times smaller than before. As we utilize only the initial portion of each trajectory, a greater number of metastable states are missed during the brief simulations, as illustrated in Appendix A.2. Training on the tenfold smaller trainings set, we refer to the model as $\\mathrm{TBG+}$ full (smaller), shows slightly worse results compared to training on the whole trainings set (Table 2 and Appendix A.5). The even smaller trainings set leads to inferior results, with several metastable states being missed as presented inAppendix A.3. Nevertheless, these findings show that transferable Boltzmann Generators can be effectively trained using very small datasets, even when individual trajectories lack metastable states. ", "page_idx": 7}, {"type": "text", "text": "5.3 Comparison with Timewarp [11] ", "text_level": 1, "page_idx": 7}, {"type": "text", "text": "In this section, we compare our TBG model with the Timewarp model [11] on the dipeptide dataset. Unlike our approach, which generates independent samples, the Timewarp model predicts large time steps, which can be cobined with Metropolis-Hastings acceptance steps to ensure asymptotically unbiased sampling. Additionally, Timewarp employs a coupling flow rather than a continuous flow. Similar to our $\\mathrm{TBG}+$ full model, the Timewarp model also treats most particles as distinguishable. It does so by conditioning the learned probability on the current state, implicitly capturing the topology information. ", "page_idx": 7}, {"type": "table", "img_path": "AYq6GxxrrY/tmp/bd4661f671803c8e3d6922b8c5bbebeed4718da97e61092ff8b5a6997cff81fe.jpg", "table_caption": ["Table 2: Effective samples size and correct configuration rate for unseen dipeptides across different transferable Boltzmann Generator (TBG) architectures. The values are computed for 8 test dipeptides. See Appendix A.5 for more results. "], "table_footnote": [], "page_idx": 8}, {"type": "table", "img_path": "AYq6GxxrrY/tmp/4942ffce28f46f9ea806a228aef52762836cc587b4dc17eb61a945904fe442c0.jpg", "table_caption": [], "table_footnote": [], "page_idx": 8}, {"type": "text", "text": "", "page_idx": 8}, {"type": "text", "text": "We compare the Wasserstein distance between the generated Ramachandran plot and the MD Ramachandran plot for different computational budgets for dipeptides: (a) 30,000 energy evaluations, (b) 12 hours, and (c) 24 hours of wall-clock simulation time on an A-100 GPU. As shown in Figure 5 the $\\mathrm{TBG+}$ full model outperformed the Timewarp model across all budgets, particularly in terms of energy evaluations. Energy evaluations are especially critical, as they become a major computational bottleneck with more complex force fields. Moreover, the unweighted samples of the $\\mathrm{TBG}+$ full model have lower energies, and are therefore closer to the actual target Boltzmann distribution, than samples generated with Timewarp without Metropolis-Hastings acceptance (exploration mode). Additional results and details can be found in Appendix A.7. ", "page_idx": 8}, {"type": "text", "text": "6 Discussion ", "text_level": 1, "page_idx": 8}, {"type": "text", "text": "For the first time, we demonstrated the feasibility of training transferable Boltzmann Generators. We introduced a general framework for training and evaluating transferable Boltzmann Generators based on continuous normalizing flows. Furthermore, we developed a transferable architecture based on equivariant graph neural networks and demonstrated the importance of including topology information in the architecture to enable efficient generalization to unseen, but similar systems. The transferable Boltzmann Generator was evaluated on dipeptides, where significant effective sample sizes were demonstrated on unseen test peptides and accurate sampling of physical properties, such as the free energy difference between metastable states, was achieved. Moreover, we have shown in ablation studies that transferable Boltzmann Generators can be extremely data efficient, with even small training trajectories being sufficient. Future research will determine whether and how transferable Boltzmann Generators can be scaled to larger systems. ", "page_idx": 8}, {"type": "text", "text": "7 Limitations / Future work ", "text_level": 1, "page_idx": 9}, {"type": "text", "text": "Scaling transferable Boltzmann Generators to larger systems remains for future work. Notably, this usually requires large amounts of computational resources, as e.g. shown in [11], where they are able to train their transferable model on tetrapeptides, but use more than 100 times more parameters than us. Scaling to larger systems often involves coarsegraining, which typically results in the loss of an explicit energy function. In such cases, the transferable Boltzmann Generator would effectively become a transferable Boltzmann Emulator. Depending on the specific application, samples from a distribution close to the target Boltzmann distribution may be sufficient. Our results show that unweighted samples from the TBG $^+$ full model already closely resemble the target Boltzmann distribution. ", "page_idx": 9}, {"type": "text", "text": "Additionally, small systems can still be highly relevant, especially when paired with more expensive force fields, such as semi-empirical or first-principles quantum-mechanical force fields. In these scenarios, energy evaluations become a primary bottleneck. Boltzmann Generators are particularly advantageous in this context, as they require several orders of magnitude fewer energy evaluations compared to MD simulations or other iterative methods, such as Timewarp [11]. One potential real world application would therefore be the simulation of small molecules with expensive force fields. ", "page_idx": 9}, {"type": "text", "text": "Instead of flow matching, one could use optimal transport flow matching [22] or equivariant optimal transport flow matching [23, 50] for training, but as indicated in [23] the gains for molecular systems, especially in the presence of many distinguishable particles, are small. ", "page_idx": 9}, {"type": "text", "text": "Throughout our work, we utilize a standard Gaussian prior distribution. However, as recently introduced, an alternative is to use a Harmonic prior distribution [63, 64], where atoms that are close in the bond graph are sampled in the vicinity of each other. Notably, We experimented with this Harmonic prior but found no significant improvements for our transferable model. This aligns with findings by [65], indicating that chemically informed priors do not enhance performance substantially compared to simpler uninformed priors for flow matching in molecular systems. Instead, the network architecture and inductive bias play a more crucial role. ", "page_idx": 9}, {"type": "text", "text": "Despite conducting a series of ablation studies, we did not pursue the impact of a training set comprising a smaller number of peptides. Instead, we opted for investigating shorter trajectories. Another potential direction could be relaxing the 2AA dataset using a semi-empirical force field and training on this modified version, similar to the alanine dipeptide experiment. However, this approach incurs additional computational costs, as the entire 2AA dataset would need to be relaxed with respect to the semi-empirical force field. ", "page_idx": 9}, {"type": "text", "text": "We used the EGNN architecture for the vector field due to its fast evaluation capabilities. Future research could explore alternative architectures for the vector field, such as those proposed by [56, 57, 58, 59, 66, 67, 64], to determine if they improve performance and enable scaling to larger systems. We hope that our framework will facilitate the scaling of transferable Boltzmann Generators to larger systems in future research. ", "page_idx": 9}, {"type": "text", "text": "8 Broader Impact ", "text_level": 1, "page_idx": 9}, {"type": "text", "text": "This work represents foundational research with no immediate societal impact. However, if our method is scalable to larger, more relevant systems, it could facilitate the acceleration of drug and material discovery by replacing or enhancing MD simulations, which often play a crucial part in the process. A potential risk is that this method then might be used to identify new diseases or develop biological weapons. Another risk is the lack of a known convergence criterion, making it impossible to confirm that all potential configurations have been identified, even with an infinite number of samples. This could lead to false claims about the results, potentially affecting subsequent applications. ", "page_idx": 9}, {"type": "text", "text": "Acknowledgements ", "text_level": 1, "page_idx": 10}, {"type": "text", "text": "We gratefully acknowledge support by the Deutsche Forschungsgemeinschaft (SFB1114, Projects No. C03, No. A04, and No. B08), the European Research Council (ERC CoG 772230 \u201cScaleCell\u201d), the Berlin Mathematics center MATH $^+$ (AA1-10), and the German Ministry for Education and Research (BIFOLD - Berlin Institute for the Foundations of Learning and Data). We gratefully acknowledge the computing time made available to them on the high-performance computer \"Lise\" at the NHR Center NHR $@$ ZIB. This center is jointly supported by the Federal Ministry of Education and Research and the state governments participating in the NHR (www.nhr-verein.de/unsere-partner). We thank Andreas Kr\u00e4mer, Michele Invernizzi, Jonas K\u00f6hler, Atharvar Kelkar, Yaoyi Chen, Max Schebek, Iryna Zaporozhets, and Hannes St\u00e4rk for insightful discussions. Moreover, we thank Andrew Foong and Yaoyi Chen for providing the datasets from the Timewarp project [11]. ", "page_idx": 10}, {"type": "text", "text": "References ", "text_level": 1, "page_idx": 11}, {"type": "text", "text": "[1] Josh Abramson, Jonas Adler, Jack Dunger, Richard Evans, Tim Green, Alexander Pritzel, Olaf Ronneberger, Lindsay Willmore, Andrew J Ballard, Joshua Bambrick, et al. Accurate structure prediction of biomolecular interactions with alphafold 3. Nature, pages 1\u20133, 2024.   \n[2] John Jumper, Richard Evans, Alexander Pritzel, Tim Green, Michael Figurnov, Olaf Ronneberger, Kathryn Tunyasuvunakool, Russ Bates, Augustin \u017d\u00eddek, Anna Potapenko, et al. Highly accurate protein structure prediction with alphafold. Nature, 596(7873):583\u2013589, 2021.   \n[3] Zeming Lin, Halil Akin, Roshan Rao, Brian Hie, Zhongkai Zhu, Wenting Lu, Allan dos Santos Costa, Maryam Fazel-Zarandi, Tom Sercu, Sal Candido, et al. Language models of protein sequences at the scale of evolution enable accurate structure prediction. BioRxiv, 2022:500902, 2022.   \n[4] Niklas Gebauer, Michael Gastegger, and Kristof Sch\u00fctt. Symmetry-adapted generation of 3d point sets for the targeted discovery of molecules. Advances in neural information processing systems, 32, 2019.   \n[5] Emiel Hoogeboom, V\u00edctor Garcia Satorras, Cl\u00e9ment Vignac, and Max Welling. Equivariant diffusion for molecule generation in 3D. In Kamalika Chaudhuri, Stefanie Jegelka, Le Song, Csaba Szepesvari, Gang Niu, and Sivan Sabato, editors, Proceedings of the 39th International Conference on Machine Learning, volume 162 of Proceedings of Machine Learning Research, pages 8867\u20138887. PMLR, 17\u201323 Jul 2022.   \n[6] Minkai Xu, Lantao Yu, Yang Song, Chence Shi, Stefano Ermon, and Jian Tang. Geodiff: A geometric diffusion model for molecular conformation generation. In International Conference on Learning Representations, 2022.   \n[7] Bowen Jing, Gabriele Corso, Jeffrey Chang, Regina Barzilay, and Tommi Jaakkola. Torsional diffusion for molecular conformer generation. In S. Koyejo, S. Mohamed, A. Agarwal, D. Belgrave, K. Cho, and A. Oh, editors, Advances in Neural Information Processing Systems, volume 35, pages 24240\u201324253. Curran Associates, Inc., 2022.   \n[8] Frank No\u00e9, Simon Olsson, Jonas K\u00f6hler, and Hao Wu. Boltzmann generators \u2014 sampling equilibrium states of many-body systems with deep learning. Science, 365:eaaw1147, 2019.   \n[9] Alessandro Coretti, Sebastian Falkner, Jan Weinreich, Christoph Dellago, and O Anatole von Lilienfeld. Boltzmann generators and the new frontier of computational sampling in many-body systems. arXiv preprint arXiv:2404.16566, 2024.   \n[10] Grant M Rotskoff. Sampling thermodynamic ensembles of molecular systems with generative neural networks: Will integrating physics-based models close the generalization gap? Current Opinion in Solid State and Materials Science, 30:101158, 2024.   \n[11] Leon Klein, Andrew Y. K. Foong, Tor Erlend Fjelde, Bruno Kacper Mlodozeniec, Marc Brockschmidt, Sebastian Nowozin, Frank Noe, and Ryota Tomioka. Timewarp: Transferable acceleration of molecular dynamics by learning time-coarsened dynamics. In Thirty-seventh Conference on Neural Information Processing Systems, 2023.   \n[12] Esteban G Tabak, Eric Vanden-Eijnden, et al. Density estimation by dual ascent of the loglikelihood. Communications in Mathematical Sciences, 8(1):217\u2013233, 2010.   \n[13] Esteban G Tabak and Cristina V Turner. A family of nonparametric density estimation algorithms. Communications on Pure and Applied Mathematics, 66(2):145\u2013164, 2013.   \n[14] George Papamakarios, Eric Nalisnick, Danilo Jimenez Rezende, Shakir Mohamed, and Balaji Lakshminarayanan. Normalizing flows for probabilistic modeling and inference. CoRR, 2019.   \n[15] Danilo Rezende and Shakir Mohamed. Variational inference with normalizing flows. In International conference on machine learning, pages 1530\u20131538. PMLR, 2015.   \n[16] Tian Qi Chen, Yulia Rubanova, Jesse Bettencourt, and David K Duvenaud. Neural ordinary differential equations. In Advances in neural information processing systems, pages 6571\u20136583, 2018.   \n[17] Will Grathwohl, Ricky T. Q. Chen, Jesse Bettencourt, and David Duvenaud. Scalable reversible generative models with free-form continuous dynamics. In International Conference on Learning Representations, 2019.   \n[18] Laurent Dinh, David Krueger, and Yoshua Bengio. Nice: Non-linear independent components estimation. CoRR, 2014.   \n[19] Yaron Lipman, Ricky T. Q. Chen, Heli Ben-Hamu, Maximilian Nickel, and Matthew Le. Flow matching for generative modeling. In The Eleventh International Conference on Learning Representations, 2023.   \n[20] Michael Samuel Albergo and Eric Vanden-Eijnden. Building normalizing flows with stochastic interpolants. In The Eleventh International Conference on Learning Representations, 2023.   \n[21] Xingchao Liu, Chengyue Gong, and qiang liu. Flow straight and fast: Learning to generate and transfer data with rectified flow. In The Eleventh International Conference on Learning Representations, 2023.   \n[22] Alexander Tong, Nikolay Malkin, Guillaume Huguet, Yanlei Zhang, Jarrid Rector-Brooks, Kilian Fatras, Guy Wolf, and Yoshua Bengio. Conditional flow matching: Simulation-free dynamic optimal transport. arXiv preprint arXiv:2302.00482, 2023.   \n[23] Leon Klein, Andreas Kr\u00e4mer, and Frank Noe. Equivariant flow matching. In Thirty-seventh Conference on Neural Information Processing Systems, 2023.   \n[24] Laurence Illing Midgley, Vincent Stimper, Javier Antoran, Emile Mathieu, Bernhard Sch\u00f6lkopf, and Jos\u00e9 Miguel Hern\u00e1ndez-Lobato. SE(3) equivariant augmented coupling flows. In Thirtyseventh Conference on Neural Information Processing Systems, 2023.   \n[25] Peter Wirnsberger, Andrew J Ballard, George Papamakarios, Stuart Abercrombie, S\u00e9bastien Racani\u00e8re, Alexander Pritzel, Danilo Jimenez Rezende, and Charles Blundell. Targeted free energy estimation via learned mappings. The Journal of Chemical Physics, 153(14):144112, 2020.   \n[26] Manuel Dibak, Leon Klein, Andreas Kr\u00e4mer, and Frank No\u00e9. Temperature steerable flows and Boltzmann generators. Phys. Rev. Res., 4:L042005, Oct 2022.   \n[27] Jonas K\u00f6hler, Andreas Kr\u00e4mer, and Frank No\u00e9. Smooth normalizing flows. In M. Ranzato, A. Beygelzimer, Y. Dauphin, P.S. Liang, and J. Wortman Vaughan, editors, Advances in Neural Information Processing Systems, volume 34, pages 2796\u20132809. Curran Associates, Inc., 2021.   \n[28] Laurence Illing Midgley, Vincent Stimper, Gregor N. C. Simm, Bernhard Sch\u00f6lkopf, and Jos\u00e9 Miguel Hern\u00e1ndez-Lobato. Flow annealed importance sampling bootstrap. In The Eleventh International Conference on Learning Representations, 2023.   \n[29] Xinqiang Ding and Bin Zhang. Deepbar: A fast and exact method for binding free energy computation. Journal of Physical Chemistry Letters, 12:2509\u20132515, 3 2021.   \n[30] Joseph C. Kim, David Bloore, Karan Kapoor, Jun Feng, Ming-Hong Hao, and Mengdi Wang. Scalable normalizing flows enable boltzmann generators for macromolecules. In International Conference on Learning Representations (ICLR), 2024.   \n[31] Rasool Ahmad and Wei Cai. Free energy calculation of crystalline solids using normalizing flows. Modelling and Simulation in Materials Science and Engineering, 30(6):065007, September 2022.   \n[32] Kim A Nicoli, Christopher J Anders, Lena Funcke, Tobias Hartung, Karl Jansen, Pan Kessel, Shinichi Nakajima, and Paolo Stornati. Estimation of thermodynamic observables in lattice field theories with deep generative models. Physical review letters, 126(3):032001, 2021.   \n[33] Maximilian Schebek, Michele Invernizzi, Frank No\u00e9, and Jutta Rogal. Efficient mapping of phase diagrams with conditional boltzmann generators. Machine Learning: Science and Technology, 2024.   \n[34] Hao Wu, Jonas K\u00f6hler, and Frank Noe. Stochastic normalizing flows. In H. Larochelle, M. Ranzato, R. Hadsell, M. F. Balcan, and H. Lin, editors, Advances in Neural Information Processing Systems, volume 33, pages 5933\u20135944. Curran Associates, Inc., 2020.   \n[35] Xinqiang Ding and Bin Zhang. Computing absolute free energy with deep generative models. Biophysical Journal, 120(3):195a, 2021.   \n[36] Andrea Rizzi, Paolo Carloni, and Michele Parrinello. Multimap targeted free energy estimation, 2023.   \n[37] Jonas K\u00f6hler, Leon Klein, and Frank No\u00e9. Equivariant flows: exact likelihood generative learning for symmetric densities. In International conference on machine learning, pages 5361\u20135370. PMLR, 2020.   \n[38] Danilo Jimenez Rezende, S\u00e9bastien Racani\u00e8re, Irina Higgins, and Peter Toth. Equivariant Hamiltonian flows. arXiv preprint arXiv:1909.13739, 2019.   \n[39] Victor Garcia Satorras, Emiel Hoogeboom, Fabian Fuchs, Ingmar Posner, and Max Welling. E(n) equivariant normalizing flows. In M. Ranzato, A. Beygelzimer, Y. Dauphin, P.S. Liang, and J. Wortman Vaughan, editors, Advances in Neural Information Processing Systems, volume 34, pages 4181\u20134192. Curran Associates, Inc., 2021.   \n[40] Jonas K\u00f6hler, Michele Invernizzi, Pim de Haan, and Frank No\u00e9. Rigid body flows for sampling molecular crystal structures. In International Conference on Machine Learning, ICML 2023, volume 202 of Proceedings of Machine Learning Research, pages 17301\u201317326. PMLR, 2023.   \n[41] Andrea Rizzi, Paolo Carloni, and Michele Parrinello. Targeted free energy perturbation revisited: Accurate free energies from mapped reference potentials. Journal of Physical Chemistry Letters, 12:9449\u20139454, 2021.   \n[42] Michele Invernizzi, Andreas Kr\u00e4mer, Cecilia Clementi, and Frank No\u00e9. Skipping the replica exchange ladder with normalizing flows. The Journal of Physical Chemistry Letters, 13:11643\u2013 11649, 2022.   \n[43] Osama Abdin and Philip M Kim. Pepflow: direct conformational sampling from peptide energy landscapes through hypernetwork-conditioned diffusion. bioRxiv, pages 2023\u201306, 2023.   \n[44] Bowen Jing, Bonnie Berger, and Tommi Jaakkola. Alphafold meets flow matching for generating protein ensembles. arXiv preprint arXiv:2402.04845, 2024.   \n[45] Shuxin Zheng, Jiyan He, Chang Liu, Yu Shi, Ziheng Lu, Weitao Feng, Fusong Ju, Jiaxi Wang, Jianwei Zhu, Yaosen Min, et al. Predicting equilibrium distributions for molecular systems with deep learning. Nature Machine Intelligence, pages 1\u201310, 2024.   \n[46] Juan Viguera Diez, Sara Romeo Atance, Ola Engkvist, and Simon Olsson. Generation of conformational ensembles of small molecules via surrogate model-assisted molecular dynamics. Machine Learning: Science and Technology, 5(2):025010, 2024.   \n[47] Mathias Schreiner, Ole Winther, and Simon Olsson. Implicit transfer operator learning: Multiple time-resolution models for molecular dynamics. In Thirty-seventh Conference on Neural Information Processing Systems, 2023.   \n[48] Nicholas E Charron, Felix Musil, Andrea Guljas, Yaoyi Chen, Klara Bonneau, Aldo S PasosTrejo, Jacopo Venturin, Daria Gusew, Iryna Zaporozhets, Andreas Kr\u00e4mer, et al. Navigating protein landscapes with a machine-learned transferable coarse-grained model. arXiv preprint arXiv:2310.18278, 2023.   \n[49] Jonas K\u00f6hler, Yaoyi Chen, Andreas Kr\u00e4mer, Cecilia Clementi, and Frank No\u00e9. Flow-matching: Efficient coarse-graining of molecular dynamics without forces. Journal of Chemical Theory and Computation, 19(3):942\u2013952, 2023.   \n[50] Yuxuan Song, Jingjing Gong, Minkai Xu, Ziyao Cao, Yanyan Lan, Stefano Ermon, Hao Zhou, and Wei-Ying Ma. Equivariant flow matching with hybrid probability transport for 3d molecule generation. In Thirty-seventh Conference on Neural Information Processing Systems, 2023.   \n[51] Yan Wang, Lihao Wang, Yuning Shen, Yiqun Wang, Huizhuo Yuan, Yue Wu, and Quanquan Gu. Protein conformation generation via force-guided se (3) diffusion models. arXiv preprint arXiv:2403.14088, 2024.   \n[52] Felix Draxler, Peter Sorrenson, Lea Zimmermann, Armand Rousselot, and Ullrich K\u00f6the. Free-form flows: Make any architecture a normalizing flow. In Sanjoy Dasgupta, Stephan Mandt, and Yingzhen Li, editors, Proceedings of The 27th International Conference on Artificial Intelligence and Statistics, volume 238 of Proceedings of Machine Learning Research, pages 2197\u20132205. PMLR, 02\u201304 May 2024.   \n[53] H Wiegand. Kish, l.: Survey sampling. john wiley & sons, inc., new york, london 1965, ix+ 643 s., 31 abb., 56 tab., preis 83 s., 1968.   \n[54] George Papamakarios, Eric T Nalisnick, Danilo Jimenez Rezende, Shakir Mohamed, and Balaji Lakshminarayanan. Normalizing flows for probabilistic modeling and inference. J. Mach. Learn. Res., 22(57):1\u201364, 2021.   \n[55] V\u0131ctor Garcia Satorras, Emiel Hoogeboom, and Max Welling. E (n) equivariant graph neural networks. In International conference on machine learning, pages 9323\u20139332. PMLR, 2021.   \n[56] Bowen Jing, Stephan Eismann, Patricia Suriana, Raphael John Lamarre Townshend, and Ron Dror. Learning from protein structure with geometric vector perceptrons. In International Conference on Learning Representations, 2021.   \n[57] Kristof Sch\u00fctt, Oliver Unke, and Michael Gastegger. Equivariant message passing for the prediction of tensorial properties and molecular spectra. In International Conference on Machine Learning, pages 9377\u20139388. PMLR, 2021.   \n[58] Yi-Lun Liao and Tess Smidt. Equiformer: Equivariant graph attention transformer for 3d atomistic graphs. In The Eleventh International Conference on Learning Representations, 2023.   \n[59] Johannes Gasteiger, Florian Becker, and Stephan G\u00fcnnemann. Gemnet: Universal directional graph neural networks for molecules. Advances in Neural Information Processing Systems, 34:6790\u20136802, 2021.   \n[60] Jonas K\u00f6hler, Leon Klein, and Frank No\u00e9. Equivariant flows: exact likelihood generative learning for symmetric densities. In International Conference on Machine Learning, pages 5361\u20135370. PMLR, 2020.   \n[61] Christoph Bannwarth, Sebastian Ehlert, and Stefan Grimme. Gfn2-xtb\u2014an accurate and broadly parametrized self-consistent tight-binding quantum chemical method with multipole electrostatics and density-dependent dispersion contributions. Journal of Chemical Theory and Computation, 15(3):1652\u20131671, 2019. PMID: 30741547.   \n[62] Guillermo P\u00e9rez-Hern\u00e1ndez, Fabian Paul, Toni Giorgino, Gianni De Fabritiis, and Frank No\u00e9. Identification of slow molecular order parameters for Markov model construction. The Journal of chemical physics, 139(1):07B604_1, 2013.   \n[63] Bowen Jing, Ezra Erives, Peter Pao-Huang, Gabriele Corso, Bonnie Berger, and Tommi Jaakkola. Eigenfold: Generative protein structure prediction with diffusion models. arXiv preprint arXiv:2304.02198, 2023.   \n[64] Hannes St\u00e4rk, Bowen Jing, Regina Barzilay, and Tommi Jaakkola. Harmonic selfconditioned flow matching for multi-ligand docking and binding site design. arXiv preprint arXiv:2310.05764, 2023.   \n[65] Dina A Sharon, Yining Huang, Motolani Oyewole, and Sammy Mustafa. How to go with the flow: an analysis of flow matching molecular docking performance with priors of varying information content. In ICLR 2024 Workshop on Generative and Experimental Perspectives for Biomolecular Design, 2024.   \n[66] Weitao Du, Yuanqi Du, Limei Wang, Dieqiao Feng, Guifeng Wang, Shuiwang Ji, Carla Gomes, and Zhi-Ming Ma. A new perspective on building efficient and expressive 3d equivariant graph neural networks. arXiv preprint arXiv:2304.04757, 2023.   \n[67] Han Yang, Chenxi Hu, Yichi Zhou, Xixian Liu, Yu Shi, Jielan Li, Guanzhi Li, Zekun Chen, Shuizhou Chen, Claudio Zeni, et al. Mattersim: A deep learning atomistic model across elements, temperatures and pressures. arXiv preprint arXiv:2405.04967, 2024.   \n[68] Adam Paszke, Sam Gross, Francisco Massa, Adam Lerer, James Bradbury, Gregory Chanan, Trevor Killeen, Zeming Lin, Natalia Gimelshein, Luca Antiga, Alban Desmaison, Andreas Kopf, Edward Yang, Zachary DeVito, Martin Raison, Alykhan Tejani, Sasank Chilamkurthy, Benoit Steiner, Lu Fang, Junjie Bai, and Soumith Chintala. Pytorch: An imperative style, high-performance deep learning library. In Advances in Neural Information Processing Systems 32, pages 8024\u20138035. Curran Associates, Inc., 2019.   \n[69] Michael Poli, Stefano Massaroli, Atsushi Yamashita, Hajime Asama, Jinkyoo Park, and Stefano Ermon. Torchdyn: Implicit models and neural numerical methods in pytorch. In Neural Information Processing Systems, Workshop on Physical Reasoning and Inductive Biases for the Real World, volume 2, 2021.   \n[70] Aric Hagberg, Pieter Swart, and Daniel S Chult. Exploring network structure, dynamics, and function using networkx. Technical report, Los Alamos National Lab.(LANL), Los Alamos, NM (United States), 2008.   \n[71] Diederik P Kingma and Jimmy Ba. Adam: A method for stochastic optimization. arXiv preprint arXiv:1412.6980, 2014. ", "page_idx": 11}, {"type": "text", "text": "", "page_idx": 12}, {"type": "text", "text": "", "page_idx": 13}, {"type": "text", "text": "", "page_idx": 14}, {"type": "text", "text": "", "page_idx": 15}, {"type": "text", "text": "Table 3: Dimensionless free energy differences for the slowest transition of alanine dipeptide estimated with various methods. Umbrella sampling yields a converged reference solution. Errors are calculated over five runs. Values for $\\mathrm{BG}+$ backbone and Umbrella sampling are taken from [23]. ", "page_idx": 16}, {"type": "image", "img_path": "AYq6GxxrrY/tmp/d03f102fad5349a5e1f88c96eff49cd186a88e67491e7d4bfc7c59100f5c0cb6.jpg", "img_caption": [], "img_footnote": [], "page_idx": 16}, {"type": "text", "text": "Figure 6: Example Ramachandran plots for different trajectory lengths for the training data. It can be observed that as the trajectory length decreases, the number of metastable states that are missed increases, thereby making the learning task more challenging. (a) AY dipeptide (b) IH dipeptide. ", "page_idx": 16}, {"type": "text", "text": "Appendix ", "text_level": 1, "page_idx": 16}, {"type": "text", "text": "A Additional results and experiments ", "text_level": 1, "page_idx": 16}, {"type": "text", "text": "A.1 Semi-empirical force field for alanine dipeptide ", "text_level": 1, "page_idx": 16}, {"type": "text", "text": "We report the free energy differences for the slowest transitions of alanine dipeptide for a semiempirical force field in Table 3. See Section 5 for more details. ", "page_idx": 16}, {"type": "text", "text": "A.2 Dipeptide training data ", "text_level": 1, "page_idx": 16}, {"type": "text", "text": "When training on smaller training sets, i.e. with shorter trajectories, additional metastable states will not be visited during the short simulation times. We show this for two example training peptides in Figure 6. Nevertheless, the $\\mathrm{TBG+}$ full (smaller) model trained on 10 times shorter trajectories, is nearly as good as the model trained on the full trajectories, see Section 5. However, for the 100 times smaller trajectories, the TBG $^+$ full model performs significantly worse, see Appendix A.3. ", "page_idx": 16}, {"type": "text", "text": "A.3 Smaller dataset ", "text_level": 1, "page_idx": 16}, {"type": "text", "text": "We investigate the effect of 100 times smaller trainings trajectories, i.e. simulation time of only 500ps. As shown in Appendix A.2, these trajectories miss many metastable states. This can be also observed for the so trained models, which we refer as $\\mathrm{TBG}+$ full (smaller500), as they do not capture especially unlikely metastable states well as presented in Figure 7 and Figure 8. In contrast, models trained on larger trajectories find all metastable states and allow for efficient reweighting, as discussed in Section 5 and Appendix A.5. ", "page_idx": 16}, {"type": "text", "text": "A.4 Sampled dipeptide configurations ", "text_level": 1, "page_idx": 16}, {"type": "text", "text": "For some amino acid combinations, both the TBG and $\\mathrm{TBG}+$ backbone models sample only a small number of correct configurations. Although the generated configurations are potentially valid molecular configurations, they are not the one of the target dipeptide as shown in Figure 9. This is often due to the encoding, which e.g. cannot distinguish between different orderings of amino acids in a peptide. Only the various $\\mathrm{TBG}+$ full architectures samples nearly exclusively correct configurations. ", "page_idx": 16}, {"type": "text", "text": "A.5 Additional results for dipeptides ", "text_level": 1, "page_idx": 16}, {"type": "text", "text": "Inference is a costly process, and extensive sampling is necessary to obtain reliable estimates for the expected sample size (ESS). Therefore, we only evaluate the transferable models on a subset of the ", "page_idx": 16}, {"type": "image", "img_path": "AYq6GxxrrY/tmp/832fda434faa352d98300d54b4c75cb72dabce230913daf0b569d0409e1061c1.jpg", "img_caption": [], "img_footnote": [], "page_idx": 17}, {"type": "text", "text": "Figure 7: Results for the KS dipeptide for $\\mathrm{TBG}+$ full model trained on 100 times smaller training trajectories. As can be seen in Figure 2, the results for the TBG $^+$ full model trained on the whole trajectories are much better. (a) KS dipeptide (b) Ramachandran plot for the weighted MD distribution (left) and for samples generate with the model (right). (c) TICA plot for the weighted MD distribution (left) and for samples generate with the model (right). (d) Energies of samples generated with the model. (e) Free energy projection along the $\\varphi$ angle. (f) Free energy projection along the slowest transition (TIC0). ", "page_idx": 17}, {"type": "image", "img_path": "AYq6GxxrrY/tmp/f2e22363b43aeac002d982b984abec2287c3909621eca4bdc31946578dce0e1a.jpg", "img_caption": [], "img_footnote": [], "page_idx": 17}, {"type": "text", "text": "Figure 8: Results for the GN dipeptide for $\\mathrm{TBG+}$ full model trained on 100 times smaller training trajectories. As can be seen in Figure 3, the results for the TBG $^+$ full model trained on the whole trajectories are much better. (a) GN dipeptide (b) Ramachandran plot for the weighted MD distribution (left) and for samples generate with the model (right). (c) TICA plot for the weighted MD distribution (left) and for samples generate with the model (right). (d) Energies of samples generated with the model. (e) Free energy projection along the $\\varphi$ angle. (f) Free energy projection along the slowest transition (TIC0). ", "page_idx": 17}, {"type": "text", "text": "test set. The dipeptides are randomly selected, but it is ensured that all amino acids are represented at least once. However, we evaluate the best-performing model, namely $\\mathrm{TBG}+$ full, for all 100 test peptides. The results for the additional test peptides are in good agreement with the first ones as presented in Table 4 and Figure 10. ", "page_idx": 17}, {"type": "text", "text": "We report individual results for the different architectures in Figure 10c,d. ", "page_idx": 17}, {"type": "text", "text": "To illustrate the performance of the TBG $^+$ full model, we present additional examples of dipeptides from the test set in Figure 11a-f and Figure 12a-f. Furthermore, we also again show results for training on the biased dataset in the same figures (Figure 11g,h,i and Figure 12g,h,i). As observed previously, the TBG $^+$ full (biased) model recovers the free energy landscape better than the $\\mathrm{TBG+}$ ", "page_idx": 17}, {"type": "image", "img_path": "AYq6GxxrrY/tmp/22e8a81dbd2924e1f3503d1995d2700645f3d39e9c5de62e4f9dc801f5faa3fe.jpg", "img_caption": [], "img_footnote": [], "page_idx": 18}, {"type": "text", "text": "Figure 9: Sampled molecules with the TBG and $\\mathrm{TBG+}$ backbone models, which do not have the correct topology. (a) NY dipeptide reference (b) Generated molecule with NY atoms by the TBG model. (c) IM dipeptide reference (d) Generated molecule with IM atoms by the TBG model. (e) TD dipeptide reference (f) Generated molecule with TD atoms by the TBG $^+$ backbone model. ", "page_idx": 18}, {"type": "image", "img_path": "AYq6GxxrrY/tmp/352ad326d54e7155056f19e60c1fdcb588f2df98de6f2453a3915eb43a42ca28.jpg", "img_caption": [], "img_footnote": [], "page_idx": 18}, {"type": "text", "text": "Figure 10: (a) Effective samples sizes for all 100 test dipeptides for the $\\mathrm{TBG}+$ full model. (b) Percentage of correct configurations for all 100 test dipeptides sampled with the $\\mathrm{TBG+}$ full model. (c,d) Performance comparison for different transferable architectures and training sets on 8 dipeptides from the test set (c) Correct configuration rate (d) Likelihood per particle. ", "page_idx": 18}, {"type": "text", "text": "full model, especially for the $\\varphi$ projections. We present additional examples of dipeptides from the test set for the $\\mathrm{TBG+}$ full model in Figure 13, Figure 14, Figure 15, Figure 16, and Figure 17. ", "page_idx": 18}, {"type": "text", "text": "Furthermore, we present results for two example peptides from the test set for the $\\mathrm{TBG+}$ full (smaller) model, which is trained on trajectories that are tenfold smaller than those used for the $\\mathrm{TBG+}$ full model. These results are shown in Figure 18 and Figure 19. ", "page_idx": 18}, {"type": "text", "text": "A.6 Transferable Boltzmann Generators as Boltzmann Emulators ", "text_level": 1, "page_idx": 18}, {"type": "text", "text": "Given the high cost of sampling with CNFs, which necessitates integrating the Jacobian trace along the positions, we did not evaluate all available test peptides for all models (see Appendix B.2). However, since sampling without the Jacobian trace is less expensive and we do not require as many samples as for estimating the ESS, we also employ the TBG $^+$ full (smaller) model as a Boltzmann Emulator to ascertain whether we have identified all metastable states, despite the fact that it was only trained on the 10 times smaller training set. The Boltzmann Emulator is evaluated on a diverse set of test peptides, and nearly always finds all metastable states within less than one hour of wall clock time. This is a notable improvement over MD simulations, which often take longer to explore due to the iterative nature of MD. Some examples are shown in Figure 20. This experiment shares similarities with the exploration mode of [11], where they employ their model without the acceptance step and therefore also explore a potentially biased distribution rather than the unbiased Boltzmann distribution. ", "page_idx": 18}, {"type": "table", "img_path": "AYq6GxxrrY/tmp/6e641a7be570f0b0222d9e3cabbbc6c1019f8cb282b4aac32dd72d1154a66754.jpg", "table_caption": ["Table 4: Effective samples size and correct configuration rate for unseen dipeptides for the TBG $^+$ full architecture for different numbers of test peptides. "], "table_footnote": [], "page_idx": 18}, {"type": "image", "img_path": "AYq6GxxrrY/tmp/ae7966b3401549bd9503ae06bdfdd0b527a93aaa28a6223dc73dd645bddefb6a.jpg", "img_caption": ["Figure 11: Results for the IM dipeptide (a) Sample generated with the TBG $^+$ full model (b) Ramachandran plot for the weighted MD distribution (left) and for samples generate with the $\\mathrm{TBG+}$ full model (right). (c) TICA plot for the weighted MD distribution (left) and for samples generate with the TBG $^+$ full model (right). (d) Energies of samples generated with the TBG $^+$ full model. (e) Free energy projection along the $\\varphi$ angle. (f) Free energy projection along the slowest transition (TIC0). (g) Energies of samples generated with the TBG $^+$ full (biased) model. (h) Free energy projection along the $\\varphi$ angle for the TBG $^+$ full (biased) model. (i) Free energy projection along the slowest transition (TIC0) for the TBG $^+$ full (biased) model. "], "img_footnote": [], "page_idx": 19}, {"type": "text", "text": "", "page_idx": 19}, {"type": "text", "text": "A.7 Comparison with the Timewarp model [11] ", "text_level": 1, "page_idx": 19}, {"type": "text", "text": "Here, we provide additional results comparing our $\\mathrm{TBG}+$ full model to the Timewarp model [11], as discussed in Section 5.3. In this second scenario, the objective is to explore all meta-stable states as given in the Ramachandran plot, aligning with the goals of a Boltzmann Emulator, where only approximate sampling from the Boltzmann distribution is required. For the TBG $^+$ full model, we do not apply reweighting, whereas in the Timewarp model, samples are rejected only if consecutive samples show an significant energy increase to prevent divergence [11]. ", "page_idx": 19}, {"type": "text", "text": "Although reweighting is not strictly needed, we evaluate the energy of all samples generated by the $\\mathrm{TBG+}$ full model, flitering out any rare, high-energy samples. We then compare both models based on the mean number of energy evaluations and the mean wall-clock time needed to explorae all states. As shown in Figure 21, the Timewarp model generally finds all states more quickly but requires more energy evaluations. Additionally, as illustrated in Figure 22, the Timewarp model\u2019s generated samples tend to exhibit higher energies compared to those from the $\\mathrm{TBG}+$ full model. Consequently, the distribution produced by the TBG $^+$ full model more accurately approximates the target Boltzmann distribution. ", "page_idx": 19}, {"type": "text", "text": "For all Timewarp experiments, we used a proposal batch size of 100, as recommended in [11] for A-100 GPUs. ", "page_idx": 19}, {"type": "image", "img_path": "AYq6GxxrrY/tmp/3a809bca086d5044023c7c039bb9e1f93c9cfb119a2b7d6720ce1088ee219bd0.jpg", "img_caption": [], "img_footnote": [], "page_idx": 20}, {"type": "text", "text": "Figure 12: Results for the NY dipeptide (a) Sample generated with the TBG $^+$ full model (b) Ramachandran plot for the weighted MD distribution (left) and for samples generate with the $\\mathrm{TBG+}$ full model (right). (c) TICA plot for the weighted MD distribution (left) and for samples generate with the $\\mathrm{TBG+}$ full model (right). (d) Energies of samples generated with the TBG $^+$ full model. (e) Free energy projection along the $\\varphi$ angle. (f) Free energy projection along the slowest transition (TIC0). (g) Energies of samples generated with the TBG $^+$ full (biased) model. (h) Free energy projection along the $\\varphi$ angle for the TBG $^+$ full (biased) model. (i) Free energy projection along the slowest transition (TIC0) for the TBG $^+$ full (biased) model. ", "page_idx": 20}, {"type": "text", "text": "B Technical details ", "text_level": 1, "page_idx": 20}, {"type": "text", "text": "B.1 Code libraries ", "text_level": 1, "page_idx": 20}, {"type": "text", "text": "We primarily use the following code libraries: PyTorch (BSD-3) [68], bgflow (MIT license) [8, 37], torchdyn (Apache License 2.0) [69], and NetworkX (BSD-3) [70] for validating graph isomorphisms. Additionally, we use the code from [39] (MIT license) for EGNNs, as well as the code from [11] (MIT license) and [23] (MIT license) for datasets and related evaluation methods. ", "page_idx": 20}, {"type": "text", "text": "Our code is available here: https://osf.io/n8vz3/?view_only $=$ 1052300a21bd43c08f700016728aa96e. ", "page_idx": 20}, {"type": "text", "text": "B.2 Benchmark systems ", "text_level": 1, "page_idx": 20}, {"type": "text", "text": "The investigated benchmark systems were created in prior studies [23, 11]. ", "page_idx": 20}, {"type": "text", "text": "Alanine dipeptide The alanine dipeptide datasets were created in [23] (CC BY 4.0), we refer to them for detailed simulation details. The classical trajectory was created at $T\\,=\\,300\\mathrm{K}$ with the classical Amber ff99SBildn force-field. The subsequent relaxation was performed with the semi-empirical GFN2-xTB force-field [61]. ", "page_idx": 20}, {"type": "text", "text": "Dipeptides (2AA dataset) The original dipeptide dataset as introduced in [11] (MIT License) is available here: https://huggingface.co/datasets/microsoft/timewarp. As this includes a lot of intermediate saved states and quantities, like energies, we create a smaller version with is available here: https://osf.io/n8vz3/?view_only $=$ 1052300a21bd43c08f700016728aa96e. For a comprehensive overview of the simulation details, refer to [11]. All dipeptides were simulated ", "page_idx": 20}, {"type": "image", "img_path": "AYq6GxxrrY/tmp/addeab07abf4b8df3836b09869b00d939d4864687de283624044728887124029.jpg", "img_caption": [], "img_footnote": [], "page_idx": 21}, {"type": "text", "text": "Figure 13: Results for the ET dipeptide (a) Sample generated with the TBG $^+$ full model (b) Ramachandran plot for the weighted MD distribution (left) and for samples generate with the $\\mathrm{TBG+}$ full model (right). (c) TICA plot for the weighted MD distribution (left) and for samples generate with the $\\mathrm{TBG}+$ full model (right). (d) Energies of generated samples (e) Free energy projection along the $\\varphi$ angle. (f) Free energy projection along the slowest transition (TIC0). ", "page_idx": 21}, {"type": "image", "img_path": "AYq6GxxrrY/tmp/c9da0f434c2e833eb75d1da3746b201bebf8ce48d1d6d22502df3312edcd7df5.jpg", "img_caption": [], "img_footnote": [], "page_idx": 21}, {"type": "text", "text": "Figure 14: Results for the RV dipeptide (a) Sample generated with the TBG $^+$ full model (b) Ramachandran plot for the weighted MD distribution (left) and for samples generate with the $\\mathrm{TBG+}$ full model (right). (c) TICA plot for the weighted MD distribution (left) and for samples generate with the $\\mathrm{TBG}+$ full model (right). (d) Energies of generated samples (e) Free energy projection along the $\\varphi$ angle. (f) Free energy projection along the slowest transition (TIC0). ", "page_idx": 21}, {"type": "text", "text": "with a classical amber- $^{l4}$ force-field at $T=310\\mathrm{K}$ . The simulation of the training peptides were run for 50ns, while the test set peptides were run for $1\\mu s$ . ", "page_idx": 21}, {"type": "text", "text": "Choice of test set peptides Inference is a costly process with CNFs (see Appendix B.7), and extensive sampling is necessary to obtain reliable estimates for the relative effective sample size (ESS). Therefore, we evaluate most of the transferable models on a subset of the test set. The dipeptides are randomly selected, but it is ensured that all amino acids are represented at least once. Only the best performing model $(\\mathrm{TBG}+\\mathrm{full})$ is evaluated on the whole test set of 100 dipeptides. ", "page_idx": 21}, {"type": "text", "text": "B.3 Hyperparameters ", "text_level": 1, "page_idx": 21}, {"type": "text", "text": "We report the model hyperparameters for the different model architectures as describes in Section 4.1 in Table 5. As in [23] all neural networks $\\phi_{\\alpha}$ have one hidden layer with $n_{\\mathrm{hidden}}$ neurons and $S i L U$ activation functions. The input size of the embedding $n$ embedding depends on the model architecture. ", "page_idx": 21}, {"type": "image", "img_path": "AYq6GxxrrY/tmp/a049565b8abde454290be66d5147f6a0e344cdc38e192c0ed50c53ab570d78fa.jpg", "img_caption": [], "img_footnote": [], "page_idx": 22}, {"type": "text", "text": "Figure 15: Results for the AC dipeptide (a) Sample generated with the TBG $^+$ full model (b) Ramachandran plot for the weighted MD distribution (left) and for samples generate with the $\\mathrm{TBG+}$ full model (right). (c) TICA plot for the weighted MD distribution (left) and for samples generate with the $\\mathrm{TBG}+$ full model (right). (d) Energies of generated samples (e) Free energy projection along the $\\varphi$ angle. (f) Free energy projection along the slowest transition (TIC0). ", "page_idx": 22}, {"type": "image", "img_path": "AYq6GxxrrY/tmp/4c0458d234b51b89fbd757e3d164fc988f8a3d205c2e711c3b37470772cc9090.jpg", "img_caption": [], "img_footnote": [], "page_idx": 22}, {"type": "text", "text": "Figure 16: Results for the NF dipeptide (a) Sample generated with the TBG $^+$ full model (b) Ramachandran plot for the weighted MD distribution (left) and for samples generate with the $\\mathrm{TBG+}$ full model (right). (c) TICA plot for the weighted MD distribution (left) and for samples generate with the $\\mathrm{TBG}+$ full model (right). (d) Energies of generated samples (e) Free energy projection along the $\\varphi$ angle. (f) Free energy projection along the slowest transition (TIC0). ", "page_idx": 22}, {"type": "text", "text": "We report training hyperparameters for the different model architectures in Table 6. It should be noted that all TBG models are trained in an identical manner if the training set is identical. We use the ADAM optimizer for all experiments [71]. For the dipeptide training, each batch consists of three samples for each peptide. ", "page_idx": 22}, {"type": "text", "text": "B.4 Biasing target samples ", "text_level": 1, "page_idx": 22}, {"type": "text", "text": "As introduced in [23], it can be beneficial to bias the training data in such a way that unlikely states are more prominent. For alalnine dipeptide and many dipeptides, the positive $\\varphi$ states at $\\varphi=1$ are often the unlikely ones and transition between the positive and negative $\\varphi$ states are slow. For the alanine dipeptide dataset, the biasing methodology proposed in [23] is employed. Similarly, we bias the dipeptides based on the von Mises distribution $f_{\\mathrm{vM}}$ . The weights $\\omega$ are computed along the $\\varphi$ dihedral angle as ", "page_idx": 22}, {"type": "equation", "text": "$$\n\\omega(\\varphi)=r\\cdot f_{\\mathrm{vM}}\\left(\\varphi|\\mu=1,\\kappa=10\\right)+1,\n$$", "text_format": "latex", "page_idx": 22}, {"type": "image", "img_path": "AYq6GxxrrY/tmp/09bfeed21c03e458cbd625404506c5ca09410a02c13eecb0acb6c221ad3e8358.jpg", "img_caption": [], "img_footnote": [], "page_idx": 23}, {"type": "text", "text": "Figure 17: Results for the GP dipeptide (a) Sample generated with the $\\mathrm{TBG}+{}$ full model (b) Ramachandran plot for the weighted MD distribution (left) and for samples generate with the $\\mathrm{TBG+}$ full model (right). (c) TICA plot for the weighted MD distribution (left) and for samples generate with the TBG $^+$ full model (right). (d) Energies of generated samples (e) Free energy projection along the $\\varphi$ angle. (f) Free energy projection along the slowest transition (TIC0). ", "page_idx": 23}, {"type": "image", "img_path": "AYq6GxxrrY/tmp/64483626b41dec58596ce7e1acfea4e4d6ac29ba1990c5d0d7871c12a2962e20.jpg", "img_caption": [], "img_footnote": [], "page_idx": 23}, {"type": "text", "text": "Figure 18: Results for the LW dipeptide for the $\\mathrm{TBG}+$ full (smaller) model, which is trained on tenfold smaller trajectories than the TBG $^+$ full model. (a) Sample generated with the $\\mathrm{TBG+}$ full (smaller) model (b) Ramachandran plot for the weighted MD distribution (left) and for samples generate with the TBG $^+$ full (smaller) model (right). (c) TICA plot for the weighted MD distribution (left) and for samples generate with the $\\mathrm{TBG+}$ full (smaller) model (right). (d) Energies of generated samples. (e) Free energy projection along the $\\varphi$ angle. (f) Free energy projection along the slowest transition (TIC0). ", "page_idx": 23}, {"type": "text", "text": "where $r$ is computed based on the ratio of positive and negative $\\varphi$ states, such that both have nearly the same weight after the biasing. ", "page_idx": 23}, {"type": "text", "text": "B.5 Encoding of atom types ", "text_level": 1, "page_idx": 23}, {"type": "text", "text": "The atom type embedding $a_{i}$ is a one-hot vector of 54 classes. The classes are mostly defined by the atom type in the peptide topology. Therefore, only a few atoms are indistinguishable, such as hydrogen atoms that are bound to the same carbon or nitrogen atom. Moreover, we also treat oxygen atoms bound to the same carbon atom as indistinguishable, unless they are in the carboxyl group. Notably, we never treat particle groups as indistinguishable, such as two CH3 groups bound to the same carbon atom. ", "page_idx": 23}, {"type": "image", "img_path": "AYq6GxxrrY/tmp/6531a60b88fd93d1cbe29cb11720817c33a44e2831c8ecde1e02ca3754604705.jpg", "img_caption": [], "img_footnote": [], "page_idx": 24}, {"type": "text", "text": "Figure 19: Results for the TD dipeptide for the $\\mathrm{TBG}+$ full (smaller) model, which is trained on tenfold smaller trajectories than the TBG $^+$ full model. (a) Sample generated with the $\\mathrm{TBG+}$ full (smaller) model (b) Ramachandran plot for the weighted MD distribution (left) and for samples generate with the TBG $^+$ full (smaller) model (right). (c) TICA plot for the weighted MD distribution (left) and for samples generate with the $\\mathrm{TBG+}$ full (smaller) model (right). (d) Energies of generated samples (e) Free energy projection along the $\\varphi$ angle. (f) Free energy projection along the slowest transition (TIC0). ", "page_idx": 24}, {"type": "table", "img_path": "AYq6GxxrrY/tmp/7c38e85cf845f917f210c68595a92ccfddba173a84408bb0ced0d8c7348f7f6d.jpg", "table_caption": ["Table 5: Model hyperparameters "], "table_footnote": [], "page_idx": 24}, {"type": "text", "text": "B.6 Effective samples sizes ", "text_level": 1, "page_idx": 24}, {"type": "text", "text": "The relative effective sample sizes (ESS) are computed with Kish\u2019s equation [53] as in prior work. For the alanine dipeptide experiments we use $2\\times10^{\\bar{5}}$ samples for the forward ESS and $1\\times10^{4}$ for the negative log likelihood computation. A total of $3\\times10^{4}$ samples were used for each dipeptide in the forward ESS, while $4.5\\times10^{3}$ samples were employed for the negative log likelihood computation. ", "page_idx": 24}, {"type": "table", "img_path": "AYq6GxxrrY/tmp/163bdb221f26d7ec878dd9033b401e7e5f10c28acb01e8dfb950d024b117763d.jpg", "table_caption": ["Table 6: Training hyperparameters "], "table_footnote": [], "page_idx": 24}, {"type": "image", "img_path": "AYq6GxxrrY/tmp/2f5794911333d81bf4a3fa5dd4e6239ab12e4e35e2de61406eb42b5e00fa4fa5.jpg", "img_caption": [], "img_footnote": [], "page_idx": 25}, {"type": "text", "text": "Figure 20: Comparison of classical MD runs for 1 hour $\\mathrm{(MD-1h)}$ and the sampling with the $\\mathrm{TBG+}$ full (smaller) model without weight computation for 1 hour (TBG $^+$ full (smaller) - 1h). The TICA plots of different peptides from the test set are shown. It is important to note that the TICA projection is always computed with respect to the long MD trajectory (MD). All peptides stem from the test set. (a) CS dipeptide (b) EK dipeptide (c) KI dipeptide (d) LW dipeptide (e) RL dipeptide (f) TF dipeptide. ", "page_idx": 25}, {"type": "table", "img_path": "AYq6GxxrrY/tmp/c35b70408ca67d84a8538b66d6674129ef2c1fb547a5890d85208c8b6a7b3c5d.jpg", "table_caption": [], "table_footnote": [], "page_idx": 25}, {"type": "text", "text": "Figure 21: Boltzmann Emulator / Timewarp exploration experiments. Errors over 5 runs. Lower is better. (a) Number of energy evaluations until all states are found. (b) Wall-clock-time until all states are found. (c) Energy difference between the mean MD energy and the mean sample energy generated by the two methods. ", "page_idx": 25}, {"type": "text", "text": "B.7 Computing resources ", "text_level": 1, "page_idx": 25}, {"type": "text", "text": "All training and inference was performed on single NVIDIA A100 GPUs with 80GB of RAM. ", "page_idx": 25}, {"type": "text", "text": "The training time for the models is reported in Appendix B.3, although it should be noted that a significant amount of time was required for hyperparameter tuning. It is estimated that at least ten times the compute time reported in Appendix B.3 was necessary to identify suitable hyperparameters. Furthermore, inference with CNFs is expensive, especially if one requires the reweighting weights. Generating $3\\times10^{4}$ samples with the large transferable models for the dipeptides requires approximately four days, whereas generating $2\\times\\Bar{1}0^{5}$ samples for the alanine dipeptide experiments takes less than one day. However, generating samples without corresponding weights significantly accelerates the sampling process. In the case of the dipeptides, the generation of $2\\times10^{5}$ samples can be completed in less than one day. However, it should be noted that sampling can be done fully in parallel, as Boltzmann Generators generate independent samples. ", "page_idx": 25}, {"type": "image", "img_path": "AYq6GxxrrY/tmp/9f52b720c1f54d02f4517feabfcfb9e8429339be125aa8d9c59d04ab9ec81741.jpg", "img_caption": [], "img_footnote": [], "page_idx": 26}, {"type": "image", "img_path": "AYq6GxxrrY/tmp/f9f3f99f4fb23b12cc69dfc4983049e98268a62483363ae4ec2c1917d19254c7.jpg", "img_caption": [], "img_footnote": [], "page_idx": 26}, {"type": "text", "text": "Figure 22: Comparison of energies of generated samples with a long MD simulation, Timewarp exploration, and $\\mathrm{TBG+}$ full without reweighting. The energy distribution of the $\\mathrm{TBG}+$ full model matches the Boltzmann distribution generated with MD better. (a) For the dipeptide KS. (b) For the dipeptide AT. ", "page_idx": 26}, {"type": "text", "text": "NeurIPS Paper Checklist ", "text_level": 1, "page_idx": 27}, {"type": "text", "text": "1. Claims ", "text_level": 1, "page_idx": 27}, {"type": "text", "text": "Question: Do the main claims made in the abstract and introduction accurately reflect the paper\u2019s contributions and scope? ", "page_idx": 27}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 27}, {"type": "text", "text": "Justification: The claims made in the abstract and introduction are all based on the results of our work, as shown in Section 5 and Appendix A . ", "page_idx": 27}, {"type": "text", "text": "Guidelines: ", "page_idx": 27}, {"type": "text", "text": "\u2022 The answer NA means that the abstract and introduction do not include the claims made in the paper.   \n\u2022 The abstract and/or introduction should clearly state the claims made, including the contributions made in the paper and important assumptions and limitations. A No or NA answer to this question will not be perceived well by the reviewers.   \n\u2022 The claims made should match theoretical and experimental results, and reflect how much the results can be expected to generalize to other settings.   \n\u2022 It is fine to include aspirational goals as motivation as long as it is clear that these goals are not attained by the paper. ", "page_idx": 27}, {"type": "text", "text": "2. Limitations ", "text_level": 1, "page_idx": 27}, {"type": "text", "text": "Question: Does the paper discuss the limitations of the work performed by the authors? ", "page_idx": 27}, {"type": "text", "text": "Answer: [Yes] ", "text_level": 1, "page_idx": 27}, {"type": "text", "text": "Justification: We discuss the limitations in Section 7. ", "page_idx": 27}, {"type": "text", "text": "Guidelines: ", "page_idx": 27}, {"type": "text", "text": "\u2022 The answer NA means that the paper has no limitation while the answer No means that the paper has limitations, but those are not discussed in the paper.   \n\u2022 The authors are encouraged to create a separate \"Limitations\" section in their paper.   \n\u2022 The paper should point out any strong assumptions and how robust the results are to violations of these assumptions (e.g., independence assumptions, noiseless settings, model well-specification, asymptotic approximations only holding locally). The authors should reflect on how these assumptions might be violated in practice and what the implications would be.   \n\u2022 The authors should reflect on the scope of the claims made, e.g., if the approach was only tested on a few datasets or with a few runs. In general, empirical results often depend on implicit assumptions, which should be articulated.   \n\u2022 The authors should reflect on the factors that influence the performance of the approach. For example, a facial recognition algorithm may perform poorly when image resolution is low or images are taken in low lighting. Or a speech-to-text system might not be used reliably to provide closed captions for online lectures because it fails to handle technical jargon.   \n\u2022 The authors should discuss the computational efficiency of the proposed algorithms and how they scale with dataset size.   \n\u2022 If applicable, the authors should discuss possible limitations of their approach to address problems of privacy and fairness.   \n\u2022 While the authors might fear that complete honesty about limitations might be used by reviewers as grounds for rejection, a worse outcome might be that reviewers discover limitations that aren\u2019t acknowledged in the paper. The authors should use their best judgment and recognize that individual actions in favor of transparency play an important role in developing norms that preserve the integrity of the community. Reviewers will be specifically instructed to not penalize honesty concerning limitations. ", "page_idx": 27}, {"type": "text", "text": "3. Theory Assumptions and Proofs ", "text_level": 1, "page_idx": 27}, {"type": "text", "text": "Question: For each theoretical result, does the paper provide the full set of assumptions and a complete (and correct) proof? ", "page_idx": 27}, {"type": "text", "text": "Answer: [NA] ", "page_idx": 27}, {"type": "text", "text": "Justification: We only utilize theorems of prior work, which we reference accordingly. Guidelines: ", "page_idx": 28}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not include theoretical results.   \n\u2022 All the theorems, formulas, and proofs in the paper should be numbered and crossreferenced.   \n\u2022 All assumptions should be clearly stated or referenced in the statement of any theorems.   \n\u2022 The proofs can either appear in the main paper or the supplemental material, but if they appear in the supplemental material, the authors are encouraged to provide a short proof sketch to provide intuition.   \n\u2022 Inversely, any informal proof provided in the core of the paper should be complemented by formal proofs provided in appendix or supplemental material.   \n\u2022 Theorems and Lemmas that the proof relies upon should be properly referenced. ", "page_idx": 28}, {"type": "text", "text": "4. Experimental Result Reproducibility ", "text_level": 1, "page_idx": 28}, {"type": "text", "text": "Question: Does the paper fully disclose all the information needed to reproduce the main experimental results of the paper to the extent that it affects the main claims and/or conclusions of the paper (regardless of whether the code and data are provided or not)? ", "page_idx": 28}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 28}, {"type": "text", "text": "Justification: We explain how we performed our experiments in Section 5 and Appendix B. Guidelines: ", "page_idx": 28}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not include experiments.   \n\u2022 If the paper includes experiments, a No answer to this question will not be perceived well by the reviewers: Making the paper reproducible is important, regardless of whether the code and data are provided or not.   \n\u2022 If the contribution is a dataset and/or model, the authors should describe the steps taken to make their results reproducible or verifiable.   \n\u2022 Depending on the contribution, reproducibility can be accomplished in various ways. For example, if the contribution is a novel architecture, describing the architecture fully might suffice, or if the contribution is a specific model and empirical evaluation, it may be necessary to either make it possible for others to replicate the model with the same dataset, or provide access to the model. In general. releasing code and data is often one good way to accomplish this, but reproducibility can also be provided via detailed instructions for how to replicate the results, access to a hosted model (e.g., in the case of a large language model), releasing of a model checkpoint, or other means that are appropriate to the research performed.   \n\u2022 While NeurIPS does not require releasing code, the conference does require all submissions to provide some reasonable avenue for reproducibility, which may depend on the nature of the contribution. For example (a) If the contribution is primarily a new algorithm, the paper should make it clear how to reproduce that algorithm. (b) If the contribution is primarily a new model architecture, the paper should describe the architecture clearly and fully. (c) If the contribution is a new model (e.g., a large language model), then there should either be a way to access this model for reproducing the results or a way to reproduce the model (e.g., with an open-source dataset or instructions for how to construct the dataset). (d) We recognize that reproducibility may be tricky in some cases, in which case authors are welcome to describe the particular way they provide for reproducibility. In the case of closed-source models, it may be that access to the model is limited in some way (e.g., to registered users), but it should be possible for other researchers to have some path to reproducing or verifying the results. ", "page_idx": 28}, {"type": "text", "text": "5. Open access to data and code ", "text_level": 1, "page_idx": 28}, {"type": "text", "text": "Question: Does the paper provide open access to the data and code, with sufficient instructions to faithfully reproduce the main experimental results, as described in supplemental material? ", "page_idx": 28}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 29}, {"type": "text", "text": "Justification: Code, data, model checkpoints as well as detailed instructions are available here: https://osf.io/n8vz3/?view_only $:=$ 1052300a21bd43c08f700016728aa96e, as stated in Appendix B.1. Nevertheless, high level training, evaluation and implementation details are described in Appendix B and Section 4.1. ", "page_idx": 29}, {"type": "text", "text": "Guidelines: ", "page_idx": 29}, {"type": "text", "text": "\u2022 The answer NA means that paper does not include experiments requiring code.   \n\u2022 Please see the NeurIPS code and data submission guidelines (https://nips.cc/ public/guides/CodeSubmissionPolicy) for more details.   \n\u2022 While we encourage the release of code and data, we understand that this might not be possible, so \u201cNo\u201d is an acceptable answer. Papers cannot be rejected simply for not including code, unless this is central to the contribution (e.g., for a new open-source benchmark).   \n\u2022 The instructions should contain the exact command and environment needed to run to reproduce the results. See the NeurIPS code and data submission guidelines (https: //nips.cc/public/guides/CodeSubmissionPolicy) for more details.   \n\u2022 The authors should provide instructions on data access and preparation, including how to access the raw data, preprocessed data, intermediate data, and generated data, etc.   \n\u2022 The authors should provide scripts to reproduce all experimental results for the new proposed method and baselines. If only a subset of experiments are reproducible, they should state which ones are omitted from the script and why.   \n\u2022 At submission time, to preserve anonymity, the authors should release anonymized versions (if applicable).   \n\u2022 Providing as much information as possible in supplemental material (appended to the paper) is recommended, but including URLs to data and code is permitted. ", "page_idx": 29}, {"type": "text", "text": "6. Experimental Setting/Details ", "text_level": 1, "page_idx": 29}, {"type": "text", "text": "Question: Does the paper specify all the training and test details (e.g., data splits, hyperparameters, how they were chosen, type of optimizer, etc.) necessary to understand the results? ", "page_idx": 29}, {"type": "text", "text": "Answer: [Yes] ", "text_level": 1, "page_idx": 29}, {"type": "text", "text": "Justification: We discuss the dataset details in Appendix B and refer to related work for datasets introduced in prior work. ", "page_idx": 29}, {"type": "text", "text": "Guidelines: ", "page_idx": 29}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not include experiments. \u2022 The experimental setting should be presented in the core of the paper to a level of detail that is necessary to appreciate the results and make sense of them. \u2022 The full details can be provided either with the code, in appendix, or as supplemental material. ", "page_idx": 29}, {"type": "text", "text": "7. Experiment Statistical Significance ", "text_level": 1, "page_idx": 29}, {"type": "text", "text": "Question: Does the paper report error bars suitably and correctly defined or other appropriate information about the statistical significance of the experiments? ", "page_idx": 29}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 29}, {"type": "text", "text": "Justification: We provide error bars for the alanine dipeptide experiments. In contrast, for the much more expensive transferable experiments, we utilize our computational resources to sample a multitude of different peptides from the test set, rather than training and sampling distinct instances of the same architecture for the same peptide. Consequently, we obtain error bounds by averaging results over different test dipeptides rather than runs. ", "page_idx": 29}, {"type": "text", "text": "Guidelines: ", "page_idx": 29}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not include experiments. \u2022 The authors should answer \"Yes\" if the results are accompanied by error bars, confidence intervals, or statistical significance tests, at least for the experiments that support the main claims of the paper. ", "page_idx": 29}, {"type": "text", "text": "\u2022 The factors of variability that the error bars are capturing should be clearly stated (for example, train/test split, initialization, random drawing of some parameter, or overall run with given experimental conditions).   \n\u2022 The method for calculating the error bars should be explained (closed form formula, call to a library function, bootstrap, etc.)   \n\u2022 The assumptions made should be given (e.g., Normally distributed errors).   \n\u2022 It should be clear whether the error bar is the standard deviation or the standard error of the mean.   \n\u2022 It is OK to report 1-sigma error bars, but one should state it. The authors should preferably report a 2-sigma error bar than state that they have a $96\\%$ CI, if the hypothesis of Normality of errors is not verified.   \n\u2022 For asymmetric distributions, the authors should be careful not to show in tables or figures symmetric error bars that would yield results that are out of range (e.g. negative error rates).   \n\u2022 If error bars are reported in tables or plots, The authors should explain in the text how they were calculated and reference the corresponding figures or tables in the text. ", "page_idx": 30}, {"type": "text", "text": "8. Experiments Compute Resources ", "text_level": 1, "page_idx": 30}, {"type": "text", "text": "Question: For each experiment, does the paper provide sufficient information on the computer resources (type of compute workers, memory, time of execution) needed to reproduce the experiments? ", "page_idx": 30}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 30}, {"type": "text", "text": "Justification: We discuss the required computational resources for this work for the training and inference in Appendix B.3 and Appendix B.7. ", "page_idx": 30}, {"type": "text", "text": "Guidelines: ", "page_idx": 30}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not include experiments.   \n\u2022 The paper should indicate the type of compute workers CPU or GPU, internal cluster, or cloud provider, including relevant memory and storage.   \n\u2022 The paper should provide the amount of compute required for each of the individual experimental runs as well as estimate the total compute.   \n\u2022 The paper should disclose whether the full research project required more compute than the experiments reported in the paper (e.g., preliminary or failed experiments that didn\u2019t make it into the paper). ", "page_idx": 30}, {"type": "text", "text": "9. Code Of Ethics ", "text_level": 1, "page_idx": 30}, {"type": "text", "text": "Question: Does the research conducted in the paper conform, in every respect, with the NeurIPS Code of Ethics https://neurips.cc/public/EthicsGuidelines? ", "page_idx": 30}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 30}, {"type": "text", "text": "Justification: The research conducted conforms with the NeurIPS Code of Ethics. All authors have read the NeurIPS Code of Ethics. ", "page_idx": 30}, {"type": "text", "text": "Guidelines: ", "page_idx": 30}, {"type": "text", "text": "\u2022 The answer NA means that the authors have not reviewed the NeurIPS Code of Ethics.   \n\u2022 If the authors answer No, they should explain the special circumstances that require a deviation from the Code of Ethics.   \n\u2022 The authors should make sure to preserve anonymity (e.g., if there is a special consideration due to laws or regulations in their jurisdiction). ", "page_idx": 30}, {"type": "text", "text": "10. Broader Impacts ", "text_level": 1, "page_idx": 30}, {"type": "text", "text": "Question: Does the paper discuss both potential positive societal impacts and negative societal impacts of the work performed? ", "page_idx": 30}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 30}, {"type": "text", "text": "Justification: We discuss the broader impact of our work in Section 8. Guidelines: ", "page_idx": 30}, {"type": "text", "text": "\u2022 The answer NA means that there is no societal impact of the work performed. ", "page_idx": 30}, {"type": "text", "text": "\u2022 If the authors answer NA or No, they should explain why their work has no societal impact or why the paper does not address societal impact.   \n\u2022 Examples of negative societal impacts include potential malicious or unintended uses (e.g., disinformation, generating fake profiles, surveillance), fairness considerations (e.g., deployment of technologies that could make decisions that unfairly impact specific groups), privacy considerations, and security considerations.   \n\u2022 The conference expects that many papers will be foundational research and not tied to particular applications, let alone deployments. However, if there is a direct path to any negative applications, the authors should point it out. For example, it is legitimate to point out that an improvement in the quality of generative models could be used to generate deepfakes for disinformation. On the other hand, it is not needed to point out that a generic algorithm for optimizing neural networks could enable people to train models that generate Deepfakes faster.   \n\u2022 The authors should consider possible harms that could arise when the technology is being used as intended and functioning correctly, harms that could arise when the technology is being used as intended but gives incorrect results, and harms following from (intentional or unintentional) misuse of the technology.   \n\u2022 If there are negative societal impacts, the authors could also discuss possible mitigation strategies (e.g., gated release of models, providing defenses in addition to attacks, mechanisms for monitoring misuse, mechanisms to monitor how a system learns from feedback over time, improving the efficiency and accessibility of ML). ", "page_idx": 31}, {"type": "text", "text": "11. Safeguards ", "text_level": 1, "page_idx": 31}, {"type": "text", "text": "Question: Does the paper describe safeguards that have been put in place for responsible release of data or models that have a high risk for misuse (e.g., pretrained language models, image generators, or scraped datasets)? ", "page_idx": 31}, {"type": "text", "text": "Answer: [NA] ", "page_idx": 31}, {"type": "text", "text": "Justification: Our models do not pose such a risk, as they are for molecular data. Guidelines: ", "page_idx": 31}, {"type": "text", "text": "\u2022 The answer NA means that the paper poses no such risks.   \n\u2022 Released models that have a high risk for misuse or dual-use should be released with necessary safeguards to allow for controlled use of the model, for example by requiring that users adhere to usage guidelines or restrictions to access the model or implementing safety filters.   \n\u2022 Datasets that have been scraped from the Internet could pose safety risks. The authors should describe how they avoided releasing unsafe images.   \n\u2022 We recognize that providing effective safeguards is challenging, and many papers do not require this, but we encourage authors to take this into account and make a best faith effort. ", "page_idx": 31}, {"type": "text", "text": "12. Licenses for existing assets ", "text_level": 1, "page_idx": 31}, {"type": "text", "text": "Question: Are the creators or original owners of assets (e.g., code, data, models), used in the paper, properly credited and are the license and terms of use explicitly mentioned and properly respected? ", "page_idx": 31}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 31}, {"type": "text", "text": "Justification: We give credit to used assets in this work in Appendix B.1 and Appendix B.2.   \nOur assets will be available under the MIT / CC BY 4.0 license. ", "page_idx": 31}, {"type": "text", "text": "Guidelines: ", "page_idx": 31}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not use existing assets.   \n\u2022 The authors should cite the original paper that produced the code package or dataset.   \n\u2022 The authors should state which version of the asset is used and, if possible, include a URL.   \n\u2022 The name of the license (e.g., CC-BY 4.0) should be included for each asset.   \n\u2022 For scraped data from a particular source (e.g., website), the copyright and terms of service of that source should be provided.   \n\u2022 If assets are released, the license, copyright information, and terms of use in the package should be provided. For popular datasets, paperswithcode.com/datasets has curated licenses for some datasets. Their licensing guide can help determine the license of a dataset.   \n\u2022 For existing datasets that are re-packaged, both the original license and the license of the derived asset (if it has changed) should be provided.   \n\u2022 If this information is not available online, the authors are encouraged to reach out to the asset\u2019s creators. ", "page_idx": 31}, {"type": "text", "text": "", "page_idx": 32}, {"type": "text", "text": "13. New Assets ", "text_level": 1, "page_idx": 32}, {"type": "text", "text": "Question: Are new assets introduced in the paper well documented and is the documentation provided alongside the assets? ", "page_idx": 32}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 32}, {"type": "text", "text": "Justification: We document our models in Appendix B. ", "page_idx": 32}, {"type": "text", "text": "Guidelines: ", "page_idx": 32}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not release new assets.   \n\u2022 Researchers should communicate the details of the dataset/code/model as part of their submissions via structured templates. This includes details about training, license, limitations, etc.   \n\u2022 The paper should discuss whether and how consent was obtained from people whose asset is used.   \n\u2022 At submission time, remember to anonymize your assets (if applicable). You can either create an anonymized URL or include an anonymized zip file. ", "page_idx": 32}, {"type": "text", "text": "14. Crowdsourcing and Research with Human Subjects ", "text_level": 1, "page_idx": 32}, {"type": "text", "text": "Question: For crowdsourcing experiments and research with human subjects, does the paper include the full text of instructions given to participants and screenshots, if applicable, as well as details about compensation (if any)? ", "page_idx": 32}, {"type": "text", "text": "Answer: [NA] ", "page_idx": 32}, {"type": "text", "text": "Justification: No crowdsourcing nor human subjects ", "page_idx": 32}, {"type": "text", "text": "Guidelines: ", "page_idx": 32}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not involve crowdsourcing nor research with human subjects.   \n\u2022 Including this information in the supplemental material is fine, but if the main contribution of the paper involves human subjects, then as much detail as possible should be included in the main paper.   \n\u2022 According to the NeurIPS Code of Ethics, workers involved in data collection, curation, or other labor should be paid at least the minimum wage in the country of the data collector. ", "page_idx": 32}, {"type": "text", "text": "15. Institutional Review Board (IRB) Approvals or Equivalent for Research with Human Subjects ", "text_level": 1, "page_idx": 32}, {"type": "text", "text": "Question: Does the paper describe potential risks incurred by study participants, whether such risks were disclosed to the subjects, and whether Institutional Review Board (IRB) approvals (or an equivalent approval/review based on the requirements of your country or institution) were obtained? ", "page_idx": 32}, {"type": "text", "text": "Answer: [NA] ", "page_idx": 32}, {"type": "text", "text": "Justification: No crowdsourcing nor human subjects ", "page_idx": 32}, {"type": "text", "text": "Guidelines: ", "page_idx": 32}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not involve crowdsourcing nor research with human subjects.   \n\u2022 Depending on the country in which research is conducted, IRB approval (or equivalent) may be required for any human subjects research. If you obtained IRB approval, you should clearly state this in the paper.   \n\u2022 We recognize that the procedures for this may vary significantly between institutions and locations, and we expect authors to adhere to the NeurIPS Code of Ethics and the guidelines for their institution.   \n\u2022 For initial submissions, do not include any information that would break anonymity (if applicable), such as the institution conducting the review. ", "page_idx": 32}, {"type": "text", "text": "", "page_idx": 33}]