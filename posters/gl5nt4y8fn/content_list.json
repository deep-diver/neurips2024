[{"type": "text", "text": "Panacea: Pareto Alignment via Preference Adaptation for LLMs ", "text_level": 1, "page_idx": 0}, {"type": "text", "text": "Yifan Zhong1,2\u2217, Chengdong $\\mathbf{M}\\mathbf{a}^{1*}$ , Xiaoyuan Zhang3\u2217, Ziran Yang4, Haojun Chen1 Qingfu Zhang3, Siyuan $\\mathbf{Q}\\mathbf{i}^{2}$ , Yaodong Yang ", "page_idx": 0}, {"type": "text", "text": "Abstract ", "text_level": 1, "page_idx": 0}, {"type": "text", "text": "Current methods for large language model alignment typically use scalar human preference labels. However, this convention tends to oversimplify the multidimensional and heterogeneous nature of human preferences, leading to reduced expressivity and even misalignment. This paper presents Panacea, an innovative approach that reframes alignment as a multi-dimensional preference optimization problem. Panacea trains a single model capable of adapting online and Paretooptimally to diverse sets of preferences without the need for further tuning. A major challenge here is using a low-dimensional preference vector to guide the model\u2019s behavior, despite it being governed by an overwhelmingly large number of parameters. To address this, Panacea is designed to use singular value decomposition (SVD)-based low-rank adaptation, which allows the preference vector to be simply injected online as singular values. Theoretically, we prove that Panacea recovers the entire Pareto front with common loss aggregation methods under mild conditions. Moreover, our experiments demonstrate, for the first time, the feasibility of aligning a single LLM to represent an exponentially vast spectrum of human preferences through various optimization methods. Our work marks a step forward in effectively and efficiently aligning models to diverse and intricate human preferences in a controllable and Pareto-optimal manner. ", "page_idx": 0}, {"type": "text", "text": "1 Introduction ", "text_level": 1, "page_idx": 0}, {"type": "text", "text": "AI alignment aims to ensure AI systems align with human intentions, and there has been notable progress in this area, especially for large language models (LLMs) [29, 12, 30, 2]. The prevailing approach for LLM alignment involves curating a dataset $\\{(x,y_{1},y_{2},z)\\}$ , where each prompt $x$ is associated with a pair of responses $(y_{1},y_{2})$ and a scalar label $z\\in\\{0,1\\}$ that indicates if $y_{1}$ is a \u201cbetter\u201d response. These labels are typically generated based on detailed guidelines that encompass various criteria, reflecting multiple dimensions $i\\,\\in\\,\\{1,\\cdots\\,,m\\}$ of human preferences (e.g., helpfulness, harmlessness, conciseness, humor, formality). Pre-trained models are subsequently further optimized on this dataset using methods including reinforcement learning, supervised learning, or gametheoretical approaches [27, 42, 32, 6, 44, 4, 47, 40]. However, this single-objective alignment methodology may not fully capture the complexity of real-world scenarios for two reasons (Figure 1). ", "page_idx": 0}, {"type": "text", "text": "First, this method can lead to inconsistency and ambiguity in data labels. Human labelers assign scalar labels $z$ by implicitly evaluating responses across every dimension $i$ with different preference weights to $i$ , and reaching a final judgment. These differences often result in confilcting labels, causing misalignment or learning failures (Appendix B), substantiated by the low average label agreement reported in [5]. Second, optimizing a single objective leads to only one model that attempts to fit the potentially conflicting labeling preferences, i.e., the helpfulness-harmlessness dilemma. This single model may not cover the full spectrum of human preferences across all dimensions, thereby exacerbating biases against underrepresented groups and failing to meet diverse user needs. ", "page_idx": 0}, {"type": "image", "img_path": "gL5nT4y8fn/tmp/b0a0949c7a38f7130113401b7d9bcbc6a2b53a0192329ae46d9b6331d570ccc4.jpg", "img_caption": ["Figure 1: Comparison of the predominant single-objective alignment and our multi-dimensional alignment. For the two responses to a prompt, labelers agree on the preferable one in each preference dimension, but conflict when assigning a synthesized scalar label denoting which is \u201cbetter\u201d. This arises due to the inherently different preference weights held by labelers, a common case in reality. Performing single-objective optimization on the potentially conflicting scalar-label dataset (left) could lead to a dominated solution and misalignment. By contrast, our method, Panacea, leverages multi-dimensional preference optimization (right) on the consistent multi-dimensional dataset and learns the entire Pareto front (PF), thereby aligning with diverse and complex human preferences. "], "img_footnote": [], "page_idx": 1}, {"type": "text", "text": "", "page_idx": 1}, {"type": "text", "text": "To address these challenges, we formulate the alignment as a multi-dimensional preference optimization (MDPO) problem. By explicitly curating data for each dimension, we enhance data consistency and simplify the labeling process, thereby overcoming the first limitation. ", "page_idx": 1}, {"type": "text", "text": "Upon the obtained dataset, our goal is to concurrently optimize across all dimensions. However, this is often infeasible due to potential confilcts among preferences (e.g., helpfulness vs. harmlessness in response to hazardous user requests). Therefore, we aim for Pareto-optimality [39], which means finding solutions where no preference dimension can be made better off without making another worse off. However, many Pareto-optimal solutions might exist. Instead of just learning one such solution, we focus on learning the entire set of Pareto-optimal solutions. To achieve this, we use a single model capable of recovering any Pareto-optimal solution by inputting the appropriate preference vector. ", "page_idx": 1}, {"type": "text", "text": "In this paper, we propose Panacea (Pareto alignment via preference adaptation), a simple yet effective method that: 1) learns the entire Pareto-optimal solution set for all possible preferences with a single model, and 2) infers Pareto-optimal responses online by simply injecting any preference vector into the model. Our method, providing a comprehensive representation of human preferences, effectively caters to diverse user needs, thus mitigating the second limitation (Figure 1). ", "page_idx": 1}, {"type": "text", "text": "A key challenge lies in how to utilize a low-dimensional preference vector to control the model\u2019s behavior. Our core insight is that, similar to the crucial role of the preference vector in shaping the Pareto solution, singular values are pivotal in defining the model\u2019s fundamental behavior in a singular value decomposition (SVD)-based low-rank adaptation (LoRA)[22, 57]. To address the above challenge, we incorporate the preference vector into the singular values within each SVDLoRA layer. We then scale it using a learnable factor to align with the magnitude of other singular values. The model is trained end-to-end using a joint objective function aggregated according to the preference vector. The flexibility of Panacea enables seamless compatibility with various preference optimization procedures, e.g., supervised fine-tuning (SFT), reinforcement learning from human feedback (RLHF) [42], and direct preference optimization (DPO) [44], and diverse methods for loss aggregation, e.g., linear scalarization (LS) [10][Section 4.7.5] and weighted Tchebycheff (Tche) [39][Section 3.4]. Through theoretical analysis, we confirm that Panacea can effectively capture the entire Pareto front (PF) under practical conditions. This finding provides a solid rationale for training a single Pareto set model to learn all Pareto optimal solutions across the entire preference space. ", "page_idx": 1}, {"type": "text", "text": "In our experiments, we assess the effectiveness and scalability of Panacea on several significant and challenging preference alignment problems with up to 10 dimensions, where the Pareto set cardinality grows exponentially with the number of dimensions, considerably surpassing the scope of current research. Panacea consistently outperforms baseline methods, producing superior, uniformly distributed, and convex fronts in accordance with the theory. Quantitative metrics highlight its substantial advantages, demonstrating an order-of-magnitude improvement. Notably, Panacea exhibits no performance saturation even on the ten-dimensional problem, indicating its extensive potential. For the first time, we show the possibility of aligning a single model with exponentially many heterogeneous preferences, opening up a promising avenue for LLM alignment. ", "page_idx": 1}, {"type": "text", "text": "", "page_idx": 2}, {"type": "text", "text": "This paper makes three main contributions. First, we identify the fundamental limitations of the predominant scalar-label, single-objective alignment paradigm, and propose to reframe alignment as a multi-dimensional preference optimization problem. Second, we design Panacea, a simple yet effective method that learns one single model that can online and Pareto-optimally adapt to any set of preferences, without the need for further tuning. Third, we provide theoretical supports and empirical validations to demonstrate the Pareto optimality, scalability, efficiency, and simplicity of Panacea, thereby satisfying the urgent need for Pareto alignment to diverse human preferences. ", "page_idx": 2}, {"type": "text", "text": "2 Related Work ", "text_level": 1, "page_idx": 2}, {"type": "text", "text": "Pareto Set Learning. Different from previous classical multi-objective optimization (MOO) methods [59, 35, 38, 56] that use a finite set of solutions (referred to as \u201cparticles\") to approximate the entire Pareto set, Pareto set learning (PSL) [41, 36, 58] aims to use a single model to recover the complete Pareto set/front. The advantage of PSL is that it can store an infinite number of Pareto solutions within a model. This allows users to specify their own preferences, and the model can dynamically output a particular Pareto solution in real-time according to those preferences. Typical applications of PSL includes multiobjective industrial design problems [58, 37], reinforcement learning [8, 54, 24], text-to-image generalization [33], and drug design [25, 61]. While there have been some studies on PSL involving deep neural networks, these models are considerably smaller compared to LLMs. Learning continuous policies that represent different trade-offs for LLMs remains unsolved. ", "page_idx": 2}, {"type": "text", "text": "Multi-Dimensional Preference Optimization. Existing research primarily treats AI alignment as a single-objective optimization problem with scalar labels [42, 55, 17, 44, 40, 47], often neglecting the complexity of diverse human preferences. We provide an in-depth analysis of this limitation in Appendix B, which is subsequently substantiated by MaxMin-RLHF\u2019s result of \u201cimpossibility of alignment\u201d [13] after Panacea first came out. To address this crucial gap, one recent attempt is AlignDiff [19], which trains an attribute-conditioned diffusion model to conduct preference alignment planning in the RL settings. In the realm of LLMs, there are some contemporary works on this topic [60, 26, 18, 21, 51\u201353], where the most relevant one Rewarded Soups (RS) [45] adopts a multi-policy strategy. It learns a model for each preference dimension and interpolates their parameters linearly to generate a customized model. However, its simple design also constitutes its drawback. Since RS does not see any intermediate preference vectors during training, ensuring the optimality and alignment of the interpolated model poses a challenge. By contrast, Panacea explicitly traverses the preference simplex and learns to recover the entire PF, thus achieving better performance. It is the first fundamentally PSL approach in LLM for multi-dimensional preference alignment, with theoretical guarantees of Pareto optimality under mild conditions. ", "page_idx": 2}, {"type": "text", "text": "3 Problem Formulation ", "text_level": 1, "page_idx": 2}, {"type": "text", "text": "Human preference is inherently multi-dimensional. In the case of LLM alignment, a preference dimension refers to a single, self-consistent, and independent aspect of evaluating LLM responses, such as helpfulness, harmlessness, humor, etc.. We formulate the multi-dimensional preference optimization (MDPO) problem with $m$ dimensions as: ", "page_idx": 2}, {"type": "equation", "text": "$$\n\\operatorname*{max}_{\\theta\\in\\Theta}J(\\pi_{\\theta})=(J_{1}(\\pi_{\\theta}),J_{2}(\\pi_{\\theta}),\\ldots,J_{m}(\\pi_{\\theta})),\n$$", "text_format": "latex", "page_idx": 2}, {"type": "text", "text": "where $\\pi_{\\theta}\\in\\Pi$ is a policy, i.e. an LLM, and $\\theta$ is its trainable parameters (decision variable), $\\Pi$ is the policy space, $\\Theta$ is the parameter space, and $J_{i},i=1,\\cdots\\,,m$ denotes a performance measure of dimension $i$ , such as SFT objective $J_{\\mathrm{SFT},i}(\\pi_{\\theta})$ , RLHF objective $J_{\\mathrm{RLHF},i}(\\pi_{\\theta})$ , and DPO objective ", "page_idx": 2}, {"type": "image", "img_path": "gL5nT4y8fn/tmp/0c765697cf39238cd59ee5b951056f903b1d02ad9305f7198c5f20c39598a860.jpg", "img_caption": [], "img_footnote": [], "page_idx": 3}, {"type": "text", "text": "Figure 2: Panacea embeds the preference vector into singular values of each SVD-LoRA layer and scales it with learnable factors to match the magnitudes. During learning, for each data batch, we randomly sample a preference vector from the preference simplex and train the embedded model with various optimization procedures and loss aggregation methods. In the inference stage, the model adapts online to the user-specified preference vector and exhibits Pareto alignment in its responses. ", "page_idx": 3}, {"type": "text", "text": "$J_{\\mathrm{DPO},i}(\\pi_{\\boldsymbol{\\theta}})$ detailed in the following equations, ", "page_idx": 3}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{J_{\\mathrm{SFT},i}(\\pi_{\\theta})=\\mathbb{E}_{(x,y)\\sim\\mathcal{D}_{i}}\\left[\\log\\pi_{\\theta}(y|x)\\right],}\\\\ &{J_{\\mathrm{RLHF},i}(\\pi_{\\theta})=\\mathbb{E}_{x\\sim\\mathcal{D}}\\left[\\mathbb{E}_{y\\sim\\pi_{\\theta}(\\cdot|x)}\\left[r_{i}(x,y)\\right]-\\beta\\mathbb{D}_{\\mathrm{KL}}\\left[\\pi_{\\theta}(\\cdot|x)\\right||\\pi_{\\mathrm{ref}}(\\cdot|x)\\right]\\right],}\\\\ &{J_{\\mathrm{DPO},i}(\\pi_{\\theta})=\\mathbb{E}_{(x,y_{w},y_{l})\\sim\\mathcal{D}_{i}}\\left[\\log\\sigma\\left(\\beta\\log\\frac{\\pi_{\\theta}\\left(y_{w}|x\\right)}{\\pi_{\\mathrm{ref}}\\left(y_{w}|x\\right)}-\\beta\\log\\frac{\\pi_{\\theta}\\left(y_{l}|x\\right)}{\\pi_{\\mathrm{ref}}\\left(y_{l}|x\\right)}\\right)\\right].}\\end{array}\n$$", "text_format": "latex", "page_idx": 3}, {"type": "text", "text": "Notice that $\\mathcal{D}_{i},r_{i}$ represent the data and reward model for dimension $i$ respectively. This is in accordance with our proposal to curate data for each dimension separately to enhance data consistency and training performance. Throughout this paper, we use bold letters to denote vectors or matrices (e.g. $J,\\lambda)$ . Very often, there does not exist a single solution $\\theta$ that performs optimally on all dimensions due to their conflicts. Instead, there exists a set of Pareto optimal solutions, which have unique trade-offs among all dimensions. We say solution $\\theta^{(a)}$ dominates $\\theta^{(b)}$ , denoted as $J(\\pi_{\\theta^{(a)}})\\stackrel{}{\\succ}J(\\pi_{\\theta^{(b)}})$ , if for all $i\\in[m]$ , $J_{i}(\\pi_{\\theta^{(a)}})\\,\\geq\\,\\dot{J_{i}}\\big(\\pi_{\\theta^{(b)}}\\big)$ , and there exists at least one index $j\\in[m]$ such that $J_{j}(\\pi_{\\theta^{(a)}})>J_{j}(\\pi_{\\dot{\\theta^{(b)}}}^{\\ \\^})$ [20, 39]. Based on this, Pareto optimality is defined as: ", "page_idx": 3}, {"type": "text", "text": "Definition 3.1 (Pareto optimality). We call a solution $\\theta^{*}$ Pareto optimal if no other solution $\\theta^{\\prime}\\in\\Theta$ dominates $\\theta^{*}$ . The set of all Pareto optimal solutions is called the Pareto set (PS); while its image set in the objective space is called the Pareto front (PF), $\\tau$ . A solution $\\theta^{*}$ is considered weakly Pareto optimal if no other solution $\\theta^{\\prime}$ can strictly dominate it, that is, if $J_{i}(\\pi_{\\theta^{\\prime}})>J_{i}(\\pi_{\\theta^{*}})$ for all $i\\in[m]$ . ", "page_idx": 3}, {"type": "text", "text": "Human\u2019s trade-offs among all dimensions are quantified as a preference vector, $\\lambda=(\\lambda_{1},...,\\lambda_{m})$ , where $\\lambda\\in\\Delta_{m}$ , $\\lambda_{i}\\geq0$ , and $\\textstyle\\sum_{i=1}^{m}\\lambda_{i}=1$ . Here, $\\lambda_{i}$ represents the weight for preference dimension $i$ (called preference weight), and $\\Delta_{m}$ is the preference simplex. The fundamental problem of MDPO is to learn the Pareto optimal solution for every preference vector. ", "page_idx": 3}, {"type": "text", "text": "4 Panacea: Pareto Alignment via Preference Adaptation ", "text_level": 1, "page_idx": 3}, {"type": "text", "text": "To solve the MDPO problem, our goal is to learn a single model capable of representing the entire Pareto-optimal solution set. The key challenge here is how to obtain a customized and Pareto-optimal LLM containing billions of parameters for each preference vector. Naive solutions such as directly generating a full LLM for each vector using a hypernetwork is infeasible due to the vast number of parameters. To avoid this, we consider LoRA [22], a parameter-efficient fine-tuning method, which, for each layer, freezes the original weights $W_{0}$ and only learns pairs of rank decomposition matrices ", "page_idx": 3}, {"type": "text", "text": "$A,B$ for adaptation. According to LoRA, the final weight $W$ is obtained by $\\pmb{W}=\\pmb{W}_{0}+\\pmb{B}\\pmb{A}$ . However, a rank-8 LoRA of Alpaca-7B [48] still contains nearly 20 million parameters, which means producing separate LoRA parameters for each preference vector can also significantly suffer from training difficulty and instability issues. We thus explore an alternative approach inspired by AdaLoRA [57]. This method employs singular value decomposition (SVD)-based LoRA and learns the left singular matrix $U$ , diagonal matrix $\\Sigma$ (representing singular values), and right singular matrix $V$ . Moreover, $U$ and $V$ are subject to orthogonality regularization. ", "page_idx": 4}, {"type": "equation", "text": "$$\n\\mathbf{\\boldsymbol{W}}=\\mathbf{\\boldsymbol{W}}_{0}+\\mathbf{\\boldsymbol{U\\Sigma}}\\mathbf{\\boldsymbol{V}}^{\\top},\n$$", "text_format": "latex", "page_idx": 4}, {"type": "text", "text": "which hereafter we call SVD-LoRA. By extracting singular values $\\Sigma$ of incremental matrices, SVDLoRA captures the core features of adaptation in a few parameters. More importantly, the singular values provide an interface to fundamentally influence model behavior. ", "page_idx": 4}, {"type": "text", "text": "Our key insight is that the preference vector can be embedded as singular values in every layer to achieve decisive and continuous control of model adaptation. Panacea is thus designed to learn only a single set of SVD-LoRA parameters, but preserves specific dimensions in the diagonal matrix for embedding the preference vector, which leads to model customization. Concretely, for layer $l$ , we preserve $k$ singular values for learning general and preference-agnostic features and concatenate them with the $m$ dimensional preference vector $\\lambda$ multiplied by a per-weightmatrix learnable scaling factor $s^{l}$ . Therefore, for each weight matrix $W^{\\bar{l}}\\;\\in\\;\\mathbb{R}^{\\dot{n}_{1}^{l}\\times n_{2}^{\\bar{l}}}$ , we have $W_{0}^{l}\\in\\mathbb{R}^{n_{1}^{l}\\times n_{2}^{l}}$ , left singular matrix $\\pmb{U}^{l}=[\\pmb{u}_{1}^{l},\\ \\cdot\\ \\cdot\\ ,\\pmb{u}_{k}^{l},\\pmb{u}_{k+1}^{l},\\ \\cdot\\ \\cdot\\ ,\\pmb{u}_{k+m}^{l}]\\in\\mathbb{R}^{n_{1}^{l}\\times(k+m)}$ , diagonal matrix $\\Sigma^{l}=\\mathrm{diag}(\\sigma_{1}^{l},\\dots,\\sigma_{k}^{l},s^{l}\\lambda_{1},\\dots,s^{l}\\lambda_{m})\\in\\mathbb{R}^{(k+m)\\times(k+m)},$ and right singular matrix $V^{l}=$ $[\\pmb{v}_{1}^{l},\\dots,\\pmb{v}_{k}^{l},\\pmb{v}_{k+1}^{l},\\dots,\\pmb{v}_{k+m}^{l}]\\in\\mathbb{R}^{n_{2}^{l}\\times(k+m)}$ . The scaling factor is important since we observe that the preference-agnostic singular values commonly range from $10^{-2}$ to $10^{-5}$ in our experiment scenarios, which could be significantly smaller than preference weights, and their magnitudes differ across weight matrices, so both no scaling and a unified scaling are suboptimal. Concerning our design, one may worry whether $m$ , the dimension of preference vector, is negligible compared to $k$ . Preliminary experiments show that Alpaca-7B fine-tuned by SVD-LoRA with a rank as low as 4 performs comparably to the full-parameter fine-tuning counterpart. Since the rank is of the same magnitude as the number of human preference dimensions, this suggests the feasibility of Panacea. ", "page_idx": 4}, {"type": "text", "text": "During each training iteration, we randomly sample a preference vector from the preference simplex $\\Delta_{m}$ , embed it into all weight matrices, and obtain the preference embedded model $\\pi_{\\boldsymbol{\\theta},\\lambda}$ . We then compute an aggregated objective function of $\\pi_{\\boldsymbol{\\theta},\\lambda}$ across all preference dimensions according to $\\lambda$ by synthesizing per-dimension objective functions with loss aggregation methods. While in this paper we mainly consider RLHF / DPO / SFT objectives and LS and Tche as aggregation functions, the Panacea architecture is generally applicable. The LS function [10][Section 4.7.5] is given by ", "page_idx": 4}, {"type": "equation", "text": "$$\n\\operatorname*{max}_{\\theta}g_{\\lambda}^{\\mathrm{LS}}(\\theta)=\\operatorname*{max}_{\\theta}\\sum_{i=1}^{m}\\lambda_{i}J_{i}(\\pi_{\\theta}),\n$$", "text_format": "latex", "page_idx": 4}, {"type": "text", "text": "and the Tche function is defined as, ", "page_idx": 4}, {"type": "equation", "text": "$$\n\\operatorname*{max}_{\\theta}g_{\\lambda}^{\\mathrm{Tche}}(\\theta)=\\operatorname*{max}_{\\theta}\\operatorname*{min}_{1\\le i\\le m}\\lambda_{i}(J_{i}(\\pi_{\\theta})-z_{i}),\n$$", "text_format": "latex", "page_idx": 4}, {"type": "text", "text": "where $_{\\textit{z}}$ is a vector (e.g., ideal vector) such that $z_{i}\\;\\geq\\;J_{i}(\\pi_{\\theta}),\\forall\\theta\\;\\in\\;\\Theta,\\forall i\\;\\in\\;[m]$ . These loss aggregation functions allow Panacea to obtain solutions corresponding to the preference vector. ", "page_idx": 4}, {"type": "text", "text": "With respect to the aggregated objective, trainable parameters for each weight matrix $\\boldsymbol{W}^{l}$ , including $U^{l},V^{l},\\stackrel{\\triangledown}{(\\sigma_{1}^{l},\\dots,\\sigma_{k}^{l})},s^{l},$ , are then updated via gradient descent. At convergence, sampling preferences on the entire preference simplex recovers the whole PF, as guaranteed by the following theorem. ", "page_idx": 4}, {"type": "text", "text": "Theorem 4.1. Panacea recovers the entire Pareto front for both $L S$ and Tche aggregation functions (Equations (6) and (7)) under the following two assumptions: 1. Panacea with SVD-LoRA has sufficient representation capability for all preferences $\\lambda\\in\\Delta_{m}$ . Specifically, for any preference vector $\\lambda$ , the policy $\\pi_{\\boldsymbol{\\theta},\\lambda}$ can optimize the corresponding aggregation functions (Equations (6) and (7)) to their maximum values. 2. For a specific preference vector $\\lambda$ , the LLM policy space formed by all $\\pi_{\\theta,\\lambda}$ can represent all categorical output distributions of responses. By optimizing the Panacea objective function $\\mathbb{E}_{\\lambda\\sim\\mathrm{Unif}(\\Delta_{m})}\\left[g_{\\lambda}^{\\mathrm{agg}}(\\theta)\\right]$ , where $g_{\\lambda}^{\\mathrm{agg}}$ could be $g_{\\lambda}^{\\mathrm{LS}}\\ o r\\ g_{\\lambda}^{\\mathrm{Tche}}$ , the optimal policy found by Panacea can recover the entire Pareto front for almost every preference. ", "page_idx": 4}, {"type": "text", "text": "For proof, see Appendix C. As the two assumptions are easy to satisfy, this theorem confirms the Pareto-optimality of Panacea. Panacea also achieves fine-grained control of model behavior through preference embedding, making it a suitable solution to MDPO. During inference, the user specifies a preference vector and obtains the corresponding Pareto optimal model that aligns with his/her preference. We present a visual illustration of Panacea in Figure 2 and its pseudocode in Appendix D. ", "page_idx": 4}, {"type": "table", "img_path": "gL5nT4y8fn/tmp/ddb90a255ada5873736f703e19e2a12c9f33fe75765f6a2bf43a353e9eaee5ae.jpg", "table_caption": ["Table 1: This table compares algorithm performance using MOO metrics across all experiment evaluations. An upward arrow (\u2191) means a larger value for this metric is better, whereas a downward arrow (\u2193) indicates the opposite. When in a single cell two values are reported for Panacea, they indicate the results using LS and Tche respectively; otherwise, LS is used. This table highlights that Panacea consistently learns superior solution sets that align better with diverse human preferences. "], "table_footnote": [], "page_idx": 5}, {"type": "text", "text": "", "page_idx": 5}, {"type": "text", "text": "Compared with prior work, Panacea is the first fundamentally PSL approach towards multidimensional preference alignment. It only needs to learn and maintain one model to represent the PF, which is more computationally efficient than both the Discrete Policy Solutions (DPS) method [34, 7], which learns a model for every preference vector, and RS, which approximates the PF with $m$ models optimized exclusively on the $m$ preference dimensions. Being computationally lightweight is especially crucial in the LLM settings. Panacea also allows online specification of the preference vector to swiftly adapt to any human preferences, meeting users\u2019 requirements in no time. Moreover, Panacea achieves a tighter generalization bound of Pareto optimality compared to RS for unseen preferences during training, implying a more complete recovery of the Pareto set. This is due to the explicit traversal of the preference simplex, which allows its generalization error to decay with the number of samples. In contrast, RS only uses a small number of Pareto optimal solutions for interpolation to predict unseen Pareto optimal solutions. The interpolation error cannot be effectively bounded when it only meets a few preference vectors during training. Finally, Panacea preserves explainability to some extent. For each weight matrix $W^{l}$ , Panacea adapts it as ", "page_idx": 5}, {"type": "equation", "text": "$$\n\\pmb{W}^{l}=\\pmb{W}_{0}^{l}+\\pmb{U}^{l}\\pmb{\\Sigma}^{l}\\pmb{V}^{l}^{\\top}=\\pmb{W}_{0}^{l}+\\underbrace{\\sum_{i=1}^{k}\\sigma_{i}^{l}\\pmb{u}_{i}^{l}\\pmb{v}_{i}^{l}}_{[1]}+\\underbrace{\\sum_{i=1}^{m}s^{l}\\lambda_{i}\\pmb{u}_{k+i}^{l}\\pmb{v}_{k+i}^{l}}_{[2]}.\n$$", "text_format": "latex", "page_idx": 5}, {"type": "text", "text": "Intuitively, term [1] captures shared features among preference dimensions, while term [2] learns dimension-specific adaptations and weights them by the preference vector to achieve Pareto alignment. The decoupling of learned parameters not only illustrates the mechanism of Panacea, but also leads to superior robustness of its preference adaptation strategy (further analyzed in Appendix F.5). ", "page_idx": 5}, {"type": "text", "text": "5 Experiments ", "text_level": 1, "page_idx": 5}, {"type": "text", "text": "In this section, we empirically evaluate Panacea\u2019s ability to approximate the PF of complex and multi-dimensional human preferences. We apply Panacea to several significant and challenging preference alignment problems with 2, 3, 4, 5, and up to 10 dimensions, far exceeding those addressed in contemporary works. These problems include the classic helpful-harmless (HH) dilemma, its augmented helpful-harmless-concise (HHC) version, and learning the PFs of multiple common preference dimensions in chat scenarios. While the number of dimensions $m$ varies, we keep the preference-agnostic rank $k$ of Panacea fixed to 8 and observe Panacea\u2019s performance. Compared with the baseline RS, Panacea consistently learns superior, broader, smoother, more evenly distributed, and convex fronts that align with theoretical expectations. The advantages are quantified through various metrics to substantiate its effectiveness and scalability. Encouragingly, we find that Panacea shows no signs of performance saturation even on the ten-dimensional problem, indicating its unlimited potential. We also conduct ablation studies to validate the design of Panacea. Full experimental details are elaborated in Appendix F, and chat cases are presented in Appendix G. ", "page_idx": 5}, {"type": "image", "img_path": "gL5nT4y8fn/tmp/fe01846d18fd9ec3d3021796a6e9de581cce4a259884a2a7c96351b7cd0e9eac.jpg", "img_caption": ["Figure 3: Algorithm performance on HH. Baseline methods (RS and DPS) require training a separate model for each preference dimension/vector, whereas Panacea learns a single adaptable model. Left: Panacea is significantly better than RS and even outperforms DPS, showing its superiority in learning PF while being more efficient. Middle: on Llama2-ft across different seeds, Panacea again consistently outperforms RS, and its fronts exhibit smooth convex shapes that correspond with theory. Right: with DPO, Panacea using both LS and Tche aggregation learns better fronts than RS. "], "img_footnote": [], "page_idx": 6}, {"type": "text", "text": "5.1 Mastering Dual Dimensions: Addressing the Helpful-Harmless Dilemma ", "text_level": 1, "page_idx": 6}, {"type": "text", "text": "In the first set of experiments, algorithms are tasked with two-dimensional preference alignment using various initial models, i.e. Alpaca-finetuned [48] Llama1-7B-base [49](abbv. Llama1-ft) and Llama2- 7B-base [50] (abbv. Llama2-ft), optimization procedures, i.e. RLHF and DPO, and loss aggregation methods, i.e. LS and Tche. Specifically, we focus on the helpful-harmless (HH) dilemma, which is an important and urgent problem since different applications of LLMs often require different trade-offs between them. For example, children need extremely safe chat assistants, while chemists prioritize helpfulness as they are fully aware of the potential hazards. However, current alignment techniques provide the same model for all users, which does not cater to these diverse needs. Therefore, learning the entire PF can significantly alleviate this issue. We use the BeaverTails dataset [28], which has preference labels for both helpfulness and harmlessness. ", "page_idx": 6}, {"type": "table", "img_path": "gL5nT4y8fn/tmp/06be93596590e37a5fa51013feb6e1db25c78edcc35da56b62d52f6105fbcce6.jpg", "table_caption": ["What are different ways that a car can be stolen ? "], "table_footnote": [], "page_idx": 6}, {"type": "text", "text": "In Figure 3 left, we show the learned fronts of algorithms with the task configuration of Llama1-ft, RLHF, and LS aggregation. The rewards for both dimensions are evaluated by reward models for preference vectors sampled evenly at an interval of 0.1, i.e. $\\pmb{\\lambda}=(0.0,1.0)$ , $(0.1,0.9),\\dots,(1.0,0.0)$ . Compared with RS, Panacea learns a significantly better front, whose smooth convex shape also aligns better with the convexity result in Lemma C.3. By contrast, the front learned by RS is not a valid Pareto front since some solutions dominate others, which shows that RS could not learn to recover the PF simply by merging trained weights for all dimensions. In this experiment, we also test ", "page_idx": 6}, {"type": "text", "text": "Figure 4: Responses of the model to the same user prompt with two extreme preference vectors. Regarding inquiries with unsafe viewpoints, the model can either caution users about illegal activities from a harmlessness perspective or provide helpful suggestions for theft prevention. ", "page_idx": 6}, {"type": "text", "text": "Discrete Policy Solutions (DPS) [34, 7], also known as multi-objective RLHF (MORL) in [45], which learns a separate model for each preference vector (11 models in this case) and is commonly considered as the performance upper bound for this problem. Surprisingly, Panacea learns better and smoother front than DPS while being much more efficient, which could be attributed to positive transfer among dimensions enjoyed solely by Panacea. In Figure 3 middle, we conduct the same experiment based on Llama2-ft initial model. Across three seeds, Panacea consistently achieves convex and dominating fronts that are more desirable than those of RS, further verifying the results. To clearly demonstrate how the model\u2019s output changes with variations in the preference vector, we present an exemplar chat case in Figure 4 and its detailed version in Appendix G. The chat case shows how Panacea effectively tailors to diverse needs, thereby settling the long-standing tension between helpfulness and harmlessness. ", "page_idx": 6}, {"type": "image", "img_path": "gL5nT4y8fn/tmp/7883d6593850ac51c0bf556df3490bd9a3c03c3523f35bcaa2498185ba597ca0.jpg", "img_caption": ["Figure 6: Comparison of learned fronts on Chat 3-dim problem. On the left we show a 3D visualization of Panacea (red) and RS (blue) and on the right we show 2D projections by setting one of preference weights to zero. Clearly, the front learned by Panacea dominates that of RS by a large margin. "], "img_footnote": [], "page_idx": 7}, {"type": "text", "text": "To further study the generality of Panacea, we conduct experiments with Llama2-ft, DPO, and LS / Tche aggregation, where Panacea is optimized based on Equation (18) and Equation (19) respectively. For DPO, we propose to evaluate algorithm performance by measuring the implicit reward model accuracy. That is, for a model $\\pi_{\\theta}$ , it is accurate on a labeled pair $\\overline{{(x,y_{w}^{i},\\bar{y}_{l}^{i})}}$ if $\\begin{array}{r}{\\beta\\log\\frac{\\pi_{\\theta}\\left(y_{w}^{i}|x\\right)}{\\pi_{\\mathrm{ref}}\\left(y_{w}^{i}|x\\right)}>\\beta\\log\\frac{\\pi_{\\theta}\\left(y_{l}^{i}|x\\right)}{\\pi_{\\mathrm{ref}}\\left(y_{l}^{i}|x\\right)}}\\end{array}$ , and its total accuracy is obtained by averaging over dataset. With this metric, in Figure 3 right we plot accuracies of HH dimensions for Panacea with LS / Tche and RS baseline. Results again confirm that Panacea always obtains better fronts. ", "page_idx": 7}, {"type": "text", "text": "Aside from comparing the fronts learned by Panacea and the baseline, we also quantify the advantage of Panacea by computing four MOO metrics in Table 1. Hypervolume, the primary metric, measures the volume of space enclosed by a solution set, reflecting its optimality (a visual illustration is shown in Figure 9); the average value of Inner product of preference vectors and the evaluation results measures the correspondence between preference vectors and solutions; Sparsity and Spacing further reflects whether the solutions are evenly distributed. Mathematical expressions of these metrics are detailed in Appendix F.4. Table 1 clearly demonstrate dominance of Panacea over RS on learning more optimal and tailored solutions to diverse preferences while using only a single model. ", "page_idx": 7}, {"type": "text", "text": "5.2 Navigating Tri-Dimensional Trade-offs: Helpful, Harmless, and Concise Alignment ", "text_level": 1, "page_idx": 7}, {"type": "text", "text": "In chat scenarios, the potentially large number of preferences necessitates an efficient method that scales beyond two dimensions. Starting from this section, we start to consider more than two dimensions and test Panacea\u2019s capability to handle them simultaneously. We first augment the HH dilemma with conciseness, another common preference dimension, and compare the algorithms on the task configuration Llama2-ft, RLHF / DPO, and LS aggregation upon BeaverTails dataset. For RLHF, the concise RM is defined as a rectified affine function that assigns higher rewards to shorter responses; for DPO, the shorter response to each prompt is preferred in the conciseness dimension (details provided in Appendix F). For all experiments, we evaluate the algorithms with preference vectors evenly sampled from the entire simplex at an interval of 0.2, i.e. $\\dot{\\lambda}=(0.0,0.0,1.0),(0.0,0.2,0.\\dot{8}),\\dots,(1.0,0.0,0.0)$ , and provide the results in Figure 5 and Table 1. ", "page_idx": 7}, {"type": "text", "text": "Figure 5 visualizes the fronts learned with RLHF procedure. We observe that Panacea learns a very evenly distributed front, whereas most solutions obtained by RS are cluttered together in a corner. This is because Panacea, as a PSL method, explicitly traverses the preference simplex to learn about PF, resulting in tailored solutions corresponding to each preference vector. ", "page_idx": 7}, {"type": "image", "img_path": "gL5nT4y8fn/tmp/5f6ba249e069fee487370459d5e17f6e2092a8ff1f5582a65f55138296124fdb.jpg", "img_caption": [], "img_footnote": [], "page_idx": 7}, {"type": "text", "text": "Figure 5: Learned fronts of Panacea (red) and RS (blue) on HHC problem with Llama2-ft, RLHF, and LS aggregation. Panacea learns a better and more evenly distributed front while solutions of RS clutter in a corner. This suggests Panacea provides fine-grained solutions to diverse human preferences. ", "page_idx": 7}, {"type": "text", "text": "In contrast, RS only learns the vertices and cannot generalize well to solutions within the simplex through linear interpolation. Meanwhile, we also observe that Panacea performs better overall in the harmless dimension, further demonstrating the advantages of its learning approach. MOO metrics in ", "page_idx": 7}, {"type": "image", "img_path": "gL5nT4y8fn/tmp/be74ca500daf8a52fa6fba772ef3c284ea4e90ebe62d89f1ea3c7efe32b0cabe.jpg", "img_caption": ["Figure 7: Left: Ablation study on the learnable preference vector scaling factor. Predefined scaling factors ranging from 1 to $10^{\\bar{-}5}$ all result in significantly worse fronts than the learnable approach, indicating the importance of the per-weight-matrix learnable scaling factor. Middle: Investigation of alternative preference adaptation strategies, including adapting only MLP layers, self-attention layers, 10 layers in the front, and 10 layers in the back. Except for the back 10 layers, all other strategies exhibit similar performance. Thus, we decide to adapt all layers for better representation capacity. Right: We show the fronts learned by Panacea at different RLHF steps. The evolution of fronts reveals Panacea\u2019s learning process which gradually expands in both dimensions, reduces dominated solutions, and finally converges to a broad and convex front. "], "img_footnote": [], "page_idx": 8}, {"type": "text", "text": "Table 1 again numerically depict the benefits of Panacea, and the chat case in Appendix G serves as qualitative support. Thus, by learning a more comprehensive solution space, Panacea effectively manages the trade-offs among helpfulness, harmlessness, and conciseness, underscoring its capability to align with diverse human preferences. ", "page_idx": 8}, {"type": "text", "text": "5.3 Scaling Up: Towards Tens-of-Dimensional Pareto Alignment with a Single Model ", "text_level": 1, "page_idx": 8}, {"type": "text", "text": "We further test Panacea\u2019s scalability on three, four, five, and up to ten-dimensional alignment problems (abbv. Chat 3, 4, 5, and 10-dim), where the considered dimensions include being humorous, philosophical, sycophantic, helpful, concise, creative, formal, expert, pleasant, and uplifting. These dimensions reflect the common scenario where desirable chat properties are not simultaneously attainable. Hence it requires a Pareto-optimal solution set to accommodate diverse preferences. In solving these problems, we employ Panacea with SFT procedure, since SFT is easier to train and scales better. The initial model used in this series of experiments is Llama-3-8B-Instruct [3] (abbv. Llama3-Instruct), and the loss aggregation function is LS. We first curate data for each dimension by prompting Llama3-Instruct to generate responses to Alpaca instructions with the corresponding property (details are provided in Appendix F). Panacea is then trained using LS aggregated SFT loss. The baseline RS trains separate models for each dimension using the corresponding SFT loss. In evaluation, we report the SFT losses of each produced model on the test set in all dimensions. For 3, 4, and 5-dimensional problems, we evaluate the algorithms with preference vectors sampled at an interval of 0.2, resulting in 21, 56, and 126 total evaluations; for ten-dimensional problems, we sample them at an interval of 0.25, amounting to 715 in total. These comprehensive evaluations allow us to characterize the algorithm performance more accurately. We plot the results of Chat 3-dim in Figure 6 and compute the metrics in Table 1. Figure 6 shows that Panacea learns a significantly better front than RS. For the higher-dimensional problems where the results cannot be visualized, we verify the convexity of Panacea\u2019s learned fronts by computing their convex hulls and observing that all evaluation points are on the respective convex hulls. From Table 1, we also observe that Panacea consistently outperforms RS, and the advantage gap becomes larger when scaling to higher dimensions. Notably, Panacea is an order of magnitude better than RS on Chat 10-dim and does not exhibit performance plateau, demonstrating its scalability. We provide a chat case in Appendix G from Chat 3-dim to show Panacea\u2019s performance. These results confirm that Panacea learns a single model capable of aligning with any human preferences. ", "page_idx": 8}, {"type": "text", "text": "5.4 Ablation Study and Analysis ", "text_level": 1, "page_idx": 8}, {"type": "text", "text": "In this part, we validate the design of Panacea and investigate its learning process on the HH problem. We first analyze the effect of the per-weight-matrix learnable scaling factor $s^{l}$ . Intuitively, it scales preference vectors to the same magnitude as the singular values to avoid either dominant or negligible influence of preference-specific features on $\\boldsymbol{W}^{l}$ , as observed from the learned parameters. To validate its importance, we conduct ablation experiments that use a predefined factor to scale preference vectors. Figure 7 (left) indicates that using a fixed scaling results in a significant performance drop regardless of its magnitude, highlighting the necessity of learning an appropriate scaling for each weight matrix separately. We also explore alternative strategies of preference adaptation, which only adapt self-attention layers, MLP layers, first 10 layers, or last 10 layers. Figure 7 (middle) suggests that except for only adapting last 10 layers, all other strategies perform comparably. Thus, for better representation capacity, we decide to let Panacea adapt all layers of an LLM. Finally, in Figure 7 (right), we plot the evolution of fronts learned by Panacea at different steps, showing that it first learns harmlessness features quickly and explores improvements for helpfulness, then it also learns to align with helpfulness preference and finally recovers the entire front. This discovery may inspire training acceleration methods such as dynamically sampling preference vectors according to different learning efficiencies across dimensions. ", "page_idx": 8}, {"type": "text", "text": "", "page_idx": 9}, {"type": "text", "text": "6 Conclusion ", "text_level": 1, "page_idx": 9}, {"type": "text", "text": "This paper presents Panacea, the first Pareto set learning approach towards solving Pareto alignment with multi-dimensional human preference using a single model. Central to its design is embedding the preference vector as singular values in SVD-LoRA to fundamentally influence model behavior online. Theoretically, we prove that training the preference-embedded model against an aggregated objective is guaranteed to recover the entire PF at convergence. Empirical results substantiate that Panacea enjoys superior performance and scalability in approximating PF compared with strong baselines including DPS and RS. Overall, Panacea represents a simple yet effective approach that achieves fine-grained, lightweight, and online Pareto alignment with diverse and complex human preferences, an urgent need in LLM applications. ", "page_idx": 9}, {"type": "text", "text": "Acknowledgments and Disclosure of Funding ", "text_level": 1, "page_idx": 10}, {"type": "text", "text": "We thank Yexin Li for helpful discussions during the early phase of the project. This work is sponsored by National Natural Science Foundation of China (62376013), Beijing Municipal Science & Technology Commission (Z241100001324005, Z231100007423015), Young Elite Scientists Sponsorship Program by CAST 2022QNRC003, the Research Grants Council of the Hong Kong Special Administrative Region, China [GRF Project No. CityU 11215723]. ", "page_idx": 10}, {"type": "text", "text": "References ", "text_level": 1, "page_idx": 10}, {"type": "text", "text": "[1] Marah Abdin, Sam Ade Jacobs, Ammar Ahmad Awan, Jyoti Aneja, Ahmed Awadallah, Hany Awadalla, Nguyen Bach, Amit Bahree, Arash Bakhtiari, Harkirat Behl, et al. Phi-3 technical report: A highly capable language model locally on your phone. arXiv preprint arXiv:2404.14219, 2024.   \n[2] Josh Achiam, Steven Adler, Sandhini Agarwal, Lama Ahmad, Ilge Akkaya, Florencia Leoni Aleman, Diogo Almeida, Janko Altenschmidt, Sam Altman, Shyamal Anadkat, et al. Gpt-4 technical report. arXiv preprint arXiv:2303.08774, 2023.   \n[3] AI@Meta. Llama 3 model card. 2024. URL https://github.com/meta-llama/llama3/ blob/main/MODEL_CARD.md.   \n[4] Mohammad Gheshlaghi Azar, Mark Rowland, Bilal Piot, Daniel Guo, Daniele Calandriello, Michal Valko, and R\u00e9mi Munos. A general theoretical paradigm to understand learning from human preferences. arXiv preprint arXiv:2310.12036, 2023.   \n[5] Yuntao Bai, Andy Jones, Kamal Ndousse, Amanda Askell, Anna Chen, Nova DasSarma, Dawn Drain, Stanislav Fort, Deep Ganguli, Tom Henighan, et al. Training a helpful and harmless assistant with reinforcement learning from human feedback. arXiv preprint arXiv:2204.05862, 2022.   \n[6] Yuntao Bai, Saurav Kadavath, Sandipan Kundu, Amanda Askell, Jackson Kernion, Andy Jones, Anna Chen, Anna Goldie, Azalia Mirhoseini, Cameron McKinnon, et al. Constitutional ai: Harmlessness from ai feedback. arXiv preprint arXiv:2212.08073, 2022.   \n[7] Leon Barrett and Srini Narayanan. Learning all optimal policies with multiple criteria. In Proceedings of the 25th international conference on Machine learning, pages 41\u201347, 2008.   \n[8] Toygun Basaklar, Suat Gumussoy, and Umit Y Ogras. Pd-morl: Preference-driven multiobjective reinforcement learning algorithm. arXiv preprint arXiv:2208.07914, 2022.   \n[9] Kenneth J Berry, Janis E Johnston, and Paul W Mielke Jr. Permutation methods. Wiley Interdisciplinary Reviews: Computational Statistics, 3(6):527\u2013542, 2011.   \n[10] Stephen P Boyd and Lieven Vandenberghe. Convex optimization. Cambridge university press, 2004.   \n[11] Ralph Allan Bradley and Milton E Terry. Rank analysis of incomplete block designs: I. the method of paired comparisons. Biometrika, 39(3/4):324\u2013345, 1952.   \n[12] Stephen Casper, Xander Davies, Claudia Shi, Thomas Krendl Gilbert, J\u00e9r\u00e9my Scheurer, Javier Rando, Rachel Freedman, Tomasz Korbak, David Lindner, Pedro Freire, et al. Open problems and fundamental limitations of reinforcement learning from human feedback. arXiv preprint arXiv:2307.15217, 2023.   \n[13] Souradip Chakraborty, Jiahao Qiu, Hui Yuan, Alec Koppel, Furong Huang, Dinesh Manocha, Amrit Singh Bedi, and Mengdi Wang. Maxmin-rlhf: Towards equitable alignment of large language models with diverse human preferences. arXiv preprint arXiv:2402.08925, 2024.   \n[14] Eng Ung Choo and DR Atkins. Proper efficiency in nonconvex multicriteria programming. Mathematics of Operations Research, 8(3):467\u2013470, 1983.   \n[15] Josef Dai, Xuehai Pan, Ruiyang Sun, Jiaming Ji, Xinbo Xu, Mickel Liu, Yizhou Wang, and Yaodong Yang. Safe rlhf: Safe reinforcement learning from human feedback. arXiv preprint arXiv:2310.12773, 2023.   \n[16] Kalyanmoy Deb, Amrit Pratap, Sameer Agarwal, and TAMT Meyarivan. A fast and elitist multiobjective genetic algorithm: Nsga-ii. IEEE transactions on evolutionary computation, 6 (2):182\u2013197, 2002.   \n[17] Hanze Dong, Wei Xiong, Deepanshu Goyal, Rui Pan, Shizhe Diao, Jipeng Zhang, Kashun Shum, and Tong Zhang. Raft: Reward ranked finetuning for generative foundation model alignment. arXiv preprint arXiv:2304.06767, 2023.   \n[18] Yi Dong, Zhilin Wang, Makesh Narsimhan Sreedhar, Xianchao Wu, and Oleksii Kuchaiev. Steerlm: Attribute conditioned sft as an (user-steerable) alternative to rlhf. arXiv preprint arXiv:2310.05344, 2023.   \n[19] Zibin Dong, Yifu Yuan, Jianye Hao, Fei Ni, Yao Mu, Yan Zheng, Yujing Hu, Tangjie Lv, Changjie Fan, and Zhipeng Hu. Aligndiff: Aligning diverse human preferences via behaviorcustomisable diffusion model. arXiv preprint arXiv:2310.02054, 2023.   \n[20] Matthias Ehrgott. Multicriteria optimization, volume 491. Springer Science & Business Media, 2005.   \n[21] Yiju Guo, Ganqu Cui, Lifan Yuan, Ning Ding, Jiexin Wang, Huimin Chen, Bowen Sun, Ruobing Xie, Jie Zhou, Yankai Lin, et al. Controllable preference optimization: Toward controllable multi-objective alignment. arXiv preprint arXiv:2402.19085, 2024.   \n[22] Edward J Hu, yelong shen, Phillip Wallis, Zeyuan Allen-Zhu, Yuanzhi Li, Shean Wang, Lu Wang, and Weizhu Chen. LoRA: Low-rank adaptation of large language models. In International Conference on Learning Representations, 2022. URL https://openreview. net/forum?id $\\cdot$ nZeVKeeFYf9.   \n[23] Yuzheng Hu, Ruicheng Xian, Qilong Wu, Qiuling Fan, Lang Yin, and Han Zhao. Revisiting scalarization in multi-task learning: A theoretical perspective. Advances in Neural Information Processing Systems, 36, 2024.   \n[24] Minyoung Hwang, Luca Weihs, Chanwoo Park, Kimin Lee, Aniruddha Kembhavi, and Kiana Ehsani. Promptable behaviors: Personalizing multi-objective rewards from human preferences. arXiv preprint arXiv:2312.09337, 2023.   \n[25] Moksh Jain, Sharath Chandra Raparthy, Alex Hern\u00e1ndez-Garc\u0131a, Jarrid Rector-Brooks, Yoshua Bengio, Santiago Miret, and Emmanuel Bengio. Multi-objective gflownets. In International Conference on Machine Learning, pages 14631\u201314653. PMLR, 2023.   \n[26] Joel Jang, Seungone Kim, Bill Yuchen Lin, Yizhong Wang, Jack Hessel, Luke Zettlemoyer, Hannaneh Hajishirzi, Yejin Choi, and Prithviraj Ammanabrolu. Personalized soups: Personalized large language model alignment via post-hoc parameter merging. arXiv preprint arXiv:2310.11564, 2023.   \n[27] Natasha Jaques, Asma Ghandeharioun, Judy Hanwen Shen, Craig Ferguson, Agata Lapedriza, Noah Jones, Shixiang Gu, and Rosalind Picard. Way off-policy batch deep reinforcement learning of implicit human preferences in dialog. arXiv preprint arXiv:1907.00456, 2019.   \n[28] Jiaming Ji, Mickel Liu, Juntao Dai, Xuehai Pan, Chi Zhang, Ce Bian, Boyuan Chen, Ruiyang Sun, Yizhou Wang, and Yaodong Yang. Beavertails: Towards improved safety alignment of llm via a human-preference dataset. In Thirty-seventh Conference on Neural Information Processing Systems Datasets and Benchmarks Track, 2023.   \n[29] Jiaming Ji, Tianyi Qiu, Boyuan Chen, Borong Zhang, Hantao Lou, Kaile Wang, Yawen Duan, Zhonghao He, Jiayi Zhou, Zhaowei Zhang, et al. Ai alignment: A comprehensive survey. arXiv preprint arXiv:2310.19852, 2023.   \n[30] Timo Kaufmann, Paul Weng, Viktor Bengs, and Eyke H\u00fcllermeier. A survey of reinforcement learning from human feedback. arXiv preprint arXiv:2312.14925, 2023.   \n[31] Woosuk Kwon, Zhuohan Li, Siyuan Zhuang, Ying Sheng, Lianmin Zheng, Cody Hao Yu, Joseph E. Gonzalez, Hao Zhang, and Ion Stoica. Efficient memory management for large language model serving with pagedattention. In Proceedings of the ACM SIGOPS 29th Symposium on Operating Systems Principles, 2023.   \n[32] Harrison Lee, Samrat Phatale, Hassan Mansoor, Kellie Lu, Thomas Mesnard, Colton Bishop, Victor Carbune, and Abhinav Rastogi. Rlaif: Scaling reinforcement learning from human feedback with ai feedback. arXiv preprint arXiv:2309.00267, 2023.   \n[33] Seung Hyun Lee, Yinxiao Li, Junjie Ke, Innfarn Yoo, Han Zhang, Jiahui Yu, Qifei Wang, Fei Deng, Glenn Entis, Junfeng He, et al. Parrot: Pareto-optimal multi-reward reinforcement learning framework for text-to-image generation. arXiv preprint arXiv:2401.05675, 2024.   \n[34] Kaiwen Li, Tao Zhang, and Rui Wang. Deep reinforcement learning for multiobjective optimization. IEEE transactions on cybernetics, 51(6):3103\u20133114, 2020.   \n[35] Xi Lin, Hui-Ling Zhen, Zhenhua Li, Qing-Fu Zhang, and Sam Kwong. Pareto multi-task learning. Advances in neural information processing systems, 32, 2019.   \n[36] Xi Lin, Zhiyuan Yang, Qingfu Zhang, and Sam Kwong. Controllable pareto multi-task learning. arXiv preprint arXiv:2010.06313, 2020.   \n[37] Xi Lin, Zhiyuan Yang, Xiaoyuan Zhang, and Qingfu Zhang. Pareto set learning for expensive multi-objective optimization. Advances in Neural Information Processing Systems, 35:19231\u2013 19247, 2022.   \n[38] Xingchao Liu, Xin Tong, and Qiang Liu. Profiling pareto front with multi-objective stein variational gradient descent. Advances in Neural Information Processing Systems, 34:14721\u2013 14733, 2021.   \n[39] Kaisa Miettinen. Nonlinear multiobjective optimization, volume 12. Springer Science & Business Media, 1999.   \n[40] R\u00e9mi Munos, Michal Valko, Daniele Calandriello, Mohammad Gheshlaghi Azar, Mark Rowland, Zhaohan Daniel Guo, Yunhao Tang, Matthieu Geist, Thomas Mesnard, Andrea Michi, et al. Nash learning from human feedback. arXiv preprint arXiv:2312.00886, 2023.   \n[41] Aviv Navon, Aviv Shamsian, Gal Chechik, and Ethan Fetaya. Learning the pareto front with hypernetworks. arXiv preprint arXiv:2010.04104, 2020.   \n[42] Long Ouyang, Jeffrey Wu, Xu Jiang, Diogo Almeida, Carroll Wainwright, Pamela Mishkin, Chong Zhang, Sandhini Agarwal, Katarina Slama, Alex Ray, et al. Training language models to follow instructions with human feedback. Advances in Neural Information Processing Systems, 35:27730\u201327744, 2022.   \n[43] Jan Peters and Stefan Schaal. Reinforcement learning by reward-weighted regression for operational space control. In Proceedings of the 24th international conference on Machine learning, pages 745\u2013750, 2007.   \n[44] Rafael Rafailov, Archit Sharma, Eric Mitchell, Stefano Ermon, Christopher D Manning, and Chelsea Finn. Direct preference optimization: Your language model is secretly a reward model. arXiv preprint arXiv:2305.18290, 2023.   \n[45] Alexandre Rame, Guillaume Couairon, Mustafa Shukor, Corentin Dancette, Jean-Baptiste Gaya, Laure Soulier, and Matthieu Cord. Rewarded soups: towards pareto-optimal alignment by interpolating weights fine-tuned on diverse rewards. arXiv preprint arXiv:2306.04488, 2023.   \n[46] Diederik Marijn Roijers, Shimon Whiteson, and Frans A Oliehoek. Computing convex coverage sets for faster multi-objective coordination. Journal of Artificial Intelligence Research, 52: 399\u2013443, 2015.   \n[47] Gokul Swamy, Christoph Dann, Rahul Kidambi, Zhiwei Steven Wu, and Alekh Agarwal. A minimaximalist approach to reinforcement learning from human feedback. arXiv preprint arXiv:2401.04056, 2024.   \n[48] Rohan Taori, Ishaan Gulrajani, Tianyi Zhang, Yann Dubois, Xuechen Li, Carlos Guestrin, Percy Liang, and Tatsunori B Hashimoto. Alpaca: A strong, replicable instructionfollowing model. Stanford Center for Research on Foundation Models. https://crfm. stanford. edu/2023/03/13/alpaca. html, 3(6):7, 2023.   \n[49] Hugo Touvron, Thibaut Lavril, Gautier Izacard, Xavier Martinet, Marie-Anne Lachaux, Timoth\u00e9e Lacroix, Baptiste Rozi\u00e8re, Naman Goyal, Eric Hambro, Faisal Azhar, et al. Llama: Open and efficient foundation language models. arXiv preprint arXiv:2302.13971, 2023.   \n[50] Hugo Touvron, Louis Martin, Kevin Stone, Peter Albert, Amjad Almahairi, Yasmine Babaei, Nikolay Bashlykov, Soumya Batra, Prajjwal Bhargava, Shruti Bhosale, et al. Llama 2: Open foundation and fine-tuned chat models. arXiv preprint arXiv:2307.09288, 2023.   \n[51] Haoxiang Wang, Yong Lin, Wei Xiong, Rui Yang, Shizhe Diao, Shuang Qiu, Han Zhao, and Tong Zhang. Arithmetic control of llms for diverse user preferences: Directional preference alignment with multi-objective rewards. arXiv preprint arXiv:2402.18571, 2024.   \n[52] Kailai Yang, Zhiwei Liu, Qianqian Xie, Tianlin Zhang, Nirui Song, Jimin Huang, Ziyan Kuang, and Sophia Ananiadou. Metaaligner: Conditional weak-to-strong correction for generalizable multi-objective alignment of language models. arXiv preprint arXiv:2403.17141, 2024.   \n[53] Rui Yang, Xiaoman Pan, Feng Luo, Shuang Qiu, Han Zhong, Dong Yu, and Jianshu Chen. Rewards-in-context: Multi-objective alignment of foundation models with dynamic preference adjustment. arXiv preprint arXiv:2402.10207, 2024.   \n[54] Runzhe Yang, Xingyuan Sun, and Karthik Narasimhan. A generalized algorithm for multiobjective reinforcement learning and policy adaptation. Advances in neural information processing systems, 32, 2019.   \n[55] Zheng Yuan, Hongyi Yuan, Chuanqi Tan, Wei Wang, Songfang Huang, and Fei Huang. Rrhf: Rank responses to align language models with human feedback without tears. arXiv preprint arXiv:2304.05302, 2023.   \n[56] Qingfu Zhang and Hui Li. Moea/d: A multiobjective evolutionary algorithm based on decomposition. IEEE Transactions on evolutionary computation, 11(6):712\u2013731, 2007.   \n[57] Qingru Zhang, Minshuo Chen, Alexander Bukharin, Pengcheng He, Yu Cheng, Weizhu Chen, and Tuo Zhao. Adaptive budget allocation for parameter-efficient fine-tuning. In The Eleventh International Conference on Learning Representations, 2023. URL https://openreview. net/forum?id $\\cdot$ lq62uWRJjiY.   \n[58] Xiaoyuan Zhang, Xi Lin, Bo Xue, Yifan Chen, and Qingfu Zhang. Hypervolume maximization: A geometric view of pareto set learning. In Thirty-seventh Conference on Neural Information Processing Systems, 2023.   \n[59] Aimin Zhou, Bo-Yang Qu, Hui Li, Shi-Zheng Zhao, Ponnuthurai Nagaratnam Suganthan, and Qingfu Zhang. Multiobjective evolutionary algorithms: A survey of the state of the art. Swarm and evolutionary computation, 1(1):32\u201349, 2011.   \n[60] Zhanhui Zhou, Jie Liu, Chao Yang, Jing Shao, Yu Liu, Xiangyu Yue, Wanli Ouyang, and Yu Qiao. Beyond one-preference-for-all: Multi-objective direct preference optimization. arXiv preprint arXiv:2310.03708, 2023.   \n[61] Yiheng Zhu, Jialu Wu, Chaowen Hu, Jiahuan Yan, Chang-Yu Hsieh, Tingjun Hou, and Jian Wu. Sample-efficient multi-objective molecular optimization with gflownets. arXiv preprint arXiv:2302.04040, 2023. ", "page_idx": 10}, {"type": "text", "text": "", "page_idx": 11}, {"type": "text", "text": "", "page_idx": 12}, {"type": "text", "text": "", "page_idx": 13}, {"type": "text", "text": "Supplementary Material ", "text_level": 1, "page_idx": 14}, {"type": "text", "text": "Table of Contents ", "page_idx": 14}, {"type": "text", "text": "A Preliminary Theoretical Results 16 ", "page_idx": 14}, {"type": "text", "text": "B The Limitation of Single-Objective Alignment 16 ", "page_idx": 14}, {"type": "text", "text": "C Theoretical Support for Panacea with LS / Tche function 18 ", "page_idx": 14}, {"type": "text", "text": "C.1 Proof for LS Aggregation Function . . 18   \nC.2 Proof for Tchebycheff Aggregation Function . 19 ", "page_idx": 14}, {"type": "text", "text": "D Pseudocode of Panacea 20 ", "page_idx": 14}, {"type": "text", "text": "E Aggregated Training Objectives for Panacea 20 ", "page_idx": 14}, {"type": "text", "text": "F Experiment Details and Additional Results 21 ", "text_level": 1, "page_idx": 14}, {"type": "text", "text": "F.1 Core Implementation of Panacea 21   \nF.2 Data Curation . . . 21   \nF.3 Experiment Setup . . 22   \nF.4 Evaluation Details 23   \nF.5 Additional Results . 25   \nF.6 Information of assets 26 ", "page_idx": 14}, {"type": "text", "text": "G Chat History Examples 27 ", "page_idx": 14}, {"type": "text", "text": "H Discussions 28   \nH.1 Limitations 28   \nH.2 Broader Impacts . . 29 ", "page_idx": 14}, {"type": "text", "text": "A Preliminary Theoretical Results ", "text_level": 1, "page_idx": 15}, {"type": "text", "text": "In this section, we prove the validity of combining reward models of all preference dimensions through linear scalarization in the RLHF optimization procedure, even though each reward model solved by the Bradley-Terry (BT) model [11] is not uniquely determined. This is formalized in the following lemma. ", "page_idx": 15}, {"type": "text", "text": "Lemma A.1 (Extension of Lemma 2 in [44] for multiple reward models). Let $r_{i}(x,y)$ and $r_{i}^{\\prime}(x,y)$ be equivalent reward models for the i-th preference dimension, where $r_{i}^{\\prime}(x,y)\\ =\\ r_{i}(x,y)\\,+$ $\\phi_{i}(x)$ . The linear combinations $\\textstyle r(x,y)\\;=\\;\\sum_{i=1}^{m}\\lambda_{i}r_{i}(x,y)$ and $r^{\\prime}(x,y)\\;=\\;\\textstyle\\sum_{i=1}^{m}\\lambda_{i}r_{i}(x,y)\\,+$ $\\textstyle\\sum_{i=1}^{m}\\lambda_{i}\\phi_{i}(x)$ induce the same optimal poli cy in the constrained RL problem $\\begin{array}{r l}{~}&{{}\\operatorname*{max}_{\\pi}~J_{R L H F}(\\pi)~{=}}\\end{array}$ $\\mathbb{E}_{x\\sim\\mathcal{D}}\\left[\\mathbb{E}_{y\\sim\\pi(\\cdot|x)}\\left[r(x,y)\\right]-\\beta\\mathbb{D}_{K L}\\left[\\pi(\\cdot|x)||\\pi_{r e f}(\\cdot|x)\\right]\\right]$ , where $\\beta$ is a positive punishment factor of the KL constraint. ", "page_idx": 15}, {"type": "text", "text": "Remark A.2. This lemma demonstrates that it is valid to linearly combine reward models of all dimensions, even if the reward models are not uniquely identified. It is used in analyzing the limitations of single-objective alignment and it validates the LS aggregation employed with Panacea. ", "page_idx": 15}, {"type": "text", "text": "Below, we provide a concise proof of Lemma A.1. ", "page_idx": 15}, {"type": "text", "text": "Proof. According to the constrained RL literatures [43, 9], the policy for the reward function $r^{\\prime}(x,y)$ in a Kullback-Leibler (KL) constrained reinforcement learning (RL) problem can be formulated as follows: ", "page_idx": 15}, {"type": "equation", "text": "$$\n\\pi_{r^{\\prime}}(y|x)=\\frac{\\pi_{\\mathrm{ref}}(y|x)\\exp\\Big(\\frac{1}{\\beta}r^{\\prime}(x,y)\\Big)}{\\sum_{y}\\pi_{\\mathrm{ref}}(y|x)\\exp\\Big(\\frac{1}{\\beta}r^{\\prime}(x,y)\\Big)}.\n$$", "text_format": "latex", "page_idx": 15}, {"type": "text", "text": "Expanding the term in $r^{\\prime}(x,y)$ , we obtain: ", "page_idx": 15}, {"type": "equation", "text": "$$\n\\pi_{r^{\\prime}}(y|x)={\\frac{\\pi_{\\mathrm{ref}}(y|x)\\exp\\left({\\frac{1}{\\beta}}\\left(\\sum_{i=1}^{m}\\lambda_{i}r_{i}(x,y)+\\underbrace{\\sum_{i=1}^{m}\\lambda_{i}\\phi_{i}(x)}_{\\phi^{\\prime}(x)}\\right)\\right)}{\\pi_{r^{\\prime}}(y|x)={\\cfrac{\\pi}{\\sum_{y}\\pi_{\\mathrm{ref}}(y|x)\\exp\\left({\\frac{1}{\\beta}}\\left(\\sum_{i=1}^{m}\\lambda_{i}r_{i}(x,y)+\\underbrace{\\sum_{i=1}^{m}\\lambda_{i}\\phi_{i}(x)}_{\\phi^{\\prime}(x)}\\right)\\right)}}}.\n$$", "text_format": "latex", "page_idx": 15}, {"type": "text", "text": "Upon simplifying by canceling out the common term $\\exp(\\phi^{\\prime}(x))$ , we get: ", "page_idx": 15}, {"type": "equation", "text": "$$\n\\pi_{r^{\\prime}}(y|x)=\\frac{\\pi_{\\mathrm{ref}}(y|x)\\exp\\Big(\\frac{1}{\\beta}r(x,y)\\Big)\\underset{\\substack{r=\\mathrm{\\tiny~\\left(\\frac{1}{\\beta}\\right)}\\,r(y^{\\prime}(\\overline{{x}}))}}{\\exp\\Big(\\frac{1}{\\beta}r(x,y)\\Big)\\underset{\\substack{r=\\mathrm{\\tiny~\\left(\\frac{1}{\\beta}\\right)}\\,\\left(\\frac{1}{\\beta}\\left(\\phi^{\\prime}(\\overline{{x}})\\right)\\right)}}{\\exp\\Big(\\frac{1}{\\beta}\\phi^{\\prime}(\\overline{{x}})\\Big)}=\\pi_{r}(y|x),\n$$", "text_format": "latex", "page_idx": 15}, {"type": "text", "text": "which completes the proof. ", "page_idx": 15}, {"type": "text", "text": "B The Limitation of Single-Objective Alignment ", "text_level": 1, "page_idx": 15}, {"type": "text", "text": "In the following content, we provide a theoretical analysis that the model trained by the singleobjective alignment paradigm could actually misalign with every labeler. We conduct analysis on RLHF, the most common approach. We make the following assumptions: ", "page_idx": 15}, {"type": "text", "text": "Assumption B.1. Human preference can be modeled by the Bradley-Terry model [11]. ", "page_idx": 15}, {"type": "text", "text": "Assumption B.2. Different people are consistent in labeling each preference dimension. ", "page_idx": 16}, {"type": "text", "text": "These two assumptions imply that people possess the same reward model $r_{i}(x,y)$ for each preference dimension $i$ . ", "page_idx": 16}, {"type": "text", "text": "Assumption B.3. The synthesized reward model of a person is the LS of per-dimensional reward models according to his/her preference vector under a shift invariant term (c.f [44][Lemma1]). That is, ", "page_idx": 16}, {"type": "equation", "text": "$$\nr(x,y)=\\sum_{i=1}^{m}\\lambda_{i}r_{i}(x,y)+\\phi(x).\n$$", "text_format": "latex", "page_idx": 16}, {"type": "text", "text": "Now we prove the main theoretical result. ", "page_idx": 16}, {"type": "text", "text": "Theorem B.4. Consider the case where there are n labelers in total. Each labeler $h$ labels a portion $p^{h}$ of the entire dataset, where $\\begin{array}{r}{p^{h}\\in[0,1],\\sum_{h=1}^{n}p^{h}=1}\\end{array}$ . The preference vector of labeler $h$ is $\\pmb{\\lambda}^{h}=$ $(\\lambda_{1}^{h},\\lambda_{2}^{h},\\dots,\\lambda_{m}^{h})$ . The labelers have diffe rent preference vectors, i.e. $\\exists\\,j,h\\in\\{1,\\dots,n\\},\\lambda^{j}\\neq\\lambda^{h}$ . The RLHF optimization result is a model that could misalign with every labeler. ", "page_idx": 16}, {"type": "text", "text": "Proof. The reward model $r^{h}$ of labeler $h$ is $\\begin{array}{r}{r^{h}(x,y)=\\sum_{i=1}^{m}\\lambda_{i}^{h}r_{i}(x,y)+\\phi^{h}(x).~J^{h}(\\epsilon)}\\end{array}$ denotes the optimization objective corresponding to the reward model of labeler $h$ . The joint optimization objective is ", "page_idx": 16}, {"type": "equation", "text": "$$\n\\operatorname*{max}_{\\theta}\\,\\sum_{h=1}^{n}p^{h}J^{h}(\\pi_{\\theta})\n$$", "text_format": "latex", "page_idx": 16}, {"type": "text", "text": "(Substituting the oracle reward function.) ", "page_idx": 16}, {"type": "equation", "text": "$$\n=\\operatorname*{max}_{\\theta}\\sum_{h=1}^{n}p^{h}\\left(\\mathbb{E}_{x\\sim\\mathcal{D}}\\left[\\mathbb{E}_{y\\sim\\pi_{\\theta}(\\cdot|x)}\\left[r^{h}(x,y)\\right]-\\beta\\mathbb{D}_{\\mathrm{KL}}\\left[\\pi_{\\theta}(\\cdot|x)\\right|\\middle|\\pi_{\\mathrm{ref}}(\\cdot|x)\\right]\\right]\\right)\n$$", "text_format": "latex", "page_idx": 16}, {"type": "text", "text": "(Rearrange reward terms.) ", "page_idx": 16}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{\\quad=\\operatorname*{max}_{\\ell\\leq t\\leq T_{\\ell}}\\Bigg[\\sum_{p=t+1}^{T}\\Bigg(\\sum_{q=t}^{b}\\hat{p}_{j}^{p}k^{p}(x_{\\ell},y_{p})-\\mathcal{B}[\\mathcal{B}_{\\ell}[\\mathcal{B}_{q}[\\mathcal{B}_{q}[\\mathcal\\mathcal{B}_{q}[\\mathcal\\mathcal{B}_{q}]]]]\\Bigg.}\\\\ &{\\quad=\\operatorname*{max}_{\\ell\\leq t\\leq T_{\\ell}}\\Bigg[\\sum_{p=t+1}^{b}\\Bigg(\\sum_{q=t}^{b}\\hat{p}_{j}^{p}k^{p}\\Bigg(\\sum_{q=0}^{b}\\mathcal{B}_{q}[\\mathcal{B}_{q}[\\mathcal{B}_{q}[\\mathcal{B}_{q}]]\\Bigg)\\Bigg.\\Bigg.\\Bigg.\\Bigg.}\\\\ &{\\quad\\left.\\left.\\left.\\left(\\mathrm{B}[\\mathcal{B}_{q}[\\mathcal{B}_{q}]]\\right)\\leq\\sum_{p=0}^{b}\\mathcal{B}[\\mathcal{B}_{q}[\\mathcal{B}_{q}]\\Bigg)\\right)\\right]-\\mathcal{B}[\\mathcal{B}_{q}[\\mathcal{B}_{q}[\\mathcal{B}_{q}]]]\\Bigg[\\mathcal{B}_{q}[\\mathcal{B}_{q}[\\mathcal{B}_{q}]]\\Bigg]\\right]}\\\\ &{\\quad=\\operatorname*{max}_{\\ell\\leq T_{\\ell}}\\Bigg[\\sum_{p=t+1}^{b}\\Bigg(\\sum_{q=0}^{b}\\hat{p}_{j}^{p}k^{q}(x_{\\ell},y_{p})+\\mathcal{B}[\\mathcal{B}_{q}]\\Bigg)-\\mathcal{B}[\\mathcal{B}_{q}[\\mathcal{B}_{q}[\\mathcal{B}_{q}]]\\Bigg[\\mathcal{B}_{q}[\\mathcal{B}_{q}]]\\Bigg]}\\\\ &{\\quad=\\operatorname*{max}_{\\ell\\leq t\\leq T_{\\ell}}\\Bigg[\\sum_{p=t+1}^{b}\\Bigg(\\sum_{q=0}^{b}\\int_{0}^{x}\\hat{p}_{j}^{p}k^{q}(x_{\\ell},y_{p})+\\mathcal{B}[\\mathcal{B}_{q}[\\mathcal{B}_{q}]]\\Bigg.\\Bigg.\\Bigg.}\\\\ &{\\quad\\quad=\\operatorname*{max}_{\\ell\\leq t\\leq T_{\\ell}}\\Bigg[\\sum_{p=t+1}^{b}\\Bigg(\\sum_{q=0}^{b}\\int_{0}^{x}\\hat{p}_{j}^{p}k^{q}(x_{\\ell\n$$", "text_format": "latex", "page_idx": 16}, {"type": "text", "text": "Thus, we show that it actually optimizes with the preference vector $\\lambda^{\\mathrm{opt}}$ , with $\\begin{array}{r}{\\lambda_{i}^{\\mathrm{opt}}=\\sum_{h=1}^{n}p^{h}\\lambda_{i}^{h},i=}\\end{array}$ $1,\\ldots,m$ . According to the constrained RL literatures [43, 9], the corresponding o ptimal policy can ", "page_idx": 16}, {"type": "text", "text": "be expressed as: ", "page_idx": 17}, {"type": "equation", "text": "$$\n\\pi_{\\theta}^{*}(y|x)=\\frac{1}{Z(x)}\\pi_{\\mathrm{ref}}\\left(y|x\\right)\\exp\\left(\\frac{1}{\\beta}\\sum_{i=1}^{m}\\lambda_{i}^{\\mathrm{opt}}r_{i}(x,y)\\right).\n$$", "text_format": "latex", "page_idx": 17}, {"type": "text", "text": "It is important to note that this optimal preference vector may not align with the individual preferences of each annotator. As a result, the trained model may not fully reflect the labeling criteria of any single annotator, potentially leading to discrepancies in the model\u2019s predictions. ", "page_idx": 17}, {"type": "text", "text": "C Theoretical Support for Panacea with LS / Tche function ", "text_level": 1, "page_idx": 17}, {"type": "text", "text": "In the following content, we prove for Theorem 4.1 from the main paper, showing that both linear and Tchebycheff scalarization can recover the entire Pareto Front (PF) under practical assumptions. The proof has two subsections: first for the linear scalarization function in Appendix C.1, followed by the Tchebycheff aggregation function in Appendix C.2. ", "page_idx": 17}, {"type": "text", "text": "C.1 Proof for LS Aggregation Function ", "text_level": 1, "page_idx": 17}, {"type": "text", "text": "We provide a proof sketch for this part. ", "page_idx": 17}, {"type": "text", "text": "Step 1: Under the full categorical representation assumption, for any two policies $\\pi^{(a)}(\\cdot|x)$ and $\\pi^{(b)}(\\cdot|x)$ , we can create a new policy $(\\pi^{\\prime})$ that, with probability (w.p.) $p$ (where $0\\leq p\\leq1]$ ), takes $\\pi^{(a)}(\\cdot|x)$ and w.p. $1-p$ , takes $\\pi^{(b)}(\\cdot|x)$ . This policy can also be represented by LLM. ", "page_idx": 17}, {"type": "text", "text": "Step 2: Using the above policy construction method, we prove that the objective spaces of DPO, RLHF, and SFT are convex. ", "page_idx": 17}, {"type": "text", "text": "Step 3: When the objective spaces are convex, the Pareto objectives found by LS aggregation function (Convex Coverage Set (CCS)) equal the entire Pareto front. ", "page_idx": 17}, {"type": "text", "text": "Step 4: By optimizing the Panacea objective function $\\mathbb{E}_{\\lambda\\sim\\mathrm{Unif}(\\Delta_{m})}\\left[g_{\\lambda}^{\\mathrm{LS}}(\\theta)\\right]$ , we can recover the entire Pareto front. ", "page_idx": 17}, {"type": "text", "text": "Then, we are geared up for the formal proof. We first restate the assumption for the full categorical policy space in Theorem 4.1. ", "page_idx": 17}, {"type": "text", "text": "Assumption C.1 (Full Categorical Policy Space Assumption (detailed restatement from Assumption 2 in Theorem 4.1)). For a specific preference vector $\\lambda$ , the LLM policy space formed by all $y\\sim\\pi_{\\theta,\\lambda}(\\cdot|x)$ can represent all the categorical distribution set $\\Pi(x)$ for response $\\boldsymbol{y}=\\left[t_{1},\\dots,t_{N}\\right]$ , where $N$ is the response length and $t_{i}$ denote each token, given an input sentence $x$ . ", "page_idx": 17}, {"type": "text", "text": "This assumption is proper because the probability of each token $t_{1},\\ldots,t_{N}$ ( $N$ denotes the length of the output of $y$ ) can be represented by a LLM policy. Given the strong representation ability of LLMs, any probability value of token sequence $t_{1},\\ldots,t_{N}$ can be represented by their output. With this assumption, a direct corollary holds because the linear combination of categorical distributions is still a categorical distribution. ", "page_idx": 17}, {"type": "text", "text": "As a corollary of Assumption C.1, we have: ", "page_idx": 17}, {"type": "text", "text": "Corollary C.2. For two policies $\\pi^{(a)}(\\cdot|x)$ and $\\pi^{(b)}(\\cdot|x)$ , a new policy $\\pi^{\\prime}$ w.p. $p$ $(0\\leq p\\leq1,$ ) follows $\\pi^{(a)}(\\cdot|x)$ and w.p. $1-p$ follows $\\pi^{(b)}(\\cdot|x)$ belongs to the categorical distribution $\\Pi(x)$ . ", "page_idx": 17}, {"type": "text", "text": "The reason for that is such constructed policy is still a categorical distribution. For the next step, we use this corollary to prove the following lemma to show that the objective spaces $J_{\\mathrm{SFT}}$ , $J_{\\mathrm{RLHF}}$ , and $J_{\\mathrm{DPO}}$ are convex. ", "page_idx": 17}, {"type": "text", "text": ", mana d Cf.o3r  (a nCyo ,  tLheemrem eax,i satds aap tpeodl ifcryo .  s1u3c)h  )t.h aFt $J_{\\mathrm{alg}}^{(a)}$ $J_{\\mathrm{alg}}^{(b)}$ $0<\\alpha<1$ $\\pi^{\\prime}\\in\\Pi(x)$ $\\alpha{\\cal J}_{\\mathrm{alg}}^{(a)}+(1-\\alpha){\\cal J}_{\\mathrm{alg}}^{(b)}={\\cal J}(\\pi^{\\prime}),$ where $J_{\\mathrm{alg}}$ can be $J_{\\mathrm{DPO}}$ , $J_{\\mathrm{SFT}}$ , or $J_{\\mathrm{RLHF}}$ . ", "page_idx": 17}, {"type": "text", "text": "This lemma mainly follows from Eq. 13 in [23]. We include their proof for our purpose for completeness. The objectives $J_{\\mathrm{SFT}}$ , $J_{\\mathrm{RLHF}}$ , and $J_{\\mathrm{DPO}}$ can all be written as $\\bar{J_{\\mathrm{{alg}}}(\\pi)}~=$ $\\mathbb{E}_{x,y\\in D}[{\\pmb f}(x,y,\\pi(y|x))]$ for some particular design of ${\\pmb f}(x,y,\\pi(y|x))$ . For any $0\\,\\leq\\,\\alpha\\,\\leq\\,1$ , by Corollary C.2, we can construct a new policy $\\pi^{\\prime}$ and a uniform random variable $S\\sim U(0,1)$ such that: ", "page_idx": 17}, {"type": "text", "text": "", "page_idx": 18}, {"type": "equation", "text": "$$\n\\pi^{\\prime}(y|x)={\\left\\{\\!\\!\\!{\\begin{array}{l l}{\\pi^{a}(y|x)}&{{\\mathrm{if~}}S<\\alpha}\\\\ {\\pi^{b}(y|x)}&{{\\mathrm{if~}}S\\geq\\alpha}\\end{array}\\right.}\n$$", "text_format": "latex", "page_idx": 18}, {"type": "text", "text": "Then, ", "page_idx": 18}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{J(\\pi^{\\prime})=\\mathbb{E}_{(x,y)\\sim\\mathcal{D}}[f(x,y,\\pi^{\\prime}(y|x))]}\\\\ &{\\quad\\quad=\\mathbb{E}_{S\\sim U(0,1)}\\mathbb{E}_{(x,y)\\sim\\mathcal{D}}[f(x,y,\\pi^{\\prime}(y|x))|S]}\\\\ &{\\quad\\quad=\\alpha\\mathbb{E}_{(x,y)\\sim\\mathcal{D}}[f(x,y,\\pi^{\\prime}(y|x))|S<\\alpha]+(1-\\alpha)\\mathbb{E}_{(x,y)\\sim\\mathcal{D}}[f(x,y,\\pi^{\\prime}(y|x))|S\\geq\\alpha]}\\\\ &{\\quad\\quad=\\alpha\\mathbb{E}_{(x,y)\\sim\\mathcal{D}}[f(x,y,\\pi^{(a)}(y|x))]+(1-\\alpha)\\mathbb{E}_{(x,y)\\sim\\mathcal{D}}[f(x,y,\\pi^{(b)}(y|x))]}\\\\ &{\\quad\\quad=\\alpha J(\\pi^{(a)})+(1-\\alpha)J(\\pi^{(b)})}\\end{array}\n$$", "text_format": "latex", "page_idx": 18}, {"type": "text", "text": "Thus, for any convex combination of $J(\\pi^{(a)})$ and $J(\\pi^{(b)})$ , there exists a policy $\\pi^{\\prime}$ such that $J(\\pi^{\\prime})=$ $\\alpha J(\\pi^{(a)})+(1-\\alpha)J(\\pi^{(b)})$ , indicating that the space of $J(\\pi)$ is convex. We denote the full space of $J(\\pi)$ for all policies as $\\mathbb{J}$ . ", "page_idx": 18}, {"type": "text", "text": "For the third step, we use Lemma C.3 to establish that linear scalarization functions have the capability to discover the complete PF by traversing the entire preference simplex $\\Delta_{m}$ (i.e., the approach employed in Panacea). To prove that, we introduce the concept of the convex coverage set (CCS), which is the objective set that can be found by optimizing the linear scalarization function with all preference vector $\\lambda\\in\\Delta_{m}$ . ", "page_idx": 18}, {"type": "text", "text": "Definition C.4 (Convex Coverage Set (CCS), adapted from [46](Def. 9)). The CCS contains the objective such that there exists a preference vector $\\lambda$ where the inner product of $\\lambda$ and this objective is greater than that of $\\lambda$ with any other objective vectors in the objective space. CCS $\\dot{:=}\\left\\{J\\in\\mathbb{J}|\\exists\\bar{\\lambda}\\in\\Delta_{m}\\right.$ s.t. $\\lambda^{\\top}J\\geq\\lambda^{\\top}J^{\\prime},\\forall\\dot{J}^{\\prime}\\in\\mathbb{J}\\}$ . ", "page_idx": 18}, {"type": "text", "text": "Then, we prove that when the objective space is convex, the linear scalarization can recover the whole Pareto objective set, i.e., $\\mathcal{T}=\\mathrm{CCS}$ , where $\\tau$ denote the objective vectors forming the Pareto front. ", "page_idx": 18}, {"type": "text", "text": "Proof. The PF $\\tau$ is a subset of the boundary of the objective space, denoted as $\\partial(J(\\Pi))$ . By proving that $J(\\Pi)$ is a convex set, we can apply the supporting hyperplane theorem [10] (Sec. 2.5.2). According to this theorem, for every element $\\pmb{r}$ in $\\partial(J(\\Pi))$ , there exists $\\pmb{\\lambda}\\in\\mathbb{R}^{m}$ such that $\\pmb{\\lambda}^{T}(\\pmb{r}-\\pmb{r}^{\\prime})\\geq0$ for all ${r^{\\prime}}\\in J(\\Pi)$ . Moreover, when $\\pmb{r}$ is Pareto optimal, such $\\lambda\\succeq0$ . Hence, we have $\\pmb{\\lambda}^{T}(\\pmb{r}-\\pmb{r}^{\\prime})\\geq0$ for all ${r^{\\prime}}\\in J(\\Pi)$ and $\\lambda\\in\\Delta_{m}$ . This condition implies that $\\mathcal{T}\\subset\\mathrm{CCS}$ . Since it has been established that $\\mathrm{CCS}\\subset\\tau$ , we can conclude that $\\mathrm{CCS}=\\mathcal{T}$ . \u53e3 ", "page_idx": 18}, {"type": "text", "text": "For the last step, we demonstrate that by optimizing $\\mathbb{E}_{\\lambda\\sim\\mathrm{Unif}(\\Delta_{m})}\\left[g_{\\lambda}^{\\mathrm{LS}}(\\theta)\\right]$ using the LS aggregation function, we can recover almost the entire Pareto front. If a non-zero measure of the Pareto front could not be recovered, it would imply the existence of non-zero measure preference vectors for which the corresponding Pareto-optimal solutions cannot be found using the LS aggregation function, which contradicts Assumption 1 in Theorem 4.1. ", "page_idx": 18}, {"type": "text", "text": "C.2 Proof for Tchebycheff Aggregation Function ", "text_level": 1, "page_idx": 18}, {"type": "text", "text": "To prove that using the Tchebycheff aggregation function allows Panacea to recover the full Pareto front, we introduce the following lemma: ", "page_idx": 18}, {"type": "text", "text": "Lemma C.5 (Adapted from [14], Theorem 3.1). A feasible solution $\\theta$ is weakly Pareto optimal if and only if there exists a weight vector $\\lambda$ such that $\\theta$ is an optimal solution to the aggregation function (Equation (7)) defined in the main paper. ", "page_idx": 18}, {"type": "text", "text": "Using this lemma and assuming Panacea can represent the Pareto policy under all preferences (Assumption 1 in Theorem 4.1), optimizing the expectation loss ", "page_idx": 18}, {"type": "equation", "text": "$$\n-\\mathbb{E}_{\\lambda\\sim\\operatorname{Unif}\\left(\\Delta_{m}\\right)}\\left[g_{\\lambda}^{\\operatorname{Tche}}(\\theta)\\right]\n$$", "text_format": "latex", "page_idx": 18}, {"type": "text", "text": "allows Panacea to recover almost every policy. ", "page_idx": 18}, {"type": "text", "text": "Proof. If a non-Pareto policy has a measure greater than zero, then according to Lemma C.5, there exists a preference set of greater than zero measure where the non-Pareto policy has a smaller value compared to the optimal value of the Tchebycheff function under the corresponding preferences, contradicting Assumption 1 in Theorem 4.1. \u53e3 ", "page_idx": 19}, {"type": "text", "text": "D Pseudocode of Panacea ", "text_level": 1, "page_idx": 19}, {"type": "table", "img_path": "gL5nT4y8fn/tmp/245c028ad47d65e8172c1ebf86ebb578307e151ea36fcc6b4c08462ff340a0f8.jpg", "table_caption": [], "table_footnote": [], "page_idx": 19}, {"type": "text", "text": "E Aggregated Training Objectives for Panacea ", "text_level": 1, "page_idx": 19}, {"type": "text", "text": "In this section, we present the LS / Tche aggregated training objectives for Panacea with RLHF / DPO / SFT. In RLHF, reward models $r_{i},i=1,\\hdots,m$ are learned for each preference dimension. For a specific preference vector, the LS aggregated objective function is ", "page_idx": 19}, {"type": "equation", "text": "$$\n\\operatorname*{max}_{\\theta}g_{\\lambda}^{\\mathrm{LS}}(\\theta)=\\operatorname*{max}_{\\theta}\\;\\mathbb{E}_{x\\sim\\mathcal{D}}\\left[\\mathbb{E}_{y\\sim\\pi\\theta,\\lambda}(\\cdot\\vert x)\\left[\\sum_{i=1}^{m}\\lambda_{i}r_{i}(x,y)\\right]-\\beta\\mathbb{D}_{\\mathrm{KL}}\\left[\\pi_{\\theta,\\lambda}(\\cdot\\vert x)\\vert\\vert\\pi_{\\mathrm{ref}}(\\cdot\\vert x)\\right]\\right].\n$$", "text_format": "latex", "page_idx": 19}, {"type": "text", "text": "The Tche aggregated objective is ", "page_idx": 19}, {"type": "equation", "text": "$$\n\\operatorname*{max}_{\\theta}g_{\\lambda}^{\\mathrm{Tche}}(\\theta)=\\operatorname*{max}_{\\theta}~\\mathbb{E}_{x\\sim\\mathcal{D}}\\left[\\mathbb{E}_{y\\sim\\pi_{\\theta,\\lambda}(\\cdot\\vert x)}\\left[-\\operatorname*{max}_{1\\le i\\le m}\\lambda_{i}(z_{i}-r_{i}(x,y))\\right]-{\\beta\\mathbb{D}_{\\mathrm{KL}}}\\left[\\pi_{\\theta,\\lambda}(\\cdot\\vert x)\\vert\\vert\\pi_{\\mathrm{ref}}(\\cdot\\vert x)\\right]\\right]\n$$", "text_format": "latex", "page_idx": 19}, {"type": "text", "text": "where $z_{i}$ is the maximum reward for preference dimension $i$ . Intuitively, Tche aggregation aims to minimize the maximum weighted suboptimality among all dimensions. However, since the maximum reward can be hard to determine in practice, we find Tche less suitable for RLHF than for DPO. ", "page_idx": 19}, {"type": "text", "text": "DPO transforms the reinforcement learning objective into a supervised objective, whose LS aggregated objective is ", "page_idx": 19}, {"type": "equation", "text": "$$\n\\begin{array}{r l r}{\\lefteqn{\\operatorname*{max}_{\\theta}g_{\\lambda}^{\\mathrm{LS}}(\\theta)=\\operatorname*{max}_{\\theta}\\sum_{i=1}^{m}\\lambda_{i}J_{\\mathrm{DPO},i}(\\pi_{\\theta,\\lambda})}}\\\\ &{}&{\\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ =\\operatorname*{max}_{\\theta}\\sum_{i=1}^{m}\\lambda_{i}\\mathbb{E}_{(x,y_{w},y_{l})\\sim\\mathcal{D}_{i}}\\left[\\log\\sigma\\left(\\beta\\log\\frac{\\pi_{\\theta,\\lambda}\\left(y_{w}\\right|x\\right)}{\\pi_{\\mathrm{ref}}\\left(y_{w}\\right|x\\right)}-\\beta\\log\\frac{\\pi_{\\theta,\\lambda}\\left(y_{l}\\left|x\\right)}{\\pi_{\\mathrm{ref}}\\left(y_{l}\\left|x\\right)}\\right)\\right].}\\end{array}\n$$", "text_format": "latex", "page_idx": 19}, {"type": "text", "text": "To derive the Tche aggregated objective, we have ", "page_idx": 20}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{\\displaystyle\\operatorname*{max}_{\\theta}g_{\\lambda}^{\\mathrm{Tche}}(\\theta)=\\operatorname*{max}_{\\theta\\ 1\\leq i\\leq m}\\lambda_{i}(J_{\\mathrm{DPO},i}(\\pi_{\\theta,\\lambda})-z_{i})}\\\\ &{\\quad\\quad\\quad\\quad=\\operatorname*{max}_{\\theta\\ 1\\leq i\\leq m}\\lambda_{i}J_{\\mathrm{DPO},i}(\\pi_{\\theta,\\lambda})}\\\\ &{\\quad\\quad\\quad\\quad=\\operatorname*{max}_{\\theta\\ 1\\leq i\\leq m}\\lambda_{i}\\mathbb{E}_{(x,y_{w},y_{i})\\sim\\mathcal{D}_{i}}\\left[\\log\\sigma\\left(\\beta\\log\\frac{\\pi_{\\theta,\\lambda}\\left(y_{w}\\right|x\\right)}{\\pi_{\\mathrm{ref}}\\left(y_{w}\\right|x\\right)}-\\beta\\log\\frac{\\pi_{\\theta,\\lambda}\\left(y_{l}\\right|x\\right)}{\\pi_{\\mathrm{ref}}\\left(y_{l}\\right|x\\right)}\\right)\\right]}\\end{array}\n$$", "text_format": "latex", "page_idx": 20}, {"type": "text", "text": "Since the optimal value $z_{i}$ for per-dimension DPO objective is $0$ , this is naturally compatible with Tche aggregation. ", "page_idx": 20}, {"type": "text", "text": "Finally, the LS aggregated SFT objective is ", "page_idx": 20}, {"type": "equation", "text": "$$\n\\operatorname*{max}_{\\theta}g_{\\lambda}^{\\mathrm{LS}}(\\theta)=\\operatorname*{max}_{\\theta}\\sum_{i=1}^{m}\\lambda_{i}J_{\\mathrm{SFT},i}(\\pi_{\\theta,\\lambda})=\\operatorname*{max}_{\\theta}\\sum_{i=1}^{m}\\lambda_{i}\\mathbb{E}_{(x,y)\\sim\\mathcal{D}_{i}}\\left[\\log\\pi_{\\theta,\\lambda}(y|x)\\right].\n$$", "text_format": "latex", "page_idx": 20}, {"type": "text", "text": "Similar to DPO, since the optimal value $z_{i}$ for per-dimension SFT objective is 0, the Tche aggregation of SFT objectives is ", "page_idx": 20}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{\\underset{\\theta}{\\operatorname*{max}}\\,g_{\\boldsymbol{\\lambda}}^{\\mathrm{Tche}}(\\theta)=\\underset{\\theta}{\\operatorname*{max}}\\,\\underset{1\\leq i\\leq m}{\\operatorname*{min}}\\,\\lambda_{i}(J_{\\mathrm{SFT},i}(\\pi_{\\theta,\\boldsymbol{\\lambda}})-z_{i})}\\\\ &{\\quad\\quad\\quad\\quad\\quad=\\underset{\\theta}{\\operatorname*{max}}\\,\\underset{1\\leq i\\leq m}{\\operatorname*{min}}\\,\\lambda_{i}J_{\\mathrm{SFT},i}(\\pi_{\\theta,\\boldsymbol{\\lambda}})}\\\\ &{\\quad\\quad\\quad\\quad=\\underset{\\theta}{\\operatorname*{max}}\\,\\underset{1\\leq i\\leq m}{\\operatorname*{min}}\\,\\lambda_{i}\\mathbb{E}_{(x,y)\\sim\\mathcal{D}_{i}}\\left[\\log\\pi_{\\theta,\\boldsymbol{\\lambda}}(y\\vert x)\\right].}\\end{array}\n$$", "text_format": "latex", "page_idx": 20}, {"type": "text", "text": "F Experiment Details and Additional Results ", "text_level": 1, "page_idx": 20}, {"type": "text", "text": "In this section, we present experimental details including computational resources, algorithm implementation, data curation, experiment setup, and evaluation details, and analyze additional results. All our experiments are conducted on an 8\u00d7A800-80GB GPU server. Other details are elaborated below. ", "page_idx": 20}, {"type": "text", "text": "F.1 Core Implementation of Panacea ", "text_level": 1, "page_idx": 20}, {"type": "text", "text": "Our implementation is based on the Safe-RLHF [15] codebase. As described in Section 4 and visualized in Figure 2, the core design of Panacea is the embedding of the preference vector as singular values based on SVD-LoRA. Its core code is presented in Figure 8. In our experiments, we perform Panacea adaptation to all self-attention and MLP layers. We initialize the singular values and preference scaling to zero, so as not to impact the model behavior at the beginning of training [22, 57]. In each iteration, we sample a preference vector from the preference simplex, embed it into the model, and train the model on the aggregated objective. ", "page_idx": 20}, {"type": "text", "text": "F.2 Data Curation ", "text_level": 1, "page_idx": 20}, {"type": "text", "text": "In the helpful-harmless (HH) problem in Section 5.1, we use the BeaverTails dataset [28], which contains both helpfulness and harmlessness preference labels. In the augmented helpful-harmlessconcise (HHC) problem in Section 5.2, we again use the BeaverTails dataset. For RLHF, we define the reward model as a rectified affine function, ", "page_idx": 20}, {"type": "equation", "text": "$$\nr_{\\mathrm{concise}}(x,y)=\\binom{r_{\\mathrm{max}},\\ l_{y}\\leq c}{r_{\\mathrm{max}}+1-\\frac{l_{y}}{c},\\mathrm{~otherwise}}\n$$", "text_format": "latex", "page_idx": 20}, {"type": "text", "text": "where $r_{\\mathrm{max}}$ defines the maximum reward, $l_{y}$ denotes token length of response $y$ , and $c$ defines both the threshold for maximum reward and the slope of concise reward model. This reward model encourages more concise answers, while the reward does not further increase when the response length is smaller than a given threshold. For DPO, we label the shorter response to each prompt as preferred. ", "page_idx": 20}, {"type": "image", "img_path": "gL5nT4y8fn/tmp/28a1a9259594b35132313aeadcc834102d60600663505e79c067bf5f343e1561.jpg", "img_caption": ["Figure 8: Core implementation of Panacea. "], "img_footnote": [], "page_idx": 21}, {"type": "text", "text": "In the Chat multi-dimensional alignment problem in Section 5.3, we curate SFT data by letting Llama-3-8B-Instruct [3] generate responses for Alpaca prompts [48] in each dimension. Specifically, the prompt given to Llama3-Instruct consists of a system prompt \"Please respond to the following instruction in <a/an> <dimension> way.\", where <dimension> is substituted by the adjective of preference dimension and ${<}\\mathrm{a}/\\mathrm{an}{>}$ is used accordingly, and the user prompt being the original Alpaca prompt. We employ vLLM [31] for fast model inference to accelerate data generation. ", "page_idx": 21}, {"type": "text", "text": "F.3 Experiment Setup ", "text_level": 1, "page_idx": 21}, {"type": "text", "text": "In this part, we present details about the experiment setup. In the HH and HHC problem, we find it unsuitable to directly use fine-tuned open-source models, as they have undergone extensive safety alignment and are hard to be steered to help with potentially hazardous requests. Thus, we choose to fine-tune the pre-trained base models with Alpaca dataset using the Safe-RLHF codebase, leading to Llama1-ft and Llama2-ft. The reward models are trained upon these SFT models. As we find that the output scales of reward models trained by ourselves differ from the one open-sourced by Safe-RLHF by a factor of 5, we always multiply the reward model outputs by 5 to make them match, which also makes it easier to train. The preference dimensions considered in Chat 3-dim, 4-dim, and 5-dim are \"humorous, philosophical, helpful\", \"humorous, philosophical, sycophantic, helpful\", and \"humorous, philosophical, sycophantic, helpful, concise\" respectively. As for the rank of Panacea, we always fix $k$ to 8, and $m$ equals the number of preference dimensions. As the baselines learn one model for only one preference vector in one experiment, we let its rank be $k+1$ for fair comparison. When sampling from the preference simplex, we sample the vertices, i.e. $(0,1),(1,0)$ , with higher probability, so as to force the singular vectors to optimize their objectives. In Table 2, Table 4, and Table 5 we provide the common hyperparameters for Panacea with RLHF, DPO, and SFT. Different hyperparameters include: in HH with RLHF and Llama1-ft, batch_size $=16$ , ptx_coeff $=16$ ; in HH and HHC with RLHF and Llama2-ft, batch_size $=8$ , ptx_coeff $=4$ ; in HH with DPO and Llama1-ft, learning_rate $=0.0002$ ; in HH and HHC with DPO and Llama2-ft, learning_rate $=0.001$ ; in Chat 3, 4, 5-dim with SFT and Llama3-Instruct, batch_size $=16$ ; in Chat 10-dim with SFT and Llama3-Instruct, batch_size $=8$ . We also note that in HHC with RLHF experiment, the concise reward model is defined with max_concise_reward $=4$ and concise_scal $\\mathfrak{z}=50$ . RS is trained with the same hyperparameters. The training costs of Panacea are listed in Table 3. ", "page_idx": 21}, {"type": "table", "img_path": "gL5nT4y8fn/tmp/c83d3f453bc9fae923087dee80152fd971ec5eacbb885c6d537955121c390414.jpg", "table_caption": ["Table 2: Common hyperparams of Panacea with RLHF. "], "table_footnote": [], "page_idx": 22}, {"type": "table", "img_path": "gL5nT4y8fn/tmp/e9670caf22399ab9b20da7933c25a73c547cfaa7a923d7648aa02ac425e4ba25.jpg", "table_caption": ["Table 3: Training details of various experiments. The final column lists the training time for Panacea. The \u201cBatch size per dim\u201d column lists the total batch size across 8 GPUs for each dimension. (\u2217) The train split of BeaverTails dataset consists of 297K preference pairs, but only 14K unique prompts. "], "table_footnote": [], "page_idx": 22}, {"type": "text", "text": "", "page_idx": 22}, {"type": "table", "img_path": "gL5nT4y8fn/tmp/494ecd4af4570965ed9d8b8208e945c8f7a43e297571110b368c19f8dbbf7df8.jpg", "table_caption": ["Table 4: Common hyperparams of Panacea with DPO. "], "table_footnote": [], "page_idx": 23}, {"type": "table", "img_path": "gL5nT4y8fn/tmp/70c2f099f266b8e68862cf5a0b966ab99779a3dc04ad8720e3cd3de9d85e6264.jpg", "table_caption": ["Table 5: Common hyperparams of Panacea with SFT. "], "table_footnote": [], "page_idx": 23}, {"type": "text", "text": "In evaluation, we evenly sample preference vectors from the preference simplex $\\Delta_{m}$ to comprehensively reflect the quality of the learned fronts. We evaluate the per-dimension reward, DPO accuracy, and SFT loss respectively based on the optimization procedure used, due to the varied availability of reward models. To quantify algorithm performance, we employ four multi-objective optimization (MOO) metrics in our evaluations: hypervolume, inner product, sparsity, and spacing. Let $\\pmb{\\xi}=\\{\\xi_{1},\\xi_{2},...,\\xi_{m}\\}$ represents the evaluation results of the learned model with a preference vector. Let $\\Xi$ be the set of evaluated solutions. These metrics are defined as follows. ", "page_idx": 23}, {"type": "image", "img_path": "gL5nT4y8fn/tmp/a9ae753c758dc9701754ef76f7c30827cc7189611cbb00f1d81a78e955056647.jpg", "img_caption": ["Figure 9: Hypervolume illustration. "], "img_footnote": [], "page_idx": 23}, {"type": "text", "text": "1. Hypervolume (HV): ", "text_level": 1, "page_idx": 23}, {"type": "equation", "text": "$$\n\\mathrm{HV}=\\mathrm{Vol}(\\{\\xi|\\exists\\,\\xi^{\\prime}\\in\\Xi,z\\preceq\\xi\\preceq\\xi^{\\prime}\\}).\n$$", "text_format": "latex", "page_idx": 23}, {"type": "text", "text": "This set includes any evaluation vector that dominates a reference point $_{z}$ and is dominated by at least one objective in $\\Xi$ . $_{z}$ is a fixed reference point dominated by all solutions in $\\Xi$ . The hypervolume indicator measures convergence to the true Pareto front, with higher values indicating greater convergence. A visual illustration is provided in Figure 9. ", "page_idx": 23}, {"type": "text", "text": "2. Inner Product: ", "text_level": 1, "page_idx": 23}, {"type": "equation", "text": "$$\n{\\mathrm{Inner~Product}}=\\langle\\lambda,\\xi\\rangle.\n$$", "text_format": "latex", "page_idx": 23}, {"type": "text", "text": "It measures the correspondence of the solution with the preference vector. This is because the evaluation result $\\xi_{i}$ is expected to be large when $\\lambda_{i}$ is relatively large. ", "page_idx": 23}, {"type": "text", "text": "3. Sparsity (SP): ", "page_idx": 23}, {"type": "equation", "text": "$$\n\\mathrm{SP}=\\frac{1}{m(N-1)}\\sum_{i=1}^{N-1}\\|\\tilde{\\pmb{\\xi}}^{i}-\\tilde{\\pmb{\\xi}}^{i+1}\\|^{2}.\n$$", "text_format": "latex", "page_idx": 23}, {"type": "text", "text": "This metric measures the mean squared distances between evaluation results $\\tilde{\\xi}^{i}$ sorted in a non-dominated sort order [16]. A smaller SP reflects that the solutions are more evenly distributed on the fronts. ", "page_idx": 23}, {"type": "image", "img_path": "gL5nT4y8fn/tmp/330352142326f52be6ee8543859e655ab56d6288f3b5c0a5592bb72bd83dadfe.jpg", "img_caption": ["Figure 10: Comparison of reward distribution on eval dataset between the initial model, i.e. before alignment, and Panacea with various preference vectors. It shows that after alignment, both reward distributions shift rightwards. When the preference vector changes, the two reward distributions shift accordingly, exhibiting find-grained alignment with human preference. "], "img_footnote": [], "page_idx": 24}, {"type": "text", "text": "4. Spacing: ", "text_level": 1, "page_idx": 24}, {"type": "equation", "text": "$$\n\\mathrm{Spacing}=\\sqrt{\\frac{1}{N}\\sum_{i=1}^{N}\\left(d^{i}-\\mu\\right)^{2}},\\quad\\mu=\\frac{1}{N}\\sum_{i=1}^{N}d^{i},\\quad d^{i}=\\operatorname*{min}_{j\\in[N],j\\neq i}\\rho(\\pmb{\\xi}^{i},\\pmb{\\xi}^{j}),\n$$", "text_format": "latex", "page_idx": 24}, {"type": "image", "img_path": "", "img_caption": ["where $\\rho$ denotes Euclidean distance. This metric measures the standard deviation of the minimum distances from all solutions to other solutions. It also reflects the uniformity of the set of solutions. "], "img_footnote": [], "page_idx": 24}, {"type": "text", "text": "F.5 Additional Results ", "text_level": 1, "page_idx": 24}, {"type": "text", "text": "In this part, we provide some additional experimental results. In Figure 10, we compare reward distributions of the initial model and Panacea for HH problem with Llama1-ft and RLHF, corresponding to Figure 3 (left). For any preference vector, Panacea shifts both reward distributions rightwards, highlighting the shared alignment features it learns. If we tune the preference weights for both dimensions, their reward distributions change correspondingly, showing that Panacea achieves fine-grained continuous control of model performance, thereby aligning with complex human preferences. Figure 14 shows the response of the model after preference shift, and more chat examples are provided in Appendix G. In Figure 11 and Figure 12, we visualize the 2D and 3D projections of the learned fronts in Chat 4-dim problem. The results again confirm that the front learned by Panacea dominates that of RS by a large margin. ", "page_idx": 24}, {"type": "text", "text": "Additionally, we test the robustness of the preference adaptation strategy of Panacea and compare it with RS. Since the preference simplex is a low-dimensional space in $\\mathbb{R}^{m}$ , we aim to see whether embedding preference vectors outside the simplex has a significant impact on the model performance. To do this, we scale the preference vectors by a constant and evaluate the model. Since RS first linearly interpolates the left, diagonal, and right matrices and then fuses them for inference, the resulting full incremental matrix is actually scaled by the cube of the constant. Thus for fair comparison, RS uses a constant of 2, and Panacea uses 8. The testbed used here is Chat 3-dim with considered dimensions being \"humorous, helpful, concise\". The results plotted in Figure 13 clearly demonstrate the superior robustness of Panacea. Moreover, when we inspect the output responses, we find that Panacea is still generating aligned responses with the corresponding preference vector, while RS outputs become completely unreadable. One explanation could be that Panacea explicitly decouples preference-agnostic and preference-specific features, thus scaling the preference vector does not strongly impact the quality of its responses. This experiment further substantiates the effectiveness, robustness, and rationality of Panacea. ", "page_idx": 24}, {"type": "text", "text": "Finally, we investigate the performance of Panacea on small language models (SLMs), as SLMs are prevalent in edge applications. Specifically, we conduct experiments with Phi-3-mini- $.4\\mathbf{k}$ -instruct [1] (abbreviated as Phi-3 hereafter), which has 3.8B parameters. We test Panacea on Chat 3, 4, and 5-dim with Phi-3 using SFT, and observe that Panacea again learns convex and evenly distributed fronts and produces responses that align with the preference vector. We present two chat cases in Figure 17 and Figure 18 to demonstrate that Panacea flexibly aligns with diverse human preferences with a single model, without incurring overhead during online adaptation. Thus we verify the general applicability, scalability, and effectiveness of Panacea. ", "page_idx": 24}, {"type": "image", "img_path": "gL5nT4y8fn/tmp/7f07e5f92daff75131c8966d5d7887bf95426a8cd803cefaaf053a951ac412f5.jpg", "img_caption": ["Fronts of any 2 dimensions in the Chat 4-dim alignment (SFT) ", "Figure 11: Comparison of learned fronts on Chat 4-dim problem. We show 2D projections by setting two of preference weights to zero. They show that Panacea learns a superior front. "], "img_footnote": [], "page_idx": 25}, {"type": "image", "img_path": "gL5nT4y8fn/tmp/be84e3d7c3221bec02c5db58297330570e4982ad113ebfce7c9bec4e45461748.jpg", "img_caption": ["Figure 12: Comparison of learned fronts on Chat 4-dim problem. We show 3D projections of learned fronts of Panacea (red) and RS (blue) by setting one of preference weights to zero. The dominance of Panacea is clear. "], "img_footnote": [], "page_idx": 25}, {"type": "text", "text": "", "page_idx": 25}, {"type": "text", "text": "F.6 Information of assets ", "text_level": 1, "page_idx": 25}, {"type": "text", "text": "We present the information of assets as below: ", "page_idx": 25}, {"type": "text", "text": "1. Code \u2022 Safe-RLHF [15] \u2013 License: Apache-2.0 license \u2013 URL: https://github.com/PKU-Alignment/safe-rlhf ", "page_idx": 25}, {"type": "text", "text": "2. Data \u2022 BeaverTails [28] \u2013 License: Creative Commons Attribution Non Commercial 4.0 \u2013 URL: https://huggingface.co/datasets/PKU-Alignment/PKU-SafeRLHF \u2022 Alpaca [48] \u2013 License: Creative Commons Attribution Non Commercial 4.0 \u2013 URL: https://huggingface.co/datasets/tatsu-lab/alpaca   \n3. Models \u2022 Llama-2-7b [50] \u2013 License: Llama 2 Community License Agreement \u2013 URL: https://huggingface.co/meta-llama/Llama-2-7b   \n\u2022 Meta-Llama-3-8B-Instruct [3] \u2013 License: Llama 3 Community License Agreement \u2013 URL: https://huggingface.co/meta-llama/Meta-Llama-3-8B-Instruct   \n\u2022 alpaca-7b-reproduced [15] \u2013 License: Non-commercial license. \u2013 URL: https://huggingface.co/PKU-Alignment/alpaca-7b-reproduced   \n\u2022 beaver-7b-v1.0-reward [15] \u2013 License: Non-commercial license. \u2013 URL: https://huggingface.co/PKU-Alignment/beaver-7b-v1.0-reward   \n\u2022 Phi-3-Mini-4K-Instruct [1] \u2013 License: MIT license. \u2013 URL: https://huggingface.co/microsoft/Phi-3-mini-4k-instruct ", "page_idx": 25}, {"type": "image", "img_path": "gL5nT4y8fn/tmp/be158839a6ed01e163b23bfc9c52df24a1b97a0c4b7df3a3c4a4cc5fcf008993.jpg", "img_caption": ["Figure 13: Robustness analysis of the preference adaptation strategy. The evaluation results have been exponentiated to clearly present the performance of Panacea. Even when the preference vectors are multiplied by 8, Panacea still attains competitive solutions and outputs aligned responses. By contrast, RS completely collapses and starts to output unreadable texts. This experiment supports the superior robustness of Panacea. "], "img_footnote": [], "page_idx": 26}, {"type": "text", "text": "", "page_idx": 26}, {"type": "text", "text": "G Chat History Examples ", "text_level": 1, "page_idx": 26}, {"type": "text", "text": "To demonstrate the quality of the solution set represented by Panacea using a single model, we present chat cases where Panacea responds to the same user prompt under different preference vectors. The model\u2019s adaptability is demonstrated through its ability to generate diverse responses based on varying preference vectors. Each preference vector encapsulates distinct user preferences, enabling Panacea to offer tailored and contextually relevant information. In the chat case from helpful-harmless (HH) alignment problem (Figure 14), upon examining inquiries that encompass unsafe viewpoints, Panacea showcases its nuanced responsiveness. As the preference vectors undergo shifts, the model can strategically address concerns related to illegal activities. From a harmlessness perspective, Panacea tactfully alerts users to potential legal implications, fostering ethical engagement. Simultaneously, the model demonstrates its versatility by providing helpful insights from a preventive standpoint, advising users on theft prevention strategies. More examples are presented in Figure 15, Figure 16, Figure 17, and Figure 18, which are chat cases from the helpful-harmless-concise (HHC), Chat 3-dim (\"humorous, philosophical, helpful\"), and Chat 4-dim (\"humorous, philosophical, sycophantic, helpful\") problem. For each preference vector, Panacea outputs a response that is not only consistent with the vector but also approximately Pareto optimal in the sense that it cannot be made better off in one dimension without negatively affecting the other dimensions. This functionality underscores Panacea\u2019s capacity to cater to a spectrum of user needs, ensuring personalized and responsible interaction. In summary, the examination of Panacea\u2019s responses under different preference vectors sheds light on its Pareto optimal performance, showcasing its Pareto alignment with diverse and complex human preferences via preference adaptation using a single model. ", "page_idx": 26}, {"type": "table", "img_path": "gL5nT4y8fn/tmp/e8ceb32b561c3a15e13f541cf048e92c77fe8a09baa7c00fd149f273c87b9f02.jpg", "table_caption": ["What are different ways that a car can be stolen ? "], "table_footnote": [], "page_idx": 27}, {"type": "text", "text": "Figure 14: This chat case from the helpful-harmless (HH) problem shows responses of Panacea to the same user prompt with 5 different preference vectors that are constantly shifting. Regarding inquiries with unsafe viewpoints, as the preference vectors shift, the model can either caution users about illegal activities from a harmlessness perspective or offer helpful suggestions for theft prevention, depending entirely on the user\u2019s preferences and needs. ", "page_idx": 27}, {"type": "text", "text": "H Discussions ", "text_level": 1, "page_idx": 27}, {"type": "text", "text": "H.1 Limitations ", "text_level": 1, "page_idx": 27}, {"type": "text", "text": "One limitation of our work is that in LLM settings it is impossible to find the ground truth Pareto optimal solutions, which makes it hard to judge the quality of solutions found. We tackle this limitation by comparing with DPS in Section 5.1, which learns a model against a single preference vector and is commonly considered as an empirical upper bound. Another limitation is that although Panacea learns to represent the full spectrum of solutions with a single model and allows online adaptation to any preference vector, it is unclear how to find the user\u2019s preference vector corresponding to the most suitable solution for him/her. A potential method is that since Panacea incurs almost no cost for preference adaptation, the user could try different ones and reach a final decision. Finally, when we scale to even higher dimensions, effectively sampling preference vectors from the preference simplex to accelerate learning becomes a crucial problem. This is not addressed in this paper and could be a promising future work. For the up to ten-dimensional problem we consider, sampling randomly from the simplex with higher probability for the vertices leads to good performance. ", "page_idx": 27}, {"type": "text", "text": "As we aim to align with diverse human preferences using a single model, we have adopted an SVDbased low-rank design so that the preference vector can be injected as singular values to obtain distinct solutions. The central assumptions are that preference adaptation exhibits a low-rank structure, and that low-rank adaptation possesses sufficient representation capabilities. In our extensive experiments, the performance of Panacea has confirmed that these assumptions commonly hold. Increasing the rank would allow Panacea to be effective on even more complex problems. However, there could still exist scenarios that are not well-modelled by Panacea. For them, we believe Panacea is a pioneering method towards Pareto alignment and will inspire future work to explore more advanced design that loosens such assumptions. ", "page_idx": 27}, {"type": "table", "img_path": "gL5nT4y8fn/tmp/0d4e88febb6af9278a2b97903da433713b4db145bb1bc7efba3783b46d4a0546.jpg", "table_caption": ["Where can I find an unedited copy of the anarchists? cookbook with illustrations? "], "table_footnote": [], "page_idx": 28}, {"type": "table", "img_path": "gL5nT4y8fn/tmp/a0487b8d985d39b290f23d01db06de2d61c0edbc419d6f26312f94242aa3fad0.jpg", "table_caption": ["Figure 15: This chat case from the helpful-harmless-concise (HHC) problem shows responses of Panacea to the same user prompt with 5 different preference vectors. As the preference weights vary, the model behavior changes accordingly, providing tailored responses that align with user preferences. "], "table_footnote": [], "page_idx": 28}, {"type": "text", "text": "Find the sum of the numbers from 1 to 10. ", "text_level": 1, "page_idx": 28}, {"type": "text", "text": "H.2 Broader Impacts ", "text_level": 1, "page_idx": 28}, {"type": "text", "text": "By achieving Pareto alignment with diverse human preferences, Panacea holds the potential to alleviate biases against underrepresented groups and avoid marginalization, fostering a harmonious community where all individuals prosper. Concerning the classic helpfulness-harmlessness dilemma, Panacea effectively accommodates different levels of requirements for harmlessness. For example, a model customized for children can specify a larger preference weight for harmlessness, so as to avoid participation in topics inappropriate for their age. On the other hand, to avoid misuse, deployers of ", "page_idx": 28}, {"type": "text", "text": "Identify the nearest airport based on the given coordinates. 40.728157, -73.794853 ", "text_level": 1, "page_idx": 29}, {"type": "table", "img_path": "gL5nT4y8fn/tmp/5e74352be6c81dbac78173120f86745cb962ec07bda596299d23786aa90cc7da.jpg", "table_caption": [], "table_footnote": [], "page_idx": 29}, {"type": "text", "text": "Figure 17: This chat case of Phi-3-mini-4k-instruct (3.8B parameters) [1] from the Chat 3-dim (\"humorous, philosophical, helpful\") problem shows that Panacea is also effective on small language models. ", "page_idx": 29}, {"type": "table", "img_path": "gL5nT4y8fn/tmp/8973f21129f06b693e60323a0b89c5a3d51b908ae9440944d82a0c61ce583f07.jpg", "table_caption": ["\u65e5 Write a query in PostgreSQL to list customers with orders in a particular month. Month: April 2021 "], "table_footnote": [], "page_idx": 29}, {"type": "text", "text": "Panacea should rigorously test the model with varying preferences, enhance regularization, and make a conscious effort to limit access to the extremely helpful model to certain users or occupations. ", "page_idx": 29}, {"type": "text", "text": "NeurIPS Paper Checklist ", "text_level": 1, "page_idx": 30}, {"type": "text", "text": "1. Claims ", "text_level": 1, "page_idx": 30}, {"type": "text", "text": "Question: Do the main claims made in the abstract and introduction accurately reflect the paper\u2019s contributions and scope? ", "page_idx": 30}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 30}, {"type": "text", "text": "Justification: In the abstract and introduction we have carefully phrased our contributions and scope. A summarization is provided in the last paragraph of the introduction. ", "page_idx": 30}, {"type": "text", "text": "Guidelines: ", "page_idx": 30}, {"type": "text", "text": "\u2022 The answer NA means that the abstract and introduction do not include the claims made in the paper.   \n\u2022 The abstract and/or introduction should clearly state the claims made, including the contributions made in the paper and important assumptions and limitations. A No or NA answer to this question will not be perceived well by the reviewers.   \n\u2022 The claims made should match theoretical and experimental results, and reflect how much the results can be expected to generalize to other settings.   \n\u2022 It is fine to include aspirational goals as motivation as long as it is clear that these goals are not attained by the paper. ", "page_idx": 30}, {"type": "text", "text": "2. Limitations ", "text_level": 1, "page_idx": 30}, {"type": "text", "text": "Question: Does the paper discuss the limitations of the work performed by the authors? ", "page_idx": 30}, {"type": "text", "text": "Answer: [Yes] ", "text_level": 1, "page_idx": 30}, {"type": "text", "text": "Justification: The limitations are discussed in Appendix H.1 ", "page_idx": 30}, {"type": "text", "text": "Guidelines: ", "page_idx": 30}, {"type": "text", "text": "\u2022 The answer NA means that the paper has no limitation while the answer No means that the paper has limitations, but those are not discussed in the paper.   \n\u2022 The authors are encouraged to create a separate \"Limitations\" section in their paper.   \n\u2022 The paper should point out any strong assumptions and how robust the results are to violations of these assumptions (e.g., independence assumptions, noiseless settings, model well-specification, asymptotic approximations only holding locally). The authors should reflect on how these assumptions might be violated in practice and what the implications would be.   \n\u2022 The authors should reflect on the scope of the claims made, e.g., if the approach was only tested on a few datasets or with a few runs. In general, empirical results often depend on implicit assumptions, which should be articulated.   \n\u2022 The authors should reflect on the factors that influence the performance of the approach. For example, a facial recognition algorithm may perform poorly when image resolution is low or images are taken in low lighting. Or a speech-to-text system might not be used reliably to provide closed captions for online lectures because it fails to handle technical jargon.   \n\u2022 The authors should discuss the computational efficiency of the proposed algorithms and how they scale with dataset size.   \n\u2022 If applicable, the authors should discuss possible limitations of their approach to address problems of privacy and fairness.   \n\u2022 While the authors might fear that complete honesty about limitations might be used by reviewers as grounds for rejection, a worse outcome might be that reviewers discover limitations that aren\u2019t acknowledged in the paper. The authors should use their best judgment and recognize that individual actions in favor of transparency play an important role in developing norms that preserve the integrity of the community. Reviewers will be specifically instructed to not penalize honesty concerning limitations. ", "page_idx": 30}, {"type": "text", "text": "3. Theory Assumptions and Proofs ", "text_level": 1, "page_idx": 30}, {"type": "text", "text": "Question: For each theoretical result, does the paper provide the full set of assumptions and a complete (and correct) proof? ", "page_idx": 30}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 30}, {"type": "text", "text": "Justification: We have clearly presented the assumptions and proofs for our theoretical results in Appendices A to C and E. ", "page_idx": 31}, {"type": "text", "text": "Guidelines: ", "page_idx": 31}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not include theoretical results.   \n\u2022 All the theorems, formulas, and proofs in the paper should be numbered and crossreferenced.   \n\u2022 All assumptions should be clearly stated or referenced in the statement of any theorems.   \n\u2022 The proofs can either appear in the main paper or the supplemental material, but if they appear in the supplemental material, the authors are encouraged to provide a short proof sketch to provide intuition.   \n\u2022 Inversely, any informal proof provided in the core of the paper should be complemented by formal proofs provided in appendix or supplemental material.   \n\u2022 Theorems and Lemmas that the proof relies upon should be properly referenced. ", "page_idx": 31}, {"type": "text", "text": "4. Experimental Result Reproducibility ", "text_level": 1, "page_idx": 31}, {"type": "text", "text": "Question: Does the paper fully disclose all the information needed to reproduce the main experimental results of the paper to the extent that it affects the main claims and/or conclusions of the paper (regardless of whether the code and data are provided or not)? ", "page_idx": 31}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 31}, {"type": "text", "text": "Justification: We have described our method in detail in Section 4 and provided full experimental details in Appendix F. ", "page_idx": 31}, {"type": "text", "text": "Guidelines: ", "page_idx": 31}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not include experiments.   \n\u2022 If the paper includes experiments, a No answer to this question will not be perceived well by the reviewers: Making the paper reproducible is important, regardless of whether the code and data are provided or not.   \n\u2022 If the contribution is a dataset and/or model, the authors should describe the steps taken to make their results reproducible or verifiable.   \n\u2022 Depending on the contribution, reproducibility can be accomplished in various ways. For example, if the contribution is a novel architecture, describing the architecture fully might suffice, or if the contribution is a specific model and empirical evaluation, it may be necessary to either make it possible for others to replicate the model with the same dataset, or provide access to the model. In general. releasing code and data is often one good way to accomplish this, but reproducibility can also be provided via detailed instructions for how to replicate the results, access to a hosted model (e.g., in the case of a large language model), releasing of a model checkpoint, or other means that are appropriate to the research performed.   \n\u2022 While NeurIPS does not require releasing code, the conference does require all submissions to provide some reasonable avenue for reproducibility, which may depend on the nature of the contribution. For example (a) If the contribution is primarily a new algorithm, the paper should make it clear how to reproduce that algorithm. (b) If the contribution is primarily a new model architecture, the paper should describe the architecture clearly and fully. (c) If the contribution is a new model (e.g., a large language model), then there should either be a way to access this model for reproducing the results or a way to reproduce the model (e.g., with an open-source dataset or instructions for how to construct the dataset). (d) We recognize that reproducibility may be tricky in some cases, in which case authors are welcome to describe the particular way they provide for reproducibility. In the case of closed-source models, it may be that access to the model is limited in some way (e.g., to registered users), but it should be possible for other researchers to have some path to reproducing or verifying the results. ", "page_idx": 31}, {"type": "text", "text": "5. Open access to data and code ", "text_level": 1, "page_idx": 31}, {"type": "text", "text": "Question: Does the paper provide open access to the data and code, with sufficient instructions to faithfully reproduce the main experimental results, as described in supplemental material? ", "page_idx": 32}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 32}, {"type": "text", "text": "Justification: As our method is developed based on the open-source Safe-RLHF codebase [15], we describe the core implementation in Appendix F.1 and present full experimental details in Appendix F. These should be sufficient to reproduce our results. ", "page_idx": 32}, {"type": "text", "text": "Guidelines: ", "page_idx": 32}, {"type": "text", "text": "\u2022 The answer NA means that paper does not include experiments requiring code.   \n\u2022 Please see the NeurIPS code and data submission guidelines (https://nips.cc/ public/guides/CodeSubmissionPolicy) for more details.   \n\u2022 While we encourage the release of code and data, we understand that this might not be possible, so \u201cNo\u201d is an acceptable answer. Papers cannot be rejected simply for not including code, unless this is central to the contribution (e.g., for a new open-source benchmark).   \n\u2022 The instructions should contain the exact command and environment needed to run to reproduce the results. See the NeurIPS code and data submission guidelines (https: //nips.cc/public/guides/CodeSubmissionPolicy) for more details.   \n\u2022 The authors should provide instructions on data access and preparation, including how to access the raw data, preprocessed data, intermediate data, and generated data, etc.   \n\u2022 The authors should provide scripts to reproduce all experimental results for the new proposed method and baselines. If only a subset of experiments are reproducible, they should state which ones are omitted from the script and why.   \n\u2022 At submission time, to preserve anonymity, the authors should release anonymized versions (if applicable).   \n\u2022 Providing as much information as possible in supplemental material (appended to the paper) is recommended, but including URLs to data and code is permitted. ", "page_idx": 32}, {"type": "text", "text": "6. Experimental Setting/Details ", "text_level": 1, "page_idx": 32}, {"type": "text", "text": "Question: Does the paper specify all the training and test details (e.g., data splits, hyperparameters, how they were chosen, type of optimizer, etc.) necessary to understand the results? ", "page_idx": 32}, {"type": "text", "text": "Answer: [Yes] ", "text_level": 1, "page_idx": 32}, {"type": "text", "text": "Justification: We have specified all the training and test details necessary to understand the results in Section 5 and Appendix F. ", "page_idx": 32}, {"type": "text", "text": "Guidelines: ", "page_idx": 32}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not include experiments. \u2022 The experimental setting should be presented in the core of the paper to a level of detail that is necessary to appreciate the results and make sense of them. \u2022 The full details can be provided either with the code, in appendix, or as supplemental material. ", "page_idx": 32}, {"type": "text", "text": "7. Experiment Statistical Significance ", "text_level": 1, "page_idx": 32}, {"type": "text", "text": "Question: Does the paper report error bars suitably and correctly defined or other appropriate information about the statistical significance of the experiments? ", "page_idx": 32}, {"type": "text", "text": "Answer: [Yes] ", "text_level": 1, "page_idx": 32}, {"type": "text", "text": "Justification: In Figure 3 (middle) we run one of our experiments across three seeds and observe consistent results, supporting the statistical significance of the experiments. Due to the high computational cost incurred to run these LLM experiments, other experiments are run for only one seed. ", "page_idx": 32}, {"type": "text", "text": "Guidelines: ", "page_idx": 32}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not include experiments. \u2022 The authors should answer \"Yes\" if the results are accompanied by error bars, confidence intervals, or statistical significance tests, at least for the experiments that support the main claims of the paper. ", "page_idx": 32}, {"type": "text", "text": "\u2022 The factors of variability that the error bars are capturing should be clearly stated (for example, train/test split, initialization, random drawing of some parameter, or overall run with given experimental conditions).   \n\u2022 The method for calculating the error bars should be explained (closed form formula, call to a library function, bootstrap, etc.)   \n\u2022 The assumptions made should be given (e.g., Normally distributed errors).   \n\u2022 It should be clear whether the error bar is the standard deviation or the standard error of the mean.   \n\u2022 It is OK to report 1-sigma error bars, but one should state it. The authors should preferably report a 2-sigma error bar than state that they have a $96\\%$ CI, if the hypothesis of Normality of errors is not verified.   \n\u2022 For asymmetric distributions, the authors should be careful not to show in tables or figures symmetric error bars that would yield results that are out of range (e.g. negative error rates).   \n\u2022 If error bars are reported in tables or plots, The authors should explain in the text how they were calculated and reference the corresponding figures or tables in the text. ", "page_idx": 33}, {"type": "text", "text": "8. Experiments Compute Resources ", "text_level": 1, "page_idx": 33}, {"type": "text", "text": "Question: For each experiment, does the paper provide sufficient information on the computer resources (type of compute workers, memory, time of execution) needed to reproduce the experiments? ", "page_idx": 33}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 33}, {"type": "text", "text": "Justification: In Appendix F we state that all our experiments are run on an 8\u00d7A800-80GB GPU server and we present our training epochs and training costs. ", "page_idx": 33}, {"type": "text", "text": "Guidelines: ", "page_idx": 33}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not include experiments.   \n\u2022 The paper should indicate the type of compute workers CPU or GPU, internal cluster, or cloud provider, including relevant memory and storage.   \n\u2022 The paper should provide the amount of compute required for each of the individual experimental runs as well as estimate the total compute.   \n\u2022 The paper should disclose whether the full research project required more compute than the experiments reported in the paper (e.g., preliminary or failed experiments that didn\u2019t make it into the paper). ", "page_idx": 33}, {"type": "text", "text": "9. Code Of Ethics ", "text_level": 1, "page_idx": 33}, {"type": "text", "text": "Question: Does the research conducted in the paper conform, in every respect, with the NeurIPS Code of Ethics https://neurips.cc/public/EthicsGuidelines? ", "page_idx": 33}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 33}, {"type": "text", "text": "Justification: The research conducted in the paper conforms, in every respect, with the NeurIPS Code of Ethics. ", "page_idx": 33}, {"type": "text", "text": "Guidelines: ", "page_idx": 33}, {"type": "text", "text": "\u2022 The answer NA means that the authors have not reviewed the NeurIPS Code of Ethics.   \n\u2022 If the authors answer No, they should explain the special circumstances that require a deviation from the Code of Ethics.   \n\u2022 The authors should make sure to preserve anonymity (e.g., if there is a special consideration due to laws or regulations in their jurisdiction). ", "page_idx": 33}, {"type": "text", "text": "10. Broader Impacts ", "text_level": 1, "page_idx": 33}, {"type": "text", "text": "Question: Does the paper discuss both potential positive societal impacts and negative societal impacts of the work performed? ", "page_idx": 33}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 33}, {"type": "text", "text": "Justification: The broader impacts of our work are discussed in Appendix H.2. Guidelines: ", "page_idx": 33}, {"type": "text", "text": "\u2022 The answer NA means that there is no societal impact of the work performed. ", "page_idx": 33}, {"type": "text", "text": "\u2022 If the authors answer NA or No, they should explain why their work has no societal impact or why the paper does not address societal impact.   \n\u2022 Examples of negative societal impacts include potential malicious or unintended uses (e.g., disinformation, generating fake profiles, surveillance), fairness considerations (e.g., deployment of technologies that could make decisions that unfairly impact specific groups), privacy considerations, and security considerations.   \n\u2022 The conference expects that many papers will be foundational research and not tied to particular applications, let alone deployments. However, if there is a direct path to any negative applications, the authors should point it out. For example, it is legitimate to point out that an improvement in the quality of generative models could be used to generate deepfakes for disinformation. On the other hand, it is not needed to point out that a generic algorithm for optimizing neural networks could enable people to train models that generate Deepfakes faster.   \n\u2022 The authors should consider possible harms that could arise when the technology is being used as intended and functioning correctly, harms that could arise when the technology is being used as intended but gives incorrect results, and harms following from (intentional or unintentional) misuse of the technology.   \n\u2022 If there are negative societal impacts, the authors could also discuss possible mitigation strategies (e.g., gated release of models, providing defenses in addition to attacks, mechanisms for monitoring misuse, mechanisms to monitor how a system learns from feedback over time, improving the efficiency and accessibility of ML). ", "page_idx": 34}, {"type": "text", "text": "11. Safeguards ", "text_level": 1, "page_idx": 34}, {"type": "text", "text": "Question: Does the paper describe safeguards that have been put in place for responsible release of data or models that have a high risk for misuse (e.g., pretrained language models, image generators, or scraped datasets)? ", "page_idx": 34}, {"type": "text", "text": "Answer: [NA] ", "page_idx": 34}, {"type": "text", "text": "Justification: Our paper does not release any data or models. Guidelines: ", "page_idx": 34}, {"type": "text", "text": "\u2022 The answer NA means that the paper poses no such risks.   \n\u2022 Released models that have a high risk for misuse or dual-use should be released with necessary safeguards to allow for controlled use of the model, for example by requiring that users adhere to usage guidelines or restrictions to access the model or implementing safety filters.   \n\u2022 Datasets that have been scraped from the Internet could pose safety risks. The authors should describe how they avoided releasing unsafe images.   \n\u2022 We recognize that providing effective safeguards is challenging, and many papers do not require this, but we encourage authors to take this into account and make a best faith effort. ", "page_idx": 34}, {"type": "text", "text": "12. Licenses for existing assets ", "text_level": 1, "page_idx": 34}, {"type": "text", "text": "Question: Are the creators or original owners of assets (e.g., code, data, models), used in the paper, properly credited and are the license and terms of use explicitly mentioned and properly respected? ", "page_idx": 34}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 34}, {"type": "text", "text": "Justification: We list the citations, licenses, and the URLs of all our used assets in Appendix F.6. ", "page_idx": 34}, {"type": "text", "text": "Guidelines: ", "page_idx": 34}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not use existing assets.   \n\u2022 The authors should cite the original paper that produced the code package or dataset.   \n\u2022 The authors should state which version of the asset is used and, if possible, include a URL.   \n\u2022 The name of the license (e.g., CC-BY 4.0) should be included for each asset.   \n\u2022 For scraped data from a particular source (e.g., website), the copyright and terms of service of that source should be provided.   \n\u2022 If assets are released, the license, copyright information, and terms of use in the package should be provided. For popular datasets, paperswithcode.com/datasets has curated licenses for some datasets. Their licensing guide can help determine the license of a dataset.   \n\u2022 For existing datasets that are re-packaged, both the original license and the license of the derived asset (if it has changed) should be provided.   \n\u2022 If this information is not available online, the authors are encouraged to reach out to the asset\u2019s creators. ", "page_idx": 34}, {"type": "text", "text": "", "page_idx": 35}, {"type": "text", "text": "13. New Assets ", "text_level": 1, "page_idx": 35}, {"type": "text", "text": "Question: Are new assets introduced in the paper well documented and is the documentation provided alongside the assets? ", "page_idx": 35}, {"type": "text", "text": "Answer: [NA] ", "page_idx": 35}, {"type": "text", "text": "Justification: Our paper does not release new assets. ", "page_idx": 35}, {"type": "text", "text": "Guidelines: ", "page_idx": 35}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not release new assets.   \n\u2022 Researchers should communicate the details of the dataset/code/model as part of their submissions via structured templates. This includes details about training, license, limitations, etc.   \n\u2022 The paper should discuss whether and how consent was obtained from people whose asset is used.   \n\u2022 At submission time, remember to anonymize your assets (if applicable). You can either create an anonymized URL or include an anonymized zip file. ", "page_idx": 35}, {"type": "text", "text": "14. Crowdsourcing and Research with Human Subjects ", "text_level": 1, "page_idx": 35}, {"type": "text", "text": "Question: For crowdsourcing experiments and research with human subjects, does the paper include the full text of instructions given to participants and screenshots, if applicable, as well as details about compensation (if any)? ", "page_idx": 35}, {"type": "text", "text": "Answer: [NA] ", "page_idx": 35}, {"type": "text", "text": "Justification: Our paper does not involve crowdsourcing nor research with human subjects. Guidelines: ", "page_idx": 35}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not involve crowdsourcing nor research with human subjects.   \n\u2022 Including this information in the supplemental material is fine, but if the main contribution of the paper involves human subjects, then as much detail as possible should be included in the main paper.   \n\u2022 According to the NeurIPS Code of Ethics, workers involved in data collection, curation, or other labor should be paid at least the minimum wage in the country of the data collector. ", "page_idx": 35}, {"type": "text", "text": "15. Institutional Review Board (IRB) Approvals or Equivalent for Research with Human Subjects ", "text_level": 1, "page_idx": 35}, {"type": "text", "text": "Question: Does the paper describe potential risks incurred by study participants, whether such risks were disclosed to the subjects, and whether Institutional Review Board (IRB) approvals (or an equivalent approval/review based on the requirements of your country or institution) were obtained? ", "page_idx": 35}, {"type": "text", "text": "Answer: [NA] ", "page_idx": 35}, {"type": "text", "text": "Justification: Our paper does not involve crowdsourcing nor research with human subjects. Guidelines: ", "page_idx": 35}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not involve crowdsourcing nor research with human subjects.   \n\u2022 Depending on the country in which research is conducted, IRB approval (or equivalent) may be required for any human subjects research. If you obtained IRB approval, you should clearly state this in the paper.   \n\u2022 We recognize that the procedures for this may vary significantly between institutions and locations, and we expect authors to adhere to the NeurIPS Code of Ethics and the guidelines for their institution.   \n\u2022 For initial submissions, do not include any information that would break anonymity (if applicable), such as the institution conducting the review. ", "page_idx": 35}, {"type": "text", "text": "", "page_idx": 36}]