[{"type": "text", "text": "Embedding Trajectory for Out-of-Distribution Detection in Mathematical Reasoning ", "text_level": 1, "page_idx": 0}, {"type": "text", "text": "Yiming Wang\u03b1 Pei Zhang\u03b2,\u03b3 Baosong Yang\u03b2,   Derek F. Wong\u03b3 Zhuosheng Zhang\u03b1 Rui Wang\u03b1, ", "page_idx": 0}, {"type": "text", "text": "\u03b1Shanghai Jiao Tong University \u03b2Tongyi Lab $\\gamma_{\\mathrm{NLP^{2}C T}}$ Lab, University of Macau : Corresponding Author Email: \u03b1{yiming.wang, wangrui12}@sjtu.edu.cn \u03b2yangbaosong.ybs@alibaba-inc.com ", "page_idx": 0}, {"type": "text", "text": "Abstract ", "text_level": 1, "page_idx": 0}, {"type": "text", "text": "Real-world data deviating from the independent and identically distributed (i.i.d.) assumption of in-distribution training data poses security threats to deep networks, thus advancing out-of-distribution (OOD) detection algorithms. Detection methods in generative language models (GLMs) mainly focus on uncertainty estimation and embedding distance measurement, with the latter proven to be most effective in traditional linguistic tasks like summarization and translation. However, another complex generative scenario mathematical reasoning poses significant challenges to embedding-based methods due to its high-density feature of output spaces, but this feature causes larger discrepancies in the embedding shift trajectory between different samples in latent spaces. Hence, we propose a trajectory-based method TV Score, which uses trajectory volatility for OOD detection in mathematical reasoning. Experiments show that our method outperforms all traditional algorithms on GLMs under mathematical reasoning scenarios and can be extended to more applications with high-density features in output spaces, such as multiple-choice questions. ", "page_idx": 0}, {"type": "text", "text": "https://github.com/Alsace08/OOD-Math-Reasoning ", "page_idx": 0}, {"type": "text", "text": "1 Introduction ", "text_level": 1, "page_idx": 0}, {"type": "text", "text": "The rapid development of generative language models (GLMs) [40, 41, 5, 2, 50] has empowered them to fit diverse and challenging datasets, showing strong generalization over in-distribution (ID) test data satisfying the independent and identically distributed (i.i.d.) assumption. However, unconstrained inputs in real-world settings frequently trigger distributional drifts, called out-ofdistribution (OOD) data. In such scenarios, model performance often deteriorates unexpectedly, yielding harmful outcomes. Thus, OOD detection [38, 4] is critical in safeguarding model security. ", "page_idx": 0}, {"type": "text", "text": "A highly scalable detection method must not rely on specific OOD data distributions, so simulating scenarios where OOD data is unavailable is more promising. Most existing research mainly focuses on vision and text classification tasks [12, 30, 55, 26, 48]. In contrast, studies addressing OOD detection on GLMs remain relatively niche, despite the more severe risks associated with OOD perils in GLMs due to the potential for error propagation in autoregressive generated sequences [43]. Existing methods on GLMs only focus on traditional text generation scenarios like summarization and translation, and these methods did not step outside the research framework of uncertainty estimation [33, 31] and embedding distance measure [43]. Among these, [43] has demonstrated that embeddingbased methods are currently the only optimal solution for text generation scenarios, they determine whether a new sample is ID or OOD by calculating the Mahalanobis Distance [22] between the new sample embedding and ID embedding distribution in the static input or output space. ", "page_idx": 0}, {"type": "text", "text": "Recently, mathematical reasoning has emerged as a challenging generative task and a crucial benchmark for evaluating model abilities. However, it presents unique phenomena in both input and output spaces that render embedding-based methods inapplicable, as shown in Figure 1: ", "page_idx": 0}, {"type": "image", "img_path": "hYMxyeyEc5/tmp/1bec9ec47e640bbadf4a34f2e93fa8f336c9f58d91a6987aeaf49836043137d5.jpg", "img_caption": ["(a) Mathematical Reasoning ", "(b) Text Generation (Translation) "], "img_footnote": [], "page_idx": 1}, {"type": "text", "text": "Figure 1: Embedding projection and cases of input and output spaces under mathematical reasoning and text generation scenarios. We select MATH [6] dataset for mathematical reasoning and OPUS [49] for text generation, each with four diverse domains. Different colors represent different domains, with lighter and darker shades indicating input and output. We use SimCSE [9] for sentence embeddings and UMAP [34] for dimensionality reduction. Appendix B shows detailed settings and examples. ", "page_idx": 1}, {"type": "text", "text": "\u2022 Input space of mathematical reasoning exhibits vague clustering features across various domains, in contrast to the more defined clusters observed in text generation. This indicates that embedding may struggle to capture the complexity of mathematical questions. \u2022 Output space of mathematical reasoning exhibits high-density characteristics with significant overlap between different domains. we call this phenomenon Pattern Collapse. Since the output is mathematically symbolic [53, 37], it compresses the search space, increasing the likelihood of overlap between questions from disparate domains (As cases of Figure 1a). More importantly, the sequence tokenization used in GLMs allows for substantial token sharing among mathematically distinct expressions, as these mathematical tokens are primarily drawn from digits 0-9 and finite special symbols such as decimal points and square roots, rather than diverse linguistic elements. These scalar outputs lack distinctive features associated with specific domain distributions. ", "page_idx": 1}, {"type": "text", "text": "More discussion of the two phenomena, especially the \u201cpattern collapse\u201d, will be presented in Section 6. Given the limitations of traditional methods, we aim to explore innovative OOD detection solutions in mathematical reasoning scenarios. We transform our focus from static embedding space to the dynamic embedding trajectory, this motivation stems from a theoretical insight, as shown in Figure 2: \u201cpattern collapse\u201d causes the convergence of the trajectory endpoints of different samples, leading to significant trajectory differences across samples. In Section 2.1, we model and prove this hypothesis to elucidate the intuition of using trajectories as a measure. Subsequently, in Section 2.2, we perform empirical experiments to investigate the underlying causes of trajectory differences between ID and OOD samples. Our findings reveal a phenomenon we term Early Stabilization, wherein GLMs achieve primary reasoning in later stages for ID samples, a pattern not observed in OOD samples. This observation provides direct evidence for the rationale behind using trajectory as a measure. ", "page_idx": 1}, {"type": "text", "text": "Based on these analyses, in Section 3, we propose the Trajectory Volatility detection algorithm (TV Score) for mathematical reasoning. Then in Section 4 and 5, we conduct extensive OOD detection experiments with diverse datasets and GLMs to validate the effectiveness of our method. We also tackle the challenging scenario of OOD quality estimation, which raises higher precision demands on the OOD scores. Results indicate that our method surpasses all traditional algorithms for GLMs under the mathematical reasoning scenario. Additionally, we demonstrate the extension of our method to a broader range of tasks with high-density features in output spaces, such as multiple-choice questions. ", "page_idx": 1}, {"type": "text", "text": "Problem Statement: OOD Detection on GLMs. We start by formalizing GLMs. Let $\\mathcal{X}$ and $\\boldsymbol{\\wp}$ be the input and output spaces with $P_{\\mathcal{X}}$ and $P_{\\mathcal{Y}}$ be the marginal distributions for respective space, and $P_{\\mathcal{X},\\mathcal{X}}$ is the joint data distribution defined over $\\mathcal X\\times\\mathcal X$ . GLMs are trained given input sequence $\\textbf{\\em x}=$ $x_{1}x_{2}...x_{t}\\sim P_{\\mathcal{X}}$ of length $t$ to autoregressively generate the next token in the corresponding output sequence $y=y_{1}y_{2}...y_{n}\\sim P_{y}$ of length $n$ over the likelihood model $\\begin{array}{r}{p_{\\pmb{\\theta}}(\\pmb{y}|\\pmb{x})=\\prod_{i=1}^{n}\\bar{p}_{\\pmb{\\theta}}(y_{i}|\\pmb{\\bar{y}}_{\\rightarrow i},\\pmb{\\bar{x}})}\\end{array}$ , where each $x_{i}$ and $y_{i}$ are taken from vocabulary $\\mathcal{V}$ and $\\pmb{\\theta}$ is sampled from the p arameter space $\\Theta$ . ", "page_idx": 1}, {"type": "image", "img_path": "hYMxyeyEc5/tmp/4eeda42fb65d9dba2dfbf5253eecc7a2819f98482267f511bed98bf4d85c3523.jpg", "img_caption": [], "img_footnote": [], "page_idx": 2}, {"type": "text", "text": "Figure 2: The \u201cpattern collapse\u201d phenomenon only exists in mathematical reasoning scenarios, where two samples initially distant in distance will converge approximately at the endpoint after undergoing embedding shifts, and does not occur in text generation scenarios. This produces a greater likelihood of trajectory variation under different samples in mathematical reasoning. ", "page_idx": 2}, {"type": "text", "text": "Assume that $\\widetilde{P}_{X,y}$ denote a distribution sufficiently different from $P_{\\mathcal{X},\\mathcal{Y}}$ , the goal of OOD detection in GLMs is t o find a score function $f(x,y,\\theta)$ for each sample and a threshold $\\epsilon$ , which may rely on the features of $\\mathcal{X},\\mathcal{Y}_{:}$ , and $\\Theta$ , to achieve a high discrimination accuracy goal: ", "page_idx": 2}, {"type": "equation", "text": "$$\n\\operatorname*{max}_{f}\\,\\mathbb{P}_{(\\pmb{x},\\pmb{y})\\sim P_{\\mathcal{X},\\mathcal{Y}}}\\left[f\\!\\left(\\pmb{x},\\pmb{y},\\pmb{\\theta}\\right)<\\epsilon\\right]+\\mathbb{P}_{(\\pmb{\\tilde{x}},\\pmb{\\tilde{y}})\\sim\\tilde{P}_{\\mathcal{X},\\mathcal{Y}}}\\left[f\\!\\left(\\pmb{\\tilde{x}},\\pmb{\\tilde{y}},\\pmb{\\theta}\\right)>\\epsilon\\right].\n$$", "text_format": "latex", "page_idx": 2}, {"type": "text", "text": "2 Dynamic Embedding Trajectory Distinguishes ID and OOD Samples in Mathematical Reasoning ", "text_level": 1, "page_idx": 2}, {"type": "text", "text": "We begin by defining the embedding trajectory and its volatility features. Given a sample $s$ , we put its input to the language model $p_{\\theta}$ with $L$ layers, and the output sequence consists of $T$ tokens. For the $t$ -th token, we denote its output embedding at layer $l$ as $h_{l}^{t}$ , with each embedding a $d$ -dimensional vector. Following the definitions in [43, 51], we define the average embedding T1 tT=1 hlt as the sentence embedding at layer l. Then, the embedding trajectory is formed as a progressive chain of these embeddings: $y_{0}\\,\\to\\,y_{1}\\,\\to\\,\\cdots\\,\\to\\,y_{l}\\,\\to\\,\\cdots\\,\\to\\,y_{L-1}\\,\\to\\,y_{L}$ . To measure the change magnitudes of the embedding trajectory in the latent space, we define two types of trajectory volatilities: ", "page_idx": 2}, {"type": "text", "text": "\u2022 Dimension-independent volatility $V_{I}(s)\\,\\in\\,\\mathbb{R}^{d}$ : For sample $s$ , we first obtain the embedding difference vector $\\vert y_{l}-y_{l-1}\\vert$ between each adjacent-layer pair $l-1$ and l. $V_{I}$ is the average of all differences across layers, it captures the local trajectory changes across individual dimensions: ", "page_idx": 2}, {"type": "equation", "text": "$$\nV_{I}(s)=\\frac{1}{L}\\cdot\\sum_{l=1}^{L}|y_{l}-y_{l-1}|=\\frac{1}{L}\\cdot\\sum_{l=1}^{L}\\left(\\left|y_{l}^{1}-y_{l-1}^{1}\\right|,\\cdot\\cdot\\cdot\\cdot,\\left|y_{l}^{d}-y_{l-1}^{d}\\right|\\right)^{\\top}.\n$$", "text_format": "latex", "page_idx": 2}, {"type": "text", "text": "\u2022 Dimension-joint volatility $V_{J}(s)\\in\\mathbb{R}$ : For sample $s$ , we first obtain the L2-norm of the embedding difference $||\\boldsymbol{y}_{l}-\\boldsymbol{y}_{l-1}||_{2}$ between each adjacent-layer pair $l-1$ and $l$ . $V_{J}$ is the average of all such differences across layers, it captures the global changes in the trajectory: ", "page_idx": 2}, {"type": "equation", "text": "$$\nV_{J}(s)=\\frac{1}{L}\\cdot\\sum_{l=1}^{L}||y_{l}-y_{l-1}||_{2}=\\frac{1}{L}\\cdot\\sum_{l=1}^{L}\\sqrt{\\frac{1}{d}\\cdot\\sum_{i=1}^{d}\\left(y_{l}^{i}-y_{l-1}^{i}\\right)^{2}}.\n$$", "text_format": "latex", "page_idx": 2}, {"type": "text", "text": "In this section, we will clarify our motivation: Why Dynamic Embedding Trajectory As The Measure? This stems from the phenomenon of \u201cpattern collapse\u201d in the output space, where the endpoints of different sample trajectories converge to a high-density region. This constraint potentially increases the likelihood of trajectory differences across samples. We will model and prove this theoretical intuition in Section 2.1 through the Dimension-independent volatility. After gaining insight into trajectory differences, we specifically explore the differences between ID and OOD sample trajectories. We will empirically investigate this in Section 2.2 through the Dimension-joint volatility. ", "page_idx": 2}, {"type": "text", "text": "2.1 Theoretical Intuition: Trajectory Differences with Higher Likelihood ", "text_level": 1, "page_idx": 2}, {"type": "text", "text": "Figure 1 has illustrated the \u201cpattern collapse\u201d phenomenon in the output space in mathematical reasoning scenarios. We abstract this phenomenon in Figure 2, which compares the trajectory ", "page_idx": 2}, {"type": "table", "img_path": "hYMxyeyEc5/tmp/e482bfdabb7409f5843e29d4343df3c2636ef4e9e6c903f83b21149445369a8b.jpg", "table_caption": [], "table_footnote": [], "page_idx": 3}, {"type": "text", "text": "Figure 3: Trajectory volatility curve comparisons between one ID data and ten OOD data from diverse mathematical domains. Each trajectory represents the average of all samples from the corresponding datasets, with color shading being the sample standard deviation. Llama2-7B is used for the backbone. ", "page_idx": 3}, {"type": "text", "text": "trend between different samples in the mathematical reasoning and text generation scenarios: In mathematical reasoning, when initial points of two trajectories are separated by any distance in the input space, they typically converge to a significantly closer distance in the output space after undergoing an embedding shift. However, in text generation, outputs from different samples may not exhibit this same convergence. This finding inspires the following theoretical intuition: Hard constraints on trajectory endpoints in mathematical reasoning allow for a higher probability of trajectory differences under different samples, as expressed by the key hypothesis: ", "page_idx": 3}, {"type": "text", "text": "Hypothesis 1 In scenarios characterized by pattern collapse in the output space, the probability of trajectory volatility differences across samples increases. ", "page_idx": 3}, {"type": "text", "text": "We now formalize this hypothesis. Assume that the output space is a Gaussian distribution $\\mathcal{N}(c,\\Sigma^{2})$ , so the output embedding $\\pmb{y}_{L}\\sim\\mathcal{N}(\\pmb{c},\\Sigma^{2})$ . For two different samples $s_{i}$ and $s_{j}$ , their dimensionindependent volatilities are $V_{I}(s_{i})$ and $V_{I}(s_{j})$ , respectively. We want to show that when pattern collapse exists, the probability of $V_{I}(s_{i})\\,-\\,\\mathbf{\\dot{V}}_{I}(s_{j})\\,\\neq\\,\\mathbf{0}$ will increase. According to the pattern collapse features under different scenarios, we can constraint the $\\pmb{y}_{L}$ as follows: ", "page_idx": 3}, {"type": "text", "text": "\u2022 For mathematical reasoning with pattern collapse, $\\Sigma\\rightarrow{\\cal O}$ , so we approximate that $\\mathbf{{y}}_{L}\\equiv c$ ;   \n\u2022 For text generation without pattern collapse, $\\Sigma=\\operatorname{diag}(\\delta_{1},\\delta_{2},\\cdot\\cdot\\cdot\\cdot,\\delta_{D})\\neq O$ , so ${\\mathbf{}}{\\mathbf{}}{\\mathbf{}}{\\mathbf{}}{\\mathbf{}}{\\mathbf{}}{\\mathbf{}}{\\mathbf{}}{\\mathbf{}}{\\mathbf{}}{\\mathbf{}}{\\neq}{\\mathbf{}}{\\mathbf{}}{\\mathbf{}}{\\mathbf{}}$ . ", "page_idx": 3}, {"type": "text", "text": "With such formalized constraints, we model our Hypothesis 1 as a main theorem: ", "page_idx": 3}, {"type": "text", "text": "Theorem 2.1 (Main Theorem) We assume that $\\{y_{l}\\}_{l=1}^{L}$ are all independent variables sampling from vector space $\\mathbb{R}^{d}$ . For different samples $s_{i}$ and $s_{j}$ , their embedding sets are $\\{[{\\pmb y}_{i}]_{l}\\}_{l=1}^{L}$ and $\\{[{\\pmb y}_{j}]_{l}\\}_{l=1}^{L}$ , respectively. The likelihood of trajectory volatility differences between $s_{i}$ and $s_{j}$ under mathematical reasoning scenarios is higher than that under text generation scenarios, which means: ", "page_idx": 3}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{\\ \\ \\ \\mathbb{{E}}_{\\{[y_{i}]_{l}\\}_{l=1}^{L},\\ \\{[y_{j}]_{l}\\}_{l=1}^{L}}\\sim\\mathcal{U}(\\mathbb{R}^{d})\\left\\{V_{I}(s_{i})-V_{I}(s_{j})\\neq\\mathbf{0}|[y_{i}]_{L},[y_{j}]_{L}\\equiv c\\right\\}}\\\\ &{>\\mathbb{E}_{\\{[y_{i}]_{l}\\}_{l=1}^{L},\\ \\{[y_{j}]_{l}\\}_{l=1}^{L}}\\sim\\mathcal{U}(\\mathbb{R}^{d})\\left\\{V_{I}(s_{i})-V_{I}(s_{j})\\neq\\mathbf{0}|[y_{i}]_{L},[y_{j}]_{L}\\sim\\mathcal{N}(c,\\Sigma^{2})\\right\\}}\\end{array}\n$$", "text_format": "latex", "page_idx": 3}, {"type": "text", "text": "Due to space limits, we present the Complete Proof in Appendix C. This demonstrates that when pattern collapse occurs, the probability of trajectory volatility differences across samples increases. ", "page_idx": 3}, {"type": "text", "text": "2.2 Empirical Analysis: Early Stabilization of ID samples ", "text_level": 1, "page_idx": 3}, {"type": "text", "text": "The theoretical analysis in Section 2.1 provides an intuition for using embedding trajectory as the measure for distinguishing between different samples. However, the specific trajectory differences between ID and OOD samples remain unclear. Thus, we investigate this empirically in this section. ", "page_idx": 3}, {"type": "text", "text": "We select eleven mathematical reasoning datasets: one for ID data and ten for OOD data. The MultiArith dataset serves as the ID data, while the OOD datasets include GSM8K, SVAMP, AddSub, SingleEq, SingleOp, and MATH. The latter encompasses five tasks across various mathematical domains: Algebra, Geometry, Counting and Probability, Number Theory, and Precalculus. This selection includes varying task types and levels of difficulty. We first train a base Llama2-7B (32 layers) using the ID training set, then inference on the ID test set and all OOD test sets. Details regarding the datasets, model, and implementation can be found in Section 4.1. ", "page_idx": 3}, {"type": "text", "text": "We measure the dimension-joint volatility for all samples from each ID and OOD test set. Specifically, we compute each adjacent-layer change magnitude $||\\pmb{\\{y}}_{l}-\\pmb{{y}}_{l-1}||_{2}$ , and connect all values as a change curve, with higher value means the higher volatility. Figure 3 shows ten curve comparisons, with each sub-figure including the ID data and one OOD data. We find that the change magnitude slightly until the 20th layer. After 20 layers, for ID data, the change magnitude is again suppressed after a few layers of inference, while for OOD data, the magnitude is maintained at a relatively high level. ", "page_idx": 4}, {"type": "text", "text": "We term this phenomenon \u201cEarly Stabilization\u201d: For ID data, GLMs largely complete their reasoning in the mid-to-late stages, and simple adjustments are sufficient after that. However, for OOD data, GLMs can still not complete accurate reasoning at a later stage. They thus can only randomly switch to a specific output pattern, i.e., the scalar mathematical expression pattern. This provides strong evidence that using embedding trajectory for OOD detection may be effective. ", "page_idx": 4}, {"type": "text", "text": "3 TV Score: Trajectory Volatility Score for OOD Detection ", "text_level": 1, "page_idx": 4}, {"type": "text", "text": "In Section 2.2, we have identified a significant difference in embedding trajectory volatilities between ID and OOD samples in mathematical reasoning. We now aim to leverage this phenomenon to develop a lightweight OOD detection solution tailored for mathematical reasoning scenarios. ", "page_idx": 4}, {"type": "text", "text": "Inspired by static embedding methods that use the ID sample embedding cluster as the reference to measure the Mahalanobis Distance (MaDis) [22], we similarly aim to use the ID sample trajectory cluster as the reference to measure the difference between them and a new sample trajectory. While measuring the difference between an embedding and an embedding cluster only requires a simple MaDis calculation, quantifying the difference between a trajectory and a trajectory cluster is less intuitive. Thus, we seek a transition idea starting from the static space Gaussian assumption. ", "page_idx": 4}, {"type": "text", "text": "First, we obey the assumption under static embeddings [3, 43] to fti all ID embeddings at each layer $l$ to a Gaussian distribution $\\mathcal{G}_{l}=\\mathcal{N}(\\mu_{l},\\Sigma_{l})$ . Next, for a new sample with $\\textit{\\textbf{y}\\!}$ be its embedding at layer $l$ , we map it to its MaDis $f(\\pmb{y}_{l}):\\mathbb{R}^{d}\\rightarrow\\mathbb{R}$ with $\\mathcal{G}_{l}$ as follows: ", "page_idx": 4}, {"type": "equation", "text": "$$\nf({\\pmb y}_{l})=({\\pmb y}_{l}-{\\pmb\\mu}_{l})^{\\top}\\left(\\Sigma_{l}\\right)^{-1}({\\pmb y}_{l}-{\\pmb\\mu}_{l})\\quad(0\\leq l\\leq L).\n$$", "text_format": "latex", "page_idx": 4}, {"type": "text", "text": "Finally, we treat the MaDis differences $|f(\\pmb{y}_{l})-f(\\pmb{y}_{l-1})|$ between adjacent layer-pairs $l-1$ and $l$ as the adjacent-layer volatility of the new sample, and average all adjacent-layer volatilities as the final trajectory volatility score (TV Score $S$ ) of this sample: ", "page_idx": 4}, {"type": "equation", "text": "$$\nS=\\frac{1}{L}\\cdot\\sum_{l=1}^{L}\\left|f(\\pmb{y}_{l})-f(\\pmb{y}_{l-1})\\right|.\n$$", "text_format": "latex", "page_idx": 4}, {"type": "text", "text": "The anticipated trend is that when the two adjacent embeddings after MaDis mapping exhibit a greater difference, the embedding change between the two layers is more volatile compared to ID data. This enables us to identify new samples with trajectory volatility features that significantly deviate from those of the ID samples, thus increasing the likelihood that they are OOD samples. ", "page_idx": 4}, {"type": "text", "text": "Furthermore, as a trajectory, outliers in the trajectory may significantly impact feature extraction [21, 28]. To mitigate this, we explore higher-order differential smoothing techniques to enhance trajectory smoothness. We first define the $k$ -order embedding $\\nabla^{k}{\\boldsymbol{y}}_{l}$ and Gaussian distribution $\\nabla^{k}\\mathcal{G}_{l}=\\nabla^{k}\\mathcal{N}(\\pmb{\\mu}_{l},\\pmb{\\Sigma}_{l})$ for all $l\\leq L-k$ based on the backward difference: ", "page_idx": 4}, {"type": "equation", "text": "$$\n\\nabla^{k}y_{l}=\\sum_{i=0}^{k}(-1)^{k+i}\\mathrm{C}_{k}^{i}y_{l+k},\\;\\;\\nabla^{k}{\\mathcal G}_{l}={\\mathcal N}\\left(\\sum_{i=0}^{k}(-1)^{k+i}\\mathrm{C}_{k}^{i}\\mu_{l+k},\\;\\sum_{i=0}^{k}\\mathrm{C}_{k}^{i}\\Sigma_{l+k}\\right),\n$$", "text_format": "latex", "page_idx": 4}, {"type": "text", "text": "where $\\begin{array}{r}{\\mathrm{C}_{k}^{i}=\\frac{k!}{i!(k-i)!}}\\end{array}$ . Similarly, we mapping $\\nabla^{k}{y}_{l}$ to its MaDis $\\nabla^{k}f(\\pmb{y}_{l}):\\mathbb{R}^{d}\\rightarrow\\mathbb{R}$ with $\\nabla^{k}\\mathcal{G}_{l}$ : ", "page_idx": 4}, {"type": "equation", "text": "$$\n\\nabla^{k}f(y_{l})=\\left(\\nabla^{k}y_{l}-\\sum_{i=0}^{k}(-1)^{k+i}\\mathrm{C}_{k}^{i}\\mu_{l+k}\\right)^{\\top}\\left(\\sum_{i=0}^{k}\\mathrm{C}_{k}^{i}\\Sigma_{l+k}\\right)^{-1}\\left(\\nabla^{k}y_{l}-\\sum_{i=0}^{k}(-1)^{k+i}\\mathrm{C}_{k}^{i}\\mu_{l+k}\\right).\n$$", "text_format": "latex", "page_idx": 4}, {"type": "text", "text": "Following the definition of TV Score, we define the trajectory volatility score after differential smoothing (TV Score w/ DiSmo $\\nabla^{k}S^{\\prime}$ ) as follows: ", "page_idx": 4}, {"type": "equation", "text": "$$\n\\nabla^{k}S=\\frac{1}{L}\\cdot\\sum_{l=1}^{L}\\left|\\nabla^{k}f(\\pmb{y}_{l})-\\nabla^{k}f(\\pmb{y}_{l-1})\\right|.\n$$", "text_format": "latex", "page_idx": 4}, {"type": "text", "text": "The Algorithmic Process and Computational Complexity are detailed in Appendix D. ", "page_idx": 4}, {"type": "text", "text": "4 Experiments ", "text_level": 1, "page_idx": 5}, {"type": "text", "text": "Dataset Selection. For the ID dataset, we use the MultiArith [44], which consists of Math Word Problems on arithmetic reasoning. For the OOD datasets, we intuitively introduce two types of detection scenarios following [43]: (i) Far-shift OOD scenario, we select the MATH [11] dataset with five domains of algebra, geometry, counting and probability, number theory, and precalculus; (ii) Near-shift OOD scenario, we select five independent datasets: GSM8K [6], SVAMP [39], AddSub [13], SingleEq [18], and SingleOp [18]. We consider the ID data negative(-) and the OOD data positive $(+)$ . Refer to Appendix E.1 for basic information and OOD features of these datasets. ", "page_idx": 5}, {"type": "text", "text": "Data Split and Sampling. Given the limited data size of MultiArith, totaling only 600 samples and lacking a standard division, we allocate 360 samples for training and 240 for testing. However, with such a small test set, randomness in evaluation becomes a concern. To mitigate this, we conduct test sampling and set the sampling size as 1000. Specifically, we denote ID dataset as $\\mathcal{D}_{\\mathrm{in}}$ and OOD dataset as $\\mathcal{D}_{\\mathrm{out}}$ . For each sampling, the collection is $\\{\\mathcal{D}_{\\mathrm{in}},\\widetilde{\\mathcal{D}}_{\\mathrm{out}}\\}$ where $\\widetilde{\\mathcal{D}}_{\\mathrm{out}}\\subset\\mathcal{D}_{\\mathrm{out}}$ and $|\\mathcal{D}_{\\mathrm{in}}|=|\\widetilde{\\mathcal{D}}_{\\mathrm{out}}|$ , this guarantees positive and negative sample balance. We report both the mean and standard variance of the results to enhance the reliability of evaluations. Refer to Appendix E.2 for the ID dataset split. ", "page_idx": 5}, {"type": "text", "text": "Implementation. To measure the application value of our method used in cutting-edge GLMs, we use Llama2-7B [50] and GPT2-XL (1.5B) [5] as our backbones for ID dataset training. Refer to Appendix E.3 for training details. However, there exists uncertainty about the data used in the pre-training phase, especially for Llama2 because its data is closed-source. Some research [57, 59] have confirmed the absence of data leakage in Llama2 for the MATH and GSM8K datasets, we still conduct pre-experiments to examine the rationality of the OOD data selection rigorously. Our criterion is the claim that a dataset can be categorized as OOD if it exceeds the capabilities of the base model, as proposed in prior studies [47, 27]. Results of the pre-experiments are shown in Appendix E.4, and they can confirm that these datasets can be considered as OOD data for the two GLMs. ", "page_idx": 5}, {"type": "text", "text": "Baseline. We compare our method with five training-free baselines where OOD training data are unavailable. We refer to the latest survey [20] to select them for the scarcity of OOD detection methods on GLMs: (1) Maximum Softmax Probability (Prob.) [12]; (2) Monte-Carlo Dropout [8]; (3) Sequence Perplexity [3]; (4) Input Embedding [43]; (5) Output Embedding [43]. Refer to Appendix E.5 for details. Additionally, we set the smoothing order $k$ ranges from 1 to 5 for TV Score w/ DiSmo and report the highest among them when with smoothing. ", "page_idx": 5}, {"type": "text", "text": "Evaluation. We divide the OOD detection evaluation into two scenarios: (1) Offline Detection, which classifies whether samples from a given list belong to OOD. For each collection $\\{\\mathcal{D}_{\\mathrm{in}},\\widetilde{\\mathcal{D}}_{\\mathrm{out}}\\}$ , we report the AUROC [35] and FPR95 metrics. The former represents the area under the ROC  curve and the latter represents the value of FPR at $95\\%$ TPR. (2) Online Detection, which utilizes the offilne detection results to calculate an optimal classification threshold for a direct determination of whether new samples belong to OOD. We introduce the metrics in the corresponding result sub-sections. ", "page_idx": 5}, {"type": "text", "text": "4.2 Main Results ", "text_level": 1, "page_idx": 5}, {"type": "text", "text": "Offline Detection. Table 1 presents the results of the offline detection scenarios. ", "page_idx": 5}, {"type": "text", "text": "\u2022 Performance Analysis: In the far-shift OOD setting, our average performance surpasses 98 (Llama2-7B) and 96 (GPT2-XL) under the AUROC metric, surpassing the optimal baseline by $^{10+}$ points. Moreover, our performance stands at an impressive 5.21 (Llama2-7B) and 9.89 (GPT2-XL) under the FPR95 metric, representing a remarkable ${\\bf80\\,\\%+}$ reduction compared to the optimal baseline, far surpassing all baseline methods. In the near-shift OOD setting, the robustness of our method is even more impressive. All of the baseline methods show significant performance degradation, especially in Llama2-7B, with the AUROC metric decreasing below 60 and the FPR95 elevating above 80. However, our method maintains excellent performances, with AUROC scores surpassing 90 and FPR95 below 30. This indicates that for more fine-grained OOD detection scenarios, our method demonstrates greater adaptability. \u2022 Model Analysis: Comparing performances of Llama2-7B and GPT2-XL, we find two phenomena: (i) Results on GPT2-XL are more stable, performance differences between GPT2-XL on farand near-drift settings are not significant, while Llama2-7B shows a significant performance ", "page_idx": 5}, {"type": "text", "text": "", "page_idx": 5}, {"type": "table", "img_path": "hYMxyeyEc5/tmp/643425f30c5a50d0f366e40972354060ca9e3b714c6f146057748314f091e14e.jpg", "table_caption": ["Table 1: AUROC and FPR95 results of the Offline Detection scenario. Underline and bold denote SOTA among all baselines and all methods, respectively. We report the average results under each setting in the main text, results of each dataset are shown in Table 11 and 12 (Appendix F). "], "table_footnote": [], "page_idx": 6}, {"type": "table", "img_path": "hYMxyeyEc5/tmp/777c3b46ebaa4194f7c7f2f324db06df1de5ba48583c57e6db120b49d7c6617e.jpg", "table_caption": ["Table 2: Accuracy and Robustness results of the Online Detection scenario. We mainly compare our method with embedding-based methods, and bold denotes the best among these methods. "], "table_footnote": ["degradation (mainly for baselines) on near-shift setting; (ii) the DiSmo technique is more effective on GPT2-XL, which suggests that there are more anomalous learning tendencies in latent spaces of small models, and the smoothing helps to minimize these anomalies. "], "page_idx": 6}, {"type": "text", "text": "In addition, we conduct significant tests (Details are shown in Table $11\\,-\\,14\\,\\mathrm{,}$ ). We find that our methods almost pass all significance tests, while the embedding-based methods have the lowest pass rate among baselines, suggesting that their results are more susceptible to sampling error. We also find that the performance of differential smoothing fluctuates greatly in different settings. Therefore, we conduct the ablation of the smoothing order $k$ . Results and analyses are shown in Appendix F.1. ", "page_idx": 6}, {"type": "text", "text": "Online Detection. In this part, we utilize the TV score for online OOD discrimination. For each collection $\\{\\mathcal{D}_{\\mathrm{in}},\\widetilde{\\mathcal{D}}_{\\mathrm{out}}\\}$ , we obtain a detector and computer the optimal cut-off $\\tau_{i}$ of Youden Index, which is at the p oint in the AUROC curve where TPR \u2212FPR is maximum. Then for all OOD samples s \u2208Dout \u2212D out, we donate $t$ as the sampling size and computer the discrimination accuracy: ", "page_idx": 6}, {"type": "equation", "text": "$$\n\\mathrm{Accuracy}=\\frac{1}{t}\\sum_{i=1}^{t}\\frac{\\sum_{s\\in\\mathcal{D}_{\\mathrm{out}}-\\widetilde{\\mathcal{D}}_{\\mathrm{out}}}\\mathbb{I}\\left[\\mathrm{TV}\\mathrm{-}\\mathrm{Score}(s)\\ge\\tau_{i}\\right]}{\\left|\\mathcal{D}_{\\mathrm{out}}-\\widetilde{\\mathcal{D}}_{\\mathrm{out}}\\right|}.\n$$", "text_format": "latex", "page_idx": 6}, {"type": "text", "text": "In addition, the discrimination accuracy should vary less under different data collections, reflecting the discriminator\u2019s robustness. Therefore, we denote the Robustness metric as sampling variance. ", "page_idx": 6}, {"type": "text", "text": "Table 2 presents the results in Llama2-7B. Compared to the embedding-based methods, our TV score obtains about an average of 20-point accuracy improvement in both far-shift OOD and near-shift OOD settings, and on some datasets, such as Cnt.&Prob, our TV score achieves more than 40 points of improvement. These all imply that TV Score can perform online discrimination of OOD samples more accurately. In addition, our TV score also possesses stronger robustness, which means that in real scenarios, we can find the optimal threshold more consistently in the face of different accessible ID and OOD data, reducing the potential riskiness due to uncontrollable data acquisition. ", "page_idx": 6}, {"type": "text", "text": "5 Generalizability Exploration ", "text_level": 1, "page_idx": 7}, {"type": "text", "text": "5.1 Beyond Detection: OOD Quality Estimation ", "text_level": 1, "page_idx": 7}, {"type": "text", "text": "In this part, we utilize the TV score for generative quality estimation (QE). For text generation, the QE performance is usually measured by calculating the correlation coefficient between automatic scores and human ratings. However, QE in mathematical reasoning scenarios is not a well-defined problem. For one mathematical question, its answer is either right or wrong, the intermediate state does not exist. For example, when the correct answer is 12.5, it is difficult to judge which is better between generated answers of 1.25 and 13.6. The human approach may be to judge by comparing the difference value or similarity like Rouge [24] and BertScore [60] between the generated answer and the correct answer, which is unfair to the machine because there is a lot of randomness in the intermediary process of computation, and the solution pattern of machines is case-based [14], so it is not suitable to judge the machine-generated results with customized mathematical rules. ", "page_idx": 7}, {"type": "text", "text": "Therefore, we use the binary direct matching1 to compare the model-generated answers with the correct answers. Considering the open-ended output of the GLMs, we give a loose matching condition, i.e., as long as the correct answer is included in the generated answer by the model, the generated answer is recognized as correct and the matching score is 1, otherwise the matching score is 0. We compute the Kendall rank correlation coefficient $\\tau$ [45] and Spearman rank correlation coefficient [36] between each OOD score and the matching score. ", "page_idx": 7}, {"type": "table", "img_path": "hYMxyeyEc5/tmp/6c12d4bcf459368f90efdb8cf6207b8347e851426be2e56d315d85fc924de248.jpg", "table_caption": ["Table 3: OOD Quality Estimation: Kendall\u2019s $\\tau$ and Spearman correlation between various OOD scores and benchmark quality metric binary matching. Each column shows the correlation when ID and OOD samples are merged. Underline denotes the SOTA among all baselines, and bold denotes the SOTA among our methods. We report the average results under each setting in the main text, results of each dataset are shown in Table 13 and 14 (Appendix F). "], "table_footnote": [], "page_idx": 7}, {"type": "text", "text": "Table 3 presents the results. For Llama2-7B, when compared with Kendall correlation, the correlation improvement of TV scores over SOTA baselines reaches up to $100\\%$ under both far-shift and near-shift OOD settings. Compared with Spearman correlation, TV scores demonstrate a correlation enhancement over SOTA baselines by up to $100\\%$ under far-shift OOD setting and ${\\bf30\\%}$ under near-shift OOD setting. GPT2-XL also demonstrates excellent performance. These findings indicate that our TV scores not only facilitate the binary discrimination of ID and OOD samples but also substantially reflect the quality and precision of generated mathematical reasoning. ", "page_idx": 7}, {"type": "text", "text": "5.2 Beyond Mathematical Reasoning ", "text_level": 1, "page_idx": 7}, {"type": "text", "text": "Apart from mathematical reasoning, our method also has a wider range of potential applications that can be extended to any task where the output space exhibits the pattern collapse property. An example would be multiple-choice questions, which is a popular evaluation tool in the era of large language models and also display the pattern collapse property due to the limited output space being confined to the \u201cABCD\u201d four options. To verify the generalizability of our method, we conduct experiments using the multiple-choice dataset MMLU [10], and our method also outperforms all traditional algorithms in this setting. Results and analyses are shown in Appendix F.4. ", "page_idx": 7}, {"type": "text", "text": "6 Rethink Inapplicability of Static Embedding Methods ", "text_level": 1, "page_idx": 8}, {"type": "text", "text": "In Figure 1, we find that the static embedding space for both input and output fails to capture distinct features across different domains. This renders traditional embedding-based methods unsuitable for mathematical reasoning tasks. Experimental results in Section 4 also verify this disadvantage. In this section, we conduct a detailed analysis of these phenomena, and reveal the root cause of the poor performance of static embedding methods in mathematical reasoning scenarios. ", "page_idx": 8}, {"type": "text", "text": "6.1 Input Space: Representation Dilemma on Mathematical Expressions ", "text_level": 1, "page_idx": 8}, {"type": "text", "text": "The input space in mathematical reasoning exhibits vague clustering features compared to text generation scenarios as shown in Figure 1. We speculate that as semantic representations, embeddings cannot accurately measure mathematical expressions in the mathematical sense. ", "page_idx": 8}, {"type": "table", "img_path": "hYMxyeyEc5/tmp/3249819e52f28e23bcb2193d0fa7aaaad00bf5980aa9a1f6aaeef3ede0f579be.jpg", "table_caption": ["Table 4: A toy example about cosine similarities between different mathematical expressions. "], "table_footnote": [], "page_idx": 8}, {"type": "text", "text": "We begin by considering a counter-intuitive toy example. We construct a benchmark expression \u201cA: $2{+}3{+}4{=}?\"$ and three diverse expressions: \u201cX: $8-0+9=?^{\\circ}$ , \u201cY: $\\mathtt{x}\\hat{\\mathrm{~\\,~}}2*\\mathtt{y}\\hat{\\mathrm{~\\,~}}3*\\mathtt{x}\\hat{\\mathrm{~\\,~}}4{=}?^{*}$ , and $^{\\bullet\\bullet}Z$ : $234*2\\!+\\!345*4\\!+\\!456*4\\!-\\!243*3\\!=\\!?^{\\ast}$ . From the mathematical sense, X is ID for A, whereas Y and Z are OOD for A since the difficulty and knowledge used to solve $\\mathrm{\\bfY}$ and $Z$ are largely different from A compared to X. Table 4 presents the cosine similarity between each of them and A. Notably, X exhibits the lowest similarity to A, primarily due to having fewer token sharing with A. This is inconsistent with human perception of mathematics. ", "page_idx": 8}, {"type": "text", "text": "", "page_idx": 8}, {"type": "table", "img_path": "hYMxyeyEc5/tmp/2b5022e77ff113acfc2e72cdf1c2db704e9e7624945478ba313cb8fca2aae900.jpg", "table_caption": ["Table 5: AUROC score matrix produced after alternating the MATH dataset\u2019s five domains as ID and OOD data measured by (a) Input Embedding Mahalanobis Distance and (b) Output Embedding (w/ CoT) Mahalanobis Distance. Darker colors represent better performances. "], "table_footnote": [], "page_idx": 8}, {"type": "text", "text": "To demonstrate this phenomenon, we use one of five domains from the MATH dataset as the ID and the remaining four domains as OOD. We rotate this setting across five iterations. Under each ID-OOD pair, we allocate half of the ID samples to compute the ID embedding distribution, while the other half and all OOD samples constitute the test samples. The Mahalanobis distance is then calculated between embeddings and the ID distributions for each sample input, yielding the OOD score. We employ SimCSE [9] to generate sentence embeddings. Table 5(a) presents the AUROC score matrix, in nearly half of the settings, the AUROC value hovers around 50, i.e., completely random. This suggests that embeddings can not distinguish between domains in a mathematical sense. ", "page_idx": 8}, {"type": "text", "text": "6.2 Output Space: High-density \u201cPattern Collapse\u201d ", "text_level": 1, "page_idx": 8}, {"type": "text", "text": "The output space in mathematical reasoning exhibits a unique high-density characteristic, which we call \u201cpattern collapse\u201d. As shown in Figure 1, the distribution of output embeddings across various domains in the mathematical reasoning scenarios is significantly concentrated and indistinguishable. ", "page_idx": 8}, {"type": "text", "text": "Two reasons cause this phenomenon: (1) Expression level: Output space of mathematical reasoning is scalar [37], resulting in a compressed search space with a higher probability of overlap in two widely divergent questions. For example, \u201c $1+3=^{\\circ}$ and \u201c $\\begin{array}{r}{\\left\\langle\\int_{1}^{3}x\\mathrm{d}x=\\right\\rangle}\\end{array}$ are both $\\bullet\\bullet\\bullet$ ; (2) Token level: We usually categorize different mathematical reasoning domains from a mathematical sense. However, GLMs model real numbers or mathematical expressions not in a mathematical sense, but based on the average embedding of all discrete token embeddings after sequence tokenization. Through tokenization, two expressions that are very different in the mathematical sense (e.g., Two numbers that are far apart on the real number line) may share many tokens because regular mathematical expressions are only taken from 0-9 number tokens and a limited number of special symbols, such as decimal points, slashes, and root signs. Thus, the collapse occurs at the token level during the autoregressive prediction of each token. ", "page_idx": 8}, {"type": "text", "text": "", "page_idx": 9}, {"type": "text", "text": "We conduct the following statistical analysis to demonstrate the universality of \u201cpattern collapse\u201d across various mathematical reasoning tasks: We categorize the mathematical tasks into various types across different domains and difficulties. In each task, we count the token number $N$ and the token type number $N_{T}$ in the dataset, then compute the token duplication rate $D$ and the vocab coverage $C$ as follows: We use Llama-2 tokenizator [50], whose token type number in vocab $N_{V}$ is 32000. The computation metric is: ", "page_idx": 9}, {"type": "table", "img_path": "hYMxyeyEc5/tmp/f873b53ee850f4443fad4cb85062aaa8a038bb14676f505a3b77dfe3d599948b.jpg", "table_caption": ["Table 6: Statistics about output tokens on mathematical reasoning (seven different task types) and text generation (translation and summarization). "], "table_footnote": [], "page_idx": 9}, {"type": "equation", "text": "$$\nD=1-\\frac{N_{\\mathcal{T}}}{N},\\;\\;\\;C=\\frac{N_{\\mathcal{T}}}{N_{\\mathcal{V}}}.\n$$", "text_format": "latex", "page_idx": 9}, {"type": "text", "text": "We also test translation and summarization tasks by taking samples with the same token size as the mathematical reasoning dataset for a clear comparison. Table 6 presents the statistics data, we find that: (i) The average token duplication rate was $98.9\\%$ on all math tasks, and even a staggering $99.9\\%$ on some easy arithmetic tasks; In contrast, the token duplication rate on the text ", "page_idx": 9}, {"type": "text", "text": "generation task is only about $60\\%$ , with about 2000 token types, and still increasing as the total number of tokens increases. These data and comparisons demonstrate that pattern collapse occurs on mathematical reasoning and not on text generation. (ii) Token repetition rate exceeded $97\\%$ on all seven math tasks of different difficulties and types. From these conclusions, we can demonstrate that the \u201cpattern collapse\u201d occurs on generally all types of mathematical reasoning tasks. ", "page_idx": 9}, {"type": "text", "text": "6.3 Can Chain-of-Thought Address \u201cpattern collapse\u201d? ", "text_level": 1, "page_idx": 9}, {"type": "text", "text": "A straightforward approach to addressing \u201cpattern collapse\u201d in the output space is to leverage chainof-thought (CoT) techniques [54, 17, 62, 52, 61] to expand the output space size. Likewise, we adopt the solution steps associated with each sample in the MATH dataset as the output and employ SimCSE to derive embedding representations. The experimental setup aligns with Section 4.1, and the results are shown in Table 5(b). We note a similar phenomenon as in Table 5(a), i.e., the detection accuracy under different ID-OOD pairs varies greatly, and thus the detection randomness is more pronounced. This suggests that despite that CoT expands the output space size, the output answer is still essentially related to the difficulty and digit of mathematical reasoning, and the semantic embedding representation cannot reflect these features accurately. ", "page_idx": 9}, {"type": "text", "text": "7 Conclusion ", "text_level": 1, "page_idx": 9}, {"type": "text", "text": "We propose the TV Score, a lightweight OOD detection method for mathematical reasoning, which distinguishes between ID and OOD samples by the embedding trajectory volatility in the latent space. We identify bottlenecks in OOD detection for mathematical reasoning and prove them empirically and theoretically. Experiments show that our method substantially outperforms all traditional algorithms, and can be extended to more application scenarios beyond mathematical reasoning. ", "page_idx": 9}, {"type": "text", "text": "Limitations ", "text_level": 1, "page_idx": 10}, {"type": "text", "text": "Our limitation mainly lies in the relatively small sizes of datasets used in our experiments. Due to the difficulty of collecting and labeling mathematical reasoning data, dataset sizes in this field are generally small, mostly in the hundreds or thousands, making it difficult to obtain millions of data for training and reasoning as in translation or summarization tasks. To address this, we adopt test sampling to reduce the randomness under small-scale testing and mitigate the data imbalance. ", "page_idx": 10}, {"type": "text", "text": "Ethics Statement ", "text_level": 1, "page_idx": 10}, {"type": "text", "text": "The data and models used in this work are sourced from the official version of the original paper, and we strictly adhere to the provided usage protocol. Regarding the data, no modifications have been made to the original dataset. Regarding the models, supervised fine-tuning and OOD data inference are involved. To mitigate the risk of uncontrollable outputs, all generated outputs in the experiments have been reviewed to ensure their safety. Furthermore, as our focus is solely on mathematical reasoning and does not involve sensitive content, we would not cause any potential societal impact. ", "page_idx": 10}, {"type": "text", "text": "Acknowledgment ", "text_level": 1, "page_idx": 10}, {"type": "text", "text": "This work is supported by the Alibaba Innovative Research Program. Yiming and Rui are partially supported by the General Program of the National Natural Science Foundation of China (62176153), the Shanghai Municipal Science and Technology Major Project (2021SHZDZX0102), and SMPZhipu.AI Large Model Cross-Disciplinary Fund, the Science and Technology Development Fund. Zhuosheng is partially supported by the National Natural Science Foundation of China (62406188). This work is also partially supported by the Science and Technology Development Fund, Macau SAR (Grant Nos. FDCT/060/2022/AFJ, FDCT/0070/2022/AMJ), and the Multi-year Research Grant from the University of Macau (Grant No. MYRG-GRG2023-00006-FST-UMDF). ", "page_idx": 10}, {"type": "text", "text": "References ", "text_level": 1, "page_idx": 10}, {"type": "text", "text": "[1] Vahdat Abdelzad, Krzysztof Czarnecki, Rick Salay, Taylor Denounden, Sachin Vernekar, and Buu Phan. Detecting out-of-distribution inputs in deep neural networks using an early-layer output. arXiv preprint arXiv:1910.10307, 2019.   \n[2] Josh Achiam, Steven Adler, Sandhini Agarwal, Lama Ahmad, Ilge Akkaya, Florencia Leoni Aleman, Diogo Almeida, Janko Altenschmidt, Sam Altman, Shyamal Anadkat, et al. Gpt-4 technical report. arXiv preprint arXiv:2303.08774, 2023.   \n[3] Udit Arora, William Huang, and He He. Types of out-of-distribution texts and how to detect them. In Proceedings of the 2021 Conference on Empirical Methods in Natural Language Processing, pages 10687\u201310701, 2021.   \n[4] Arsenii Ashukha, Alexander Lyzhov, Dmitry Molchanov, and Dmitry Vetrov. Pitfalls of indomain uncertainty estimation and ensembling in deep learning. In International Conference on Learning Representations, 2019.   \n[5] Tom Brown, Benjamin Mann, Nick Ryder, Melanie Subbiah, Jared D Kaplan, Prafulla Dhariwal, Arvind Neelakantan, Pranav Shyam, Girish Sastry, Amanda Askell, et al. Language models are few-shot learners. Advances in neural information processing systems, 33:1877\u20131901, 2020.   \n[6] Karl Cobbe, Vineet Kosaraju, Mohammad Bavarian, Mark Chen, Heewoo Jun, Lukasz Kaiser, Matthias Plappert, Jerry Tworek, Jacob Hilton, Reiichiro Nakano, et al. Training verifiers to solve math word problems. arXiv preprint arXiv:2110.14168, 2021.   \n[7] Taylor Denouden, Rick Salay, Krzysztof Czarnecki, Vahdat Abdelzad, Buu Phan, and Sachin Vernekar. Improving reconstruction autoencoder out-of-distribution detection with mahalanobis distance. arXiv preprint arXiv:1812.02765, 2018.   \n[8] Yarin Gal and Zoubin Ghahramani. Dropout as a bayesian approximation: Representing model uncertainty in deep learning. In international conference on machine learning, pages 1050\u20131059. PMLR, 2016.   \n[9] Tianyu Gao, Xingcheng Yao, and Danqi Chen. Simcse: Simple contrastive learning of sentence embeddings. In Proceedings of the 2021 Conference on Empirical Methods in Natural Language Processing, pages 6894\u20136910, 2021.   \n[10] Dan Hendrycks, Collin Burns, Steven Basart, Andy Zou, Mantas Mazeika, Dawn Song, and Jacob Steinhardt. Measuring massive multitask language understanding. In International Conference on Learning Representations, 2020.   \n[11] Dan Hendrycks, Collin Burns, Saurav Kadavath, Akul Arora, Steven Basart, Eric Tang, Dawn Song, and Jacob Steinhardt. Measuring mathematical problem solving with the math dataset. In Thirty-fifth Conference on Neural Information Processing Systems Datasets and Benchmarks Track (Round 2), 2021.   \n[12] Dan Hendrycks and Kevin Gimpel. A baseline for detecting misclassified and out-of-distribution examples in neural networks. In International Conference on Learning Representations, 2016.   \n[13] Mohammad Javad Hosseini, Hannaneh Hajishirzi, Oren Etzioni, and Nate Kushman. Learning to solve arithmetic word problems with verb categorization. In Proceedings of the 2014 Conference on Empirical Methods in Natural Language Processing (EMNLP), pages 523\u2013533, 2014.   \n[14] Yi Hu, Xiaojuan Tang, Haotong Yang, and Muhan Zhang. Case-based or rule-based: How do transformers do the math? arXiv preprint arXiv:2402.17709, 2024.   \n[15] Rui Huang, Andrew Geng, and Yixuan Li. On the importance of gradients for detecting distributional shifts in the wild. Advances in Neural Information Processing Systems, 34:677\u2013 689, 2021.   \n[16] Wenyu Jiang, Yuxin Ge, Hao Cheng, Mingcai Chen, Shuai Feng, and Chongjun Wang. Read: Aggregating reconstruction error into out-of-distribution detection. In Proceedings of the AAAI Conference on Artificial Intelligence, volume 37, pages 14910\u201314918, 2023.   \n[17] Takeshi Kojima, Shixiang Shane Gu, Machel Reid, Yutaka Matsuo, and Yusuke Iwasawa. Large language models are zero-shot reasoners. Advances in neural information processing systems, 35:22199\u201322213, 2022.   \n[18] Rik Koncel-Kedziorski, Subhro Roy, Aida Amini, Nate Kushman, and Hannaneh Hajishirzi. Mawps: A math word problem repository. In Proceedings of the 2016 conference of the north american chapter of the association for computational linguistics: human language technologies, pages 1152\u20131157, 2016.   \n[19] Balaji Lakshminarayanan, Alexander Pritzel, and Charles Blundell. Simple and scalable predictive uncertainty estimation using deep ensembles. Advances in neural information processing systems, 30, 2017.   \n[20] Hao Lang, Yinhe Zheng, Yixuan Li, SUN Jian, Fei Huang, and Yongbin Li. A survey on out-of-distribution detection in nlp. Transactions on Machine Learning Research, 2023.   \n[21] Rikard Laxhammar and G\u00f6ran Falkman. Online learning and sequential anomaly detection in trajectories. IEEE transactions on pattern analysis and machine intelligence, 36(6):1158\u20131173, 2013.   \n[22] Kimin Lee, Kibok Lee, Honglak Lee, and Jinwoo Shin. A simple unified framework for detecting out-of-distribution samples and adversarial attacks. Advances in neural information processing systems, 31, 2018.   \n[23] Shiyu Liang, Yixuan Li, and R Srikant. Enhancing the reliability of out-of-distribution image detection in neural networks. In International Conference on Learning Representations, 2018.   \n[24] Chin-Yew Lin. Rouge: A package for automatic evaluation of summaries. In Text summarization branches out, pages 74\u201381, 2004.   \n[25] Zi Lin, Jeremiah Zhe Liu, and Jingbo Shang. Towards collaborative neural-symbolic graph semantic parsing via uncertainty. Findings of the Association for Computational Linguistics: ACL 2022, 2022.   \n[26] Weitang Liu, Xiaoyun Wang, John Owens, and Yixuan Li. Energy-based out-of-distribution detection. Advances in neural information processing systems, 33:21464\u201321475, 2020.   \n[27] Yang Liu, Yuanshun Yao, Jean-Francois Ton, Xiaoying Zhang, Ruocheng Guo, Hao Cheng, Yegor Klochkov, Muhammad Faaiz Taufiq, and Hang Li. Trustworthy llms: a survey and guideline for evaluating large language models\u2019 alignment. In Socially Responsible Language Modelling Research, 2023.   \n[28] Yiding Liu, Kaiqi Zhao, Gao Cong, and Zhifeng Bao. Online anomalous trajectory detection with deep generative sequence modeling. In 2020 IEEE 36th International Conference on Data Engineering (ICDE), pages 949\u2013960. IEEE, 2020.   \n[29] Ilya Loshchilov and Frank Hutter. Decoupled weight decay regularization. In International Conference on Learning Representations, 2018.   \n[30] Christos Louizos and Max Welling. Multiplicative normalizing flows for variational bayesian neural networks. In International Conference on Machine Learning, pages 2218\u20132227. PMLR, 2017.   \n[31] Denis Lukovnikov, Sina Daubener, and Asja Fischer. Detecting compositionally out-ofdistribution examples in semantic parsing. In Findings of the Association for Computational Linguistics: EMNLP 2021, pages 591\u2013598, 2021.   \n[32] Andrey Malinin, Neil Band, Yarin Gal, Mark Gales, Alexander Ganshin, German Chesnokov, Alexey Noskov, Andrey Ploskonosov, Liudmila Prokhorenkova, Ivan Provilkov, et al. Shifts: A dataset of real distributional shift across multiple large-scale tasks. In Thirty-fifth Conference on Neural Information Processing Systems Datasets and Benchmarks Track (Round 2), 2021.   \n[33] Andrey Malinin and Mark Gales. Uncertainty estimation in autoregressive structured prediction. In International Conference on Learning Representations, 2020.   \n[34] Leland McInnes, John Healy, Nathaniel Saul, and Lukas Gro\u00dfberger. Umap: Uniform manifold approximation and projection. Journal of Open Source Software, 3(29):861, 2018.   \n[35] Charles E Metz. Basic principles of roc analysis. In Seminars in nuclear medicine, volume 8, pages 283\u2013298. Elsevier, 1978.   \n[36] Leann Myers and Maria J Sirois. Spearman correlation coefficients, differences between. Encyclopedia of statistical sciences, 12, 2004.   \n[37] Inderjeet Nair and Lu Wang. Midgard: Self-consistency using minimum description length for structured commonsense reasoning, 2024.   \n[38] Yaniv Ovadia, Emily Fertig, Jie Ren, Zachary Nado, David Sculley, Sebastian Nowozin, Joshua Dillon, Balaji Lakshminarayanan, and Jasper Snoek. Can you trust your model\u2019s uncertainty? evaluating predictive uncertainty under dataset shift. Advances in neural information processing systems, 32, 2019.   \n[39] Arkil Patel, Satwik Bhattamishra, and Navin Goyal. Are nlp models really able to solve simple math word problems? In Proceedings of the 2021 Conference of the North American Chapter of the Association for Computational Linguistics: Human Language Technologies, pages 2080\u20132094, 2021.   \n[40] Alec Radford, Karthik Narasimhan, Tim Salimans, Ilya Sutskever, et al. Improving language understanding by generative pre-training. 2018.   \n[41] Alec Radford, Jeffrey Wu, Rewon Child, David Luan, Dario Amodei, Ilya Sutskever, et al. Language models are unsupervised multitask learners. OpenAI blog, 1(8):9, 2019.   \n[42] Jie Ren, Stanislav Fort, Jeremiah Liu, Abhijit Guha Roy, Shreyas Padhy, and Balaji Lakshminarayanan. A simple fix to mahalanobis distance for improving near-ood detection. arXiv preprint arXiv:2106.09022, 2021.   \n[43] Jie Ren, Jiaming Luo, Yao Zhao, Kundan Krishna, Mohammad Saleh, Balaji Lakshminarayanan, and Peter J Liu. Out-of-distribution detection and selective generation for conditional language models. In The Eleventh International Conference on Learning Representations, 2023.   \n[44] Subhro Roy and Dan Roth. Solving general arithmetic word problems. In Proceedings of the Conference on Empirical Methods in Natural Language Processing, pages 1743\u20131752, 2015.   \n[45] Pranab Kumar Sen. Estimates of the regression coefficient based on kendall\u2019s tau. Journal of the American statistical association, 63(324):1379\u20131389, 1968.   \n[46] Rupesh K Srivastava, Klaus Greff, and J\u00fcrgen Schmidhuber. Training very deep networks. Advances in neural information processing systems, 28, 2015.   \n[47] Lichao Sun, Yue Huang, Haoran Wang, Siyuan Wu, Qihui Zhang, Chujie Gao, Yixin Huang, Wenhan Lyu, Yixuan Zhang, Xiner Li, et al. Trustllm: Trustworthiness in large language models. arXiv preprint arXiv:2401.05561, 2024.   \n[48] Yiyou Sun, Yifei Ming, Xiaojin Zhu, and Yixuan Li. Out-of-distribution detection with deep nearest neighbors. In International Conference on Machine Learning, pages 20827\u201320840. PMLR, 2022.   \n[49] J\u00f6rg Tiedemann. Parallel data, tools and interfaces in opus. In Proceedings of the Eighth International Conference on Language Resources and Evaluation, pages 2214\u20132218, 2012.   \n[50] Hugo Touvron, Louis Martin, Kevin Stone, Peter Albert, Amjad Almahairi, Yasmine Babaei, Nikolay Bashlykov, Soumya Batra, Prajjwal Bhargava, Shruti Bhosale, et al. Llama 2: Open foundation and fine-tuned chat models. arXiv preprint arXiv:2307.09288, 2023.   \n[51] Yiming Wang, Pei Zhang, Baosong Yang, Derek F Wong, and Rui Wang. Latent space chain-ofembedding enables output-free llm self-evaluation. arXiv preprint arXiv:2410.13640, 2024.   \n[52] Yiming Wang, Zhuosheng Zhang, and Rui Wang. Element-aware summarization with large language models: Expert-aligned evaluation and chain-of-thought method. In Proceedings of the 61st Annual Meeting of the Association for Computational Linguistics (Volume 1: Long Papers), pages 8640\u20138665, 2023.   \n[53] Yiming Wang, Zhuosheng Zhang, Pei Zhang, Baosong Yang, and Rui Wang. Meta-reasoning: Semantics-symbol deconstruction for large language models. In Findings of the Association for Computational Linguistics ACL 2024, pages 622\u2013643, 2024.   \n[54] Jason Wei, Xuezhi Wang, Dale Schuurmans, Maarten Bosma, Fei Xia, Ed Chi, Quoc V Le, Denny Zhou, et al. Chain-of-thought prompting elicits reasoning in large language models. Advances in neural information processing systems, 35:24824\u201324837, 2022.   \n[55] Yeming Wen, Paul Vicol, Jimmy Ba, Dustin Tran, and Roger Grosse. Flipout: Efficient pseudoindependent weight perturbations on mini-batches. In International Conference on Learning Representations, 2018.   \n[56] Tim Z Xiao, Aidan Gomez, and Yarin Gal. Wat zei je? detecting out-of-distribution translations with variational transformers. 2020.   \n[57] Ruijie Xu, Zengzhi Wang, Run-Ze Fan, and Pengfei Liu. Benchmarking benchmark leakage in large language models. arXiv preprint arXiv:2404.18824, 2024.   \n[58] Jingkang Yang, Kaiyang Zhou, Yixuan Li, and Ziwei Liu. Generalized out-of-distribution detection: A survey. arXiv preprint arXiv:2110.11334, 2021.   \n[59] Hugh Zhang, Jeff Da, Dean Lee, Vaughn Robinson, Catherine Wu, Will Song, Tiffany Zhao, Pranav Raja, Dylan Slack, Qin Lyu, et al. A careful examination of large language model performance on grade school arithmetic. arXiv preprint arXiv:2405.00332, 2024.   \n[60] Tianyi Zhang, Varsha Kishore, Felix Wu, Kilian Q Weinberger, and Yoav Artzi. Bertscore: Evaluating text generation with bert. In International Conference on Learning Representations, 2019.   \n[61] Zhuosheng Zhang, Yao Yao, Aston Zhang, Xiangru Tang, Xinbei Ma, Zhiwei He, Yiming Wang, Mark Gerstein, Rui Wang, Gongshen Liu, et al. Igniting language intelligence: The hitchhiker\u2019s guide from chain-of-thought reasoning to language agents. arXiv preprint arXiv:2311.11797, 2023.   \n[62] Zhuosheng Zhang, Aston Zhang, Mu Li, and Alex Smola. Automatic chain of thought prompting in large language models. arXiv preprint arXiv:2210.03493, 2022. ", "page_idx": 10}, {"type": "text", "text": "", "page_idx": 11}, {"type": "text", "text": "", "page_idx": 12}, {"type": "text", "text": "", "page_idx": 13}, {"type": "text", "text": "", "page_idx": 14}, {"type": "text", "text": "Appendix ", "text_level": 1, "page_idx": 15}, {"type": "text", "text": "A Related Work ", "text_level": 1, "page_idx": 15}, {"type": "text", "text": "Data-unavailable OOD Detection: Generic Methods. In scenarios where OOD data is unavailable. Detection methods are categorized into three main types: (1) Output-based methods assess confidence using predicted probabilities. (2) Ensemble-based methods assess the uncertainty of a collection of supporting models, classical techniques are Monte-Carlo dropout [46, 8] based on Bayesian inference and deep ensemble [19, 31]; (3) Feature-based methods assess the Mahalanobis Distance between OOD samples and the distribution of the ID data feature space, usually considering the input and output spaces [22, 42, 48], occasionally extending to specific hidden layer spaces [1]. Besides, there are some fragmented methods, such as gradient methods [23, 15] and autoencoder reconstruction methods [7, 16]. Still, these methods suffer from optimization and computational complexity with serious performance bottlenecks [58] and thus are not mainstream detection methods. ", "page_idx": 15}, {"type": "text", "text": "OOD Detection in GLMs. Relatively few studies have explored OOD detection in GLMs, mainly in semantic parsing [31, 25], speech recognition [33], machine translation [56, 32], summarization [43], and they do not jump out of the frameworks of uncertainty estimation, ensemble-based methods, and embedding-based methods. To our knowledge, we are the first to study OOD detection on mathematical reasoning, and we have found the failure of traditional algorithms in this scenario. Mathematical reasoning is an important and difficult research topic in the era of LLMs, and this research is valuable for the scenario expansion of OOD detection algorithms on language models. ", "page_idx": 15}, {"type": "text", "text": "B Motivation Visualization Details of Figure 1 ", "text_level": 1, "page_idx": 15}, {"type": "text", "text": "B.1 Projection Setting ", "text_level": 1, "page_idx": 15}, {"type": "text", "text": "We use UMAP [34] for projection visualization, which is a nonlinear dimensionality reduction technique for mapping high-dimensional data into low-dimensional spaces. It uses optimization of the local and global structure of the original data to produce a high-quality mapping that can preserve the original data\u2019s local and global characteristics. ", "page_idx": 15}, {"type": "text", "text": "The UMAP algorithm consists of two steps: (i) Calculate the local similarity between each data point and its immediate neighbors to construct a local similarity map. (ii) Map the high-dimensional data to a low-dimensional space by optimizing an objective function that maintains the local and global structure. The hyperparameter \u201cn_neighbors\u201d in the first step is key, we set it as 10 in our paper. ", "page_idx": 15}, {"type": "text", "text": "B.2 More Examples ", "text_level": 1, "page_idx": 15}, {"type": "text", "text": "We select the MATH [6] dataset for mathematical reasoning and the OPUS [49] for text generation (translation). In the MATH, we choose four domains: algebra, geometry, number theory, and precalculus; In the OPUS, we also choose four domains: Bible, news, TED, and health. We present examples of inputs and outputs under different domains for mathematical reasoning and translation scenarios in Table 7 and Table 8, respectively. They correspond to the case projection of Figure 1. Obviously, under mathematical reasoning, the outputs under different domains may appear exactly the same, while it is impossible under translation. ", "page_idx": 15}, {"type": "text", "text": "C Theoretical Analysis of Section 2.1 ", "text_level": 1, "page_idx": 15}, {"type": "text", "text": "In this section, we theoretically analyze Why pattern collapse in the output space leads to a greater likelihood of volatility differences in trajectories under different samples, which corresponds to Hypothesis 1 in the main paper. ", "page_idx": 15}, {"type": "text", "text": "C.1 Problem Setup ", "text_level": 1, "page_idx": 15}, {"type": "text", "text": "Latent Space Embedding. For a given sample $s_{i}$ , $[\\pmb{y}_{i}]_{l}\\,\\in\\,\\mathbb{R}^{d}(1\\,\\le\\,l\\,\\le\\,L)$ denote the hidden embedding of the $l_{\\cdot}$ -th layer. We define the embedding coordinate in the latent space as $\\{(l,[{\\pmb y}_{i}]_{l})\\}_{l=1}^{L}$ . ", "page_idx": 15}, {"type": "table", "img_path": "hYMxyeyEc5/tmp/c71e1c78020fc293ec6a667e6535234d14749a73ba8f67f6ee708d23d99428ee.jpg", "table_caption": ["Table 7: Examples of inputs/outputs from different domains in the mathematical reasoning scenario. "], "table_footnote": [], "page_idx": 16}, {"type": "table", "img_path": "hYMxyeyEc5/tmp/46eb8ae4a2bdcc85fb32fb97d409b8a32ea2b2f58455e3c8edb00604c1186ac6.jpg", "table_caption": ["Table 8: Examples of inputs/outputs from different domains in the translation scenario. "], "table_footnote": [], "page_idx": 16}, {"type": "text", "text": "Embedding Interpolation. We assume the $F_{i}(x)=\\left[F_{i1}(x),F_{i2}(x),...,F_{i d}(x)\\right]^{\\intercal}:\\mathbb{R}\\rightarrow\\mathbb{R}^{d}$ with $d$ independent components fits the $L$ coordinates, representing a continuous learning trajectory for $s_{i}$ , so $[{\\pmb y}_{i}]_{l}=F_{i}({\\boldsymbol l})$ . $F_{i}(x)$ is taken from the functional space $\\mathbf{\\deltaX}$ , so $\\{F_{i}(l)\\}_{l=1}^{L}$ are all independent variables. We constrain each component function of this $F_{i}(x)$ to satisfy the $m$ -order $\\bar{(m~\\!\\geq~\\!3)}$ derivability property. Under this setting, the definition of dimension-independent trajectory volatility (Eq. 2) equates to ", "page_idx": 16}, {"type": "equation", "text": "$$\n\\begin{array}{l}{{\\displaystyle{\\cal V}(s_{i})=\\left[V_{1}(s_{i}),V_{2}(s_{i}),...,V_{L}(s_{i})\\right]^{\\top}}\\ ~}\\\\ {{\\displaystyle~~~~~~=\\frac{1}{L}\\sum_{l=1}^{L-1}\\left[|F_{i1}(l)-F_{i1}(l-1)|,|F_{i2}(l)-F_{i2}(l-1)|,...,|F_{i d}(l)-F_{i d}(l-1)|\\right]^{\\top}}\\ ~}\\end{array}\n$$", "text_format": "latex", "page_idx": 16}, {"type": "text", "text": "Modeling. We observe the \u201cpattern collapse\u201d phenomenon in the output space in Figure 1. We abstract this phenomenon in Figure 2, which compares the trajectory trend between different samples in the mathematical reasoning and text generation scenarios. ", "page_idx": 16}, {"type": "text", "text": "We specify that $[\\pmb{y}_{i}]_{L}=\\pmb{F}_{i}(L)\\sim\\mathcal{N}(\\pmb{c},\\Sigma^{2})$ , where ", "page_idx": 17}, {"type": "equation", "text": "$$\n\\begin{array}{r}{\\boldsymbol{c}=[c_{1},c_{2},...,c_{d}]^{\\top},\\;\\;\\;\\Sigma=\\mathrm{diag}(\\delta_{1},\\delta_{2},\\cdot\\cdot\\cdot\\,,\\delta_{d}).}\\end{array}\n$$", "text_format": "latex", "page_idx": 17}, {"type": "text", "text": "According to the pattern collapse property under different tasks, we can constraint the endpoint embedding $F_{i}(L)$ in the output space: ", "page_idx": 17}, {"type": "text", "text": "\u2022 For mathematical reasoning with pattern collapse, $\\Sigma\\rightarrow{\\cal O}$ , so we approximate that $\\mathbf{}F_{i}(L)\\equiv c$ ;   \n\u2022 For text generation without pattern collapse, $\\Sigma\\neq O$ , so $\\mathbf{}F_{i}(L)\\neq\\mathbf{c}$ . ", "page_idx": 17}, {"type": "text", "text": "With such constraints, we model the main theorem: ", "page_idx": 17}, {"type": "text", "text": "Theorem C.1 (Main Theorem) For different samples $s_{i}$ and $s_{j}$ , the likelihood of variations in trajectory volatility under mathematical reasoning scenarios is higher than that under text generation scenarios, which means: ", "page_idx": 17}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{\\quad\\mathbb{E}_{\\{F_{i}(l)\\}_{l=1}^{L},\\ \\{F_{j}(l)\\}_{l=1}^{L}}\\sim\\mathcal{U}(\\mathbb{R}^{d})\\left\\{V(s_{i})-V(s_{j})\\neq\\mathbf{0}|F_{i}(L),F_{j}(L)\\equiv c\\right\\}}\\\\ &{>\\mathbb{E}_{\\{F_{i}(l)\\}_{l=1}^{L},\\ \\{F_{j}(l)\\}_{l=1}^{L}}\\sim\\mathcal{U}(\\mathbb{R}^{d})\\left\\{V(s_{i})-V(s_{j})\\neq\\mathbf{0}|F_{i}(L),F_{j}(L)\\sim\\mathcal{N}(c,\\Sigma^{2})\\right\\},}\\end{array}\n$$", "text_format": "latex", "page_idx": 17}, {"type": "text", "text": "where $\\mathcal{U}(\\mathbb{R}^{d})$ denotes the uniform distribution defined in $d$ -dimensional real number space. ", "page_idx": 17}, {"type": "text", "text": "C.2 Prelinimary ", "text_level": 1, "page_idx": 17}, {"type": "text", "text": "Next, we move on to the formal proofs. We begin with some propositions and lemmas that will be useful in the main theorem. ", "page_idx": 17}, {"type": "text", "text": "Proposition C.1 (Lagrange Remainder Term) In the Taylor Expansion expression ", "page_idx": 17}, {"type": "equation", "text": "$$\nf(x)=f(a)+{\\frac{\\mathrm{d}f}{\\mathrm{d}x}}(x-a)+{\\frac{1}{2!}}\\cdot{\\frac{\\mathrm{d}^{2}f}{\\mathrm{d}x^{2}}}(x-a)^{2}+\\cdot\\cdot+{\\frac{1}{n!}}\\cdot{\\frac{\\mathrm{d}^{n}f}{\\mathrm{d}x^{n}}}(x-a)^{n}+R_{n+1}(x),\n$$", "text_format": "latex", "page_idx": 17}, {"type": "text", "text": "the remainder $R_{n+1}(x)$ has the following property: ", "page_idx": 17}, {"type": "equation", "text": "$$\n|R_{n+1}(x)|=\\left|{\\frac{1}{(n+1)!}}\\cdot{\\frac{\\mathrm{d}^{n+1}f}{\\mathrm{d}\\!c^{n+1}}}\\cdot(x-a)^{n+1}\\right|\\leq{\\frac{M}{(n+1)!}}\\cdot\\left|(x-a)^{n+1}\\right|,\n$$", "text_format": "latex", "page_idx": 17}, {"type": "text", "text": "where $c\\in[a,x]$ or $c\\in[x,a]$ , and $\\begin{array}{r}{M=\\operatorname*{sup}\\left\\{\\left|\\frac{\\mathrm{d}^{n+1}f}{\\mathrm{d}\\xi^{n+1}}\\right|:\\xi\\in[a,x]\\;o r\\,\\xi\\in[x,a]\\right\\}>0.}\\end{array}$ ", "page_idx": 17}, {"type": "text", "text": "Proof. We consider the case of $a<x$ with $a>x$ identically. We use the Fundamental Theorem of Calculus (FTC) for the most basic expansion of $f(x)$ : ", "page_idx": 17}, {"type": "equation", "text": "$$\nf(x)=f(a)+\\int_{a}^{x}{\\frac{\\mathrm{d}f}{\\mathrm{d}x_{1}}}\\;\\mathrm{d}x_{1}.\n$$", "text_format": "latex", "page_idx": 17}, {"type": "text", "text": "Continue to use the FTC to expand the derivatives in integrals: ", "page_idx": 17}, {"type": "equation", "text": "$$\n\\begin{array}{l}{\\displaystyle f(\\boldsymbol{x})=f(\\boldsymbol{a})+\\int_{a}^{x}\\frac{\\mathrm{d}f}{\\mathrm{d}x_{1}}\\,\\mathrm{d}x_{1}=f(\\boldsymbol{a})+\\int_{a}^{x}\\left(\\frac{\\mathrm{d}f}{\\mathrm{d}a}+\\int_{a}^{x_{1}}\\frac{\\mathrm{d}^{2}f}{\\mathrm{d}x_{2}^{2}}\\,\\mathrm{d}x_{2}\\right)\\,\\mathrm{d}x_{1}}\\\\ {\\displaystyle\\qquad=f(\\boldsymbol{a})+\\frac{\\mathrm{d}f}{\\mathrm{d}x}(\\boldsymbol{x}-\\boldsymbol{a})+\\int_{a}^{x}\\int_{a}^{x_{1}}\\frac{\\mathrm{d}^{2}f}{\\mathrm{d}x_{2}^{2}}\\,\\mathrm{d}x_{2}\\,\\mathrm{d}x_{1}}\\\\ {\\displaystyle\\qquad=\\cdots}\\\\ {\\displaystyle=\\sum_{k=0}^{n}\\frac{1}{k!}\\cdot\\frac{\\mathrm{d}^{k}f}{\\mathrm{d}a^{k}}\\cdot(\\boldsymbol{x}-\\boldsymbol{a})^{k}+\\int_{a}^{x}\\int_{a}^{x_{1}}\\int_{a}^{x_{2}}\\cdots\\int_{a}^{x_{n}}\\frac{\\mathrm{d}^{n+1}f}{\\mathrm{d}x_{n+1}^{n+1}}\\,\\mathrm{d}x_{n+1}\\,\\mathrm{d}x_{n}\\cdot\\cdot\\cdot\\,\\mathrm{d}x_{1}.}\\end{array}\n$$", "text_format": "latex", "page_idx": 17}, {"type": "text", "text": "Therefore, the generalized remainder is known as ", "page_idx": 17}, {"type": "equation", "text": "$$\n{\\begin{array}{r l}&{R_{n+1}(x)=\\int_{a}^{x}\\int_{a}^{x_{1}}\\int_{a}^{x_{2}}\\cdot\\cdot\\cdot\\int_{a}^{x_{n}}{\\frac{\\mathrm{d}^{\\mathrm{n}+1}f}{\\mathrm{d}x_{n+1}^{n+1}}}\\;\\mathrm{d}x_{n+1}\\;\\mathrm{d}x_{n}\\cdot\\cdot\\cdot\\;\\mathrm{d}x_{1}}\\\\ &{\\qquad\\qquad=\\int_{a}^{x}{\\frac{1}{n!}}\\cdot{\\frac{\\mathrm{d}^{\\mathrm{n}+1}f}{\\mathrm{d}t^{n+1}}}\\cdot(x-t)^{n}\\;\\mathrm{d}t.}\\end{array}}\n$$", "text_format": "latex", "page_idx": 17}, {"type": "text", "text": "$\\begin{array}{r}{m_{n+1}=\\operatorname*{min}_{t\\in[a,x]}\\frac{{\\mathrm{d}}^{{\\mathrm{n}}+1}f}{{\\mathrm{d}}t^{n+1}}}\\end{array}$ and $\\begin{array}{r}{M_{n+1}=\\operatorname*{max}_{t\\in[a,x]}\\frac{\\mathrm{d}^{n+1}f}{\\mathrm{d}t^{n+1}}}\\end{array}$ , so ", "page_idx": 18}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{\\qquad m_{n+1}\\displaystyle\\int_{a}^{x}(x-t)^{n}\\,\\mathrm{d}t\\le\\int_{a}^{x}\\frac{\\mathrm{d}^{\\mathrm{n}+1}f}{\\mathrm{d}t^{n+1}}\\cdot(x-t)^{n}\\,\\mathrm{d}t\\le M_{n+1}\\displaystyle\\int_{a}^{x}(x-t)^{n}\\,\\mathrm{d}t}\\\\ &{\\Longrightarrow\\,m_{n+1}\\le\\frac{\\int_{a}^{x}\\frac{\\mathrm{d}^{\\mathrm{n}+1}f}{\\mathrm{d}t^{n+1}}\\cdot(x-t)^{n}}{\\frac{(x-a)^{n+1}}{n+1}}\\le M_{n+1}.}\\end{array}\n$$", "text_format": "latex", "page_idx": 18}, {"type": "text", "text": "According to the Lagrange\u2019s Mean Value Theorem, there must exist a number $c\\in[a,x]$ with ", "page_idx": 18}, {"type": "equation", "text": "$$\n\\frac{\\mathrm{d}^{\\mathrm{n+1}}f}{\\mathrm{d}c^{n+1}}=\\frac{\\int_{a}^{x}\\frac{\\mathrm{d}^{\\mathrm{n+1}}f}{\\mathrm{d}t^{n+1}}\\cdot(x-t)^{n}}{\\frac{(x-a)^{n+1}}{n+1}},\n$$", "text_format": "latex", "page_idx": 18}, {"type": "text", "text": "this gives us ", "page_idx": 18}, {"type": "equation", "text": "$$\n\\begin{array}{r l r}&{}&{\\int_{a}^{x}\\frac{\\mathrm{d}^{n+1}f}{\\mathrm{d}t^{n+1}}\\cdot(x-t)^{n}=\\frac{\\mathrm{d}^{n+1}f}{\\mathrm{d}c^{n+1}}\\cdot\\frac{(x-a)^{n+1}}{n+1}}\\\\ &{}&{\\implies R_{n+1}(x)=\\frac{1}{(n+1)!}\\cdot\\frac{\\mathrm{d}^{n+1}f}{\\mathrm{d}c^{n+1}}\\cdot(x-a)^{n+1},}\\end{array}\n$$", "text_format": "latex", "page_idx": 18}, {"type": "text", "text": "and the equation on the left side of the proposition is proved completely. The inequality on the right-hand side is clearly established by the Lagrange\u2019s Mean Value Theorem. \u25a1 ", "page_idx": 18}, {"type": "text", "text": "Lemma C.1 (Error Bound for the Midpoint Rule) Suppose that $f(x)$ is a m-th $(m\\geq2)$ order differentiable function on the interval $(-\\infty,+\\infty)$ , and $\\begin{array}{r}{K=\\operatorname*{sup}\\left\\{\\left|\\frac{\\mathrm{d}^{2}f}{\\mathrm{d}x^{2}}\\right|:x\\in[a,b]\\right\\}\\in\\mathbb{R},}\\end{array}$ , then ", "page_idx": 18}, {"type": "equation", "text": "$$\n\\left|\\int_{a}^{b}f(x)\\,\\mathrm{d}x-(b-a)f\\left({\\frac{a+b}{2}}\\right)\\right|\\leq{\\frac{K}{24}}(b-a)^{3}\n$$", "text_format": "latex", "page_idx": 18}, {"type": "text", "text": "Proof. We do the first order Taylor Expansion for $f(x)$ at the midpoint $\\textstyle x={\\frac{a+b}{2}}$ of the interval $[a,b]$ : ", "page_idx": 18}, {"type": "equation", "text": "$$\n\\begin{array}{l}{\\displaystyle\\left|\\int_{a}^{b}f(x)\\,\\mathrm{d}x-(b-a)f\\left(\\frac{a+b}{2}\\right)\\right|=\\left|\\int_{a}^{b}\\left[f(x)-f\\left(\\frac{a+b}{2}\\right)\\right]\\,\\mathrm{d}x\\right|}\\\\ {\\displaystyle=\\left|\\int_{a}^{b}\\left[\\frac{\\mathrm{d}f}{\\mathrm{d}\\left(\\frac{a+b}{2}\\right)}\\cdot\\left(x-\\frac{a+b}{2}\\right)+R_{1}(x)\\right]\\mathrm{d}x\\right|}\\\\ {\\displaystyle=\\left|0+\\int_{a}^{b}R_{1}(x)\\,\\mathrm{d}x\\right|=\\left|\\int_{a}^{b}R_{1}(x)\\,\\mathrm{d}x\\right|}\\end{array}\n$$", "text_format": "latex", "page_idx": 18}, {"type": "text", "text": "Following Theorem C.1, we do the inequality scaling as below: ", "page_idx": 18}, {"type": "equation", "text": "$$\n\\left|\\int_{a}^{b}R_{1}(x)\\,\\mathrm{d}x\\right|\\leq\\left|\\int_{a}^{b}{\\frac{K}{2!}}\\left(x-{\\frac{a+b}{2}}\\right)^{2}\\,\\mathrm{d}x\\right|={\\frac{K}{6}}\\left[\\left({\\frac{b-a}{2}}\\right)^{3}-\\left({\\frac{a-b}{2}}\\right)^{3}\\right]={\\frac{K}{24}}(b-a)^{3}\n$$", "text_format": "latex", "page_idx": 18}, {"type": "text", "text": "Lemma C.2 (Differential-Integral Error Order Estimation) Suppose that $f(x)$ is $\\textit{a}\\ m{-}t h$ $\\begin{array}{r l r}{(m}&{{}\\geq}&{3)}\\end{array}$ order differentiable function on the interval $\\left(-\\infty,+\\infty\\right)$ and $\\begin{array}{r l}{K_{i}}&{{}=}\\end{array}$ $\\begin{array}{r}{\\operatorname*{sup}\\left\\{\\left|\\frac{\\mathrm{d}^{i}f}{\\mathrm{d}x^{i}}\\right|:x\\in(-\\infty,+\\infty)\\right\\}\\,<\\,+\\infty\\ (i\\,=\\,1,2,\\cdot\\cdot\\cdot\\,,m),}\\end{array}$ , then on the closed interval $[a,b]$ , we have ", "page_idx": 18}, {"type": "equation", "text": "$$\nA:=\\left\\{\\left|\\sum_{i=1}^{L}\\left|f\\left(a+{\\frac{b-a}{L}}i\\right)-f\\left(a+{\\frac{b-a}{L}}(i-1)\\right)\\right|-\\int_{a}^{b}\\left|{\\frac{\\mathrm{d}f}{\\mathrm{d}x}}\\right|\\,\\mathrm{d}x\\right|\\right\\}\\leq R(L)\\sim o({\\frac{1}{L}}).\n$$", "text_format": "latex", "page_idx": 18}, {"type": "text", "text": "Proof. For each sub-interval $\\begin{array}{r}{\\left(a+\\frac{b-a}{L}(i-1),a+\\frac{b-a}{L}i\\right)}\\end{array}$ , we perform a Taylor Expansion at the midpoint $\\begin{array}{r}{x=a+\\frac{b-a}{L}(i-\\frac{1}{2})}\\end{array}$ to obtain the following expression: ", "page_idx": 19}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{\\quad\\displaystyle\\sum_{i=1}^{L}\\left|f(a+\\frac{b-a}{L}a_{i})-f(a+\\frac{b-a}{L}a_{i}-1)\\right|}\\\\ &{=\\displaystyle\\sum_{i=1}^{L}\\left[f\\left(a+\\frac{b-a}{L}(i-\\frac{1}{2})\\right)+\\frac{\\mathrm{d}f}{\\mathrm{d}\\left(a+\\frac{b-a}{2}(i-\\frac{1}{2})\\right)},\\frac{b-a}{L}+\\mathcal{O}\\left[\\left(\\frac{b-a}{2L}\\right)^{2}\\right]\\right]}\\\\ &{\\quad-\\left[f\\left(a+\\frac{b-a}{L}(i-\\frac{1}{2})\\right)+\\frac{\\mathrm{d}f}{\\mathrm{d}\\left(a+\\frac{b-a}{2}(i-\\frac{1}{2})\\right)},\\frac{a-b}{L}+\\mathcal{O}\\left[\\left(\\frac{b-a}{2L}\\right)^{2}\\right]\\right]\\right|}\\\\ &{=\\displaystyle\\sum_{i=1}^{L}\\left|\\frac{\\mathrm{d}f}{\\mathrm{d}\\left(a+\\frac{b-a}{L}(i-\\frac{1}{2})\\right)}\\cdot\\frac{b-a}{L}+\\mathcal{O}(\\frac{1}{L^{2}})\\right|}\\\\ &{\\quad\\le\\displaystyle\\frac{b-a}{L}\\cdot\\sum_{i=1}^{L}\\left|\\frac{\\mathrm{d}f}{\\mathrm{d}\\left(a+\\frac{b-a}{L}(i-\\frac{1}{2})\\right)}\\right|+\\sum_{i=1}^{L}\\mathcal{O}(\\frac{1}{L^{2}})}\\\\ &{=\\displaystyle\\frac{b-a}{L}\\cdot\\sum_{i=1}^{L}\\left|\\frac{\\mathrm{d}f}{\\mathrm{d}\\left(a+\\frac{b-a}{L}(i-\\frac{1}{2})\\right)}\\right|+\\mathcal{O}(\\frac{1}{L})}\\end{array}\n$$", "text_format": "latex", "page_idx": 19}, {"type": "text", "text": "Following Lemma C.1, we do the inequality scaling for the first-order derivative summation: ", "page_idx": 19}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{\\quad\\cfrac{b-a}{L}\\cdot\\displaystyle\\sum_{i=1}^{L}\\left|\\frac{\\mathrm{d}f}{\\mathrm{d}\\,\\big(a+\\frac{b-a}{L}(i-\\frac{1}{2})\\big)}\\right|\\leq\\sum_{i=1}^{L}\\int_{a+\\frac{b-a}{L}(i-1)}^{a+\\frac{b-a}{L}i}\\left[\\left|\\frac{\\mathrm{d}f}{\\mathrm{d}x}\\right|+\\frac{K_{3}}{24}\\left(\\frac{b-a}{L}\\right)^{3}\\right]\\,\\mathrm{d}x}\\\\ &{=\\displaystyle\\int_{a}^{b}\\left[\\left|\\frac{\\mathrm{d}f}{\\mathrm{d}x}\\right|+\\frac{K_{3}(b-a)^{3}}{24L^{2}}\\right]\\,\\mathrm{d}x=\\int_{a}^{b}\\left|\\frac{\\mathrm{d}f}{\\mathrm{d}x}\\right|\\,\\mathrm{d}x+\\frac{K_{3}(b-a)^{4}}{24L^{2}}}\\end{array}\n$$", "text_format": "latex", "page_idx": 19}, {"type": "equation", "text": "$$\n\\mathcal{A}:\\leq\\frac{K_{3}(b-a)^{4}}{24L^{2}}+\\mathcal{O}(\\frac{1}{L})=R(L)\\sim o(\\frac{1}{L})\n$$", "text_format": "latex", "page_idx": 19}, {"type": "text", "text": "C.3 Main Theorem Proof ", "text_level": 1, "page_idx": 19}, {"type": "text", "text": "Finally, we formally prove our main theorem C.1 in this sub-section, thereby verifying the Hypotheses 1 in the main paper. Since the $d$ components of $V(s_{i})-V(s_{j})$ are independent of each other, we only consider the $d$ -th dimensional component and the rest of the components $V_{d}(s_{i})-V_{d}(s_{j})$ can be proved in the same way. ", "page_idx": 19}, {"type": "text", "text": "Proof. According to Lemma C.2, we can approximate $V_{d}(s_{i})-V_{d}(s_{j})$ as ", "page_idx": 19}, {"type": "equation", "text": "$$\n\\begin{array}{l}{{\\displaystyle V_{d}(s_{i})-V_{d}(s_{j})=\\sum_{l=1}^{L}|F_{i d}(l)-F_{i d}(l-1)|-\\sum_{l=1}^{L}|F_{j d}(l)-F_{j d}(l-1)|}}\\\\ {{\\displaystyle=\\int_{1}^{L}\\left|\\frac{\\mathrm{d}F_{i d}}{\\mathrm{d}x}\\right|\\;\\mathrm{d}x-\\int_{1}^{L}\\left|\\frac{\\mathrm{d}F_{j d}}{\\mathrm{d}x}\\right|\\;\\mathrm{d}x+\\mathcal{O}(\\frac{1}{L})}}\\\\ {{\\displaystyle\\approx\\int_{1}^{L}\\left|\\frac{\\mathrm{d}F_{i d}}{\\mathrm{d}x}\\right|\\;\\mathrm{d}x-\\int_{1}^{L}\\left|\\frac{\\mathrm{d}F_{j d}}{\\mathrm{d}x}\\right|\\;\\mathrm{d}x}}\\end{array}\n$$", "text_format": "latex", "page_idx": 19}, {"type": "text", "text": "Now we want to remove the absolute value of the integrated function. Due to the continuity of the first-order derivative, there must be several zero points that are not extreme points, dividing the domain of function definition into several open intervals with alternating constant positive and negative function values. We first define such a set of zeros on the domain of definition $\\dot{\\mathcal{D}}=[1,L]$ : ", "page_idx": 19}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{{\\mathscr X}_{i}=\\left\\{x\\mid x\\in{\\mathcal D};\\frac{\\mathrm{d}F_{i d}}{\\mathrm{d}x}=0\\right\\}=\\{i_{1},i_{2},\\cdots,i_{p}\\},}\\\\ &{{\\mathscr X}_{j}=\\left\\{x\\mid x\\in{\\mathcal D};\\frac{\\mathrm{d}F_{j d}}{\\mathrm{d}x}=0\\right\\}=\\{j_{1},j_{2},\\cdots,j_{q}\\}.}\\end{array}\n$$", "text_format": "latex", "page_idx": 19}, {"type": "text", "text": "For all zero points $i_{t}\\in\\mathcal{X}_{i}$ or ${j_{t}}\\in\\mathcal{X}_{j}$ , they must satisfy the following properties to ensure that they are not extreme points: ", "page_idx": 20}, {"type": "equation", "text": "$$\n\\exists\\epsilon>0,\\forall\\Delta x<\\epsilon,\\frac{\\mathrm{d}F_{i d}}{\\mathrm{d}(i_{t}-\\Delta x)}\\cdot\\frac{\\mathrm{d}F_{i d}}{\\mathrm{d}(i_{t}+\\Delta x)}<0,\n$$", "text_format": "latex", "page_idx": 20}, {"type": "text", "text": "and $j_{t}$ is the same as $i_{t}$ . Therefore, in the sub-interval $(1,i_{1}),(i_{1},i_{2}),\\cdots,(i_{p},L),\\;F_{i d}(x)$ is alternately constant positive and constant negative, and the same as $F_{j d}(x)$ . ", "page_idx": 20}, {"type": "text", "text": "We assume that the first interval $(1,i_{1})$ and $(1,j_{1})$ are constant positive intervals (the same can be proven for constant negative intervals). In this setting, we can continue to simplify Eq.22: ", "page_idx": 20}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{\\quad\\int_{1}^{L}\\left|\\frac{\\mathrm{d}F_{\\hat{\\varepsilon}}}{\\mathrm{d}x}\\right|\\,\\mathrm{d}x-\\int_{1}^{L}\\left|\\frac{\\mathrm{d}F_{\\hat{\\varepsilon}}}{\\mathrm{d}x}\\right|\\,\\mathrm{d}x}\\\\ &{=\\Biggl(\\int_{1}^{L}\\left|\\frac{\\mathrm{d}F_{\\hat{\\varepsilon}}}{\\mathrm{d}x}\\right|\\,\\mathrm{d}x+\\int_{i_{1}}^{L}\\left|\\frac{\\mathrm{d}F_{\\hat{\\varepsilon}}}{\\mathrm{d}x}\\right|\\,\\mathrm{d}x+\\cdots+\\int_{i_{p}}^{L}\\left|\\frac{\\mathrm{d}F_{\\hat{\\varepsilon}}}{\\mathrm{d}x}\\right|\\,\\mathrm{d}x\\Biggr)}\\\\ &{\\quad-\\left(\\int_{1}^{L}\\left|\\frac{\\mathrm{d}F_{\\hat{\\varepsilon}}}{\\mathrm{d}x}\\right|\\,\\mathrm{d}x+\\int_{2i_{p}}^{L_{2}}\\left|\\frac{\\mathrm{d}F_{\\hat{\\varepsilon}}}{\\mathrm{d}x}\\right|\\,\\mathrm{d}x+\\cdots+\\int_{j_{p}}^{L}\\left|\\frac{\\mathrm{d}F_{\\hat{\\varepsilon}}}{\\mathrm{d}x}\\right|\\,\\mathrm{d}x\\right)}\\\\ &{=\\left[F_{i\\ell}(x)\\right]_{1}^{i_{1}}+(-1)\\cdot F_{i\\ell}(x)|_{1}^{i_{2}}+\\cdots+(-1)^{i_{p}}\\cdot F_{i\\ell}(x)|_{i_{p}}^{L_{\\ell}}\\Biggr]}\\\\ &{\\quad-\\left[F_{j\\ell}(x)\\right]_{1}^{i_{1}}+(-1)\\cdot F_{j\\ell}(x)|_{1}^{i_{2}}+\\cdots+(-1)^{i_{p}}\\cdot F_{j\\ell}(x)|_{i_{p}}^{j_{2}}\\Biggr]}\\\\ &{=[\\!-F_{i\\ell}(1)\\!+\\!F_{j\\ell}(1)]+\\left[\\sum_{k=1}^{p}\\!\\!\\!(\\!x\\!-\\!1\\!)^{k-1}\\cdot F_{i\\ell}(i_{k})\\!-\\!2\\!\\sum_{k=1}^{q}\\!\\!\\left(\\!-\\!1\\!)^{k-1}\\!\\cdot F_{j\\ell}(j_{k})\\!\\right]}\\\\ &{\\quad+[\\!-\\!(1\\!-\\!1)^{i_{p}-1}\\!\\cdot F_{i\\ell}(L)-(-1)^{i_{p}\n$$", "text_format": "latex", "page_idx": 20}, {"type": "text", "text": "Since $F_{i d}(x)$ and $F_{j d}(x)$ are taken from the functional space, $\\{F_{i d}(1),\\{F_{i d}(i_{k})\\}_{k=1}^{p}\\}$ and $\\{F_{j d}(1),\\{F_{j d}(j_{k})\\}_{k=1}^{q}\\}$ can be seen as independent variables. We let ", "page_idx": 20}, {"type": "equation", "text": "$$\nc=\\left[(-1)^{i_{p}-1}\\cdot F_{i d}(L)-(-1)^{j_{q}-1}\\cdot F_{j d}(L)\\right],\n$$", "text_format": "latex", "page_idx": 20}, {"type": "text", "text": "then we can rewrite Eq.25 to the matrix form: ", "page_idx": 20}, {"type": "equation", "text": "$$\n\\int_{1}^{L}\\left|{\\frac{\\mathrm{d}F_{i d}}{\\mathrm{d}x}}\\right|\\;\\mathrm{d}x-\\int_{1}^{L}\\left|{\\frac{\\mathrm{d}F_{j d}}{\\mathrm{d}x}}\\right|\\;\\mathrm{d}x=A\\pmb{x}+c,\n$$", "text_format": "latex", "page_idx": 20}, {"type": "text", "text": "where $\\pmb{A}$ is the coefficient matrix, and $\\textbf{\\em x}$ is the unknown variable vector: ", "page_idx": 20}, {"type": "equation", "text": "$$\n\\begin{array}{r l}&{A=[-1,1,\\underbrace{2,-2,2,-2,\\dots,(-1)^{p-1}\\cdot2}_{p\\mathrm{~dimensions}},\\underbrace{-2,2,-2,2,\\dots,(-1)^{q}\\cdot2}_{q\\mathrm{~dimensions}}]\\in\\mathbb{R}^{1\\times(p+q+2)}}\\\\ &{x=[F_{i d}(1),F_{j d}(1),F_{i d}(i_{1}),...,F_{i d}(i_{p}),F_{j d}(j_{1}),...,F_{j d}(j_{q})]^{\\top}\\in\\mathbb{R}^{(p+q+2)\\times1}}\\end{array}\n$$", "text_format": "latex", "page_idx": 20}, {"type": "text", "text": "We let $i_{p}\\equiv j_{q}(\\bmod2)$ , and return to the condition in the mathematical expectation on both sides of the inequality in the main theorem C.1 for the following categorical discussion: ", "page_idx": 20}, {"type": "text", "text": "We denote $N(A)$ as the solution space of $\\{{\\pmb x}|A{\\pmb x}={\\bf0}\\}$ and $P(A)$ as the solution space of $\\{x|A x=$ $-c\\}$ . For $x\\in P(A)$ , $x=x_{p}$ or $x=x_{p}+x_{n}$ where $x_{p}$ is the special solution and $x_{n}$ is the solution in zero space, $i.e.$ ., $x_{n}\\in N{\\dot{(}}A{\\big)}$ . Since $\\operatorname{rank}(A)=1\\,\\Bar{<}\\,p+q+2$ , the special solution $x_{p}$ exists, so the size of the solution space $P(A)$ is larger than $N(A)$ . In this case, when the variable $\\textbf{\\em x}$ is sampled from the real number space, its probability of being in $N(A)$ is smaller, namely its probability of not being in $N(A)$ is larger. This is exactly equivalent to the form of the proof of Main Theorem C.1, so the proof is complete. \u25a1 ", "page_idx": 20}, {"type": "text", "text": "C.4 Extended Conclusion ", "text_level": 1, "page_idx": 21}, {"type": "text", "text": "During the proof of the main theorem, we can unlock a hidden conclusion due to the embedding interpolation: GLMs with a larger number of hidden layers may achieve more stable detection performance, i.e., discrepancies in embedding volatility of different samples will be more obvious. ", "page_idx": 21}, {"type": "text", "text": "In Lemma C.2, we have proved the upper bound of differential-integral error order estimation is the equivalent infinitesimals of $1/L$ . Actually, when $L\\to+\\infty$ , we have ", "page_idx": 21}, {"type": "equation", "text": "$$\n\\operatorname*{lim}_{L\\to+\\infty}\\sum_{i=1}^{L}\\left|f\\left(a+{\\frac{b-a}{L}}i\\right)-f\\left(a+{\\frac{b-a}{L}}(i-1)\\right)\\right|=\\int_{a}^{b}\\left|{\\frac{\\mathrm{d}f}{\\mathrm{d}x}}\\right|\\,\\mathrm{d}x,\n$$", "text_format": "latex", "page_idx": 21}, {"type": "text", "text": "which is clear according to the definition of Riemann Sum. This means that when the value of $L$ increases, the differential-integral approximation error will be reduced, so the conclusion of the main theorem will be more accurate. In our experiments, we use GPT2-XL (48 layers) and Llama2-7B (32 layers) as training backbones and find that the average performance of GPT2-XL is higher and more stable than that of Llama2-7B, while the number of layers of GPT2-XL is 1.5 times that of Llama2-7B. This further validates the correctness of our extended conclusions. ", "page_idx": 21}, {"type": "text", "text": "D Algorithm: TV Score Computation ", "text_level": 1, "page_idx": 21}, {"type": "text", "text": "The pseudo-code of our TV Score computation pipeline is shown in Algorithm 1. ", "page_idx": 21}, {"type": "table", "img_path": "hYMxyeyEc5/tmp/bf520016cea47bec46c7b23d60321ea4b7e8f31dd2ec06a71d35e0d6e05c7a49.jpg", "table_caption": [], "table_footnote": [], "page_idx": 21}, {"type": "text", "text": "As for the computational complexity, once we have all $\\textit{\\textbf{y}\\ }$ , our TV score requires only scalar addition and multiplication. During the ID distribution ftiting phase, both operations are $O({\\bar{L}}d n)$ , where $n$ is the dataset size. During the score computation phase, both operations are $\\mathcal{O}(L d k)$ . In practice, the computation time is measured in milliseconds. ", "page_idx": 21}, {"type": "text", "text": "E Experimental Setting Details ", "text_level": 1, "page_idx": 21}, {"type": "text", "text": "E.1 Basic Information of Dataset ", "text_level": 1, "page_idx": 21}, {"type": "text", "text": "For the ID dataset, we use the MultiArith [44], which consists of Math Word Problems on arithmetic reasoning. For the OOD datasets, we intuitively introduce two types of detection scenarios following [43]: (i) Far-shift OOD setting, we select the MATH [11] as the OOD data, which spans across distinct mathematical domains encompassing algebra, geometry, counting and probability, number theory, and precalculus. It contains college difficulty level math problems, whereas MultiArith has only elementary school difficulty, and thus can be considered as sourced from far-different distributions; (ii) Near-shift OOD setting, we select five arithmetic reasoning datasets as the OOD data: GSM8K [6], SVAMP [39], AddSub [13], SingleEq [18], and SingleOp [18], they all consist of Math Word Problems like the MultiArith but require different reasoning hops and knowledge points for solving the problems, and thus can be considered as sourced from near-different distributions. In addition, we present the data sizes and examples of all ID and OOD datasets, as shown in Table 9. ", "page_idx": 21}, {"type": "text", "text": "", "page_idx": 22}, {"type": "text", "text": "E.2 ID Dataset Split ", "text_level": 1, "page_idx": 22}, {"type": "text", "text": "For the ID dataset MultiArith, we find that every 100 consecutive samples show a similar quadratic operation pattern (e.g., samples with id 0-100 are a mixture of addition and subtraction, and id 100-200 are a mixture of addition and multiplication). Therefore, we divide it into 6 subsets $(6^{*}100)$ in order. In each subset, we take the first 60 as training samples and the last 40 as test samples. ", "page_idx": 22}, {"type": "text", "text": "E.3 Training Implementation ", "text_level": 1, "page_idx": 22}, {"type": "text", "text": "We train Llama2-7B [50] and GPT2-XL [5] models on the training split of MultiArith. Llama2-7B is trained with AdamW optimizer [29] for 10K steps and 8 batch sizes in 4-card RTX 3090 (2 per card). The learning rate is set to 1e-5, the warmup step to 10, and the maximum gradient normalization to 0.3. GPT2-XL is trained for 3K steps and 128 batch sizes in a single RTX 3090, and other configurations are the same as Llama2-7B. ", "page_idx": 22}, {"type": "text", "text": "E.4 OOD Dataset Selection Rationality ", "text_level": 1, "page_idx": 22}, {"type": "text", "text": "In this part, we examine the rationality of the OOD data selection, ensuring that the OOD data distribution significantly differs from the pre-trained data distribution and has not been fully learned during the pre-training phase. Some research [57, 59] have confirmed the absence of data leakage in Llama2 for MATH and GSM8K datasets, we still conduct experiments and analyses to ensure this. ", "page_idx": 22}, {"type": "text", "text": "For GPT2-XL, We can determine this from the time dimension. GPT-2 was released in 2019, but the MATH and GSM8k datasets were released in 2021, so they are unlikely to appear in the pre-training data. However, for Llama2-7B, due to the closed-source data, we cannot confirm which data the model used in the pre-training phase, so we cannot fully determine whether the selected dataset was OOD for the model from a data perspective. ", "page_idx": 22}, {"type": "text", "text": "Therefore, we argue that a dataset can be considered OOD when it is beyond the capability of the base model as claimed by prior work [47, 27]. We test all ten datasets we select as the OOD data in the pre-trained Llama2-7B and GPT2-XL model, and Table 10 shows the results. We find that GPT2-XL cannot handle any of the ten mathematical reasoning tasks, and Llama2-7B performs with very low accuracy. Therefore, from a capability standpoint, we can ensure that these datasets are OOD for these two GLMs. ", "page_idx": 22}, {"type": "text", "text": "E.5 Baseline ", "text_level": 1, "page_idx": 22}, {"type": "text", "text": "Let $\\textbf{\\em x}$ represent the input sequence and $\\textit{\\textbf{y}}$ the output sequence, with lengths denoted as $n_{x}$ and $n_{y}$ respectively. In addition, we assume that $p(\\cdot;\\theta)$ represents the GLM parameterized by $\\pmb{\\theta}$ that has been trained in ID dataset $\\mathcal{D}$ , outputting a sequence of softmax probabilities. We compare some training-free baseline methods as below: ", "page_idx": 22}, {"type": "text", "text": "\u2022 Maximum Softmax Probability [12]: ", "page_idx": 22}, {"type": "equation", "text": "$$\n\\frac{1}{n_{y}}\\cdot\\sum_{i=1}^{n_{y}}p(y_{i}|y_{\\prec i},x;\\pmb\\theta).\n$$", "text_format": "latex", "page_idx": 22}, {"type": "text", "text": "\u2022 Monte-Carlo Dropout [8]: ", "page_idx": 22}, {"type": "equation", "text": "$$\n\\int p(\\pmb{y}|\\pmb{x};\\pmb{\\theta})q(\\pmb{\\theta})\\mathrm{d}\\theta,\n$$", "text_format": "latex", "page_idx": 22}, {"type": "text", "text": "where $q(\\pmb\\theta)\\approx p(\\pmb\\theta|\\mathcal{D})$ . ", "page_idx": 22}, {"type": "text", "text": "Table 9: ID and OOD datasets used in this paper. ", "page_idx": 23}, {"type": "table", "img_path": "hYMxyeyEc5/tmp/b6620d06ded21a5cb86aacf68e0eaf8816f0778305bf5d2ccd58af1344a47078.jpg", "table_caption": [], "table_footnote": [], "page_idx": 23}, {"type": "table", "img_path": "hYMxyeyEc5/tmp/fc43a2738d913520ccfec4c13f6cb0967655850e3226748cb2cc1c2b0640a55a.jpg", "table_caption": ["Table 10: Accuracies of all datasets we select as the OOD data in pre-trained GLMs. "], "table_footnote": [], "page_idx": 24}, {"type": "text", "text": "\u2022 Sequence Perplexity [43]: ", "page_idx": 24}, {"type": "equation", "text": "$$\n\\left[\\prod_{i=1}^{n_{y}}p(y_{i}|y_{\\prec i},\\pmb{x};\\pmb{\\theta})\\right]^{-\\frac{1}{n_{y}}}.\n$$", "text_format": "latex", "page_idx": 24}, {"type": "text", "text": "\u2022 Input Embedding [43]: ", "page_idx": 24}, {"type": "equation", "text": "$$\n({\\pmb x}-{\\pmb\\mu}_{x})^{\\top}{\\pmb\\Sigma}_{x}^{-1}({\\pmb x}-{\\pmb\\mu}_{x}),\n$$", "text_format": "latex", "page_idx": 24}, {"type": "text", "text": "where $\\pmb{\\mu}_{x}$ and $\\pmb{\\Sigma}_{x}$ represent the mean and variance of the Gaussian distribution associated with the first-layer hidden state. ", "page_idx": 24}, {"type": "text", "text": "\u2022 Output Embedding [43]: ", "page_idx": 24}, {"type": "equation", "text": "$$\n(\\pmb{y}-\\pmb{\\mu}_{y})^{\\top}\\pmb{\\Sigma}_{y}^{-1}(\\pmb{y}-\\pmb{\\mu}_{y}),\n$$", "text_format": "latex", "page_idx": 24}, {"type": "text", "text": "where $\\pmb{\\mu}_{y}$ and $\\Sigma_{y}$ represent the mean and variance of the Gaussian distribution associated with the final-layer hidden state. ", "page_idx": 24}, {"type": "text", "text": "F Supplementary Experimental Results ", "text_level": 1, "page_idx": 24}, {"type": "text", "text": "F.1 Hyperparameter Ablation: Smoothing Order k ", "text_level": 1, "page_idx": 24}, {"type": "image", "img_path": "hYMxyeyEc5/tmp/192cdb331c6579b4b66c7a1efa962b2682019f1304b49c44de9ba7a139c1d9e3.jpg", "img_caption": ["Figure 4: Smoothing order $k$ analysis: $k$ ranges from 0 \u22125 $k=0$ corresponds to the original TV Score). The upper part is for the OOD detection scenario and the lower part is for the OOD quality estimation scenario; the left part is for the far-shift OOD datasets and the right part is for the near-shift OOD datasets. "], "img_footnote": [], "page_idx": 24}, {"type": "text", "text": "In the main experiments, we found that differential smoothing is not as effective as the basic TV score, with excellent results occurring on only a few datasets. Figure 4 visualizes the results for the ", "page_idx": 24}, {"type": "text", "text": "OOD detection scenario with no smoothing ( $[k=0]$ ) and smoothing order $k\\,1{-}5$ . We find that there is a significant effect of differential smoothing in two cases: (1) very good performance without smoothing, e.g., the precalculus dataset, where the AUROC results are almost close to $100\\%$ ; and (2) significantly poor performance without smoothing, e.g., the AddSub dataset, where the FPR95 results on all other near-shift OOD datasets are 20 below, the results on this dataset are more than 80, when differential smoothing helps to eliminate some of the noise features and helps better detection. ", "page_idx": 25}, {"type": "text", "text": "In addition, for the case of $k>0$ , the peak performance basically occurs in the case of $k=1$ or 2, which indicates that when $k$ is too large, the phenomenon of over-smoothing tends to occur. Too much useful feature information is lost, leading to a decrease in detection accuracy. ", "page_idx": 25}, {"type": "text", "text": "F.2 OOD Detection ", "text_level": 1, "page_idx": 25}, {"type": "text", "text": "Results of each dataset are shown in Table 11 (Llama2-7B) and Table 12 (GPT2-XL). ", "page_idx": 25}, {"type": "table", "img_path": "hYMxyeyEc5/tmp/fa55f44f5693933605f44adf00709e07d8620d98e12f0fb8256212559b3e9f13.jpg", "table_caption": ["Table 11: AUROC and FPR95 results in Llama2-7B of the Offline Detection scenario $\\boldsymbol{p}$ -value $>$ 0.05 are grayed out). Underline and bold denote SOTA among all baselines and all methods. "], "table_footnote": [], "page_idx": 25}, {"type": "table", "img_path": "hYMxyeyEc5/tmp/d689b6b3c1e922258b9e8c550c8d130194640d7a9ec40caafb858683d8eece79.jpg", "table_caption": ["Table 12: AUROC and FPR95 results in GPT2-XL of the Offline Detection scenario ( $\\stackrel{.}{p}$ -value $>$ 0.05 are grayed out). Underline and bold denote SOTA among all baselines and all methods. "], "table_footnote": [], "page_idx": 25}, {"type": "text", "text": "F.3 Beyond Detection: OOD Quality Estimation ", "text_level": 1, "page_idx": 26}, {"type": "text", "text": "Results of each dataset are shown in Table 13 (Llama2-7B) and Table 14 (GPT2-XL). ", "page_idx": 26}, {"type": "text", "text": "Table 13: OOD Quality Estimation (Llama2-7B): Kendall\u2019s $\\tau$ and Spearman correlation between various OOD scores and benchmark quality metric binary matching. Each column shows the correlation when ID and OOD samples are merged. Underline denotes the SOTA among all baselines, and bold denotes the SOTA among our methods. ", "page_idx": 26}, {"type": "table", "img_path": "hYMxyeyEc5/tmp/7fab1b326e16c2060b4d94d55d35cf31e466bbe9dea5eba9a3faad65b8f2f475.jpg", "table_caption": [], "table_footnote": [], "page_idx": 26}, {"type": "text", "text": "Table 14: OOD Quality Estimation (GPT2-XL): Kendall\u2019s $\\tau$ and Spearman correlation between various OOD scores and benchmark quality metric binary matching. Each column shows the correlation when ID and OOD samples are merged. Underline denotes the SOTA among all baselines, and bold denotes the SOTA among our methods. ", "page_idx": 26}, {"type": "table", "img_path": "hYMxyeyEc5/tmp/1e5735e2454fc88252743fa55132af2aae06dd76ab2904b7d8fbb5aefef9fc42.jpg", "table_caption": [], "table_footnote": [], "page_idx": 26}, {"type": "text", "text": "F.4 Beyond Mathematical Reasoning ", "text_level": 1, "page_idx": 26}, {"type": "text", "text": "Our method has a wider range of application scenarios beyond mathematical reasoning. To verify generalizability, we choose the multiple-choice quizzing task, which has the same \u201cpattern collapse\u201d property as mathematical reasoning, since the output space is limited to the \u201cABCD\u201d four options. ", "page_idx": 26}, {"type": "text", "text": "We select the MMLU dataset [10] and choose eight domains among it: high school mathematics, high school physics, high school chemistry, high school biology, high school geography, high school government and politics, high school psychology, high school statistics. We test eight rounds, each using one of the domains as the ID dataset and the remaining seven domains as the OOD datasets. ", "page_idx": 26}, {"type": "text", "text": "We use Llama2-7B as the training backbone, each model is trained for 3K steps and 8 batch sizes in 4-card NVIDIA Tesla V100 (2 per card). The AUROC score matrices are shown in Figure 5(a)-(e), presenting the results for TV score, input embedding, output embedding, and perplexity, respectively. In the figures, the Roman numeral I - VIII are represented as: ", "page_idx": 26}, {"type": "text", "text": "", "page_idx": 27}, {"type": "text", "text": "\u2022 ${\\mathrm{I}}={\\mathrm{\\Omega}}$ high school mathematics   \n\u2022 $\\amalg=$ high school physics   \n\u2022 $\\mathrm{III}=$ high school chemistry   \n\u2022 $\\mathrm{IV}=$ high school biology   \n\u2022 $\\mathrm{V}=$ high school geography   \n\u2022 ${\\mathrm{VI}}=$ high school government and politics   \n\u2022 ${\\mathrm{VII}}=$ high school psychology   \n\u2022 ${\\mathrm{VIII}}=$ high school statistics ", "page_idx": 27}, {"type": "text", "text": "We find that MS-Prob and PPL nearly fail on the multiple-choice task and the output embedding is not as excellent as expected, which is caused by the pattern collapse phenomenon. ", "page_idx": 27}, {"type": "text", "text": "Our method is comparable to the input embedding method and has very good absolute performances. For some far-shift OOD scenarios, e.g., mathematics-psychology (I-VII), physics-politics (II-VI), etc., performances of the input embedding method and our method are basically the same, and there exists a reasonable range of competing phenomena, e.g., our method performs more advantageously under physics-biology (II-IV), and the input embedding method is better under physics-geography (II-V). For some near-shift OOD scenarios, e.g., mathematics-statistics (I-VIII), where both domains essentially belong to the category of math, our method will be more well-performed, indicating that the embedding-based method produces performance degradation in fine-grained scenarios, while our method possesses stronger robustness. ", "page_idx": 27}, {"type": "text", "text": "Overall, our method is scalable and has greater advantages in fine-grained detection scenarios. ", "page_idx": 27}, {"type": "image", "img_path": "hYMxyeyEc5/tmp/78a860e6c2dfdf92c9ea96fe2bfee94ee809e98ffea500a766c4dad91a53540c.jpg", "img_caption": ["Figure 5: AUROC score matrix in MMLU dataset of different OOD scores. Rows represent ID data, and columns represent OOD data. ", "(e) TV Score (Ours) "], "img_footnote": [], "page_idx": 28}, {"type": "text", "text": "NeurIPS Paper Checklist ", "text_level": 1, "page_idx": 29}, {"type": "text", "text": "1. Claims ", "text_level": 1, "page_idx": 29}, {"type": "text", "text": "Question: Do the main claims made in the abstract and introduction accurately reflect the paper\u2019s contributions and scope? ", "page_idx": 29}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 29}, {"type": "text", "text": "Justification: [Abstract, Section 1] ", "page_idx": 29}, {"type": "text", "text": "Guidelines: ", "page_idx": 29}, {"type": "text", "text": "\u2022 The answer NA means that the abstract and introduction do not include the claims made in the paper.   \n\u2022 The abstract and/or introduction should clearly state the claims made, including the contributions made in the paper and important assumptions and limitations. A No or NA answer to this question will not be perceived well by the reviewers.   \n\u2022 The claims made should match theoretical and experimental results, and reflect how much the results can be expected to generalize to other settings.   \n\u2022 It is fine to include aspirational goals as motivation as long as it is clear that these goals are not attained by the paper. ", "page_idx": 29}, {"type": "text", "text": "2. Limitations ", "text_level": 1, "page_idx": 29}, {"type": "text", "text": "Question: Does the paper discuss the limitations of the work performed by the authors? ", "page_idx": 29}, {"type": "text", "text": "Answer: [Yes] ", "text_level": 1, "page_idx": 29}, {"type": "text", "text": "Justification: [Limitations] ", "page_idx": 29}, {"type": "text", "text": "Guidelines: ", "page_idx": 29}, {"type": "text", "text": "\u2022 The answer NA means that the paper has no limitation while the answer No means that the paper has limitations, but those are not discussed in the paper.   \n\u2022 The authors are encouraged to create a separate \"Limitations\" section in their paper.   \n\u2022 The paper should point out any strong assumptions and how robust the results are to violations of these assumptions (e.g., independence assumptions, noiseless settings, model well-specification, asymptotic approximations only holding locally). The authors should reflect on how these assumptions might be violated in practice and what the implications would be.   \n\u2022 The authors should reflect on the scope of the claims made, e.g., if the approach was only tested on a few datasets or with a few runs. In general, empirical results often depend on implicit assumptions, which should be articulated.   \n\u2022 The authors should reflect on the factors that influence the performance of the approach. For example, a facial recognition algorithm may perform poorly when image resolution is low or images are taken in low lighting. Or a speech-to-text system might not be used reliably to provide closed captions for online lectures because it fails to handle technical jargon.   \n\u2022 The authors should discuss the computational efficiency of the proposed algorithms and how they scale with dataset size.   \n\u2022 If applicable, the authors should discuss possible limitations of their approach to address problems of privacy and fairness.   \n\u2022 While the authors might fear that complete honesty about limitations might be used by reviewers as grounds for rejection, a worse outcome might be that reviewers discover limitations that aren\u2019t acknowledged in the paper. The authors should use their best judgment and recognize that individual actions in favor of transparency play an important role in developing norms that preserve the integrity of the community. Reviewers will be specifically instructed to not penalize honesty concerning limitations. ", "page_idx": 29}, {"type": "text", "text": "3. Theory Assumptions and Proofs ", "text_level": 1, "page_idx": 29}, {"type": "text", "text": "Question: For each theoretical result, does the paper provide the full set of assumptions and a complete (and correct) proof? ", "page_idx": 29}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 29}, {"type": "text", "text": "Justification: [Section 2, Appendix C] Guidelines: ", "page_idx": 30}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not include theoretical results.   \n\u2022 All the theorems, formulas, and proofs in the paper should be numbered and crossreferenced.   \n\u2022 All assumptions should be clearly stated or referenced in the statement of any theorems.   \n\u2022 The proofs can either appear in the main paper or the supplemental material, but if they appear in the supplemental material, the authors are encouraged to provide a short proof sketch to provide intuition.   \n\u2022 Inversely, any informal proof provided in the core of the paper should be complemented by formal proofs provided in appendix or supplemental material.   \n\u2022 Theorems and Lemmas that the proof relies upon should be properly referenced. ", "page_idx": 30}, {"type": "text", "text": "4. Experimental Result Reproducibility ", "text_level": 1, "page_idx": 30}, {"type": "text", "text": "Question: Does the paper fully disclose all the information needed to reproduce the main experimental results of the paper to the extent that it affects the main claims and/or conclusions of the paper (regardless of whether the code and data are provided or not)? ", "page_idx": 30}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 30}, {"type": "text", "text": "Justification: [Section 4, Appendix E] ", "page_idx": 30}, {"type": "text", "text": "Guidelines: ", "page_idx": 30}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not include experiments.   \n\u2022 If the paper includes experiments, a No answer to this question will not be perceived well by the reviewers: Making the paper reproducible is important, regardless of whether the code and data are provided or not.   \n\u2022 If the contribution is a dataset and/or model, the authors should describe the steps taken to make their results reproducible or verifiable.   \n\u2022 Depending on the contribution, reproducibility can be accomplished in various ways. For example, if the contribution is a novel architecture, describing the architecture fully might suffice, or if the contribution is a specific model and empirical evaluation, it may be necessary to either make it possible for others to replicate the model with the same dataset, or provide access to the model. In general. releasing code and data is often one good way to accomplish this, but reproducibility can also be provided via detailed instructions for how to replicate the results, access to a hosted model (e.g., in the case of a large language model), releasing of a model checkpoint, or other means that are appropriate to the research performed.   \n\u2022 While NeurIPS does not require releasing code, the conference does require all submissions to provide some reasonable avenue for reproducibility, which may depend on the nature of the contribution. For example (a) If the contribution is primarily a new algorithm, the paper should make it clear how to reproduce that algorithm. (b) If the contribution is primarily a new model architecture, the paper should describe the architecture clearly and fully. (c) If the contribution is a new model (e.g., a large language model), then there should either be a way to access this model for reproducing the results or a way to reproduce the model (e.g., with an open-source dataset or instructions for how to construct the dataset). (d) We recognize that reproducibility may be tricky in some cases, in which case authors are welcome to describe the particular way they provide for reproducibility. In the case of closed-source models, it may be that access to the model is limited in some way (e.g., to registered users), but it should be possible for other researchers to have some path to reproducing or verifying the results. ", "page_idx": 30}, {"type": "text", "text": "5. Open access to data and code ", "text_level": 1, "page_idx": 30}, {"type": "text", "text": "Question: Does the paper provide open access to the data and code, with sufficient instructions to faithfully reproduce the main experimental results, as described in supplemental material? ", "page_idx": 30}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 31}, {"type": "text", "text": "Justification: [Section 4, Appendix E] Guidelines: ", "page_idx": 31}, {"type": "text", "text": "\u2022 The answer NA means that paper does not include experiments requiring code.   \n\u2022 Please see the NeurIPS code and data submission guidelines (https://nips.cc/ public/guides/CodeSubmissionPolicy) for more details.   \n\u2022 While we encourage the release of code and data, we understand that this might not be possible, so \u201cNo\u201d is an acceptable answer. Papers cannot be rejected simply for not including code, unless this is central to the contribution (e.g., for a new open-source benchmark).   \n\u2022 The instructions should contain the exact command and environment needed to run to reproduce the results. See the NeurIPS code and data submission guidelines (https: //nips.cc/public/guides/CodeSubmissionPolicy) for more details.   \n\u2022 The authors should provide instructions on data access and preparation, including how to access the raw data, preprocessed data, intermediate data, and generated data, etc.   \n\u2022 The authors should provide scripts to reproduce all experimental results for the new proposed method and baselines. If only a subset of experiments are reproducible, they should state which ones are omitted from the script and why.   \n\u2022 At submission time, to preserve anonymity, the authors should release anonymized versions (if applicable).   \n\u2022 Providing as much information as possible in supplemental material (appended to the paper) is recommended, but including URLs to data and code is permitted. ", "page_idx": 31}, {"type": "text", "text": "6. Experimental Setting/Details ", "text_level": 1, "page_idx": 31}, {"type": "text", "text": "Question: Does the paper specify all the training and test details (e.g., data splits, hyperparameters, how they were chosen, type of optimizer, etc.) necessary to understand the results? ", "page_idx": 31}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 31}, {"type": "text", "text": "Justification: [Section 4, Appendix E] Guidelines: ", "page_idx": 31}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not include experiments. \u2022 The experimental setting should be presented in the core of the paper to a level of detail that is necessary to appreciate the results and make sense of them. \u2022 The full details can be provided either with the code, in appendix, or as supplemental material. ", "page_idx": 31}, {"type": "text", "text": "7. Experiment Statistical Significance ", "text_level": 1, "page_idx": 31}, {"type": "text", "text": "Question: Does the paper report error bars suitably and correctly defined or other appropriate information about the statistical significance of the experiments? ", "page_idx": 31}, {"type": "text", "text": "Answer: [Yes] ", "text_level": 1, "page_idx": 31}, {"type": "text", "text": "Justification: [Section 4, Appendix F] Guidelines: ", "page_idx": 31}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not include experiments.   \n\u2022 The authors should answer \"Yes\" if the results are accompanied by error bars, confidence intervals, or statistical significance tests, at least for the experiments that support the main claims of the paper.   \n\u2022 The factors of variability that the error bars are capturing should be clearly stated (for example, train/test split, initialization, random drawing of some parameter, or overall run with given experimental conditions).   \n\u2022 The method for calculating the error bars should be explained (closed form formula, call to a library function, bootstrap, etc.)   \n\u2022 The assumptions made should be given (e.g., Normally distributed errors).   \n\u2022 It should be clear whether the error bar is the standard deviation or the standard error of the mean.   \n\u2022 It is OK to report 1-sigma error bars, but one should state it. The authors should preferably report a 2-sigma error bar than state that they have a $96\\%$ CI, if the hypothesis of Normality of errors is not verified.   \n\u2022 For asymmetric distributions, the authors should be careful not to show in tables or figures symmetric error bars that would yield results that are out of range (e.g. negative error rates).   \n\u2022 If error bars are reported in tables or plots, The authors should explain in the text how they were calculated and reference the corresponding figures or tables in the text. ", "page_idx": 31}, {"type": "text", "text": "", "page_idx": 32}, {"type": "text", "text": "8. Experiments Compute Resources ", "text_level": 1, "page_idx": 32}, {"type": "text", "text": "Question: For each experiment, does the paper provide sufficient information on the computer resources (type of compute workers, memory, time of execution) needed to reproduce the experiments? ", "page_idx": 32}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 32}, {"type": "text", "text": "Justification: [Section 4, Appendix E] Guidelines: ", "page_idx": 32}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not include experiments.   \n\u2022 The paper should indicate the type of compute workers CPU or GPU, internal cluster, or cloud provider, including relevant memory and storage.   \n\u2022 The paper should provide the amount of compute required for each of the individual experimental runs as well as estimate the total compute.   \n\u2022 The paper should disclose whether the full research project required more compute than the experiments reported in the paper (e.g., preliminary or failed experiments that didn\u2019t make it into the paper). ", "page_idx": 32}, {"type": "text", "text": "9. Code Of Ethics ", "text_level": 1, "page_idx": 32}, {"type": "text", "text": "Question: Does the research conducted in the paper conform, in every respect, with the NeurIPS Code of Ethics https://neurips.cc/public/EthicsGuidelines? ", "page_idx": 32}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 32}, {"type": "text", "text": "Justification: [Ethics Statement] Guidelines: ", "page_idx": 32}, {"type": "text", "text": "\u2022 The answer NA means that the authors have not reviewed the NeurIPS Code of Ethics.   \n\u2022 If the authors answer No, they should explain the special circumstances that require a deviation from the Code of Ethics.   \n\u2022 The authors should make sure to preserve anonymity (e.g., if there is a special consideration due to laws or regulations in their jurisdiction). ", "page_idx": 32}, {"type": "text", "text": "10. Broader Impacts ", "text_level": 1, "page_idx": 32}, {"type": "text", "text": "Question: Does the paper discuss both potential positive societal impacts and negative societal impacts of the work performed? ", "page_idx": 32}, {"type": "text", "text": "Answer: [Yes] ", "text_level": 1, "page_idx": 32}, {"type": "text", "text": "Justification: [Ethics Statement] ", "page_idx": 32}, {"type": "text", "text": "Guidelines: ", "page_idx": 32}, {"type": "text", "text": "\u2022 The answer NA means that there is no societal impact of the work performed.   \n\u2022 If the authors answer NA or No, they should explain why their work has no societal impact or why the paper does not address societal impact.   \n\u2022 Examples of negative societal impacts include potential malicious or unintended uses (e.g., disinformation, generating fake profiles, surveillance), fairness considerations (e.g., deployment of technologies that could make decisions that unfairly impact specific groups), privacy considerations, and security considerations.   \n\u2022 The conference expects that many papers will be foundational research and not tied to particular applications, let alone deployments. However, if there is a direct path to any negative applications, the authors should point it out. For example, it is legitimate to point out that an improvement in the quality of generative models could be used to ", "page_idx": 32}, {"type": "text", "text": "generate deepfakes for disinformation. On the other hand, it is not needed to point out that a generic algorithm for optimizing neural networks could enable people to train models that generate Deepfakes faster. ", "page_idx": 33}, {"type": "text", "text": "\u2022 The authors should consider possible harms that could arise when the technology is being used as intended and functioning correctly, harms that could arise when the technology is being used as intended but gives incorrect results, and harms following from (intentional or unintentional) misuse of the technology. \u2022 If there are negative societal impacts, the authors could also discuss possible mitigation strategies (e.g., gated release of models, providing defenses in addition to attacks, mechanisms for monitoring misuse, mechanisms to monitor how a system learns from feedback over time, improving the efficiency and accessibility of ML). ", "page_idx": 33}, {"type": "text", "text": "11. Safeguards ", "text_level": 1, "page_idx": 33}, {"type": "text", "text": "Question: Does the paper describe safeguards that have been put in place for responsible release of data or models that have a high risk for misuse (e.g., pretrained language models, image generators, or scraped datasets)? ", "page_idx": 33}, {"type": "text", "text": "Answer: [Yes] ", "text_level": 1, "page_idx": 33}, {"type": "text", "text": "Justification: [Ethics Statement] ", "page_idx": 33}, {"type": "text", "text": "Guidelines: ", "page_idx": 33}, {"type": "text", "text": "\u2022 The answer NA means that the paper poses no such risks.   \n\u2022 Released models that have a high risk for misuse or dual-use should be released with necessary safeguards to allow for controlled use of the model, for example by requiring that users adhere to usage guidelines or restrictions to access the model or implementing safety filters.   \n\u2022 Datasets that have been scraped from the Internet could pose safety risks. The authors should describe how they avoided releasing unsafe images.   \n\u2022 We recognize that providing effective safeguards is challenging, and many papers do not require this, but we encourage authors to take this into account and make a best faith effort. ", "page_idx": 33}, {"type": "text", "text": "12. Licenses for existing assets ", "text_level": 1, "page_idx": 33}, {"type": "text", "text": "Question: Are the creators or original owners of assets (e.g., code, data, models), used in the paper, properly credited and are the license and terms of use explicitly mentioned and properly respected? ", "page_idx": 33}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 33}, {"type": "text", "text": "Justification: [Section 4, Appendix E] ", "page_idx": 33}, {"type": "text", "text": "Guidelines: ", "page_idx": 33}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not use existing assets.   \n\u2022 The authors should cite the original paper that produced the code package or dataset.   \n\u2022 The authors should state which version of the asset is used and, if possible, include a URL.   \n\u2022 The name of the license (e.g., CC-BY 4.0) should be included for each asset.   \n\u2022 For scraped data from a particular source (e.g., website), the copyright and terms of service of that source should be provided.   \n\u2022 If assets are released, the license, copyright information, and terms of use in the package should be provided. For popular datasets, paperswithcode.com/datasets has curated licenses for some datasets. Their licensing guide can help determine the license of a dataset.   \n\u2022 For existing datasets that are re-packaged, both the original license and the license of the derived asset (if it has changed) should be provided.   \n\u2022 If this information is not available online, the authors are encouraged to reach out to the asset\u2019s creators. ", "page_idx": 33}, {"type": "text", "text": "13. New Assets ", "text_level": 1, "page_idx": 33}, {"type": "text", "text": "Question: Are new assets introduced in the paper well documented and is the documentation provided alongside the assets? ", "page_idx": 33}, {"type": "text", "text": "Answer: [NA] . ", "page_idx": 34}, {"type": "text", "text": "Justification: [Our paper does not introduce new assets.] Guidelines: ", "page_idx": 34}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not release new assets.   \n\u2022 Researchers should communicate the details of the dataset/code/model as part of their submissions via structured templates. This includes details about training, license, limitations, etc.   \n\u2022 The paper should discuss whether and how consent was obtained from people whose asset is used.   \n\u2022 At submission time, remember to anonymize your assets (if applicable). You can either create an anonymized URL or include an anonymized zip file. ", "page_idx": 34}, {"type": "text", "text": "14. Crowdsourcing and Research with Human Subjects ", "text_level": 1, "page_idx": 34}, {"type": "text", "text": "Question: For crowdsourcing experiments and research with human subjects, does the paper include the full text of instructions given to participants and screenshots, if applicable, as well as details about compensation (if any)? ", "page_idx": 34}, {"type": "text", "text": "Answer: [NA] ", "page_idx": 34}, {"type": "text", "text": "Justification: [Our paper does not involve crowdsourcing experiments and research.] Guidelines: ", "page_idx": 34}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not involve crowdsourcing nor research with human subjects.   \n\u2022 Including this information in the supplemental material is fine, but if the main contribution of the paper involves human subjects, then as much detail as possible should be included in the main paper.   \n\u2022 According to the NeurIPS Code of Ethics, workers involved in data collection, curation, or other labor should be paid at least the minimum wage in the country of the data collector. ", "page_idx": 34}, {"type": "text", "text": "15. Institutional Review Board (IRB) Approvals or Equivalent for Research with Human Subjects ", "text_level": 1, "page_idx": 34}, {"type": "text", "text": "Question: Does the paper describe potential risks incurred by study participants, whether such risks were disclosed to the subjects, and whether Institutional Review Board (IRB) approvals (or an equivalent approval/review based on the requirements of your country or institution) were obtained? ", "page_idx": 34}, {"type": "text", "text": "Answer: [NA] . Justification: [NA] ", "page_idx": 34}, {"type": "text", "text": "Guidelines: ", "page_idx": 34}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not involve crowdsourcing nor research with human subjects.   \n\u2022 Depending on the country in which research is conducted, IRB approval (or equivalent) may be required for any human subjects research. If you obtained IRB approval, you should clearly state this in the paper.   \n\u2022 We recognize that the procedures for this may vary significantly between institutions and locations, and we expect authors to adhere to the NeurIPS Code of Ethics and the guidelines for their institution.   \n\u2022 For initial submissions, do not include any information that would break anonymity (if applicable), such as the institution conducting the review. ", "page_idx": 34}]