[{"type": "text", "text": "A2PO: Towards Effective Offline Reinforcement Learning from an Advantage-aware Perspective ", "text_level": 1, "page_idx": 0}, {"type": "text", "text": "Yunpeng Qing1 , Shunyu $\\mathbf{Liu}^{2*}$ , Jingyuan $\\mathbf{Cong^{1}}$ , Kaixuan Chen1 , Yihe Zhou1 , Mingli Song2,3 ", "page_idx": 0}, {"type": "text", "text": "1 College of Computer Science and Technology, Zhejiang University 2 State Key Laboratory of Blockchain and Data Security, Zhejiang University 3 Hangzhou High-Tech Zone (Binjiang) Institute of Blockchain and Data Security ", "page_idx": 0}, {"type": "text", "text": "Abstract ", "text_level": 1, "page_idx": 0}, {"type": "text", "text": "Offilne reinforcement learning endeavors to leverage offilne datasets to craft effective agent policy without online interaction, which imposes proper conservative constraints with the support of behavior policies to tackle the out-of-distribution problem. However, existing works often suffer from the constraint conflict issue when offline datasets are collected from multiple behavior policies, i.e., different behavior policies may exhibit inconsistent actions with distinct returns across the state space. To remedy this issue, recent advantage-weighted methods prioritize samples with high advantage values for agent training while inevitably ignoring the diversity of behavior policy. In this paper, we introduce a novel AdvantageAware Policy Optimization (A2PO) method to explicitly construct advantage-aware policy constraints for offline learning under mixed-quality datasets. Specifically, A2PO employs a conditional variational auto-encoder to disentangle the action distributions of intertwined behavior policies by modeling the advantage values of all training data as conditional variables. Then the agent can follow such disentangled action distribution constraints to optimize the advantage-aware policy towards high advantage values. Extensive experiments conducted on both the single-quality and mixed-quality datasets of the D4RL benchmark demonstrate that A2PO yields results superior to the counterparts. Our code is available at https://github.com/Plankson/A2PO. ", "page_idx": 0}, {"type": "text", "text": "1 Introduction ", "text_level": 1, "page_idx": 0}, {"type": "text", "text": "Offline Reinforcement Learning (RL) [11, 4] aims to learn effective control policies from precollected datasets without online exploration, and has witnessed its unprecedented success in various real-world applications, including robot control [57, 45, 24, 25], power grid control [2, 49, 26, 36], etc. A formidable challenge of offline RL lies in the Out-Of-Distribution (OOD) problem [21], involving the distribution shift between data induced by the learned policy and data collected by the behavior policy. Consequently, the direct application of conventional online RL methods inevitably exhibits extrapolation error [34], where the unseen state-action pairs are erroneously estimated. To tackle this OOD problem, offilne RL methods attempt to impose proper conservatism on the learning agent within the distribution of the dataset, such as restricting the learned policy with a regularization term [19, 9] or penalizing the value overestimation of OOD actions [20, 18]. ", "page_idx": 0}, {"type": "text", "text": "Despite the promising results achieved, offilne RL often encounters the constraint confilct issue when dealing with the mixed-quality dataset [40, 12, 1, 28]. Specifically, when training data are collected from multiple behavior policies with distinct returns, existing works still treat each sample constraint equally with no regard for the differences in data quality and diversity. This oversight results in improper constrain on conflict actions [5, 16, 50, 15], ultimately leading to further suboptimal outcomes. To resolve this concern, the Advantage-Weighted (AW) methods [5, 43, 58, 28] employ weighted sampling to prioritize training transitions with high advantage values from the offilne dataset. However, we argue that these AW methods implicitly reduce the diverse behavior policies associated with the offilne dataset into a narrow one from the viewpoint of the dataset redistribution. As a result, this redistribution operation of AW may exclude a significant number of critical transitions during training, imposing erroneous constraints on agent learning. To exemplify the above issue of AW, we conduct a didactic experiment on the recent advanced AW method, LAPO [5], as shown in Figure 1. The toy one-step jump task requires the agent to jump over obstacles and reach two designated goal positions with different rewards. The offilne dataset mainly contains failed attempts, with only a few successful transitions, making it very challenging for the agent to learn an effective policy. The results in Figure 1b demonstrate that LAPO performs poorly in this task. Furthermore, Figure 1c reveals that the AW redistribution does not effectively prioritize either optimal or suboptimal actions in modeling the behavior policy. Instead, the AW redistribution can lead to an incorrect on bad actions, which results in unreliable policy optimization. ", "page_idx": 0}, {"type": "image", "img_path": "hYjRmGqq5e/tmp/20d27c2817b964c5a1f9db4d2e0e81dd66fa9c6f5327d74d447c7f8cf44c6219.jpg", "img_caption": ["Figure 1: A didactic experiment. (a) The visualization of the toy one-step jump task and the composition of the mixed-quality dataset. The agent starts at position 0 and can make a one-step jump $a\\in[-10,10]$ to reach a new position and receive a reward $r$ . (b) Learning curves of A2PO and LAPO. (c) VAE-generated action distributions of A2PO and LAPO at the initial state. LAPO VAE conditions only on the state, while A2PO VAE conditions on both the state and the advantage $\\xi$ . "], "img_footnote": [], "page_idx": 1}, {"type": "text", "text": "", "page_idx": 1}, {"type": "text", "text": "In this paper, we propose Advantage-Aware Policy Optimization, abbreviated as A2PO, to explicitly learn the advantage-aware policy with disentangled behavior policies from the mixed-quality offilne dataset. Unlike previous AW methods devoted to dataset redistribution while reducing the data diversity, the proposed A2PO directly conditions the agent policy on the advantage values of all training data without any prior preference. Technically, A2PO comprises two alternating stages, behavior policy disentangling and agent policy optimization. The former stage introduces a Conditional Variational Auto-Encoder (CVAE) [41] to disentangle different behavior policies into separate action distributions by modeling the advantage values of collected state-action pairs as conditioned variables. The latter stage further imposes an explicit advantage-aware policy constraint on the training agent within the support of disentangled action distributions. The advantage-conditioned CVAE can models the behavior policy distribution (Figure 1c), which is further utilized to construct advantage-aware constraint for agent optimization toward high advantage values, resulting in an effective decision-making policy (Figure 1b). ", "page_idx": 1}, {"type": "text", "text": "To sum up, our main contribution is the first dedicated attempt towards advantage-aware policy optimization to alleviate the constraint conflict issue under the mixed-quality offline dataset. The proposed A2PO can achieve advantage-aware policy constraint derived from different behavior policies, where a customized CVAE is employed to infer diverse action distributions associated with the behavior policies by modeling advantage values as conditional variables. Extensive experiments conducted on the D4RL benchmark [8], including both single-quality and mixed-quality datasets, demonstrate that the proposed A2PO method yields significantly superior performance to other advanced offline RL baselines, as well as the advantage-weighted competitors. ", "page_idx": 1}, {"type": "text", "text": "2 Related Works ", "text_level": 1, "page_idx": 2}, {"type": "text", "text": "Offline RL can be broadly classified into four categories: policy constraint [11, 44], value regularization [13, 14], model-based method [55, 52], and return-conditioned supervised learning [7, 23]. Policy constraint methods impose constraints on the learned policy to be close to the behavior policy [19]. Previous studies directly introduce the explicit constraint on policy learning, such as behavior cloning [9], maximum mean discrepancy [19], or maximum likelihood estimation [48]. In contrast, recent efforts [29, 46] mainly focus on realizing the policy constraints implicitly by approximating the formal optimal policy derived from KL-divergence constraint. On the other hand, value regularization methods make constraints on the value function to alleviate the overestimation of OOD action. Researchers try to approximate the lower bound of the value function with the Q-regularization term for conservative action selection [20, 27]. Model-based methods construct the environment dynamics to estimate state-action uncertainty for OOD penalty [17, 6]. Several works also converts offline RL into a return-conditioned supervised learning task. Decision Transformer (DT) [3] builds a transformer policy conditioned on both the current state and the additional sum return signal with supervised learning. Yamagata et al. [51] improve the stitching ability of DT policy on sub-optimal samples by relabeling the return signal with Q-learning results. However, in the context of offilne RL with a mixed-quality dataset and no access to the trajectory return signals, all these methods treat each sample equally without considering data quality, thereby resulting in improper regularization and further suboptimal learning outcomes. ", "page_idx": 2}, {"type": "text", "text": "Advantage-weighted Offline RL Method employs weighted sampling to prioritize training transitions with high advantage values from the offline dataset. To enhance sample efficiency, Peng et al. [31] introduce an advantage-weighted maximum likelihood loss by directly calculating advantage values via trajectory return. [29] further use the critic network to estimate advantage values for advantage-weighted policy training. This technique has been incorporated as a subroutine in other works [18, 50] for agent policy extraction. Recently, AW methods have also been well studied in addressing the constraint confilct issue that arises from the mixed-quality dataset [5, 58, 40]. Several studies present advantage-weighted behavior cloning as a direct objective function [58] or an explicit policy constraint [32]. [5] propose the Latent Advantage-Weighted Policy Optimization (LAPO) framework, which employs an advantage-weighted loss to train CVAE for generating high-advantage actions based on the state condition. Besides AW methods, Hong et al. [15] enhance the classical offline RL training objective with the weight of subsequent return. On the other hand, Hong et al. [16] directly learning the optimal policy density as the weight function to enable sampling from high-performing policies. However, this AW mechanism inevitably diminishes the data diversity in the dataset. In contrast, our A2PO directly conditions the agent policy on both the state and the estimated advantage value, enabling effective utilization of all samples with varying quality. ", "page_idx": 2}, {"type": "text", "text": "3 Preliminaries ", "text_level": 1, "page_idx": 2}, {"type": "text", "text": "We formalize the RL task as a Markov Decision Process (MDP) [35] defined by a tuple $\\mathcal{M}\\,=$ $\\langle S,A,P,r,\\gamma,\\rho_{0}\\rangle$ , where $\\boldsymbol{S}$ represents the state space, $\\boldsymbol{\\mathcal{A}}$ represents the action space, $P:S\\!\\times\\!A\\!\\times\\!S\\to$ $[0,1]$ denotes the environment dynamics, $r:S\\times A\\to\\mathbb{R}$ denotes the reward function, $\\gamma\\in(0,1]$ is the discount factor, and $\\rho_{0}$ is the initial state distribution. At each time step $t$ , the agent observes the state $s_{t}\\ \\in\\ S$ and selects an action $a_{t}\\ \\in\\ A$ according to its policy $\\pi$ . This action leads to a transition to the next state $s_{t+1}$ based on the dynamics distribution $P$ . Additionally, the agent receives a reward signal $r_{t}$ . The goal of RL is to learn an optimal policy $\\pi^{*}$ that maximizes the expected return: $\\begin{array}{r}{\\pi^{*}=\\arg\\operatorname*{max}_{\\pi}\\mathbb{E}_{\\pi}\\left[\\sum_{k=0}^{\\infty}\\gamma^{k}r_{t+k}\\right]}\\end{array}$ . In offline RL, the agent can only learn from an offilne dataset without online interaction with the environment. In the single-quality settings, the offline dataset $\\mathcal{D}=\\left\\{\\left(s_{t},a_{t},r_{t},s_{t+1}\\right)\\mid t=1,\\cdot\\cdot\\cdot\\mid\\boldsymbol{\\mathrm{,}}$ with $N$ transitions is collected by only one behavior policy $\\pi_{\\beta}$ . In the mixed-quality settings, the offilne dataset $\\begin{array}{r}{\\mathcal{D}=\\bigcup_{i}\\left\\{\\left(s_{i,t},a_{i,t},r_{i,t},s_{i,t+1}\\right)\\mid t=1,\\cdot\\cdot\\cdot\\mid\\boldsymbol{N}\\right\\}}\\end{array}$ is collected by multiple behavior policies {\u03c0\u03b2i}iM=1. ", "page_idx": 2}, {"type": "text", "text": ". $\\pi$ Thbey sttahtee vaalctuieo nfunvcatliuoen ifsu ndcetifoinned $\\begin{array}{r l}{Q^{\\pi}(s,a)}&{{}=}\\end{array}$ $\\begin{array}{r}{\\mathbb{E}_{\\pi}\\left[\\sum_{t=0}^{\\infty}\\gamma^{t}r(s_{t},a_{t})\\mid s_{0}=s,\\bar{a_{0}}=\\bar{a}\\right]}\\end{array}$ $\\begin{array}{r l}{V^{\\pi}\\big({s}\\big)}&{{}=}\\end{array}$ $\\mathbb{E}_{a\\sim\\pi}\\left[Q^{\\pi}(s,a)\\right]$ , while the advantage function is defined as $A^{\\pi}(s,a)\\,=\\,Q^{\\pi}(s,a)\\,-\\,V^{\\pi}(\\dot{s})$ . For continuous control, our A2PO implementation uses the TD3 algorithm [10] based on the actor-critic framework as a basic backbone for its robust performance. The actor network $\\pi_{\\omega}$ , known as the learned policy, is parameterized by $\\omega$ , while the critic networks consist of the Q-network $Q_{\\theta}$ parameterized by $\\theta$ and the V-network $V_{\\phi}$ parameterized by $\\phi$ . The actor-critic framework involves two steps: policy evaluation and policy improvement. During policy evaluation phase, the Q-network $Q_{\\theta}$ is optimized by the temporal-difference (TD) loss [42]: ", "page_idx": 2}, {"type": "image", "img_path": "hYjRmGqq5e/tmp/9ecb7def65a10e98a8fca09810533235a7726e5043d6bc97f705e66ffe8694f9.jpg", "img_caption": ["Figure 2: An illustrative diagram of the Advantage-Aware Policy Optimization (A2PO) method. "], "img_footnote": [], "page_idx": 3}, {"type": "text", "text": "", "page_idx": 3}, {"type": "equation", "text": "$$\n\\mathcal{L}_{Q}(\\theta)=\\mathbb{E}_{(s,a,r,s^{\\prime})\\sim\\mathcal{D},a^{\\prime}\\sim\\pi_{\\hat{\\omega}}(s^{\\prime})}\\big[Q_{\\theta}(s,a)-\\big(r(s,a)+\\gamma Q_{\\hat{\\theta}}(s^{\\prime},a^{\\prime})\\big)\\big]^{2},\n$$", "text_format": "latex", "page_idx": 3}, {"type": "text", "text": "where $\\hat{\\theta}$ and $\\hat{\\omega}$ are the parameters of the target networks that are regularly updated by online parameters $\\theta$ and $\\omega$ to maintain learning stability. The $\\mathrm{V}.$ -network $V_{\\phi}$ can also be optimized by the similar TD loss. For policy improvement in continuous control, the actor network $\\pi_{\\omega}$ can be optimized by the deterministic policy gradient loss [39, 38]: ", "page_idx": 3}, {"type": "equation", "text": "$$\n\\mathcal{L}_{\\pi}(\\omega)=\\mathbb{E}_{s\\sim\\mathcal{D}}\\left[-Q_{\\theta}(s,\\pi_{\\omega}(s))\\right].\n$$", "text_format": "latex", "page_idx": 3}, {"type": "text", "text": "Note that offilne RL will impose conservative constraints on the optimization losses to tackle the OOD problem. Moreover, the performance of the final learned policy $\\pi_{\\omega}$ highly depends on the quality of the offline dataset $\\mathcal{D}$ associated with the behavior policies $\\{\\pi_{\\beta_{i}}\\}$ . ", "page_idx": 3}, {"type": "text", "text": "4 Methodology ", "text_level": 1, "page_idx": 3}, {"type": "text", "text": "In this section, we provide details of our proposed A2PO approach, consisting of two key components: behavior policy disentangling and agent policy optimization. In the behavior policy disentangling phase, we disentangle behavior policies with a CVAE specifically modeling the action distribution conditioned on the advantage values of collected state-action pairs. By taking different advantage inputs, the newly formed CVAE allows the agent to infer distinct action distributions that are associated with various behavior policies. Then in the agent policy optimization phase, the action distributions derived from the advantage condition serve as disentangled behavior policies, establishing an advantage-aware policy constraint to guide agent training. An overview of our A2PO is illustrated in Figure 2. ", "page_idx": 3}, {"type": "text", "text": "4.1 Behavior Policy Disentangling ", "text_level": 1, "page_idx": 3}, {"type": "text", "text": "To realize behavior policy disentangling, we adopt a CVAE to relate the behavior distribution of different specific behavior policies $\\pi_{\\beta_{i}}$ to the advantage condition variables, which is quite different from previous methods [11, 5, 56] utilizing CVAE only for approximating the overall mixed-quality behavior policy set $\\left\\{\\pi_{\\beta_{i}}\\right\\}_{i=1}^{M}$ conditioned only on specific state $s$ . Concretely, we have made adjustments to the architecture of the CVAE to be advantage-aware. The encoder $q_{\\varphi}(z|a,c)$ is fed with condition $c$ and action $a$ to project them into a latent representation $z$ . Given specific condition $c$ and the encoder output $z$ , the decoder $p_{\\psi}(a|z,c)$ captures the correlation between condition $c$ and latent representation $z$ to reconstruct the original action $a$ . Unlike previous methods [11, 5, 48] predicting action solely based on the state $s$ , we consider both state $s$ and advantage value $\\xi$ for CVAE condition. The state-advantage condition $c$ is formulated as: ", "page_idx": 3}, {"type": "equation", "text": "$$\nc=s\\left|\\right|\\xi.\n$$", "text_format": "latex", "page_idx": 3}, {"type": "text", "text": "Therefore, given the current state $s$ and the advantage value $\\xi$ as a joint condition, the CVAE model is able to generate corresponding action $a$ with varying quality positively correlated with the advantage value $\\xi$ . For a state-action pair $(s,a)$ , the advantage value $\\xi$ can be computed as follows: ", "page_idx": 4}, {"type": "equation", "text": "$$\n\\xi=\\operatorname{tanh}\\big(\\operatorname*{min}_{i=1,2}Q_{\\theta_{i}}(s,a)-V_{\\phi}(s)\\big),\n$$", "text_format": "latex", "page_idx": 4}, {"type": "text", "text": "where two Q-networks with the $\\operatorname*{min}(\\cdot)$ operation are adopted to ensure conservatism in offline RL settings [11]. Moreover, we employ the $\\operatorname{tanh}(\\cdot)$ function to normalize the advantage condition within the range of $(-1,1)$ . This operation prevents excessive outliers from impacting the performance of CVAE, improving the controllability of generation. The optimization of Q-networks and V-network will be described in the following section. ", "page_idx": 4}, {"type": "text", "text": "The CVAE model is trained using the state-advantage condition $c$ and the corresponding action $a$ . The training objective involves maximizing the Empirical Lower Bound (ELBO) [41] on the log-likelihood of the sampled minibatch: ", "page_idx": 4}, {"type": "equation", "text": "$$\n\\mathcal{L}_{\\mathrm{CVAE}}(\\varphi,\\psi)=-\\mathbb{E}_{\\mathcal{D}}\\left[\\mathbb{E}_{q_{\\varphi}(z\\,|\\,a,c)}\\left[\\log(p_{\\psi}(a|z,c))\\right]+\\alpha\\cdot\\mathrm{KL}\\left[q_{\\varphi}(z|a,c)\\parallel p(z)\\right]\\right],\n$$", "text_format": "latex", "page_idx": 4}, {"type": "text", "text": "where $\\alpha$ is the coefficient for trading off the KL-divergence loss term, and $p(z)$ denotes the prior distribution of $z$ setting to be $\\mathcal{N}(0,1)$ . The first log-likelihood term encourages the generated action to match the real action as much as possible, while the second KL divergence term aligns the latent variable distribution with the prior distribution $p(z)$ . ", "page_idx": 4}, {"type": "text", "text": "At each round of CVAE training, a minibatch of state-action pairs $(s,a)$ is sampled from the offline dataset. These pairs are fed to the critic network $Q_{\\theta}$ and $V_{\\phi}$ to get corresponding advantage condition $\\xi$ by Eq. (4). Then the advantage-aware CVAE is subsequently optimized by Eq. (5). By incorporating the advantage condition $\\xi$ , the CVAE captures the relation between $\\xi$ and the action distribution of the behavior policies, as shown in the upper part of Figure 2. This further enables the CVAE to generate actions $a$ based on the state-advantage condition $c$ in a manner where the action quality is positively correlated with $\\xi$ . Furthermore, the advantage-aware CVAE is utilized to establish an advantage-aware policy constraint for agent policy optimization in the next stage. ", "page_idx": 4}, {"type": "text", "text": "4.2 Agent Policy Optimization ", "text_level": 1, "page_idx": 4}, {"type": "text", "text": "The agent is constructed using the actor-critic framework [42]. The critic comprises two Q-networks $Q_{\\theta_{i=1,2}}$ and one V-network $V_{\\phi}$ to approximate the value of the agent policy. The actor, advantageaware policy $\\pi_{\\omega}(\\cdot|c)$ , with input $c=s\\,||\\,\\xi$ , generates a latent representation $\\tilde{z}$ based on the state $s$ and the designated advantage condition $\\xi$ . This latent representation $\\tilde{z}$ , along with $c$ , is then fed into the decoder $p_{\\psi}$ for an recognizable action $a_{\\xi}$ : ", "page_idx": 4}, {"type": "equation", "text": "$$\na_{\\xi}\\sim p_{\\psi}(\\cdot\\mid\\tilde{z},c),\\ \\mathrm{where}\\ \\tilde{z}\\sim\\pi_{\\omega}(\\cdot\\mid c).\n$$", "text_format": "latex", "page_idx": 4}, {"type": "text", "text": "With this form, the advantage-aware policy $\\pi_{\\omega}$ is expected to produce action with different qualities that are positively correlated to the designated advantage input $\\xi$ which is normalized within $(-1,1)$ in Eq. 4). Therefore, the output optimal action $a^{*}$ is obtained by $c^{*}=s\\,||\\,\\xi^{*}$ input with $\\xi^{*}=1$ . It should be noted that the critic networks are to approximate the expected value of the optimal policy $\\pi_{\\omega}(\\cdot|c^{*})$ . The agent optimization, following the actor-critic framework, encompasses policy evaluation and policy improvement steps. During the policy evaluation step, the critic is updated through the minimization of the temporal difference loss with the optimal policy $\\pi_{\\omega}(\\cdot|c^{*})$ . Specifically, for the V-network $v_{\\phi}$ , we employ the one-step Bellman operator to approximate the state value under the current agent-aware policy, conditioned on the optimal advantage input $\\xi^{*}=1$ , as follows: ", "page_idx": 4}, {"type": "equation", "text": "$$\n\\begin{array}{r}{\\mathcal{L}_{\\mathrm{TD}}(\\phi)=\\mathbb{E}_{\\begin{array}{c}{(s,a,r,s^{\\prime})\\sim\\mathcal{D},}\\\\ {\\tilde{z}^{\\ast}\\sim\\pi_{\\omega}(\\cdot|c^{\\ast}),}\\end{array}}\\Big[r+\\gamma\\operatorname*{min}_{i}Q_{\\hat{\\theta}_{i}}(s^{\\prime},a_{\\xi}^{\\ast})-V_{\\phi}(s)^{2}\\Big],}\\\\ {a_{\\xi}^{\\ast}\\!\\sim\\!p_{\\psi}(\\cdot|\\tilde{z}^{\\ast},c^{\\ast})}\\end{array}\n$$", "text_format": "latex", "page_idx": 4}, {"type": "text", "text": "where $Q_{\\hat{\\theta}}$ is the target network updated softly. As for the $\\mathrm{^Q}$ -networks, both of the two $Q\\cdot$ -network entities $Q_{\\theta_{i}}$ are optimized with agent policy $\\pi_{\\omega}(\\cdot|c^{*})$ following Equation 1. ", "page_idx": 4}, {"type": "text", "text": "For the policy improvement, the actor loss is defined as: ", "page_idx": 4}, {"type": "equation", "text": "$$\n\\begin{array}{r}{\\mathcal{L}_{\\mathrm{AC}}(\\omega)=-\\lambda\\cdot\\mathbb{E}_{s\\sim\\mathcal{D},\\xi^{*}\\sim\\pi_{\\omega}(\\cdot|\\xi^{*}),\\atop\\alpha_{\\xi}^{*}\\sim p_{\\psi}(\\cdot|\\xi^{*},c^{*})}\\big[Q_{\\theta_{1}}(s,a_{\\xi}^{*})\\big]+\\mathbb{E}_{(s,a)\\sim\\mathcal{D},\\xi\\sim\\pi_{\\omega}(\\cdot|c),\\atop\\alpha_{\\xi}\\sim p_{\\psi}(\\cdot|\\xi,c)}\\big[(a-a_{\\xi})^{2}\\big],}\\end{array}\n$$", "text_format": "latex", "page_idx": 4}, {"type": "text", "text": "where $a_{\\xi}^{\\ast}$ in the first term is the optimal action generated with the fixed maximum advantage condition $\\xi^{*}=1$ input and $a_{\\xi}$ in the second term is obtained with the advantage condition $\\xi$ derived from the critic based on Eq. 4 applied to the sampled batch. Meanwhile, following $\\mathrm{TD3+BC}$ [9], we add a normalization coefficient $\\begin{array}{r}{\\lambda=\\alpha/\\bigl(\\frac{1}{N}\\sum_{(s_{i},a_{i})}^{}|Q(s_{i},a_{i})|\\bigr)}\\end{array}$ to the first term to keep the scale balance between Q value objective and regularization, where $\\alpha$ is a hyperparameter to control the scale of the normalized Q value. The first term encourages the optimal policy condition on $c^{*}$ to select actions that yield the highest expected returns represented by the Q-value. This aligns with the policy improvement step in conventional RL approaches [22]. The second behavior cloning term explicitly imposes constraints on the advantage-aware policy, ensuring the policy selects in-sample actions that adhere to the advantage condition $\\xi$ determined by the critic. Therefore, the suboptimal samples with low advantage condition $\\xi$ will not disrupt the optimization of optimal policy $\\bar{\\pi}_{\\omega}(\\cdot|c^{*})$ . And they enforce valid constraints on the corresponding policy $\\pi_{\\omega}(\\cdot|c)$ , as shown in the lower part of Figure 2. It should be noted that the decoder $p_{\\psi}$ is fixed during both policy evaluation and improvement. ", "page_idx": 5}, {"type": "text", "text": "Our A2PO implementation selects $\\mathrm{TD3+BC}$ [9] as the base backbone for its robustness. The general framework derived above is thoroughly described in Appendix A. ", "page_idx": 5}, {"type": "text", "text": "5 Experiments ", "text_level": 1, "page_idx": 5}, {"type": "text", "text": "To illustrate the effectiveness of the proposed A2PO method, we conduct experiments on the D4RL benchmark [8]. We aim to answer the following questions: (1) Can A2PO outperform the advanced offline RL methods in both the single-quality datasets and mixed-quality datasets? (Section 5.2) (2) How do different components of A2PO contribute to the overall performance? (Section 5.3 and Appendix D\u2013G) (3) How does A2PO perform under mixed-quality datasets with varying singlequality samples? (Section 5.5 and Appendix H) (4) Can the A2PO agent effectively estimate the quality of different transitions? (Section 5.4 and Appendix I) (5) How does the time overhead of A2PO compare to other baselines? (Section 5.6) ", "page_idx": 5}, {"type": "text", "text": "5.1 Experiment Settings ", "text_level": 1, "page_idx": 5}, {"type": "text", "text": "Tasks and Datasets. We consider four different domains of tasks in D4RL benchmark [8]: Gym, Maze, Adroit, and Kitchen. Each domain contains several tasks and corresponding distinct datasets. We conduct experiments for each Gym task using single-quality and mixed-quality datasets. The single-quality datasets are generated with the medium behavior policy. The mixed-quality datasets are the combinations of random, medium, and expert single-quality datasets, including medium-expert, medium-replay, random-medium, medium-expert, and random-medium-expert. The D4RL benchmark only includes the first two mixed-quality datasets. Thus, following Hong et al. [16, 15], we manually construct the last three mixed-quality datasets by combining the corresponding single-quality datasets in D4RL with equal proportions. For the other domains of tasks, the corresponding D4RL datasets exhibit a significant level of diversity to evaluate the effectiveness of our A2PO algorithm. ", "page_idx": 5}, {"type": "text", "text": "Comparison Methods and Hyperparameters. We compare the proposed A2PO to several advanced offilne RL methods: BCQ [11], TD3+BC [9], CQL [20], EQL [50], especially the advantage-weighted offline RL methods: AWAC [29], IQL [18], $\\mathrm{CQL+AW}$ [15], LAPO [5]. Besides, we also select the vanilla BC method [33], the model-based offline RL method MOPO [53], and the emerging diffusion-based method Diffusion-QL [47], for comparison. We report the performance of baselines using the best results reported from their own paper. More comparison results can be found in Appendix C. The detailed hyperparameters of A2PO are given in Appendix B.2. ", "page_idx": 5}, {"type": "text", "text": "5.2 Comparison on D4RL Benchmarks ", "text_level": 1, "page_idx": 5}, {"type": "text", "text": "Results for Gym Tasks. The experimental results of all compared methods in the D4RL Gym tasks are presented in Table 1. For the single-quality medium dataset and mixed-quality medium-expert and medium-replay datasets from D4RL, our A2PO achieves state-of-the-art results with low variance. Meanwhile, both conventional offilne RL approaches like EQL and advantage-weighted approaches like LAPO still learn acceptable policy, indicating that the confilct issue hardly occurs in these datasets with low diversity. However, the newly constructed mixed-quality datasets, namely random-medium, random-expert, and random-medium-expert, highlight the issue of substantial gaps between behavior policies. The results on these datasets reveal a significant drop in performance for all other baselines. ", "page_idx": 5}, {"type": "text", "text": "Table 1: Test returns of our proposed A2PO and baselines on the Gym tasks. $\\pm$ corresponds to one standard deviation of the performance on 5 random seeds. The performance is measured by the normalized scores at the last training iteration. Bold indicates the best performance in each task. ", "page_idx": 6}, {"type": "table", "img_path": "hYjRmGqq5e/tmp/7e1ff38539f334eadfde513b5aa873e801f8506a90890ae7342ae46842bf8f53.jpg", "table_caption": [], "table_footnote": [], "page_idx": 6}, {"type": "table", "img_path": "hYjRmGqq5e/tmp/9f5f3912209fd0fe8503fba6081389d6773d7562797bad4af4d945cb9b62ab33.jpg", "table_caption": ["Table 2: Test returns of our proposed A2PO and baselines on the Maze, Kitchen, and Adroit tasks. "], "table_footnote": [], "page_idx": 6}, {"type": "text", "text": "Instead, our A2PO continues to achieve the best performance on these datasets. When considering the total scores across all datasets, A2PO outperforms the next best-performing AW method, $\\mathrm{{CQL+AW}},$ , by over $21\\%$ . The results reveal the exceptional ability of A2PO to capture and utilize high-quality interactions within the dataset in order to enforce a reasonable advantage-aware policy constraint and further obtain an optimal agent policy. ", "page_idx": 6}, {"type": "text", "text": "Results for Maze, Kitchen, and Adroit Tasks. Table 2 presents the experimental results of all the compared methods on the D4RL Maze, Kitchen, and Adroit tasks. The D4RL datasets for these tasks exhibit varying patterns in behavior policy samples. For instance, the Antmaze datasets are highly sub-optimal, while the Adroit datasets have a narrow state-action distribution. Among the offilne RL baselines and AW methods, A2PO delivers remarkable performance in these challenging tasks and showcases the robust representation capabilities of the advantage-aware policy. ", "page_idx": 6}, {"type": "text", "text": "5.3 Ablation Analysis ", "text_level": 1, "page_idx": 6}, {"type": "text", "text": "Different Advantage condition during training. The performance comparison of different advantage condition computing methods for agent training is given in Figure 3. Eq. 4 obtains continuous advantage condition $\\xi$ in the range of $(-1,1)$ . To evaluate the effectiveness of the continuous computing method, we design a discrete form of advantage condition: $\\xi_{\\mathrm{dis}}=\\operatorname{sgn}(\\xi)\\cdot\\mathbf{1}_{|\\xi|>\\epsilon}$ , where $\\operatorname{sgn}({\\mathord{\\cdot}})$ is the symbolic function, and ${\\bf1}_{|\\xi|>\\epsilon}$ is the indicator function returning 1 if the absolute value of $\\xi$ is greater than the hyperparameter of threshold $\\epsilon$ , otherwise 0. Thus, the advantage condition $\\xi_{\\mathrm{dis}}$ is constrained to discrete value of $\\{-1,0,1\\}$ . Another special form of advantage condition is $\\xi_{\\mathrm{fix}}=1$ for all state-action pairs, in which the advantage-aware ability is lost. Figure 3a shows that setting $\\xi_{\\mathrm{fix}}=1$ without explicitly advantage-aware mechanism leads to a significant performance decreasing, especially in the new mixed-quality dataset. Meanwhile, $\\xi_{\\mathrm{dis}}$ with different values of threshold $\\epsilon$ achieve slightly inferior results than the continuous $\\xi$ . This outcome strongly supports the efficiency of continuous $\\xi$ . Although the $\\xi_{\\mathrm{dis}}$ signals are more stable, $\\xi_{\\mathrm{dis}}$ hidden the concrete advantage value, causing a mismatch between the advantage value and the sampled transition. ", "page_idx": 6}, {"type": "image", "img_path": "hYjRmGqq5e/tmp/183c0dd72ef9b466c6ae905a20461eb906590502b10223e7117da818c61a0793.jpg", "img_caption": ["Figure 3: Test return difference of A2PO with different discrete advantage conditions during training compared with original A2PO with continuous advantage condition during training. Task abbreviations are listed in Appendix B.1. Test returns are reported in Appendix D. "], "img_footnote": [], "page_idx": 7}, {"type": "image", "img_path": "hYjRmGqq5e/tmp/26787cb6365efa6850fabadab3ba595b3897f4a3b8ab369219ec7e4f76880ce3.jpg", "img_caption": ["Figure 4: Learning curves of A2PO under different fixed advantage inputs during the test while using the original continuous advantage condition for training. Test returns are reported in Appendix E. "], "img_footnote": [], "page_idx": 7}, {"type": "text", "text": "", "page_idx": 7}, {"type": "text", "text": "Different Advantage Condition for Test. The performance comparison of different discrete advantage conditions input for the test is given in Figure 4. To ensure clear differentiation, we select $\\xi$ from $\\{-1,0,1\\}$ . The different designated advantage conditions $\\xi$ are fixed input for the actor, leading to different policies $\\pi_{\\omega}(\\cdot|s,\\xi)$ . The final outcomes demonstrate the partition of returns corresponding to the policies with different $\\xi$ . Furthermore, the magnitude of the gap increases as the offilne dataset includes samples from more diverse behavior policies. These observations provide strong evidence for the success of A2PO disentangling the behavior policies under the multi-quality dataset. ", "page_idx": 7}, {"type": "image", "img_path": "hYjRmGqq5e/tmp/6bb36351811ab5d3d8db3ae549f5f922adf4d441a895c02978829badf22e2993.jpg", "img_caption": ["Figure 5: Visualization of A2PO latent representation after applying PCA with different advantage conditions and actual returns in the walker2d-medium-replay and hopper-medium-replay tasks. Each data point indicates a latent representation $\\tilde{z}$ based on the initial state and different advantage conditions sampled uniformly from $[-1,1]$ . The actual return is measured under the corresponding sampled advantage condition. The value magnitude is indicated with varying shades of color. "], "img_footnote": [], "page_idx": 7}, {"type": "text", "text": "5.4 Visualization ", "text_level": 1, "page_idx": 8}, {"type": "text", "text": "Figure 5 presents the visualization of A2PO latent representation. The uniformly sampled advantage condition $\\xi$ combined with the initial state $s$ , are fed into the actor-network to get the latent representation generated by the final layer of the actor. The result demonstrates that the representations converge according to the advantage and the actual return. Moreover, upon comparing Figure 5(a,b), as well as Figure 5(c,d) separately, we observe that the latent action representation follows the same alteration pattern based on the actual real return. These observations demonstrate that our advantage-aware policy effectively capture policies with different returns by the designated advantage input $\\xi$ . This provides compelling evidence for the efficacy of the A2PO policy construction. More experiments of advantage estimation conducted on different tasks and datasets are presented in Appendix I. ", "page_idx": 8}, {"type": "text", "text": "5.5 Robustness ", "text_level": 1, "page_idx": 8}, {"type": "text", "text": "Figure 6 presents the experimental results of A2PO across mixed-quality datasets with varying proportions of single-quality samples. Following the methodology of [15, 16], we evaluate the effectiveness of A2PO on three mixed-quality datasets: medium-expert, randommedium, and random-expert. These datasets consist of a total number of $1\\times10^{6}$ transitions. We vary the proportions $\\sigma$ of higher quality samples and $(1\\!-\\!\\sigma)$ of lower quality samples. The results demonstrate that our A2PO effectively captures and infers high-quality potential behavior policies for proper policy regularization, even with a small proportion of high-quality samples. Additionally, as the $\\sigma$ becomes larger, the variance decreases. Thus, A2PO demonstrates its robustness in handling variations in the proportions of different single-quality samples, guaranteeing consistently high performance. ", "page_idx": 8}, {"type": "image", "img_path": "hYjRmGqq5e/tmp/e22875680384849d2bdb468e8425f9c2a862d62112a202d21e464eacb1d88856.jpg", "img_caption": ["Figure 6: Compare the returns of A2PO under random-expert dataset with different high-quality data proportions $\\sigma$ in the Gym tasks. Detail returns are reported in Appendix $_\\mathrm{H}$ . "], "img_footnote": [], "page_idx": 8}, {"type": "text", "text": "5.6 Time Overhead ", "text_level": 1, "page_idx": 8}, {"type": "text", "text": "We measure the training times of A2PO as well as other baselines, which are presented in Table 7. The experiments are performed on a cluster of 4 A40 GPUs under halfcheetah-medium-expert- $\\nu2$ scenarios for $1\\times10^{6}$ steps. Although the A2PO runtime is longer than the lightweight algorithms like IQL due to CVAE training, our A2PO is more efficient compared to other AW methods such as LAPO and CQL $+\\mathrm{AW}$ . ", "page_idx": 8}, {"type": "image", "img_path": "hYjRmGqq5e/tmp/8d853838c31331d215b1adc3334ecdd86a10bb7ecffa4205a1553364f9750442.jpg", "img_caption": [], "img_footnote": [], "page_idx": 8}, {"type": "text", "text": "6 Conclusion ", "text_level": 1, "page_idx": 8}, {"type": "text", "text": "In this paper, we propose a novel approach, termed as A2PO, to tackle the constraint conflict issue on mixed-quality offline datasets with advantage-aware policy constraints. Specifically, A2PO utilizes a CVAE to effectively disentangle the action distributions associated with various behavior policies. This is achieved by modeling the advantage values of all training data as conditional variables. Consequently, advantage-aware agent policy optimization can be focused on maximizing high advantage values while conforming to the disentangled distribution constraint imposed by the mixed-quality dataset. Experimental results show that A2PO successfully decouples the underlying behavior policies and significantly outperforms advanced offline RL competitors. For our future work, we will extend A2PO to multi-task offilne RL scenarios characterized by a greater diversity of behavior policies and a more prominent constraint conflict issue. ", "page_idx": 8}, {"type": "text", "text": "Limitations. The limitation of A2PO is that it incorporates CVAE during training, which may lead to quite a large time overhead. However, the results presented in Section 5.6 show that the time overhead of A2PO remains reasonably acceptable when compared to other baseline methods. ", "page_idx": 9}, {"type": "text", "text": "7 Acknowledgement ", "text_level": 1, "page_idx": 9}, {"type": "text", "text": "This work was supported in part by the Hangzhou Joint Funds of the Zhejiang Provincial Natural Science Foundation of China under Grant No. LHZSD24F020001, in part by the Fundamental Research Funds for the Central Universities under Grant No. 226-2024-00058, and in part by the Zhejiang Province High-Level Talents Special Support Program \u201cLeading Talent of Technological Innovation of Ten-Thousands Talents Program\" under Grant No. 2022R52046. ", "page_idx": 9}, {"type": "text", "text": "References ", "text_level": 1, "page_idx": 9}, {"type": "text", "text": "[1] Y. Chebotar, Q. Vuong, A. Irpan, K. Hausman, F. Xia, Y. Lu, A. Kumar, T. Yu, A. Herzog, K. Pertsch, et al. Q-transformer: Scalable offline reinforcement learning via autoregressive q-functions. arXiv preprint arXiv:2309.10150, 2023.   \n[2] K. Chen, W. Luo, S. Liu, Y. Wei, Y. Zhou, Y. Qing, Q. Zhang, J. Song, and M. Song. Powerformer: A section-adaptive transformer for power flow adjustment. arXiv preprint arXiv:2401.02771, 2024.   \n[3] L. Chen, K. Lu, A. Rajeswaran, K. Lee, A. Grover, M. Laskin, P. Abbeel, A. Srinivas, and I. Mordatch. Decision transformer: Reinforcement learning via sequence modeling. In Annual Conference on Neural Information Processing Systems, 2021.   \n[4] X. Chen, Z. Zhou, Z. Wang, C. Wang, Y. Wu, and K. Ross. Bail: Best-action imitation learning for batch deep reinforcement learning. In Annual Conference on Neural Information Processing Systems, 2020.   \n[5] X. Chen, A. Ghadirzadeh, T. Yu, J. Wang, A. Y. Gao, W. Li, L. Bin, C. Finn, and C. Zhang. Lapo: Latent-variable advantage-weighted policy optimization for offline reinforcement learning. In Annual Conference on Neural Information Processing Systems, 2022.   \n[6] C. Diehl, T. S. Sievernich, M. Kr\u00fcger, F. Hoffmann, and T. Bertram. Uncertainty-aware modelbased offline reinforcement learning for automated driving. IEEE Robotics and Automation Letters, 8(2):1167\u20131174, 2023.   \n[7] S. Emmons, B. Eysenbach, I. Kostrikov, and S. Levine. Rvs: What is essential for offilne rl via supervised learning? arXiv preprint arXiv:2112.10751, 2021.   \n[8] J. Fu, A. Kumar, O. Nachum, G. Tucker, and S. Levine. D4rl: Datasets for deep data-driven reinforcement learning. arXiv preprint arXiv:2004.07219, 2020.   \n[9] S. Fujimoto and S. S. Gu. A minimalist approach to offilne reinforcement learning. In Annual Conference on Neural Information Processing Systems, 2021.   \n[10] S. Fujimoto, H. Hoof, and D. Meger. Addressing function approximation error in actor-critic methods. In International Conference on Machine Learning, 2018.   \n[11] S. Fujimoto, D. Meger, and D. Precup. Off-policy deep reinforcement learning without exploration. In International Conference on Machine Learning, 2019.   \n[12] C. Gao, C. Wu, M. Cao, R. Kong, Z. Zhang, and Y. Yu. Act: Empowering decision transformer with dynamic programming via advantage conditioning. arXiv preprint arXiv:2309.05915, 2023.   \n[13] K. Ghasemipour, S. S. Gu, and O. Nachum. Why so pessimistic? estimating uncertainties for offline rl through ensembles, and why their independence matters. In Annual Conference on Neural Information Processing Systems, 2022.   \n[14] J. Hong, A. Kumar, and S. Levine. Confidence-conditioned value functions for offilne reinforcement learning. arXiv preprint arXiv:2212.04607, 2022.   \n[15] Z.-W. Hong, P. Agrawal, R. T. d. Combes, and R. Laroche. Harnessing mixed offilne reinforcement learning datasets via trajectory weighting. arXiv preprint arXiv:2306.13085, 2023.   \n[16] Z.-W. Hong, A. Kumar, S. Karnik, A. Bhandwaldar, A. Srivastava, J. Pajarinen, R. Laroche, A. Gupta, and P. Agrawal. Beyond uniform sampling: Offline reinforcement learning with imbalanced datasets. In Annual Conference on Neural Information Processing Systems, 2023.   \n[17] M. O. Karabag and U. Topcu. On the sample complexity of vanilla model-based offline reinforcement learning with dependent samples. arXiv preprint arXiv:2303.04268, 2023.   \n[18] I. Kostrikov, A. Nair, and S. Levine. Offline reinforcement learning with implicit q-learning. arXiv preprint arXiv:2110.06169, 2021.   \n[19] A. Kumar, J. Fu, M. Soh, G. Tucker, and S. Levine. Stabilizing off-policy q-learning via bootstrapping error reduction. In Annual Conference on Neural Information Processing Systems, 2019.   \n[20] A. Kumar, A. Zhou, G. Tucker, and S. Levine. Conservative q-learning for offilne reinforcement learning. In Annual Conference on Neural Information Processing Systems, 2020.   \n[21] S. Levine, A. Kumar, G. Tucker, and J. Fu. Offline reinforcement learning: Tutorial, review, and perspectives on open problems. arXiv preprint arXiv:2005.01643, 2020.   \n[22] T. P. Lillicrap, J. J. Hunt, A. Pritzel, N. Heess, T. Erez, Y. Tassa, D. Silver, and D. Wierstra. Continuous control with deep reinforcement learning. arXiv preprint arXiv:1509.02971, 2015.   \n[23] H. Liu and P. Abbeel. Emergent agentic transformer from chain of hindsight experience. arXiv preprint arXiv:2305.16554, 2023.   \n[24] S. Liu, Y. Qing, S. Xu, H. Wu, J. Zhang, J. Cong, T. Chen, Y. Liu, and M. Song. Curricular subgoals for inverse reinforcement learning. arXiv preprint arXiv:2306.08232, 2023.   \n[25] S. Liu, Y. Zhou, J. Song, T. Zheng, K. Chen, T. Zhu, Z. Feng, and M. Song. Contrastive identityaware learning for multi-agent value decomposition. In Proceedings of the AAAI Conference on Artificial Intelligence, volume 37, pages 11595\u201311603, 2023.   \n[26] S. Liu, W. Luo, Y. Zhou, K. Chen, Q. Zhang, H. Xu, Q. Guo, and M. Song. Transmission interface power flow adjustment: A deep reinforcement learning approach based on multi-task attribution map. IEEE Transactions on Power Systems, 39(2):3324\u20133335, 2024.   \n[27] J. Lyu, X. Ma, X. Li, and Z. Lu. Mildly conservative q-learning for offline reinforcement learning. In Annual Conference on Neural Information Processing Systems, 2022.   \n[28] Y. Mao, C. Wu, X. Chen, H. Hu, J. Jiang, T. Zhou, T. Lv, C. Fan, Z. Hu, Y. Wu, et al. Stylized offline reinforcement learning: Extracting diverse high-quality behaviors from heterogeneous datasets. In International Conference on Learning Representations, 2023.   \n[29] A. Nair, A. Gupta, M. Dalal, and S. Levine. Awac: Accelerating online reinforcement learning with offline datasets. arXiv preprint arXiv:2006.09359, 2020.   \n[30] A. Paszke, S. Gross, F. Massa, A. Lerer, J. Bradbury, G. Chanan, T. Killeen, Z. Lin, N. Gimelshein, L. Antiga, A. Desmaison, A. Kopf, E. Z. Yang, Z. DeVito, M. Raison, A. Tejani, S. Chilamkurthy, B. Steiner, L. Fang, J. Bai, and S. Chintala. Pytorch: An imperative style, high-performance deep learning library. In Annual Conference on Neural Information Processing Systems, 2019.   \n[31] X. B. Peng, A. Kumar, G. Zhang, and S. Levine. Advantage-weighted regression: Simple and scalable off-policy reinforcement learning. arXiv preprint arXiv:1910.00177, 2019.   \n[32] Z. Peng, C. Han, Y. Liu, and Z. Zhou. Weighted policy constraints for offline reinforcement learning. In AAAI Conference on Artificial Intelligence, 2023.   \n[33] D. A. Pomerleau. Efficient training of artificial neural networks for autonomous navigation. Neural Computation, 3(1):88\u201397, 1991.   \n[34] R. F. Prudencio, M. R. Maximo, and E. L. Colombini. A survey on offline reinforcement learning: Taxonomy, review, and open problems. IEEE Transactions on Neural Networks and Learning Systems, 2023.   \n[35] M. L. Puterman. Markov decision processes: discrete stochastic dynamic programming. John Wiley & Sons, 2014.   \n[36] Y. Qing, S. Liu, J. Song, H. Wang, and M. Song. A survey on explainable reinforcement learning: Concepts, algorithms, challenges. arXiv preprint arXiv:2211.06665, 2022.   \n[37] Y. Ran, Y.-C. Li, F. Zhang, Z. Zhang, and Y. Yu. Policy regularization with dataset constraint for offline reinforcement learning. In International Conference on Machine Learning, pages 28701\u201328717. PMLR, 2023.   \n[38] J. Schulman, F. Wolski, P. Dhariwal, A. Radford, and O. Klimov. Proximal policy optimization algorithms. arXiv preprint arXiv:1707.06347, 2017.   \n[39] D. Silver, G. Lever, N. Heess, T. Degris, D. Wierstra, and M. Riedmiller. Deterministic policy gradient algorithms. In International Conference on Machine Learning, 2014.   \n[40] A. Singh, A. Kumar, Q. Vuong, Y. Chebotar, and S. Levine. Offline rl with realistic datasets: Heteroskedasticity and support constraints. arXiv preprint arXiv:2211.01052, 2022.   \n[41] K. Sohn, H. Lee, and X. Yan. Learning structured output representation using deep conditional generative models. In Annual Conference on Neural Information Processing Systems, 2015.   \n[42] R. S. Sutton and A. G. Barto. Reinforcement learning: An introduction. MIT press, 2018.   \n[43] Q. Tian, K. Kuang, F. Liu, and B. Wang. Learning from good trajectories in offilne multi-agent reinforcement learning. In AAAI Conference on Artificial Intelligence, 2023.   \n[44] Q. Vuong, A. Kumar, S. Levine, and Y. Chebotar. Dasco: Dual-generator adversarial support constrained offline reinforcement learning. In Annual Conference on Neural Information Processing Systems, 2022.   \n[45] A. Wagenmaker and A. Pacchiano. Leveraging offilne data in online reinforcement learning. In International Conference on Machine Learning, 2023.   \n[46] S. Wang, Q. Yang, J. Gao, M. G. Lin, H. Chen, L. Wu, N. Jia, S. Song, and G. Huang. Train once, get a family: State-adaptive balances for offline-to-online reinforcement learning. arXiv preprint arXiv:2310.17966, 2023.   \n[47] Z. Wang, J. J. Hunt, and M. Zhou. Diffusion policies as an expressive policy class for offline reinforcement learning. arXiv preprint arXiv:2208.06193, 2022.   \n[48] J. Wu, H. Wu, Z. Qiu, J. Wang, and M. Long. Supported policy optimization for offline reinforcement learning. In Annual Conference on Neural Information Processing Systems, 2022.   \n[49] F. Xu, S. Liu, Y. Qing, Y. Zhou, Y. Wang, and M. Song. Temporal prototype-aware learning for active voltage control on power distribution networks. In ACM SIGKDD Conference on Knowledge Discovery and Data Mining, 2024.   \n[50] H. Xu, L. Jiang, J. Li, Z. Yang, Z. Wang, V. W. K. Chan, and X. Zhan. Offline rl with no ood actions: In-sample learning via implicit value regularization. arXiv preprint arXiv:2303.15810, 2023.   \n[51] T. Yamagata, A. Khalil, and R. Santos-Rodriguez. Q-learning decision transformer: Leveraging dynamic programming for conditional sequence modelling in offline rl. In International Conference on Machine Learning, 2023.   \n[52] J. Yang, X. Chen, S. Wang, and B. Zhang. Model-based offline policy optimization with adversarial network. arXiv preprint arXiv:2309.02157, 2023.   \n[53] T. Yu, G. Thomas, L. Yu, S. Ermon, J. Y. Zou, S. Levine, C. Finn, and T. Ma. Mopo: Modelbased offline policy optimization. In Annual Conference on Neural Information Processing Systems, 2020.   \n[54] Y. Yue, B. Kang, X. Ma, Z. Xu, G. Huang, and S. Yan. Boosting offilne reinforcement learning via data rebalancing. arXiv preprint arXiv:2210.09241, 2022.   \n[55] Q. Zheng, M. Henaff, B. Amos, and A. Grover. Semi-supervised offilne reinforcement learning with action-free trajectories. In International Conference on Machine Learning, 2023.   \n[56] W. Zhou, S. Bajracharya, and D. Held. Plas: Latent action space for offline reinforcement learning. In Conference on Robot Learning, 2021.   \n[57] Y. Zhou, S. Liu, Y. Qing, K. Chen, T. Zheng, Y. Huang, J. Song, and M. Song. Is centralized training with decentralized execution framework centralized enough for marl? arXiv preprint arXiv:2305.17352, 2023.   \n[58] Z. Zhuang, K. Lei, J. Liu, D. Wang, and Y. Guo. Behavior proximal policy optimization. arXiv preprint arXiv:2302.11312, 2023. ", "page_idx": 9}, {"type": "text", "text": "", "page_idx": 10}, {"type": "text", "text": "", "page_idx": 11}, {"type": "text", "text": "", "page_idx": 12}, {"type": "text", "text": "A Pseudocode ", "text_level": 1, "page_idx": 13}, {"type": "text", "text": "To make the proposed A2PO method clearer for readers, the pseudocode is provided in Algorithm 1. ", "page_idx": 13}, {"type": "text", "text": "Algorithm 1 Advantage-Aware Policy Optimization (A2PO) ", "page_idx": 13}, {"type": "text", "text": "Input: offline dataset $\\mathcal{D}$ , CVAE training step $K$ , total training step $T$ , soft update rate $\\tau$ .   \nInitialize: CVAE encoder $q_{\\varphi}$ and decoder $p_{\\psi}$ , actor network $\\pi_{\\omega}$ , critic networks $Q_{\\theta}$ and $V_{\\phi}$ . for $i=1$ to $T$ do Sample random minibatch of transitions $B=\\{(s,a,r,s^{\\prime})\\}\\sim\\mathcal{D}$ . Calculate $\\begin{array}{r}{\\xi=\\operatorname{tanh}(\\operatorname*{min}_{i=1,2}Q_{\\theta_{i}}(s,a)-V_{\\phi}(\\bar{s})),\\xi^{*}=\\mathrm{i},c=s||\\boldsymbol{\\xi},c^{*}=s||\\boldsymbol{\\xi}^{*}.}\\end{array}$ # Behavior Policy Disentangling if $i\\leq K$ then Optimize CVAE encoder $q_{\\varphi}$ and decoder $p_{\\psi}$ according to Eq. 5 as $\\mathcal{L}_{\\mathrm{CVAE}}(\\varphi,\\psi)=-\\mathbb{E}_{\\mathcal{D}}\\left[\\mathbb{E}_{q_{\\varphi}(z|a,c)}\\left[\\mathrm{log}(p_{\\psi}(a|z,c))\\right]+\\alpha\\cdot\\mathrm{KL}\\left[(q_{\\varphi}(z|a,c)\\parallel p(z))\\right]\\right].$ end if # Agent Policy Optimization Optimize critic networks $Q_{\\theta}$ and $V_{\\phi}$ according to Eq. 1 and Eq. 7 as $\\mathcal{L}_{\\mathrm{TD}}(\\theta,\\phi)=\\mathbb{E}_{\\mathrm{\\Phi}_{(s,a,r,s^{\\prime})\\sim\\mathcal{P}_{*}}^{\\mathrm{~\\tiny~(~s,a,r,s^{\\prime})\\sim\\mathcal{P}_{*}}}}\\bigg[\\sum_{i}\\big[r+\\gamma\\operatorname*{min}_{j}Q_{\\hat{\\theta}_{j}}(s^{\\prime},a_{\\xi}^{*})-Q_{\\theta_{i}}(s,a)\\big]^{2}+\\big[r+\\gamma\\operatorname*{min}_{i}Q_{\\hat{\\theta}_{i}}(s^{\\prime},a_{\\xi}^{*})-V_{\\phi}(s)\\big]^{2}\\bigg].$ Optimize actor network $\\pi_{\\omega}$ according to Eq. 8 as $\\begin{array}{r}{\\mathcal{L}_{\\mathrm{AC}}(\\omega)=-\\lambda\\cdot\\mathbb{E}_{\\stackrel{\\tilde{z}\\sim\\sim\\mathcal{D},}{z\\sim\\pi_{\\omega}(\\cdot|\\tilde{z}^{*},c^{*})}}\\left[Q_{\\theta_{1}}(s,a_{\\xi}^{*})\\right]+\\mathbb{E}_{\\stackrel{(s,a)\\sim\\mathcal{D},}{\\tilde{z}\\sim\\pi_{\\omega}(\\cdot|c)},}\\left[(a-a_{\\xi})^{2}\\right].}\\\\ {a_{\\xi\\sim p_{\\psi}(\\cdot|\\tilde{z}^{*},c^{*})}^{*}\\qquad\\qquad\\qquad\\qquad\\qquad a_{\\xi\\sim p_{\\psi}(\\cdot|\\tilde{z},c)}}\\end{array}$ Update the target networks with $\\hat{\\theta}\\leftarrow(1-\\tau)\\hat{\\theta}+\\tau\\theta,\\hat{\\phi}\\leftarrow(1-\\tau)\\hat{\\phi}+\\tau\\phi$ . end for ", "page_idx": 13}, {"type": "text", "text": "B Experiment Details ", "text_level": 1, "page_idx": 13}, {"type": "text", "text": "B.1 Task Abbreviations and Task Versions ", "text_level": 1, "page_idx": 13}, {"type": "text", "text": "In order to improve the readability and conciseness, we adopt abbreviations for the Gym tasks throughout the main text. The corresponding abbreviations for each task are provided in Table 3. For the specific task versions, we use the \u2018-v2\u2019 version for the Gym tasks, the \u2018-v1\u2019 version for the Maze2d tasks, the \u2018-v0\u2019 version for the Antmaze tasks, the \u2018-v0\u2019 version for the Kitchen tasks, the \u2018-v1\u2019 version for the Adroit tasks. ", "page_idx": 13}, {"type": "table", "img_path": "hYjRmGqq5e/tmp/dc57c324ccc8b956379c40cbba07c62a5d9d4250ae57fe3b8ab3824c303d4460.jpg", "table_caption": ["Table 3: The abbreviation of the corresponding Gym task and dataset. "], "table_footnote": [], "page_idx": 13}, {"type": "text", "text": "B.2 Implementation Details ", "text_level": 1, "page_idx": 14}, {"type": "text", "text": "In this section, we provide the implementation details of our experiments. We conducted our experiments using PyTorch 3.8 [30] on a cluster of 4 A40 GPUs.The source code will be made publicly available upon the publication of this paper. ", "page_idx": 14}, {"type": "text", "text": "The critic, actor, and CVAE networks are all constructed using a 2-layer MLP with 256 hidden units. They are updated using the Adam optimizer with a learning rate of $3\\times10^{-4}$ . Additionally, we employ a target critic network with a soft-update rate of $5\\times10^{-3}$ . Following the $\\mathrm{TD}+3\\mathrm{BC}$ approach [9], we incorporate Q normalization, policy noise, and policy clipping during the training process. or the hyperparameter value $\\alpha$ in Q normalization, we adopted the strategy proposed by Wang et al. [47], selecting values of 5.0 and 6.0 for the antmaze-medium/large-diverse tasks respectively to promote robust and stable Q Learning. In contrast, we chose $\\alpha=0.005$ for the kitchen-partial task to facilitate policy regularization. For other tasks, setting $\\alpha\\,=\\,1.0$ yields state-of-the-art results. As for the CVAE step $K$ , 0.2M steps demonstrate sufficient robustness for most tasks, while the optimal settings for the maze2d-umaze/medium tasks are 0.4M and 0.1M steps, respectively. Among the tasks, the continuous form of the advantage signal $\\xi$ , as described in Eq. 4, consistently produces outstanding results across most scenarios. However, the advantage distribution may vary significantly across all the tasks, necessitating the fine-tuning of advantage computation methods based on online evaluations. The maze2d-umaze task requires a discrete form with $\\epsilon=0.1$ . In the case of the maze2d-medium task, we utilize an $\\epsilon$ value of 0.2. For both the maze2d-large and antmaze-umaze tasks, we increase this to $\\epsilon=0.8$ . In contrast, for the kitchen-partial/mixed tasks, we adopt a value of $\\epsilon=0.0$ . Further details on this sensitivity can be found in Section 5.3 and Appendix D. ", "page_idx": 14}, {"type": "text", "text": "Since all of the original papers of other baselines do not provide the complete results of all the tasks, we make implementation of the baselines. The CQL, IQL and MOPO baselines are implemented using the implementations provided at github.com/young-geng/cql, gwthomas/iql-pytorch, and github.com/yihaosun1124/OfflineRL-Kit, respectively. The remaining baselines, including BCQ, CQL, $\\mathrm{TD3+BC}$ , EQL, Diffusion-QL, AWAC, $\\mathrm{{CQL+AW}},$ , and LAPO, are implemented using the original implementations provided by the authors of the respective papers. These implementations can be found at: BCQ github.com/sfujim/BCQ, $\\mathrm{TD3+BC}$ github.com/sfujim/TD3_BC, EQL github.com/ryanxhr/IVR, Diffusion-QL github.com/Zhendong-Wang/DiffusionPolicies-for-Offline-RL, AWAC github.com/rail-berkeley/rlkit/tree/master/examples/awac, CQL+AW github.com/Improbable-AI/harness-offline-rl, and LAPO github.com/pcchenxi/LAPOofflienRL. ", "page_idx": 14}, {"type": "text", "text": "C Additional Comparisons with More Baselines ", "text_level": 1, "page_idx": 14}, {"type": "text", "text": "In this section, we have added the data rebalance baseline ReD [54]; novel policy-constrain baseline PRDC [37] and return-conditioned baselines Decision Transformer and $\\%\\mathrm{BC}$ [3] as the comparison baselines to further evaluate the superiority of our A2PO. The results are illustrated in Table 4. Our A2PO method demonstrates comparable performance to various offline RL methods. While the performance of A2PO is slightly inferior to that of PRDC in the medium and medium-replay dataset, it surpasses all additional baselines in the majority of scenarios. ", "page_idx": 14}, {"type": "text", "text": "D Analysis of Advantage Condition Input for Training ", "text_level": 1, "page_idx": 14}, {"type": "text", "text": "In this section, we provide a full comparison of different advantage condition computing methods for training on Gym tasks in Table 5. These computing methods are thoroughly described in Section 5.3. The A2PO algorithm degenerates into $\\mathrm{TD}3{+}\\mathrm{BC}$ under $\\xi_{\\mathrm{fix}}=1$ , which treats each sample constraint equally with no regard for the differences in the data quality. In this case, it achieves significantly worse performance compared to using varied $\\xi$ values, particularly on the random-expert datasets which highlight the substantial gap between the behavior policies. This observation highlights the potential risks of constraint conflict issues in policy regularization methods. On the other hand, the discrete $\\xi_{\\mathrm{dis}}$ yields slightly inferior performances and larger variances compared to the continuous $\\xi$ , when different threshold values $\\epsilon$ are used. While the $\\xi_{\\mathrm{dis}}$ signals demonstrate more stability, the discretization process fails to accurately capture the advantage value associated with each sampled transition. Consequently, there is a mismatch between the advantage value and the actual sampled transition, which negatively impacts the overall algorithm performance. However, by utilizing the ", "page_idx": 14}, {"type": "text", "text": "Table 4: Test returns of our proposed A2PO and additional baselines on the locomotion tasks. The italic results of the baselines are obtained from the corresponding original paper. ", "page_idx": 15}, {"type": "table", "img_path": "hYjRmGqq5e/tmp/1b2a845b6ea114310a5644de2b7913bf4ac8eac5c1bb4a29dd5f00013ce2dc4c.jpg", "table_caption": [], "table_footnote": [], "page_idx": 15}, {"type": "table", "img_path": "hYjRmGqq5e/tmp/3e9ef7e81f579c35e754c175af526da02ca5a43aea674bb56916d12138b16c14.jpg", "table_caption": ["Table 5: Test returns of our proposed A2PO with different advantage conditions during training. \u00b1 corresponds to one standard deviation of the average evaluation of the performance on 5 random seeds. The performance is measured by the normalized scores at the last training iteration. Bold indicates the best performance in each task. "], "table_footnote": [], "page_idx": 15}, {"type": "text", "text": "continuous advantage value, our A2PO is able to better adapt to the varying environment dynamics and complexities found in the mixed-quality dataset, thereby further getting state-of-the-art performance with low variance. This enables a more precise capture of the relationship between the advantage condition and the disentangled behavior policies. ", "page_idx": 15}, {"type": "text", "text": "E Analysis of Advantage Condition Input for Testing ", "text_level": 1, "page_idx": 15}, {"type": "text", "text": "In this section, we provide a full comparison of different fixed advantage condition inputs for testing on Gym tasks in Table 6 as a supplement for Figure 4. It should be noted that in contrast to the ablation study shown in Appendix D which investigates different methods for computing advantages during CVAE and agent learning, this section utilizes the original continuous advantage computation method. However, the designated $\\xi$ is varied during the testing process. On one hand, the CVAE decoder $p_{\\psi}$ can generate CVAE-approximated behavior policies by varying the input $\\xi$ . On the other hand, Eq. 8 for policy improvement regulates the advantage-aware policy to closely resemble samples from the same advantage condition. This indicates that the quality of the generated action should be positively correlated with the specified action input. The experimental outcomes demonstrate the relationship between varying values of $\\xi$ and the corresponding A2PO policy returns: the agent performance consistently improves as the fixed advantage condition input $\\xi$ increases. Moreover, the gap between the returns increases as the offline dataset includes more diverse behavior policies. These observations serve as strong evidence for the effectiveness of A2PO in effectively disentangling the behavior policies within a multi-quality dataset. ", "page_idx": 15}, {"type": "table", "img_path": "hYjRmGqq5e/tmp/7a546b6edec54b162ea040e8a39f82f9fef5df640c3e99d06e8f83cc4c24e1af.jpg", "table_caption": ["Table 6: Test returns of A2PO with different discrete advantage conditions for test while using the original continuous advantage condition during training. "], "table_footnote": [], "page_idx": 16}, {"type": "text", "text": "", "page_idx": 16}, {"type": "text", "text": "F Analysis of the CVAE Policy ", "text_level": 1, "page_idx": 16}, {"type": "text", "text": "The CVAE policy corresponds to the CVAE decoder $p_{\\psi}(a|z_{0},c^{*})$ , where $z_{0}$ is sampled from $\\mathcal{N}(0,1)$ ,and $c^{*}=\\,s\\,||\\,\\xi^{*}$ . As described in Section 4.1, the advantage-aware CVAE utilizes the advantage condition computed by the agent critic to construct the ELBO loss, which is formulated as advantage-guided supervised learning [12]. The CVAE decoder $p_{\\psi}(a|z_{0},c^{*})$ generates action outputs of varying qualities based on the target advantage input signal $\\xi$ . By conditioning on the maximum normalized advantage value $\\xi^{*}$ to get the optimal action of CVAE and agent policy, we present thorough comparison results of the CVAE policy and agent policy in Table 7. The performance of the CVAE policy indicates that it only demonstrates superior performance in a limited set of tasks and datasets, specifically the hopper-random and walker2d-random environments. The A2PO agent consistently outperforms the CVAE agent in the majority of cases. This performance gap is particularly significant in the newly constructed mix-quality datasets including random-expert and random-medium-expert highlighting the confilct issue. These findings suggest that A2PO achieves well-disentangled behavior policies and an optimal agent policy, surpassing the capabilities of CVAE-reconstructed behavior policies. ", "page_idx": 16}, {"type": "text", "text": "G Analysis of A2PO Policy Optimization ", "text_level": 1, "page_idx": 16}, {"type": "text", "text": "In this section, we evaluate the effectiveness of the policy regularization term within the policy improvement step as shown in Equation 8. Previous approaches [56, 5] that construct agent policies within the CVAE latent space do not incorporate the BC regularization term, as the latent action space inherently imposes constraints on the action outputs. In contrast, our advantage-aware policy integrates the BC term into the actor loss to explicitly ensure appropriate pessimism. Meanwhile, to guarantee the policy action outputs are consistent with the advantage condition $\\xi$ , we develop a variant of A2PO, designated $\\mathrm{A}2\\mathrm{PO}[a_{\\mathrm{cvae}}^{*}]$ , which constrains the agent output to the optimal CVAE policy $p_{\\psi}(\\cdot|z_{0}\\sim\\mathcal{N}(0,\\bar{I}),c^{*})$ . Unlike this variant, the original A2PO utilizes the MSE loss to align the agent action output $\\pi(\\cdot|\\tilde{z}^{*},c^{*})$ with the sampled action $a$ . To assess the impact of our A2PO architecture and the BC regularization, we conduct an ablation study by comparing the results of different A2PO variants and LAPO, as demonstrated in Table 8. The results indicate that even without the BC regularization term, A2PO consistently outperforms LAPO in most tasks. Furthermore, the original formulation of the BC term in the main text can enhance performance in most cases. This comparison highlights the superior performance achieved by A2PO, showcasing its effective disentanglement of action distributions from different behavior policies to enforce a reasonable advantage-aware policy constraint and obtain an optimal agent policy. ", "page_idx": 16}, {"type": "table", "img_path": "hYjRmGqq5e/tmp/1d222a48a22b95b18aa19b5a49f4f6651dc791c23c1abffa196e4794dabcbd9e.jpg", "table_caption": ["Table 7: Test returns of A2PO with CVAE policy or agent policy. "], "table_footnote": [], "page_idx": 17}, {"type": "text", "text": "", "page_idx": 17}, {"type": "text", "text": "H Analysis of A2PO Under Mixed-quality Dataset with Different Proportion ", "text_level": 1, "page_idx": 17}, {"type": "text", "text": "In this section, we conducted additional experiments to assess the robustness of A2PO under various mixed-quality datasets. The mixed datasets consist of a fixed number of $1\\times10^{6}$ offline samples. These datasets are generated by combining $\\sigma$ of either an expert or medium dataset (high-return) and $1-\\sigma$ of a random or medium dataset (low-return). The quantitative results are presented in Table 9. The results demonstrate that our A2PO algorithm is capable of achieving expert-level performance even with a limited number of high-quality samples. Moreover, as the proportion $\\sigma$ increases, the A2PO policy becomes more stable. These results indicate the robustness and effectiveness of our A2PO algorithm in deriving optimal policies across diverse structures of offline datasets. ", "page_idx": 17}, {"type": "text", "text": "I Advantage Visualization ", "text_level": 1, "page_idx": 17}, {"type": "text", "text": "In this section, we illustrate the distribution of initial state-action pairs in offilne datasets across various tasks, along with the corresponding actual return and estimated advantage values. Figure 8 and 9 present a comparative analysis of the actual return, LAPO, and our A2PO advantage approximation. The findings indicate that LAPO exhibits limited discrimination in assessing transition advantages, while A2PO effectively distinguishes between transitions of varying data quality. These results underscore the limitations of the AW method and highlight the superiority of our A2PO approach. ", "page_idx": 17}, {"type": "table", "img_path": "hYjRmGqq5e/tmp/d0be659b0ea1e253f778e2c066395b9865a1241520b06e8872f199efe2f179d9.jpg", "table_caption": ["Table 8: Test returns of LAPO, A2PO and its variants in relation to policy regularization. "], "table_footnote": [], "page_idx": 18}, {"type": "text", "text": "", "page_idx": 18}, {"type": "text", "text": "J Boarder Impact ", "text_level": 1, "page_idx": 18}, {"type": "text", "text": "This paper presents an offline advantage-aware learning approach that leverages the estimated advantage condition to deal with mixed-quality datasets. The advantage-aware concept brings a new perspective to the solution of real-world RL tasks, facilitating a more practical and effective utilization of the offline datasets. It has the potential to enhance the robustness of the agent towards the varying offilne datasets from real-world RL scenarios, where the pre-collected offilne datasets are noisy and often not as well-organized as the D4RL standardized datasets. ", "page_idx": 18}, {"type": "text", "text": "Table 9: Test returns of A2PO under random-expert dataset with different component proportions $\\sigma$ in the Gym tasks. The datasets consist of $1\\times10^{\\bar{6}}$ samples, where $\\sigma$ of the samples originate from the expert dataset and the remaining $1-\\sigma$ of the samples come from the random dataset. ", "page_idx": 18}, {"type": "table", "img_path": "hYjRmGqq5e/tmp/d29d1b8fa90a903aefa1f8cb5d206a6480e1ce5755f68fb45369957e0e695fb2.jpg", "table_caption": [], "table_footnote": [], "page_idx": 18}, {"type": "image", "img_path": "hYjRmGqq5e/tmp/1c8ca7c9a6e95d3a44e7a87ed679460c73ecdf73c6dfe572f046a85209ebe187.jpg", "img_caption": ["Figure 8: Comparison of our proposed A2PO method and the recent advanced AW method (LAPO) in advantage estimation for mixed-quality offilne datasets (random-expert) in Gym tasks. Each data point represents an initial state-action pair in the offline dataset after applying PCA while varying shades of color indicate the magnitude of the actual return or advantage value. "], "img_footnote": [], "page_idx": 19}, {"type": "image", "img_path": "hYjRmGqq5e/tmp/824247a324373c67ec5c16a7699f21c44625cc13837b341f6306ccfd2ba26e35.jpg", "img_caption": ["Figure 9: Comparison of our proposed A2PO method and the recent advanced AW method (LAPO) in advantage estimation for mixed-quality offline datasets (random-medium-expert) in locomotion tasks. Each data point represents an initial state-action pair in the offilne dataset after applying PCA while varying shades of color indicate the magnitude of the actual return or advantage value. "], "img_footnote": [], "page_idx": 20}, {"type": "text", "text": "NeurIPS Paper Checklist ", "text_level": 1, "page_idx": 21}, {"type": "text", "text": "1. Claims ", "text_level": 1, "page_idx": 21}, {"type": "text", "text": "Question: Do the main claims made in the abstract and introduction accurately reflect the paper\u2019s contributions and scope? ", "page_idx": 21}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 21}, {"type": "text", "text": "Justification: See abstract. ", "page_idx": 21}, {"type": "text", "text": "Guidelines: ", "page_idx": 21}, {"type": "text", "text": "\u2022 The answer NA means that the abstract and introduction do not include the claims made in the paper.   \n\u2022 The abstract and/or introduction should clearly state the claims made, including the contributions made in the paper and important assumptions and limitations. A No or NA answer to this question will not be perceived well by the reviewers.   \n\u2022 The claims made should match theoretical and experimental results, and reflect how much the results can be expected to generalize to other settings.   \n\u2022 It is fine to include aspirational goals as motivation as long as it is clear that these goals are not attained by the paper. ", "page_idx": 21}, {"type": "text", "text": "2. Limitations ", "text_level": 1, "page_idx": 21}, {"type": "text", "text": "Question: Does the paper discuss the limitations of the work performed by the authors? ", "page_idx": 21}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 21}, {"type": "text", "text": "Justification: See Section 6. ", "page_idx": 21}, {"type": "text", "text": "Guidelines: ", "page_idx": 21}, {"type": "text", "text": "\u2022 The answer NA means that the paper has no limitation while the answer No means that the paper has limitations, but those are not discussed in the paper.   \n\u2022 The authors are encouraged to create a separate \"Limitations\" section in their paper.   \n\u2022 The paper should point out any strong assumptions and how robust the results are to violations of these assumptions (e.g., independence assumptions, noiseless settings, model well-specification, asymptotic approximations only holding locally). The authors should reflect on how these assumptions might be violated in practice and what the implications would be.   \n\u2022 The authors should reflect on the scope of the claims made, e.g., if the approach was only tested on a few datasets or with a few runs. In general, empirical results often depend on implicit assumptions, which should be articulated.   \n\u2022 The authors should reflect on the factors that influence the performance of the approach. For example, a facial recognition algorithm may perform poorly when image resolution is low or images are taken in low lighting. Or a speech-to-text system might not be used reliably to provide closed captions for online lectures because it fails to handle technical jargon.   \n\u2022 The authors should discuss the computational efficiency of the proposed algorithms and how they scale with dataset size.   \n\u2022 If applicable, the authors should discuss possible limitations of their approach to address problems of privacy and fairness.   \n\u2022 While the authors might fear that complete honesty about limitations might be used by reviewers as grounds for rejection, a worse outcome might be that reviewers discover limitations that aren\u2019t acknowledged in the paper. The authors should use their best judgment and recognize that individual actions in favor of transparency play an important role in developing norms that preserve the integrity of the community. Reviewers will be specifically instructed to not penalize honesty concerning limitations. ", "page_idx": 21}, {"type": "text", "text": "3. Theory Assumptions and Proofs ", "text_level": 1, "page_idx": 21}, {"type": "text", "text": "Question: For each theoretical result, does the paper provide the full set of assumptions and a complete (and correct) proof? ", "page_idx": 21}, {"type": "text", "text": "Answer: [NA] ", "page_idx": 21}, {"type": "text", "text": "Justification: ", "page_idx": 22}, {"type": "text", "text": "Guidelines: ", "page_idx": 22}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not include theoretical results.   \n\u2022 All the theorems, formulas, and proofs in the paper should be numbered and crossreferenced.   \n\u2022 All assumptions should be clearly stated or referenced in the statement of any theorems.   \n\u2022 The proofs can either appear in the main paper or the supplemental material, but if they appear in the supplemental material, the authors are encouraged to provide a short proof sketch to provide intuition.   \n\u2022 Inversely, any informal proof provided in the core of the paper should be complemented by formal proofs provided in appendix or supplemental material.   \n\u2022 Theorems and Lemmas that the proof relies upon should be properly referenced. ", "page_idx": 22}, {"type": "text", "text": "4. Experimental Result Reproducibility ", "text_level": 1, "page_idx": 22}, {"type": "text", "text": "Question: Does the paper fully disclose all the information needed to reproduce the main experimental results of the paper to the extent that it affects the main claims and/or conclusions of the paper (regardless of whether the code and data are provided or not)? ", "page_idx": 22}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 22}, {"type": "text", "text": "Justification: See Appendix B Guidelines: ", "page_idx": 22}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not include experiments.   \n\u2022 If the paper includes experiments, a No answer to this question will not be perceived well by the reviewers: Making the paper reproducible is important, regardless of whether the code and data are provided or not.   \n\u2022 If the contribution is a dataset and/or model, the authors should describe the steps taken to make their results reproducible or verifiable.   \n\u2022 Depending on the contribution, reproducibility can be accomplished in various ways. For example, if the contribution is a novel architecture, describing the architecture fully might suffice, or if the contribution is a specific model and empirical evaluation, it may be necessary to either make it possible for others to replicate the model with the same dataset, or provide access to the model. In general. releasing code and data is often one good way to accomplish this, but reproducibility can also be provided via detailed instructions for how to replicate the results, access to a hosted model (e.g., in the case of a large language model), releasing of a model checkpoint, or other means that are appropriate to the research performed.   \n\u2022 While NeurIPS does not require releasing code, the conference does require all submissions to provide some reasonable avenue for reproducibility, which may depend on the nature of the contribution. For example (a) If the contribution is primarily a new algorithm, the paper should make it clear how to reproduce that algorithm. (b) If the contribution is primarily a new model architecture, the paper should describe the architecture clearly and fully. (c) If the contribution is a new model (e.g., a large language model), then there should either be a way to access this model for reproducing the results or a way to reproduce the model (e.g., with an open-source dataset or instructions for how to construct the dataset). (d) We recognize that reproducibility may be tricky in some cases, in which case authors are welcome to describe the particular way they provide for reproducibility. In the case of closed-source models, it may be that access to the model is limited in some way (e.g., to registered users), but it should be possible for other researchers to have some path to reproducing or verifying the results. ", "page_idx": 22}, {"type": "text", "text": "5. Open access to data and code ", "text_level": 1, "page_idx": 22}, {"type": "text", "text": "Question: Does the paper provide open access to the data and code, with sufficient instructions to faithfully reproduce the main experimental results, as described in supplemental material? ", "page_idx": 22}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 23}, {"type": "text", "text": "Justification: See supplemental material. Guidelines: ", "page_idx": 23}, {"type": "text", "text": "\u2022 The answer NA means that paper does not include experiments requiring code.   \n\u2022 Please see the NeurIPS code and data submission guidelines (https://nips.cc/ public/guides/CodeSubmissionPolicy) for more details.   \n\u2022 While we encourage the release of code and data, we understand that this might not be possible, so \u201cNo\u201d is an acceptable answer. Papers cannot be rejected simply for not including code, unless this is central to the contribution (e.g., for a new open-source benchmark).   \n\u2022 The instructions should contain the exact command and environment needed to run to reproduce the results. See the NeurIPS code and data submission guidelines (https: //nips.cc/public/guides/CodeSubmissionPolicy) for more details.   \n\u2022 The authors should provide instructions on data access and preparation, including how to access the raw data, preprocessed data, intermediate data, and generated data, etc.   \n\u2022 The authors should provide scripts to reproduce all experimental results for the new proposed method and baselines. If only a subset of experiments are reproducible, they should state which ones are omitted from the script and why.   \n\u2022 At submission time, to preserve anonymity, the authors should release anonymized versions (if applicable).   \n\u2022 Providing as much information as possible in supplemental material (appended to the paper) is recommended, but including URLs to data and code is permitted. ", "page_idx": 23}, {"type": "text", "text": "6. Experimental Setting/Details ", "text_level": 1, "page_idx": 23}, {"type": "text", "text": "Question: Does the paper specify all the training and test details (e.g., data splits, hyperparameters, how they were chosen, type of optimizer, etc.) necessary to understand the results? ", "page_idx": 23}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 23}, {"type": "text", "text": "Justification: See Appendix B Guidelines: ", "page_idx": 23}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not include experiments. \u2022 The experimental setting should be presented in the core of the paper to a level of detail that is necessary to appreciate the results and make sense of them. \u2022 The full details can be provided either with the code, in appendix, or as supplemental material. ", "page_idx": 23}, {"type": "text", "text": "7. Experiment Statistical Significance ", "text_level": 1, "page_idx": 23}, {"type": "text", "text": "Question: Does the paper report error bars suitably and correctly defined or other appropriate information about the statistical significance of the experiments? ", "page_idx": 23}, {"type": "text", "text": "Answer: [Yes] ", "text_level": 1, "page_idx": 23}, {"type": "text", "text": "Justification: See Section 5. Guidelines: ", "page_idx": 23}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not include experiments.   \n\u2022 The authors should answer \"Yes\" if the results are accompanied by error bars, confidence intervals, or statistical significance tests, at least for the experiments that support the main claims of the paper.   \n\u2022 The factors of variability that the error bars are capturing should be clearly stated (for example, train/test split, initialization, random drawing of some parameter, or overall run with given experimental conditions).   \n\u2022 The method for calculating the error bars should be explained (closed form formula, call to a library function, bootstrap, etc.)   \n\u2022 The assumptions made should be given (e.g., Normally distributed errors).   \n\u2022 It should be clear whether the error bar is the standard deviation or the standard error of the mean.   \n\u2022 It is OK to report 1-sigma error bars, but one should state it. The authors should preferably report a 2-sigma error bar than state that they have a $96\\%$ CI, if the hypothesis of Normality of errors is not verified.   \n\u2022 For asymmetric distributions, the authors should be careful not to show in tables or figures symmetric error bars that would yield results that are out of range (e.g. negative error rates).   \n\u2022 If error bars are reported in tables or plots, The authors should explain in the text how they were calculated and reference the corresponding figures or tables in the text. ", "page_idx": 23}, {"type": "text", "text": "", "page_idx": 24}, {"type": "text", "text": "8. Experiments Compute Resources ", "text_level": 1, "page_idx": 24}, {"type": "text", "text": "Question: For each experiment, does the paper provide sufficient information on the computer resources (type of compute workers, memory, time of execution) needed to reproduce the experiments? ", "page_idx": 24}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 24}, {"type": "text", "text": "Justification: See Appendix B. Guidelines: ", "page_idx": 24}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not include experiments.   \n\u2022 The paper should indicate the type of compute workers CPU or GPU, internal cluster, or cloud provider, including relevant memory and storage.   \n\u2022 The paper should provide the amount of compute required for each of the individual experimental runs as well as estimate the total compute.   \n\u2022 The paper should disclose whether the full research project required more compute than the experiments reported in the paper (e.g., preliminary or failed experiments that didn\u2019t make it into the paper). ", "page_idx": 24}, {"type": "text", "text": "9. Code Of Ethics ", "text_level": 1, "page_idx": 24}, {"type": "text", "text": "Question: Does the research conducted in the paper conform, in every respect, with the NeurIPS Code of Ethics https://neurips.cc/public/EthicsGuidelines? ", "page_idx": 24}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 24}, {"type": "text", "text": "Justification: See supplemental material. Guidelines: ", "page_idx": 24}, {"type": "text", "text": "\u2022 The answer NA means that the authors have not reviewed the NeurIPS Code of Ethics.   \n\u2022 If the authors answer No, they should explain the special circumstances that require a deviation from the Code of Ethics.   \n\u2022 The authors should make sure to preserve anonymity (e.g., if there is a special consideration due to laws or regulations in their jurisdiction). ", "page_idx": 24}, {"type": "text", "text": "10. Broader Impacts ", "text_level": 1, "page_idx": 24}, {"type": "text", "text": "Question: Does the paper discuss both potential positive societal impacts and negative societal impacts of the work performed? ", "page_idx": 24}, {"type": "text", "text": "Answer: [Yes] ", "page_idx": 24}, {"type": "text", "text": "Justification: See Appendix J. ", "page_idx": 24}, {"type": "text", "text": "Guidelines: ", "page_idx": 24}, {"type": "text", "text": "\u2022 The answer NA means that there is no societal impact of the work performed.   \n\u2022 If the authors answer NA or No, they should explain why their work has no societal impact or why the paper does not address societal impact.   \n\u2022 Examples of negative societal impacts include potential malicious or unintended uses (e.g., disinformation, generating fake profiles, surveillance), fairness considerations (e.g., deployment of technologies that could make decisions that unfairly impact specific groups), privacy considerations, and security considerations.   \n\u2022 The conference expects that many papers will be foundational research and not tied to particular applications, let alone deployments. However, if there is a direct path to any negative applications, the authors should point it out. For example, it is legitimate to point out that an improvement in the quality of generative models could be used to ", "page_idx": 24}, {"type": "text", "text": "generate deepfakes for disinformation. On the other hand, it is not needed to point out that a generic algorithm for optimizing neural networks could enable people to train models that generate Deepfakes faster. ", "page_idx": 25}, {"type": "text", "text": "\u2022 The authors should consider possible harms that could arise when the technology is being used as intended and functioning correctly, harms that could arise when the technology is being used as intended but gives incorrect results, and harms following from (intentional or unintentional) misuse of the technology. \u2022 If there are negative societal impacts, the authors could also discuss possible mitigation strategies (e.g., gated release of models, providing defenses in addition to attacks, mechanisms for monitoring misuse, mechanisms to monitor how a system learns from feedback over time, improving the efficiency and accessibility of ML). ", "page_idx": 25}, {"type": "text", "text": "11. Safeguards ", "text_level": 1, "page_idx": 25}, {"type": "text", "text": "Question: Does the paper describe safeguards that have been put in place for responsible release of data or models that have a high risk for misuse (e.g., pretrained language models, image generators, or scraped datasets)? ", "page_idx": 25}, {"type": "text", "text": "Answer: [NA] ", "page_idx": 25}, {"type": "text", "text": "Justification: ", "page_idx": 25}, {"type": "text", "text": "Guidelines: ", "page_idx": 25}, {"type": "text", "text": "\u2022 The answer NA means that the paper poses no such risks.   \n\u2022 Released models that have a high risk for misuse or dual-use should be released with necessary safeguards to allow for controlled use of the model, for example by requiring that users adhere to usage guidelines or restrictions to access the model or implementing safety filters.   \n\u2022 Datasets that have been scraped from the Internet could pose safety risks. The authors should describe how they avoided releasing unsafe images.   \n\u2022 We recognize that providing effective safeguards is challenging, and many papers do not require this, but we encourage authors to take this into account and make a best faith effort. ", "page_idx": 25}, {"type": "text", "text": "12. Licenses for existing assets ", "text_level": 1, "page_idx": 25}, {"type": "text", "text": "Question: Are the creators or original owners of assets (e.g., code, data, models), used in the paper, properly credited and are the license and terms of use explicitly mentioned and properly respected? ", "page_idx": 25}, {"type": "text", "text": "Answer: [NA] ", "page_idx": 25}, {"type": "text", "text": "Justification: Guidelines: ", "page_idx": 25}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not use existing assets.   \n\u2022 The authors should cite the original paper that produced the code package or dataset.   \n\u2022 The authors should state which version of the asset is used and, if possible, include a URL.   \n\u2022 The name of the license (e.g., CC-BY 4.0) should be included for each asset.   \n\u2022 For scraped data from a particular source (e.g., website), the copyright and terms of service of that source should be provided.   \n\u2022 If assets are released, the license, copyright information, and terms of use in the package should be provided. For popular datasets, paperswithcode.com/datasets has curated licenses for some datasets. Their licensing guide can help determine the license of a dataset.   \n\u2022 For existing datasets that are re-packaged, both the original license and the license of the derived asset (if it has changed) should be provided.   \n\u2022 If this information is not available online, the authors are encouraged to reach out to the asset\u2019s creators. ", "page_idx": 25}, {"type": "text", "text": "13. New Assets ", "text_level": 1, "page_idx": 25}, {"type": "text", "text": "Question: Are new assets introduced in the paper well documented and is the documentation provided alongside the assets? ", "page_idx": 25}, {"type": "text", "text": "Answer: [NA] Justification: Guidelines: ", "page_idx": 26}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not release new assets.   \n\u2022 Researchers should communicate the details of the dataset/code/model as part of their submissions via structured templates. This includes details about training, license, limitations, etc.   \n\u2022 The paper should discuss whether and how consent was obtained from people whose asset is used.   \n\u2022 At submission time, remember to anonymize your assets (if applicable). You can either create an anonymized URL or include an anonymized zip file. ", "page_idx": 26}, {"type": "text", "text": "14. Crowdsourcing and Research with Human Subjects ", "text_level": 1, "page_idx": 26}, {"type": "text", "text": "Question: For crowdsourcing experiments and research with human subjects, does the paper include the full text of instructions given to participants and screenshots, if applicable, as well as details about compensation (if any)? ", "page_idx": 26}, {"type": "text", "text": "Answer: [NA] Justification: Guidelines: ", "page_idx": 26}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not involve crowdsourcing nor research with human subjects.   \n\u2022 Including this information in the supplemental material is fine, but if the main contribution of the paper involves human subjects, then as much detail as possible should be included in the main paper.   \n\u2022 According to the NeurIPS Code of Ethics, workers involved in data collection, curation, or other labor should be paid at least the minimum wage in the country of the data collector. ", "page_idx": 26}, {"type": "text", "text": "15. Institutional Review Board (IRB) Approvals or Equivalent for Research with Human Subjects ", "page_idx": 26}, {"type": "text", "text": "Question: Does the paper describe potential risks incurred by study participants, whether such risks were disclosed to the subjects, and whether Institutional Review Board (IRB) approvals (or an equivalent approval/review based on the requirements of your country or institution) were obtained? ", "page_idx": 26}, {"type": "text", "text": "Answer: [NA] Justification: Guid ", "page_idx": 26}, {"type": "text", "text": "\u2022 The answer NA means that the paper does not involve crowdsourcing nor research with human subjects.   \n\u2022 Depending on the country in which research is conducted, IRB approval (or equivalent) may be required for any human subjects research. If you obtained IRB approval, you should clearly state this in the paper.   \n\u2022 We recognize that the procedures for this may vary significantly between institutions and locations, and we expect authors to adhere to the NeurIPS Code of Ethics and the guidelines for their institution.   \n\u2022 For initial submissions, do not include any information that would break anonymity (if applicable), such as the institution conducting the review. ", "page_idx": 26}]